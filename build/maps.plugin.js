!function(root,factory){"object"==typeof exports&&"object"==typeof module?module.exports=factory():"function"==typeof define&&define.amd?define([],factory):"object"==typeof exports?exports["perspective-viewer-maps"]=factory():root["perspective-viewer-maps"]=factory()}(window,function(){return function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={i:moduleId,l:!1,exports:{}};return modules[moduleId].call(module.exports,module,module.exports,__webpack_require__),module.l=!0,module.exports}return __webpack_require__.m=modules,__webpack_require__.c=installedModules,__webpack_require__.d=function(exports,name,getter){__webpack_require__.o(exports,name)||Object.defineProperty(exports,name,{enumerable:!0,get:getter})},__webpack_require__.r=function(exports){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(exports,"__esModule",{value:!0})},__webpack_require__.t=function(value,mode){if(1&mode&&(value=__webpack_require__(value)),8&mode)return value;if(4&mode&&"object"==typeof value&&value&&value.__esModule)return value;var ns=Object.create(null);if(__webpack_require__.r(ns),Object.defineProperty(ns,"default",{enumerable:!0,value:value}),2&mode&&"string"!=typeof value)for(var key in value)__webpack_require__.d(ns,key,function(key){return value[key]}.bind(null,key));return ns},__webpack_require__.n=function(module){var getter=module&&module.__esModule?function(){return module.default}:function(){return module};return __webpack_require__.d(getter,"a",getter),getter},__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)},__webpack_require__.p="",__webpack_require__(__webpack_require__.s=83)}([function(module,exports,__webpack_require__){var store=__webpack_require__(23)("wks"),uid=__webpack_require__(18),Symbol=__webpack_require__(2).Symbol,USE_SYMBOL="function"==typeof Symbol;(module.exports=function(name){return store[name]||(store[name]=USE_SYMBOL&&Symbol[name]||(USE_SYMBOL?Symbol:uid)("Symbol."+name))}).store=store},function(module,exports,__webpack_require__){var global=__webpack_require__(2),core=__webpack_require__(11),hide=__webpack_require__(8),redefine=__webpack_require__(9),ctx=__webpack_require__(12),$export=function(type,name,source){var key,own,out,exp,IS_FORCED=type&$export.F,IS_GLOBAL=type&$export.G,IS_STATIC=type&$export.S,IS_PROTO=type&$export.P,IS_BIND=type&$export.B,target=IS_GLOBAL?global:IS_STATIC?global[name]||(global[name]={}):(global[name]||{}).prototype,exports=IS_GLOBAL?core:core[name]||(core[name]={}),expProto=exports.prototype||(exports.prototype={});for(key in IS_GLOBAL&&(source=name),source)out=((own=!IS_FORCED&&target&&void 0!==target[key])?target:source)[key],exp=IS_BIND&&own?ctx(out,global):IS_PROTO&&"function"==typeof out?ctx(Function.call,out):out,target&&redefine(target,key,out,type&$export.U),exports[key]!=out&&hide(exports,key,exp),IS_PROTO&&expProto[key]!=out&&(expProto[key]=out)};global.core=core,$export.F=1,$export.G=2,$export.S=4,$export.P=8,$export.B=16,$export.W=32,$export.U=64,$export.R=128,module.exports=$export},function(module,exports){var global=module.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=global)},function(module,exports,__webpack_require__){var isObject=__webpack_require__(4);module.exports=function(it){if(!isObject(it))throw TypeError(it+" is not an object!");return it}},function(module,exports){module.exports=function(it){return"object"==typeof it?null!==it:"function"==typeof it}},function(module,exports){module.exports=function(exec){try{return!!exec()}catch(e){return!0}}},function(module,exports,__webpack_require__){module.exports=!__webpack_require__(5)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(module,exports,__webpack_require__){var anObject=__webpack_require__(3),IE8_DOM_DEFINE=__webpack_require__(50),toPrimitive=__webpack_require__(33),dP=Object.defineProperty;exports.f=__webpack_require__(6)?Object.defineProperty:function(O,P,Attributes){if(anObject(O),P=toPrimitive(P,!0),anObject(Attributes),IE8_DOM_DEFINE)try{return dP(O,P,Attributes)}catch(e){}if("get"in Attributes||"set"in Attributes)throw TypeError("Accessors not supported!");return"value"in Attributes&&(O[P]=Attributes.value),O}},function(module,exports,__webpack_require__){var dP=__webpack_require__(7),createDesc=__webpack_require__(22);module.exports=__webpack_require__(6)?function(object,key,value){return dP.f(object,key,createDesc(1,value))}:function(object,key,value){return object[key]=value,object}},function(module,exports,__webpack_require__){var global=__webpack_require__(2),hide=__webpack_require__(8),has=__webpack_require__(10),SRC=__webpack_require__(18)("src"),$toString=__webpack_require__(86),TPL=(""+$toString).split("toString");__webpack_require__(11).inspectSource=function(it){return $toString.call(it)},(module.exports=function(O,key,val,safe){var isFunction="function"==typeof val;isFunction&&(has(val,"name")||hide(val,"name",key)),O[key]!==val&&(isFunction&&(has(val,SRC)||hide(val,SRC,O[key]?""+O[key]:TPL.join(String(key)))),O===global?O[key]=val:safe?O[key]?O[key]=val:hide(O,key,val):(delete O[key],hide(O,key,val)))})(Function.prototype,"toString",function(){return"function"==typeof this&&this[SRC]||$toString.call(this)})},function(module,exports){var hasOwnProperty={}.hasOwnProperty;module.exports=function(it,key){return hasOwnProperty.call(it,key)}},function(module,exports){var core=module.exports={version:"2.6.5"};"number"==typeof __e&&(__e=core)},function(module,exports,__webpack_require__){var aFunction=__webpack_require__(13);module.exports=function(fn,that,length){if(aFunction(fn),void 0===that)return fn;switch(length){case 1:return function(a){return fn.call(that,a)};case 2:return function(a,b){return fn.call(that,a,b)};case 3:return function(a,b,c){return fn.call(that,a,b,c)}}return function(){return fn.apply(that,arguments)}}},function(module,exports){module.exports=function(it){if("function"!=typeof it)throw TypeError(it+" is not a function!");return it}},function(module,exports){var toString={}.toString;module.exports=function(it){return toString.call(it).slice(8,-1)}},function(module,exports,__webpack_require__){var $keys=__webpack_require__(53),enumBugKeys=__webpack_require__(40);module.exports=Object.keys||function(O){return $keys(O,enumBugKeys)}},function(module,exports,__webpack_require__){var IObject=__webpack_require__(36),defined=__webpack_require__(25);module.exports=function(it){return IObject(defined(it))}},function(module,exports,__webpack_require__){"use strict";module.exports=rbush,module.exports.default=rbush;var quickselect=__webpack_require__(120);function rbush(maxEntries,format){if(!(this instanceof rbush))return new rbush(maxEntries,format);this._maxEntries=Math.max(4,maxEntries||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),format&&this._initFormat(format),this.clear()}function findItem(item,items,equalsFn){if(!equalsFn)return items.indexOf(item);for(var i=0;i<items.length;i++)if(equalsFn(item,items[i]))return i;return-1}function calcBBox(node,toBBox){distBBox(node,0,node.children.length,toBBox,node)}function distBBox(node,k,p,toBBox,destNode){destNode||(destNode=createNode(null)),destNode.minX=1/0,destNode.minY=1/0,destNode.maxX=-1/0,destNode.maxY=-1/0;for(var child,i=k;i<p;i++)child=node.children[i],extend(destNode,node.leaf?toBBox(child):child);return destNode}function extend(a,b){return a.minX=Math.min(a.minX,b.minX),a.minY=Math.min(a.minY,b.minY),a.maxX=Math.max(a.maxX,b.maxX),a.maxY=Math.max(a.maxY,b.maxY),a}function compareNodeMinX(a,b){return a.minX-b.minX}function compareNodeMinY(a,b){return a.minY-b.minY}function bboxArea(a){return(a.maxX-a.minX)*(a.maxY-a.minY)}function bboxMargin(a){return a.maxX-a.minX+(a.maxY-a.minY)}function contains(a,b){return a.minX<=b.minX&&a.minY<=b.minY&&b.maxX<=a.maxX&&b.maxY<=a.maxY}function intersects(a,b){return b.minX<=a.maxX&&b.minY<=a.maxY&&b.maxX>=a.minX&&b.maxY>=a.minY}function createNode(children){return{children:children,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function multiSelect(arr,left,right,n,compare){for(var mid,stack=[left,right];stack.length;)(right=stack.pop())-(left=stack.pop())<=n||(mid=left+Math.ceil((right-left)/n/2)*n,quickselect(arr,mid,left,right,compare),stack.push(left,mid,mid,right))}rbush.prototype={all:function(){return this._all(this.data,[])},search:function(bbox){var node=this.data,result=[],toBBox=this.toBBox;if(!intersects(bbox,node))return result;for(var i,len,child,childBBox,nodesToSearch=[];node;){for(i=0,len=node.children.length;i<len;i++)child=node.children[i],intersects(bbox,childBBox=node.leaf?toBBox(child):child)&&(node.leaf?result.push(child):contains(bbox,childBBox)?this._all(child,result):nodesToSearch.push(child));node=nodesToSearch.pop()}return result},collides:function(bbox){var node=this.data,toBBox=this.toBBox;if(!intersects(bbox,node))return!1;for(var i,len,child,childBBox,nodesToSearch=[];node;){for(i=0,len=node.children.length;i<len;i++)if(child=node.children[i],intersects(bbox,childBBox=node.leaf?toBBox(child):child)){if(node.leaf||contains(bbox,childBBox))return!0;nodesToSearch.push(child)}node=nodesToSearch.pop()}return!1},load:function(data){if(!data||!data.length)return this;if(data.length<this._minEntries){for(var i=0,len=data.length;i<len;i++)this.insert(data[i]);return this}var node=this._build(data.slice(),0,data.length-1,0);if(this.data.children.length)if(this.data.height===node.height)this._splitRoot(this.data,node);else{if(this.data.height<node.height){var tmpNode=this.data;this.data=node,node=tmpNode}this._insert(node,this.data.height-node.height-1,!0)}else this.data=node;return this},insert:function(item){return item&&this._insert(item,this.data.height-1),this},clear:function(){return this.data=createNode([]),this},remove:function(item,equalsFn){if(!item)return this;for(var i,parent,index,goingUp,node=this.data,bbox=this.toBBox(item),path=[],indexes=[];node||path.length;){if(node||(node=path.pop(),parent=path[path.length-1],i=indexes.pop(),goingUp=!0),node.leaf&&-1!==(index=findItem(item,node.children,equalsFn)))return node.children.splice(index,1),path.push(node),this._condense(path),this;goingUp||node.leaf||!contains(node,bbox)?parent?(i++,node=parent.children[i],goingUp=!1):node=null:(path.push(node),indexes.push(i),i=0,node=(parent=node).children[0])}return this},toBBox:function(item){return item},compareMinX:compareNodeMinX,compareMinY:compareNodeMinY,toJSON:function(){return this.data},fromJSON:function(data){return this.data=data,this},_all:function(node,result){for(var nodesToSearch=[];node;)node.leaf?result.push.apply(result,node.children):nodesToSearch.push.apply(nodesToSearch,node.children),node=nodesToSearch.pop();return result},_build:function(items,left,right,height){var node,N=right-left+1,M=this._maxEntries;if(N<=M)return calcBBox(node=createNode(items.slice(left,right+1)),this.toBBox),node;height||(height=Math.ceil(Math.log(N)/Math.log(M)),M=Math.ceil(N/Math.pow(M,height-1))),(node=createNode([])).leaf=!1,node.height=height;var i,j,right2,right3,N2=Math.ceil(N/M),N1=N2*Math.ceil(Math.sqrt(M));for(multiSelect(items,left,right,N1,this.compareMinX),i=left;i<=right;i+=N1)for(multiSelect(items,i,right2=Math.min(i+N1-1,right),N2,this.compareMinY),j=i;j<=right2;j+=N2)right3=Math.min(j+N2-1,right2),node.children.push(this._build(items,j,right3,height-1));return calcBBox(node,this.toBBox),node},_chooseSubtree:function(bbox,node,level,path){for(var i,len,child,targetNode,area,enlargement,minArea,minEnlargement,a,b;path.push(node),!node.leaf&&path.length-1!==level;){for(minArea=minEnlargement=1/0,i=0,len=node.children.length;i<len;i++)area=bboxArea(child=node.children[i]),a=bbox,b=child,(enlargement=(Math.max(b.maxX,a.maxX)-Math.min(b.minX,a.minX))*(Math.max(b.maxY,a.maxY)-Math.min(b.minY,a.minY))-area)<minEnlargement?(minEnlargement=enlargement,minArea=area<minArea?area:minArea,targetNode=child):enlargement===minEnlargement&&area<minArea&&(minArea=area,targetNode=child);node=targetNode||node.children[0]}return node},_insert:function(item,level,isNode){var toBBox=this.toBBox,bbox=isNode?item:toBBox(item),insertPath=[],node=this._chooseSubtree(bbox,this.data,level,insertPath);for(node.children.push(item),extend(node,bbox);0<=level&&insertPath[level].children.length>this._maxEntries;)this._split(insertPath,level),level--;this._adjustParentBBoxes(bbox,insertPath,level)},_split:function(insertPath,level){var node=insertPath[level],M=node.children.length,m=this._minEntries;this._chooseSplitAxis(node,m,M);var splitIndex=this._chooseSplitIndex(node,m,M),newNode=createNode(node.children.splice(splitIndex,node.children.length-splitIndex));newNode.height=node.height,newNode.leaf=node.leaf,calcBBox(node,this.toBBox),calcBBox(newNode,this.toBBox),level?insertPath[level-1].children.push(newNode):this._splitRoot(node,newNode)},_splitRoot:function(node,newNode){this.data=createNode([node,newNode]),this.data.height=node.height+1,this.data.leaf=!1,calcBBox(this.data,this.toBBox)},_chooseSplitIndex:function(node,m,M){var i,bbox1,bbox2,overlap,area,minOverlap,minArea,index,a,b,minX,minY,maxX,maxY;for(minOverlap=minArea=1/0,i=m;i<=M-m;i++)bbox1=distBBox(node,0,i,this.toBBox),bbox2=distBBox(node,i,M,this.toBBox),a=bbox1,b=bbox2,void 0,minX=Math.max(a.minX,b.minX),minY=Math.max(a.minY,b.minY),maxX=Math.min(a.maxX,b.maxX),maxY=Math.min(a.maxY,b.maxY),overlap=Math.max(0,maxX-minX)*Math.max(0,maxY-minY),area=bboxArea(bbox1)+bboxArea(bbox2),overlap<minOverlap?(minOverlap=overlap,index=i,minArea=area<minArea?area:minArea):overlap===minOverlap&&area<minArea&&(minArea=area,index=i);return index},_chooseSplitAxis:function(node,m,M){var compareMinX=node.leaf?this.compareMinX:compareNodeMinX,compareMinY=node.leaf?this.compareMinY:compareNodeMinY;this._allDistMargin(node,m,M,compareMinX)<this._allDistMargin(node,m,M,compareMinY)&&node.children.sort(compareMinX)},_allDistMargin:function(node,m,M,compare){node.children.sort(compare);var i,child,toBBox=this.toBBox,leftBBox=distBBox(node,0,m,toBBox),rightBBox=distBBox(node,M-m,M,toBBox),margin=bboxMargin(leftBBox)+bboxMargin(rightBBox);for(i=m;i<M-m;i++)child=node.children[i],extend(leftBBox,node.leaf?toBBox(child):child),margin+=bboxMargin(leftBBox);for(i=M-m-1;m<=i;i--)child=node.children[i],extend(rightBBox,node.leaf?toBBox(child):child),margin+=bboxMargin(rightBBox);return margin},_adjustParentBBoxes:function(bbox,path,level){for(var i=level;0<=i;i--)extend(path[i],bbox)},_condense:function(path){for(var siblings,i=path.length-1;0<=i;i--)0===path[i].children.length?0<i?(siblings=path[i-1].children).splice(siblings.indexOf(path[i]),1):this.clear():calcBBox(path[i],this.toBBox)},_initFormat:function(format){var compareArr=["return a"," - b",";"];this.compareMinX=new Function("a","b",compareArr.join(format[0])),this.compareMinY=new Function("a","b",compareArr.join(format[1])),this.toBBox=new Function("a","return {minX: a"+format[0]+", minY: a"+format[1]+", maxX: a"+format[2]+", maxY: a"+format[3]+"};")}}},function(module,exports){var id=0,px=Math.random();module.exports=function(key){return"Symbol(".concat(void 0===key?"":key,")_",(++id+px).toString(36))}},function(module,exports){module.exports=!1},function(module,exports){module.exports={}},function(module){module.exports={a:"perspective-viewer-maps"}},function(module,exports){module.exports=function(bitmap,value){return{enumerable:!(1&bitmap),configurable:!(2&bitmap),writable:!(4&bitmap),value:value}}},function(module,exports,__webpack_require__){var core=__webpack_require__(11),global=__webpack_require__(2),store=global["__core-js_shared__"]||(global["__core-js_shared__"]={});(module.exports=function(key,value){return store[key]||(store[key]=void 0!==value?value:{})})("versions",[]).push({version:core.version,mode:__webpack_require__(19)?"pure":"global",copyright:"Â© 2019 Denis Pushkarev (zloirock.ru)"})},function(module,exports,__webpack_require__){var defined=__webpack_require__(25);module.exports=function(it){return Object(defined(it))}},function(module,exports){module.exports=function(it){if(null==it)throw TypeError("Can't call method on  "+it);return it}},function(module,exports,__webpack_require__){var toInteger=__webpack_require__(37),min=Math.min;module.exports=function(it){return 0<it?min(toInteger(it),9007199254740991):0}},function(module,exports){exports.f={}.propertyIsEnumerable},function(module,exports,__webpack_require__){var def=__webpack_require__(7).f,has=__webpack_require__(10),TAG=__webpack_require__(0)("toStringTag");module.exports=function(it,tag,stat){it&&!has(it=stat?it:it.prototype,TAG)&&def(it,TAG,{configurable:!0,value:tag})}},function(module,exports,__webpack_require__){var anObject=__webpack_require__(3),dPs=__webpack_require__(109),enumBugKeys=__webpack_require__(40),IE_PROTO=__webpack_require__(39)("IE_PROTO"),Empty=function(){},createDict=function(){var iframeDocument,iframe=__webpack_require__(32)("iframe"),i=enumBugKeys.length;for(iframe.style.display="none",__webpack_require__(58).appendChild(iframe),iframe.src="javascript:",(iframeDocument=iframe.contentWindow.document).open(),iframeDocument.write("<script>document.F=Object<\/script>"),iframeDocument.close(),createDict=iframeDocument.F;i--;)delete createDict.prototype[enumBugKeys[i]];return createDict()};module.exports=Object.create||function(O,Properties){var result;return null!==O?(Empty.prototype=anObject(O),result=new Empty,Empty.prototype=null,result[IE_PROTO]=O):result=createDict(),void 0===Properties?result:dPs(result,Properties)}},function(module,exports,__webpack_require__){__webpack_require__(65)("asyncIterator")},function(module,exports,__webpack_require__){"use strict";var global=__webpack_require__(2),has=__webpack_require__(10),DESCRIPTORS=__webpack_require__(6),$export=__webpack_require__(1),redefine=__webpack_require__(9),META=__webpack_require__(111).KEY,$fails=__webpack_require__(5),shared=__webpack_require__(23),setToStringTag=__webpack_require__(28),uid=__webpack_require__(18),wks=__webpack_require__(0),wksExt=__webpack_require__(66),wksDefine=__webpack_require__(65),enumKeys=__webpack_require__(112),isArray=__webpack_require__(34),anObject=__webpack_require__(3),isObject=__webpack_require__(4),toIObject=__webpack_require__(16),toPrimitive=__webpack_require__(33),createDesc=__webpack_require__(22),_create=__webpack_require__(29),gOPNExt=__webpack_require__(113),$GOPD=__webpack_require__(46),$DP=__webpack_require__(7),$keys=__webpack_require__(15),gOPD=$GOPD.f,dP=$DP.f,gOPN=gOPNExt.f,$Symbol=global.Symbol,$JSON=global.JSON,_stringify=$JSON&&$JSON.stringify,HIDDEN=wks("_hidden"),TO_PRIMITIVE=wks("toPrimitive"),isEnum={}.propertyIsEnumerable,SymbolRegistry=shared("symbol-registry"),AllSymbols=shared("symbols"),OPSymbols=shared("op-symbols"),ObjectProto=Object.prototype,USE_NATIVE="function"==typeof $Symbol,QObject=global.QObject,setter=!QObject||!QObject.prototype||!QObject.prototype.findChild,setSymbolDesc=DESCRIPTORS&&$fails(function(){return 7!=_create(dP({},"a",{get:function(){return dP(this,"a",{value:7}).a}})).a})?function(it,key,D){var protoDesc=gOPD(ObjectProto,key);protoDesc&&delete ObjectProto[key],dP(it,key,D),protoDesc&&it!==ObjectProto&&dP(ObjectProto,key,protoDesc)}:dP,wrap=function(tag){var sym=AllSymbols[tag]=_create($Symbol.prototype);return sym._k=tag,sym},isSymbol=USE_NATIVE&&"symbol"==typeof $Symbol.iterator?function(it){return"symbol"==typeof it}:function(it){return it instanceof $Symbol},$defineProperty=function(it,key,D){return it===ObjectProto&&$defineProperty(OPSymbols,key,D),anObject(it),key=toPrimitive(key,!0),anObject(D),has(AllSymbols,key)?(D.enumerable?(has(it,HIDDEN)&&it[HIDDEN][key]&&(it[HIDDEN][key]=!1),D=_create(D,{enumerable:createDesc(0,!1)})):(has(it,HIDDEN)||dP(it,HIDDEN,createDesc(1,{})),it[HIDDEN][key]=!0),setSymbolDesc(it,key,D)):dP(it,key,D)},$defineProperties=function(it,P){anObject(it);for(var key,keys=enumKeys(P=toIObject(P)),i=0,l=keys.length;i<l;)$defineProperty(it,key=keys[i++],P[key]);return it},$propertyIsEnumerable=function(key){var E=isEnum.call(this,key=toPrimitive(key,!0));return!(this===ObjectProto&&has(AllSymbols,key)&&!has(OPSymbols,key))&&(!(E||!has(this,key)||!has(AllSymbols,key)||has(this,HIDDEN)&&this[HIDDEN][key])||E)},$getOwnPropertyDescriptor=function(it,key){if(it=toIObject(it),key=toPrimitive(key,!0),it!==ObjectProto||!has(AllSymbols,key)||has(OPSymbols,key)){var D=gOPD(it,key);return!D||!has(AllSymbols,key)||has(it,HIDDEN)&&it[HIDDEN][key]||(D.enumerable=!0),D}},$getOwnPropertyNames=function(it){for(var key,names=gOPN(toIObject(it)),result=[],i=0;names.length>i;)has(AllSymbols,key=names[i++])||key==HIDDEN||key==META||result.push(key);return result},$getOwnPropertySymbols=function(it){for(var key,IS_OP=it===ObjectProto,names=gOPN(IS_OP?OPSymbols:toIObject(it)),result=[],i=0;names.length>i;)!has(AllSymbols,key=names[i++])||IS_OP&&!has(ObjectProto,key)||result.push(AllSymbols[key]);return result};USE_NATIVE||(redefine(($Symbol=function(){if(this instanceof $Symbol)throw TypeError("Symbol is not a constructor!");var tag=uid(0<arguments.length?arguments[0]:void 0),$set=function(value){this===ObjectProto&&$set.call(OPSymbols,value),has(this,HIDDEN)&&has(this[HIDDEN],tag)&&(this[HIDDEN][tag]=!1),setSymbolDesc(this,tag,createDesc(1,value))};return DESCRIPTORS&&setter&&setSymbolDesc(ObjectProto,tag,{configurable:!0,set:$set}),wrap(tag)}).prototype,"toString",function(){return this._k}),$GOPD.f=$getOwnPropertyDescriptor,$DP.f=$defineProperty,__webpack_require__(67).f=gOPNExt.f=$getOwnPropertyNames,__webpack_require__(27).f=$propertyIsEnumerable,__webpack_require__(42).f=$getOwnPropertySymbols,DESCRIPTORS&&!__webpack_require__(19)&&redefine(ObjectProto,"propertyIsEnumerable",$propertyIsEnumerable,!0),wksExt.f=function(name){return wrap(wks(name))}),$export($export.G+$export.W+$export.F*!USE_NATIVE,{Symbol:$Symbol});for(var es6Symbols="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),j=0;es6Symbols.length>j;)wks(es6Symbols[j++]);for(var wellKnownSymbols=$keys(wks.store),k=0;wellKnownSymbols.length>k;)wksDefine(wellKnownSymbols[k++]);$export($export.S+$export.F*!USE_NATIVE,"Symbol",{for:function(key){return has(SymbolRegistry,key+="")?SymbolRegistry[key]:SymbolRegistry[key]=$Symbol(key)},keyFor:function(sym){if(!isSymbol(sym))throw TypeError(sym+" is not a symbol!");for(var key in SymbolRegistry)if(SymbolRegistry[key]===sym)return key},useSetter:function(){setter=!0},useSimple:function(){setter=!1}}),$export($export.S+$export.F*!USE_NATIVE,"Object",{create:function(it,P){return void 0===P?_create(it):$defineProperties(_create(it),P)},defineProperty:$defineProperty,defineProperties:$defineProperties,getOwnPropertyDescriptor:$getOwnPropertyDescriptor,getOwnPropertyNames:$getOwnPropertyNames,getOwnPropertySymbols:$getOwnPropertySymbols}),$JSON&&$export($export.S+$export.F*(!USE_NATIVE||$fails(function(){var S=$Symbol();return"[null]"!=_stringify([S])||"{}"!=_stringify({a:S})||"{}"!=_stringify(Object(S))})),"JSON",{stringify:function(it){for(var replacer,$replacer,args=[it],i=1;arguments.length>i;)args.push(arguments[i++]);if($replacer=replacer=args[1],(isObject(replacer)||void 0!==it)&&!isSymbol(it))return isArray(replacer)||(replacer=function(key,value){if("function"==typeof $replacer&&(value=$replacer.call(this,key,value)),!isSymbol(value))return value}),args[1]=replacer,_stringify.apply($JSON,args)}}),$Symbol.prototype[TO_PRIMITIVE]||__webpack_require__(8)($Symbol.prototype,TO_PRIMITIVE,$Symbol.prototype.valueOf),setToStringTag($Symbol,"Symbol"),setToStringTag(Math,"Math",!0),setToStringTag(global.JSON,"JSON",!0)},function(module,exports,__webpack_require__){var isObject=__webpack_require__(4),document=__webpack_require__(2).document,is=isObject(document)&&isObject(document.createElement);module.exports=function(it){return is?document.createElement(it):{}}},function(module,exports,__webpack_require__){var isObject=__webpack_require__(4);module.exports=function(it,S){if(!isObject(it))return it;var fn,val;if(S&&"function"==typeof(fn=it.toString)&&!isObject(val=fn.call(it)))return val;if("function"==typeof(fn=it.valueOf)&&!isObject(val=fn.call(it)))return val;if(!S&&"function"==typeof(fn=it.toString)&&!isObject(val=fn.call(it)))return val;throw TypeError("Can't convert object to primitive value")}},function(module,exports,__webpack_require__){var cof=__webpack_require__(14);module.exports=Array.isArray||function(arg){return"Array"==cof(arg)}},function(module,exports,__webpack_require__){var ctx=__webpack_require__(12),IObject=__webpack_require__(36),toObject=__webpack_require__(24),toLength=__webpack_require__(26),asc=__webpack_require__(87);module.exports=function(TYPE,$create){var IS_MAP=1==TYPE,IS_FILTER=2==TYPE,IS_SOME=3==TYPE,IS_EVERY=4==TYPE,IS_FIND_INDEX=6==TYPE,NO_HOLES=5==TYPE||IS_FIND_INDEX,create=$create||asc;return function($this,callbackfn,that){for(var val,res,O=toObject($this),self=IObject(O),f=ctx(callbackfn,that,3),length=toLength(self.length),index=0,result=IS_MAP?create($this,length):IS_FILTER?create($this,0):void 0;index<length;index++)if((NO_HOLES||index in self)&&(res=f(val=self[index],index,O),TYPE))if(IS_MAP)result[index]=res;else if(res)switch(TYPE){case 3:return!0;case 5:return val;case 6:return index;case 2:result.push(val)}else if(IS_EVERY)return!1;return IS_FIND_INDEX?-1:IS_SOME||IS_EVERY?IS_EVERY:result}}},function(module,exports,__webpack_require__){var cof=__webpack_require__(14);module.exports=Object("z").propertyIsEnumerable(0)?Object:function(it){return"String"==cof(it)?it.split(""):Object(it)}},function(module,exports){var ceil=Math.ceil,floor=Math.floor;module.exports=function(it){return isNaN(it=+it)?0:(0<it?floor:ceil)(it)}},function(module,exports,__webpack_require__){"use strict";var fails=__webpack_require__(5);module.exports=function(method,arg){return!!method&&fails(function(){arg?method.call(null,function(){},1):method.call(null)})}},function(module,exports,__webpack_require__){var shared=__webpack_require__(23)("keys"),uid=__webpack_require__(18);module.exports=function(key){return shared[key]||(shared[key]=uid(key))}},function(module,exports){module.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(module,exports,__webpack_require__){var $export=__webpack_require__(1);$export($export.S+$export.F*!__webpack_require__(6),"Object",{defineProperty:__webpack_require__(7).f})},function(module,exports){exports.f=Object.getOwnPropertySymbols},function(module,exports,__webpack_require__){var cof=__webpack_require__(14),TAG=__webpack_require__(0)("toStringTag"),ARG="Arguments"==cof(function(){return arguments}());module.exports=function(it){var O,T,B;return void 0===it?"Undefined":null===it?"Null":"string"==typeof(T=function(it,key){try{return it[key]}catch(e){}}(O=Object(it),TAG))?T:ARG?cof(O):"Object"==(B=cof(O))&&"function"==typeof O.callee?"Arguments":B}},function(module,exports,__webpack_require__){"use strict";var addToUnscopables=__webpack_require__(106),step=__webpack_require__(107),Iterators=__webpack_require__(20),toIObject=__webpack_require__(16);module.exports=__webpack_require__(60)(Array,"Array",function(iterated,kind){this._t=toIObject(iterated),this._i=0,this._k=kind},function(){var O=this._t,kind=this._k,index=this._i++;return!O||index>=O.length?(this._t=void 0,step(1)):step(0,"keys"==kind?index:"values"==kind?O[index]:[index,O[index]])},"values"),Iterators.Arguments=Iterators.Array,addToUnscopables("keys"),addToUnscopables("values"),addToUnscopables("entries")},function(module,exports,__webpack_require__){for(var $iterators=__webpack_require__(44),getKeys=__webpack_require__(15),redefine=__webpack_require__(9),global=__webpack_require__(2),hide=__webpack_require__(8),Iterators=__webpack_require__(20),wks=__webpack_require__(0),ITERATOR=wks("iterator"),TO_STRING_TAG=wks("toStringTag"),ArrayValues=Iterators.Array,DOMIterables={CSSRuleList:!0,CSSStyleDeclaration:!1,CSSValueList:!1,ClientRectList:!1,DOMRectList:!1,DOMStringList:!1,DOMTokenList:!0,DataTransferItemList:!1,FileList:!1,HTMLAllCollection:!1,HTMLCollection:!1,HTMLFormElement:!1,HTMLSelectElement:!1,MediaList:!0,MimeTypeArray:!1,NamedNodeMap:!1,NodeList:!0,PaintRequestList:!1,Plugin:!1,PluginArray:!1,SVGLengthList:!1,SVGNumberList:!1,SVGPathSegList:!1,SVGPointList:!1,SVGStringList:!1,SVGTransformList:!1,SourceBufferList:!1,StyleSheetList:!0,TextTrackCueList:!1,TextTrackList:!1,TouchList:!1},collections=getKeys(DOMIterables),i=0;i<collections.length;i++){var key,NAME=collections[i],explicit=DOMIterables[NAME],Collection=global[NAME],proto=Collection&&Collection.prototype;if(proto&&(proto[ITERATOR]||hide(proto,ITERATOR,ArrayValues),proto[TO_STRING_TAG]||hide(proto,TO_STRING_TAG,NAME),Iterators[NAME]=ArrayValues,explicit))for(key in $iterators)proto[key]||redefine(proto,key,$iterators[key],!0)}},function(module,exports,__webpack_require__){var pIE=__webpack_require__(27),createDesc=__webpack_require__(22),toIObject=__webpack_require__(16),toPrimitive=__webpack_require__(33),has=__webpack_require__(10),IE8_DOM_DEFINE=__webpack_require__(50),gOPD=Object.getOwnPropertyDescriptor;exports.f=__webpack_require__(6)?gOPD:function(O,P){if(O=toIObject(O),P=toPrimitive(P,!0),IE8_DOM_DEFINE)try{return gOPD(O,P)}catch(e){}if(has(O,P))return createDesc(!pIE.f.call(O,P),O[P])}},function(module,exports,__webpack_require__){"use strict";var re1,re2,regexpFlags=__webpack_require__(48),nativeExec=RegExp.prototype.exec,nativeReplace=String.prototype.replace,patchedExec=nativeExec,UPDATES_LAST_INDEX_WRONG=(re1=/a/,re2=/b*/g,nativeExec.call(re1,"a"),nativeExec.call(re2,"a"),0!==re1.lastIndex||0!==re2.lastIndex),NPCG_INCLUDED=void 0!==/()??/.exec("")[1];(UPDATES_LAST_INDEX_WRONG||NPCG_INCLUDED)&&(patchedExec=function(str){var lastIndex,reCopy,match,i,re=this;return NPCG_INCLUDED&&(reCopy=new RegExp("^"+re.source+"$(?!\\s)",regexpFlags.call(re))),UPDATES_LAST_INDEX_WRONG&&(lastIndex=re.lastIndex),match=nativeExec.call(re,str),UPDATES_LAST_INDEX_WRONG&&match&&(re.lastIndex=re.global?match.index+match[0].length:lastIndex),NPCG_INCLUDED&&match&&1<match.length&&nativeReplace.call(match[0],reCopy,function(){for(i=1;i<arguments.length-2;i++)void 0===arguments[i]&&(match[i]=void 0)}),match}),module.exports=patchedExec},function(module,exports,__webpack_require__){"use strict";var anObject=__webpack_require__(3);module.exports=function(){var that=anObject(this),result="";return that.global&&(result+="g"),that.ignoreCase&&(result+="i"),that.multiline&&(result+="m"),that.unicode&&(result+="u"),that.sticky&&(result+="y"),result}},function(module,exports,__webpack_require__){var $export=__webpack_require__(1);$export($export.S,"Array",{isArray:__webpack_require__(34)})},function(module,exports,__webpack_require__){module.exports=!__webpack_require__(6)&&!__webpack_require__(5)(function(){return 7!=Object.defineProperty(__webpack_require__(32)("div"),"a",{get:function(){return 7}}).a})},function(module,exports,__webpack_require__){"use strict";var $export=__webpack_require__(1),$filter=__webpack_require__(35)(2);$export($export.P+$export.F*!__webpack_require__(38)([].filter,!0),"Array",{filter:function(callbackfn){return $filter(this,callbackfn,arguments[1])}})},function(module,exports,__webpack_require__){var toObject=__webpack_require__(24),$keys=__webpack_require__(15);__webpack_require__(91)("keys",function(){return function(it){return $keys(toObject(it))}})},function(module,exports,__webpack_require__){var has=__webpack_require__(10),toIObject=__webpack_require__(16),arrayIndexOf=__webpack_require__(89)(!1),IE_PROTO=__webpack_require__(39)("IE_PROTO");module.exports=function(object,names){var key,O=toIObject(object),i=0,result=[];for(key in O)key!=IE_PROTO&&has(O,key)&&result.push(key);for(;names.length>i;)has(O,key=names[i++])&&(~arrayIndexOf(result,key)||result.push(key));return result}},function(module,exports,__webpack_require__){"use strict";var Internal,newGenericPromiseCapability,OwnPromiseCapability,Wrapper,LIBRARY=__webpack_require__(19),global=__webpack_require__(2),ctx=__webpack_require__(12),classof=__webpack_require__(43),$export=__webpack_require__(1),isObject=__webpack_require__(4),aFunction=__webpack_require__(13),anInstance=__webpack_require__(94),forOf=__webpack_require__(95),speciesConstructor=__webpack_require__(55),task=__webpack_require__(56).set,microtask=__webpack_require__(99)(),newPromiseCapabilityModule=__webpack_require__(59),perform=__webpack_require__(100),userAgent=__webpack_require__(101),promiseResolve=__webpack_require__(102),TypeError=global.TypeError,process=global.process,versions=process&&process.versions,v8=versions&&versions.v8||"",$Promise=global.Promise,isNode="process"==classof(process),empty=function(){},newPromiseCapability=newGenericPromiseCapability=newPromiseCapabilityModule.f,USE_NATIVE=!!function(){try{var promise=$Promise.resolve(1),FakePromise=(promise.constructor={})[__webpack_require__(0)("species")]=function(exec){exec(empty,empty)};return(isNode||"function"==typeof PromiseRejectionEvent)&&promise.then(empty)instanceof FakePromise&&0!==v8.indexOf("6.6")&&-1===userAgent.indexOf("Chrome/66")}catch(e){}}(),isThenable=function(it){var then;return!(!isObject(it)||"function"!=typeof(then=it.then))&&then},notify=function(promise,isReject){if(!promise._n){promise._n=!0;var chain=promise._c;microtask(function(){for(var value=promise._v,ok=1==promise._s,i=0,run=function(reaction){var result,then,exited,handler=ok?reaction.ok:reaction.fail,resolve=reaction.resolve,reject=reaction.reject,domain=reaction.domain;try{handler?(ok||(2==promise._h&&onHandleUnhandled(promise),promise._h=1),!0===handler?result=value:(domain&&domain.enter(),result=handler(value),domain&&(domain.exit(),exited=!0)),result===reaction.promise?reject(TypeError("Promise-chain cycle")):(then=isThenable(result))?then.call(result,resolve,reject):resolve(result)):reject(value)}catch(e){domain&&!exited&&domain.exit(),reject(e)}};chain.length>i;)run(chain[i++]);promise._c=[],promise._n=!1,isReject&&!promise._h&&onUnhandled(promise)})}},onUnhandled=function(promise){task.call(global,function(){var result,handler,console,value=promise._v,unhandled=isUnhandled(promise);if(unhandled&&(result=perform(function(){isNode?process.emit("unhandledRejection",value,promise):(handler=global.onunhandledrejection)?handler({promise:promise,reason:value}):(console=global.console)&&console.error&&console.error("Unhandled promise rejection",value)}),promise._h=isNode||isUnhandled(promise)?2:1),promise._a=void 0,unhandled&&result.e)throw result.v})},isUnhandled=function(promise){return 1!==promise._h&&0===(promise._a||promise._c).length},onHandleUnhandled=function(promise){task.call(global,function(){var handler;isNode?process.emit("rejectionHandled",promise):(handler=global.onrejectionhandled)&&handler({promise:promise,reason:promise._v})})},$reject=function(value){var promise=this;promise._d||(promise._d=!0,(promise=promise._w||promise)._v=value,promise._s=2,promise._a||(promise._a=promise._c.slice()),notify(promise,!0))},$resolve=function(value){var then,promise=this;if(!promise._d){promise._d=!0,promise=promise._w||promise;try{if(promise===value)throw TypeError("Promise can't be resolved itself");(then=isThenable(value))?microtask(function(){var wrapper={_w:promise,_d:!1};try{then.call(value,ctx($resolve,wrapper,1),ctx($reject,wrapper,1))}catch(e){$reject.call(wrapper,e)}}):(promise._v=value,promise._s=1,notify(promise,!1))}catch(e){$reject.call({_w:promise,_d:!1},e)}}};USE_NATIVE||($Promise=function(executor){anInstance(this,$Promise,"Promise","_h"),aFunction(executor),Internal.call(this);try{executor(ctx($resolve,this,1),ctx($reject,this,1))}catch(err){$reject.call(this,err)}},(Internal=function(executor){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=__webpack_require__(103)($Promise.prototype,{then:function(onFulfilled,onRejected){var reaction=newPromiseCapability(speciesConstructor(this,$Promise));return reaction.ok="function"!=typeof onFulfilled||onFulfilled,reaction.fail="function"==typeof onRejected&&onRejected,reaction.domain=isNode?process.domain:void 0,this._c.push(reaction),this._a&&this._a.push(reaction),this._s&&notify(this,!1),reaction.promise},catch:function(onRejected){return this.then(void 0,onRejected)}}),OwnPromiseCapability=function(){var promise=new Internal;this.promise=promise,this.resolve=ctx($resolve,promise,1),this.reject=ctx($reject,promise,1)},newPromiseCapabilityModule.f=newPromiseCapability=function(C){return C===$Promise||C===Wrapper?new OwnPromiseCapability(C):newGenericPromiseCapability(C)}),$export($export.G+$export.W+$export.F*!USE_NATIVE,{Promise:$Promise}),__webpack_require__(28)($Promise,"Promise"),__webpack_require__(104)("Promise"),Wrapper=__webpack_require__(11).Promise,$export($export.S+$export.F*!USE_NATIVE,"Promise",{reject:function(r){var capability=newPromiseCapability(this);return(0,capability.reject)(r),capability.promise}}),$export($export.S+$export.F*(LIBRARY||!USE_NATIVE),"Promise",{resolve:function(x){return promiseResolve(LIBRARY&&this===Wrapper?$Promise:this,x)}}),$export($export.S+$export.F*!(USE_NATIVE&&__webpack_require__(105)(function(iter){$Promise.all(iter).catch(empty)})),"Promise",{all:function(iterable){var C=this,capability=newPromiseCapability(C),resolve=capability.resolve,reject=capability.reject,result=perform(function(){var values=[],index=0,remaining=1;forOf(iterable,!1,function(promise){var $index=index++,alreadyCalled=!1;values.push(void 0),remaining++,C.resolve(promise).then(function(value){alreadyCalled||(alreadyCalled=!0,values[$index]=value,--remaining||resolve(values))},reject)}),--remaining||resolve(values)});return result.e&&reject(result.v),capability.promise},race:function(iterable){var C=this,capability=newPromiseCapability(C),reject=capability.reject,result=perform(function(){forOf(iterable,!1,function(promise){C.resolve(promise).then(capability.resolve,reject)})});return result.e&&reject(result.v),capability.promise}})},function(module,exports,__webpack_require__){var anObject=__webpack_require__(3),aFunction=__webpack_require__(13),SPECIES=__webpack_require__(0)("species");module.exports=function(O,D){var S,C=anObject(O).constructor;return void 0===C||null==(S=anObject(C)[SPECIES])?D:aFunction(S)}},function(module,exports,__webpack_require__){var defer,channel,port,ctx=__webpack_require__(12),invoke=__webpack_require__(57),html=__webpack_require__(58),cel=__webpack_require__(32),global=__webpack_require__(2),process=global.process,setTask=global.setImmediate,clearTask=global.clearImmediate,MessageChannel=global.MessageChannel,Dispatch=global.Dispatch,counter=0,queue={},run=function(){var id=+this;if(queue.hasOwnProperty(id)){var fn=queue[id];delete queue[id],fn()}},listener=function(event){run.call(event.data)};setTask&&clearTask||(setTask=function(fn){for(var args=[],i=1;arguments.length>i;)args.push(arguments[i++]);return queue[++counter]=function(){invoke("function"==typeof fn?fn:Function(fn),args)},defer(counter),counter},clearTask=function(id){delete queue[id]},"process"==__webpack_require__(14)(process)?defer=function(id){process.nextTick(ctx(run,id,1))}:Dispatch&&Dispatch.now?defer=function(id){Dispatch.now(ctx(run,id,1))}:MessageChannel?(port=(channel=new MessageChannel).port2,channel.port1.onmessage=listener,defer=ctx(port.postMessage,port,1)):global.addEventListener&&"function"==typeof postMessage&&!global.importScripts?(defer=function(id){global.postMessage(id+"","*")},global.addEventListener("message",listener,!1)):defer="onreadystatechange"in cel("script")?function(id){html.appendChild(cel("script")).onreadystatechange=function(){html.removeChild(this),run.call(id)}}:function(id){setTimeout(ctx(run,id,1),0)}),module.exports={set:setTask,clear:clearTask}},function(module,exports){module.exports=function(fn,args,that){var un=void 0===that;switch(args.length){case 0:return un?fn():fn.call(that);case 1:return un?fn(args[0]):fn.call(that,args[0]);case 2:return un?fn(args[0],args[1]):fn.call(that,args[0],args[1]);case 3:return un?fn(args[0],args[1],args[2]):fn.call(that,args[0],args[1],args[2]);case 4:return un?fn(args[0],args[1],args[2],args[3]):fn.call(that,args[0],args[1],args[2],args[3])}return fn.apply(that,args)}},function(module,exports,__webpack_require__){var document=__webpack_require__(2).document;module.exports=document&&document.documentElement},function(module,exports,__webpack_require__){"use strict";var aFunction=__webpack_require__(13);function PromiseCapability(C){var resolve,reject;this.promise=new C(function($$resolve,$$reject){if(void 0!==resolve||void 0!==reject)throw TypeError("Bad Promise constructor");resolve=$$resolve,reject=$$reject}),this.resolve=aFunction(resolve),this.reject=aFunction(reject)}module.exports.f=function(C){return new PromiseCapability(C)}},function(module,exports,__webpack_require__){"use strict";var LIBRARY=__webpack_require__(19),$export=__webpack_require__(1),redefine=__webpack_require__(9),hide=__webpack_require__(8),Iterators=__webpack_require__(20),$iterCreate=__webpack_require__(108),setToStringTag=__webpack_require__(28),getPrototypeOf=__webpack_require__(61),ITERATOR=__webpack_require__(0)("iterator"),BUGGY=!([].keys&&"next"in[].keys()),returnThis=function(){return this};module.exports=function(Base,NAME,Constructor,next,DEFAULT,IS_SET,FORCED){$iterCreate(Constructor,NAME,next);var methods,key,IteratorPrototype,getMethod=function(kind){if(!BUGGY&&kind in proto)return proto[kind];switch(kind){case"keys":case"values":return function(){return new Constructor(this,kind)}}return function(){return new Constructor(this,kind)}},TAG=NAME+" Iterator",DEF_VALUES="values"==DEFAULT,VALUES_BUG=!1,proto=Base.prototype,$native=proto[ITERATOR]||proto["@@iterator"]||DEFAULT&&proto[DEFAULT],$default=$native||getMethod(DEFAULT),$entries=DEFAULT?DEF_VALUES?getMethod("entries"):$default:void 0,$anyNative="Array"==NAME&&proto.entries||$native;if($anyNative&&(IteratorPrototype=getPrototypeOf($anyNative.call(new Base)))!==Object.prototype&&IteratorPrototype.next&&(setToStringTag(IteratorPrototype,TAG,!0),LIBRARY||"function"==typeof IteratorPrototype[ITERATOR]||hide(IteratorPrototype,ITERATOR,returnThis)),DEF_VALUES&&$native&&"values"!==$native.name&&(VALUES_BUG=!0,$default=function(){return $native.call(this)}),LIBRARY&&!FORCED||!BUGGY&&!VALUES_BUG&&proto[ITERATOR]||hide(proto,ITERATOR,$default),Iterators[NAME]=$default,Iterators[TAG]=returnThis,DEFAULT)if(methods={values:DEF_VALUES?$default:getMethod("values"),keys:IS_SET?$default:getMethod("keys"),entries:$entries},FORCED)for(key in methods)key in proto||redefine(proto,key,methods[key]);else $export($export.P+$export.F*(BUGGY||VALUES_BUG),NAME,methods);return methods}},function(module,exports,__webpack_require__){var has=__webpack_require__(10),toObject=__webpack_require__(24),IE_PROTO=__webpack_require__(39)("IE_PROTO"),ObjectProto=Object.prototype;module.exports=Object.getPrototypeOf||function(O){return O=toObject(O),has(O,IE_PROTO)?O[IE_PROTO]:"function"==typeof O.constructor&&O instanceof O.constructor?O.constructor.prototype:O instanceof Object?ObjectProto:null}},function(module,exports,__webpack_require__){var toInteger=__webpack_require__(37),defined=__webpack_require__(25);module.exports=function(TO_STRING){return function(that,pos){var a,b,s=String(defined(that)),i=toInteger(pos),l=s.length;return i<0||l<=i?TO_STRING?"":void 0:(a=s.charCodeAt(i))<55296||56319<a||i+1===l||(b=s.charCodeAt(i+1))<56320||57343<b?TO_STRING?s.charAt(i):a:TO_STRING?s.slice(i,i+2):b-56320+(a-55296<<10)+65536}}},function(module,exports){!function(global){"use strict";var undefined,Op=Object.prototype,hasOwn=Op.hasOwnProperty,$Symbol="function"==typeof Symbol?Symbol:{},iteratorSymbol=$Symbol.iterator||"@@iterator",asyncIteratorSymbol=$Symbol.asyncIterator||"@@asyncIterator",toStringTagSymbol=$Symbol.toStringTag||"@@toStringTag",inModule="object"==typeof module,runtime=global.regeneratorRuntime;if(runtime)inModule&&(module.exports=runtime);else{(runtime=global.regeneratorRuntime=inModule?module.exports:{}).wrap=wrap;var GenStateSuspendedStart="suspendedStart",GenStateSuspendedYield="suspendedYield",GenStateExecuting="executing",GenStateCompleted="completed",ContinueSentinel={},IteratorPrototype={};IteratorPrototype[iteratorSymbol]=function(){return this};var getProto=Object.getPrototypeOf,NativeIteratorPrototype=getProto&&getProto(getProto(values([])));NativeIteratorPrototype&&NativeIteratorPrototype!==Op&&hasOwn.call(NativeIteratorPrototype,iteratorSymbol)&&(IteratorPrototype=NativeIteratorPrototype);var Gp=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(IteratorPrototype);GeneratorFunction.prototype=Gp.constructor=GeneratorFunctionPrototype,GeneratorFunctionPrototype.constructor=GeneratorFunction,GeneratorFunctionPrototype[toStringTagSymbol]=GeneratorFunction.displayName="GeneratorFunction",runtime.isGeneratorFunction=function(genFun){var ctor="function"==typeof genFun&&genFun.constructor;return!!ctor&&(ctor===GeneratorFunction||"GeneratorFunction"===(ctor.displayName||ctor.name))},runtime.mark=function(genFun){return Object.setPrototypeOf?Object.setPrototypeOf(genFun,GeneratorFunctionPrototype):(genFun.__proto__=GeneratorFunctionPrototype,toStringTagSymbol in genFun||(genFun[toStringTagSymbol]="GeneratorFunction")),genFun.prototype=Object.create(Gp),genFun},runtime.awrap=function(arg){return{__await:arg}},defineIteratorMethods(AsyncIterator.prototype),AsyncIterator.prototype[asyncIteratorSymbol]=function(){return this},runtime.AsyncIterator=AsyncIterator,runtime.async=function(innerFn,outerFn,self,tryLocsList){var iter=new AsyncIterator(wrap(innerFn,outerFn,self,tryLocsList));return runtime.isGeneratorFunction(outerFn)?iter:iter.next().then(function(result){return result.done?result.value:iter.next()})},defineIteratorMethods(Gp),Gp[toStringTagSymbol]="Generator",Gp[iteratorSymbol]=function(){return this},Gp.toString=function(){return"[object Generator]"},runtime.keys=function(object){var keys=[];for(var key in object)keys.push(key);return keys.reverse(),function next(){for(;keys.length;){var key=keys.pop();if(key in object)return next.value=key,next.done=!1,next}return next.done=!0,next}},runtime.values=values,Context.prototype={constructor:Context,reset:function(skipTempReset){if(this.prev=0,this.next=0,this.sent=this._sent=undefined,this.done=!1,this.delegate=null,this.method="next",this.arg=undefined,this.tryEntries.forEach(resetTryEntry),!skipTempReset)for(var name in this)"t"===name.charAt(0)&&hasOwn.call(this,name)&&!isNaN(+name.slice(1))&&(this[name]=undefined)},stop:function(){this.done=!0;var rootRecord=this.tryEntries[0].completion;if("throw"===rootRecord.type)throw rootRecord.arg;return this.rval},dispatchException:function(exception){if(this.done)throw exception;var context=this;function handle(loc,caught){return record.type="throw",record.arg=exception,context.next=loc,caught&&(context.method="next",context.arg=undefined),!!caught}for(var i=this.tryEntries.length-1;0<=i;--i){var entry=this.tryEntries[i],record=entry.completion;if("root"===entry.tryLoc)return handle("end");if(entry.tryLoc<=this.prev){var hasCatch=hasOwn.call(entry,"catchLoc"),hasFinally=hasOwn.call(entry,"finallyLoc");if(hasCatch&&hasFinally){if(this.prev<entry.catchLoc)return handle(entry.catchLoc,!0);if(this.prev<entry.finallyLoc)return handle(entry.finallyLoc)}else if(hasCatch){if(this.prev<entry.catchLoc)return handle(entry.catchLoc,!0)}else{if(!hasFinally)throw new Error("try statement without catch or finally");if(this.prev<entry.finallyLoc)return handle(entry.finallyLoc)}}}},abrupt:function(type,arg){for(var i=this.tryEntries.length-1;0<=i;--i){var entry=this.tryEntries[i];if(entry.tryLoc<=this.prev&&hasOwn.call(entry,"finallyLoc")&&this.prev<entry.finallyLoc){var finallyEntry=entry;break}}finallyEntry&&("break"===type||"continue"===type)&&finallyEntry.tryLoc<=arg&&arg<=finallyEntry.finallyLoc&&(finallyEntry=null);var record=finallyEntry?finallyEntry.completion:{};return record.type=type,record.arg=arg,finallyEntry?(this.method="next",this.next=finallyEntry.finallyLoc,ContinueSentinel):this.complete(record)},complete:function(record,afterLoc){if("throw"===record.type)throw record.arg;return"break"===record.type||"continue"===record.type?this.next=record.arg:"return"===record.type?(this.rval=this.arg=record.arg,this.method="return",this.next="end"):"normal"===record.type&&afterLoc&&(this.next=afterLoc),ContinueSentinel},finish:function(finallyLoc){for(var i=this.tryEntries.length-1;0<=i;--i){var entry=this.tryEntries[i];if(entry.finallyLoc===finallyLoc)return this.complete(entry.completion,entry.afterLoc),resetTryEntry(entry),ContinueSentinel}},catch:function(tryLoc){for(var i=this.tryEntries.length-1;0<=i;--i){var entry=this.tryEntries[i];if(entry.tryLoc===tryLoc){var record=entry.completion;if("throw"===record.type){var thrown=record.arg;resetTryEntry(entry)}return thrown}}throw new Error("illegal catch attempt")},delegateYield:function(iterable,resultName,nextLoc){return this.delegate={iterator:values(iterable),resultName:resultName,nextLoc:nextLoc},"next"===this.method&&(this.arg=undefined),ContinueSentinel}}}function wrap(innerFn,outerFn,self,tryLocsList){var protoGenerator=outerFn&&outerFn.prototype instanceof Generator?outerFn:Generator,generator=Object.create(protoGenerator.prototype),context=new Context(tryLocsList||[]);return generator._invoke=function(innerFn,self,context){var state=GenStateSuspendedStart;return function(method,arg){if(state===GenStateExecuting)throw new Error("Generator is already running");if(state===GenStateCompleted){if("throw"===method)throw arg;return doneResult()}for(context.method=method,context.arg=arg;;){var delegate=context.delegate;if(delegate){var delegateResult=maybeInvokeDelegate(delegate,context);if(delegateResult){if(delegateResult===ContinueSentinel)continue;return delegateResult}}if("next"===context.method)context.sent=context._sent=context.arg;else if("throw"===context.method){if(state===GenStateSuspendedStart)throw state=GenStateCompleted,context.arg;context.dispatchException(context.arg)}else"return"===context.method&&context.abrupt("return",context.arg);state=GenStateExecuting;var record=tryCatch(innerFn,self,context);if("normal"===record.type){if(state=context.done?GenStateCompleted:GenStateSuspendedYield,record.arg===ContinueSentinel)continue;return{value:record.arg,done:context.done}}"throw"===record.type&&(state=GenStateCompleted,context.method="throw",context.arg=record.arg)}}}(innerFn,self,context),generator}function tryCatch(fn,obj,arg){try{return{type:"normal",arg:fn.call(obj,arg)}}catch(err){return{type:"throw",arg:err}}}function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}function defineIteratorMethods(prototype){["next","throw","return"].forEach(function(method){prototype[method]=function(arg){return this._invoke(method,arg)}})}function AsyncIterator(generator){var previousPromise;this._invoke=function(method,arg){function callInvokeWithMethodAndArg(){return new Promise(function(resolve,reject){!function invoke(method,arg,resolve,reject){var record=tryCatch(generator[method],generator,arg);if("throw"!==record.type){var result=record.arg,value=result.value;return value&&"object"==typeof value&&hasOwn.call(value,"__await")?Promise.resolve(value.__await).then(function(value){invoke("next",value,resolve,reject)},function(err){invoke("throw",err,resolve,reject)}):Promise.resolve(value).then(function(unwrapped){result.value=unwrapped,resolve(result)},function(error){return invoke("throw",error,resolve,reject)})}reject(record.arg)}(method,arg,resolve,reject)})}return previousPromise=previousPromise?previousPromise.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}}function maybeInvokeDelegate(delegate,context){var method=delegate.iterator[context.method];if(method===undefined){if(context.delegate=null,"throw"===context.method){if(delegate.iterator.return&&(context.method="return",context.arg=undefined,maybeInvokeDelegate(delegate,context),"throw"===context.method))return ContinueSentinel;context.method="throw",context.arg=new TypeError("The iterator does not provide a 'throw' method")}return ContinueSentinel}var record=tryCatch(method,delegate.iterator,context.arg);if("throw"===record.type)return context.method="throw",context.arg=record.arg,context.delegate=null,ContinueSentinel;var info=record.arg;return info?info.done?(context[delegate.resultName]=info.value,context.next=delegate.nextLoc,"return"!==context.method&&(context.method="next",context.arg=undefined),context.delegate=null,ContinueSentinel):info:(context.method="throw",context.arg=new TypeError("iterator result is not an object"),context.delegate=null,ContinueSentinel)}function pushTryEntry(locs){var entry={tryLoc:locs[0]};1 in locs&&(entry.catchLoc=locs[1]),2 in locs&&(entry.finallyLoc=locs[2],entry.afterLoc=locs[3]),this.tryEntries.push(entry)}function resetTryEntry(entry){var record=entry.completion||{};record.type="normal",delete record.arg,entry.completion=record}function Context(tryLocsList){this.tryEntries=[{tryLoc:"root"}],tryLocsList.forEach(pushTryEntry,this),this.reset(!0)}function values(iterable){if(iterable){var iteratorMethod=iterable[iteratorSymbol];if(iteratorMethod)return iteratorMethod.call(iterable);if("function"==typeof iterable.next)return iterable;if(!isNaN(iterable.length)){var i=-1,next=function next(){for(;++i<iterable.length;)if(hasOwn.call(iterable,i))return next.value=iterable[i],next.done=!1,next;return next.value=undefined,next.done=!0,next};return next.next=next}}return{next:doneResult}}function doneResult(){return{value:undefined,done:!0}}}(function(){return this||"object"==typeof self&&self}()||Function("return this")())},function(module,exports,__webpack_require__){"use strict";var $export=__webpack_require__(1),$forEach=__webpack_require__(35)(0),STRICT=__webpack_require__(38)([].forEach,!0);$export($export.P+$export.F*!STRICT,"Array",{forEach:function(callbackfn){return $forEach(this,callbackfn,arguments[1])}})},function(module,exports,__webpack_require__){var global=__webpack_require__(2),core=__webpack_require__(11),LIBRARY=__webpack_require__(19),wksExt=__webpack_require__(66),defineProperty=__webpack_require__(7).f;module.exports=function(name){var $Symbol=core.Symbol||(core.Symbol=LIBRARY?{}:global.Symbol||{});"_"==name.charAt(0)||name in $Symbol||defineProperty($Symbol,name,{value:wksExt.f(name)})}},function(module,exports,__webpack_require__){exports.f=__webpack_require__(0)},function(module,exports,__webpack_require__){var $keys=__webpack_require__(53),hiddenKeys=__webpack_require__(40).concat("length","prototype");exports.f=Object.getOwnPropertyNames||function(O){return $keys(O,hiddenKeys)}},function(module,exports,__webpack_require__){"use strict";var $export=__webpack_require__(1),$map=__webpack_require__(35)(1);$export($export.P+$export.F*!__webpack_require__(38)([].map,!0),"Array",{map:function(callbackfn){return $map(this,callbackfn,arguments[1])}})},function(module,exports,__webpack_require__){var $export=__webpack_require__(1);$export($export.S,"Object",{create:__webpack_require__(29)})},function(module,exports,__webpack_require__){var $export=__webpack_require__(1);$export($export.S,"Object",{setPrototypeOf:__webpack_require__(122).set})},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.importTemplate=importTemplate,exports.registerElement=registerElement,exports.bindTemplate=function(template){for(var _len=arguments.length,styleStrings=new Array(1<_len?_len-1:0),_key=1;_key<_len;_key++)styleStrings[_key-1]=arguments[_key];var style=styleStrings.map(function(x){return x.toString()}).join("\n");return function(cls){return registerElement(template,{toString:function(){return style}},cls)}},exports.copy_to_clipboard=function(csv){var element=document.createElement("textarea");document.body.appendChild(element),element.value=csv,element.select(),document.execCommand("copy"),document.body.removeChild(element)},exports.array_attribute=exports.json_attribute=void 0,__webpack_require__(63),__webpack_require__(125),__webpack_require__(69),__webpack_require__(70),__webpack_require__(54),__webpack_require__(68),__webpack_require__(41),__webpack_require__(30),__webpack_require__(31),__webpack_require__(45),__webpack_require__(49),__webpack_require__(126),__webpack_require__(128);var obj,_detectie=(obj=__webpack_require__(129))&&obj.__esModule?obj:{default:obj};function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _possibleConstructorReturn(self,call){return!call||"object"!==_typeof(call)&&"function"!=typeof call?function(self){if(void 0!==self)return self;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(self):call}function _get(target,property,receiver){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(target,property,receiver){var base=function(object,property){for(;!Object.prototype.hasOwnProperty.call(object,property)&&null!==(object=_getPrototypeOf(object)););return object}(target,property);if(base){var desc=Object.getOwnPropertyDescriptor(base,property);return desc.get?desc.get.call(receiver):desc.value}})(target,property,receiver||target)}function _getPrototypeOf(o){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function _setPrototypeOf(o,p){return(_setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}function importTemplate(template){var div=document.createElement("div");return div.innerHTML=template,Array.prototype.slice.call(div.children)[0]}function registerElement(templateString,styleString,proto){var template=importTemplate(templateString);!function(template){var child;if(!template.content)for(template.content=document.createDocumentFragment();child=template.firstChild;)Node.prototype.appendChild.call(template.content,child)}(template),styleString&&(template.innerHTML="<style>".concat(styleString.toString(),"</style>")+template.innerHTML),window.ShadyCSS&&window.ShadyCSS.prepareTemplate(template,template.getAttribute("id")),template.innerHTML='<style id="psp_styles" scope="'.concat(template.getAttribute("id"),'">test{}</style>')+template.innerHTML;var _perspective_element=function(_proto){function _perspective_element(){return function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,_perspective_element),_possibleConstructorReturn(this,_getPrototypeOf(_perspective_element).apply(this,arguments))}var Constructor,protoProps,staticProps;return function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&_setPrototypeOf(subClass,superClass)}(_perspective_element,proto),Constructor=_perspective_element,staticProps=[{key:"observedAttributes",get:function(){return Object.getOwnPropertyNames(proto.prototype)}}],(protoProps=[{key:"attributeChangedCallback",value:function(name,old,value){"_"!==name[0]&&old!=value&&(this[name]=value)}},{key:"connectedCallback",value:function(){if(window.ShadyCSS&&window.ShadyCSS.styleElement(this),!this._initialized){for(this._initializing=!0,this._old_children=[];this.hasChildNodes();)1===this.lastChild.nodeType&&this._old_children.push(this.lastChild),this.removeChild(this.lastChild);this._old_children=this._old_children.reverse();var node=document.importNode(template.content,!0);this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(node),_get(_getPrototypeOf(_perspective_element.prototype),"connectedCallback",this)&&_get(_getPrototypeOf(_perspective_element.prototype),"connectedCallback",this).call(this);var _iterator=Object.getOwnPropertyNames(proto.prototype),_isArray=Array.isArray(_iterator),_i=0;for(_iterator=_isArray?_iterator:_iterator[Symbol.iterator]();;){var _ref;if(_isArray){if(_i>=_iterator.length)break;_ref=_iterator[_i++]}else{if((_i=_iterator.next()).done)break;_ref=_i.value}var key=_ref;"connectedCallback"!==key&&this.hasAttribute(key)&&"_"!==key[0]&&(this[key]=this.getAttribute(key))}this._initializing=!1,this._initialized=!0}}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),_perspective_element}(),_loop=function(){if(_isArray2){if(_i2>=_iterator2.length)return"break";_ref2=_iterator2[_i2++]}else{if((_i2=_iterator2.next()).done)return"break";_ref2=_i2.value}var key=_ref2,descriptor=Object.getOwnPropertyDescriptor(proto.prototype,key);if(descriptor&&descriptor.set){var old=descriptor.set;descriptor.set=function(val){this.getAttribute(key)===val?(this._initializing||this._initialized)&&old.call(this,val):this.setAttribute(key,val)},Object.defineProperty(proto.prototype,key,descriptor)}},_iterator2=Object.getOwnPropertyNames(proto.prototype),_isArray2=Array.isArray(_iterator2),_i2=0;for(_iterator2=_isArray2?_iterator2:_iterator2[Symbol.iterator]();;){var _ref2;if("break"===_loop())break}var name=template.getAttribute("id");console.log("Registered ".concat(name)),window.customElements.define(name,_perspective_element)}function _attribute(_default){return function(cls,name,desc){var old_set=desc.set;return desc.set=function(x){var attr=this.getAttribute(name);try{if(null==x&&(x=_default()),"string"!=typeof x&&(x=JSON.stringify(x)),x!==attr)return this.setAttribute(name,x),void(attr=x);attr=JSON.parse(attr)}catch(e){console.error('Invalid value for attribute "'.concat(name,'": ').concat(x)),attr=_default()}old_set.call(this,attr)},desc.get=function(){if(this.hasAttribute(name))return JSON.parse(this.getAttribute(name))},desc}}var json_attribute=_attribute(function(){return{}});exports.json_attribute=json_attribute;var array_attribute=_attribute(function(){return[]});function get(url){return new Promise(function(resolve){var xhr=new XMLHttpRequest;xhr.open("GET",url,!0),xhr.onload=function(){return resolve(xhr.responseText)},xhr.send(null)})}function _load_themes(){var fn;return fn=regeneratorRuntime.mark(function _callee(){var themes,_loop2,_iterator3,_isArray3,_i3,_ref3;return regeneratorRuntime.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:themes=document.head.querySelectorAll("link[is=custom-style]"),_loop2=regeneratorRuntime.mark(function _loop2(){var url,css;return regeneratorRuntime.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:if(!_isArray3){_context.next=6;break}if(_i3>=_iterator3.length)return _context.abrupt("return","break");_context.next=3;break;case 3:_ref3=_iterator3[_i3++],_context.next=10;break;case 6:if((_i3=_iterator3.next()).done)return _context.abrupt("return","break");_context.next=9;break;case 9:_ref3=_i3.value;case 10:return url=_ref3.getAttribute("href"),console.log("Loading theme ".concat(url," asynchronously due to IE")),_context.next=15,get(url);case 15:css=_context.sent,window.ShadyCSS.CustomStyleInterface.addCustomStyle({getStyle:function(){var style=document.createElement("style");return style.textContent=css,style}});case 17:case"end":return _context.stop()}},_loop2,this)}),_iterator3=themes,_isArray3=Array.isArray(_iterator3),_i3=0,_iterator3=_isArray3?_iterator3:_iterator3[Symbol.iterator]();case 3:return _context2.delegateYield(_loop2(),"t0",4);case 4:if("break"===_context2.t0)return _context2.abrupt("break",9);_context2.next=7;break;case 7:_context2.next=3;break;case 9:case"end":return _context2.stop()}},_callee,this)}),(_load_themes=function(){var self=this,args=arguments;return new Promise(function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)})}).apply(this,arguments)}exports.array_attribute=array_attribute,(0,_detectie.default)()&&window.addEventListener("load",function(){return _load_themes.apply(this,arguments)})},function(module,exports,__webpack_require__){(module.exports=__webpack_require__(130)(!1)).push([module.i,'/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\n.ol-box {\n  box-sizing: border-box;\n  border-radius: 2px;\n  border: 2px solid blue;\n}\n\n.ol-mouse-position {\n  top: 8px;\n  right: 8px;\n  position: absolute;\n}\n\n.ol-scale-line {\n  background: rgba(0,60,136,0.3);\n  border-radius: 4px;\n  bottom: 8px;\n  left: 8px;\n  padding: 2px;\n  position: absolute;\n}\n.ol-scale-line-inner {\n  border: 1px solid #eee;\n  border-top: none;\n  color: #eee;\n  font-size: 10px;\n  text-align: center;\n  margin: 1px;\n  will-change: contents, width;\n}\n.ol-overlay-container {\n  will-change: left,right,top,bottom;\n}\n\n.ol-unsupported {\n  display: none;\n}\n.ol-viewport, .ol-unselectable {\n  -webkit-touch-callout: none;\n  -webkit-user-select: none;\n  -moz-user-select: none;\n  -ms-user-select: none;\n  user-select: none;\n  -webkit-tap-highlight-color: rgba(0,0,0,0);\n}\n.ol-selectable {\n  -webkit-touch-callout: default;\n  -webkit-user-select: text;\n  -moz-user-select: text;\n  -ms-user-select: text;\n  user-select: text;\n}\n.ol-grabbing {\n  cursor: -webkit-grabbing;\n  cursor: -moz-grabbing;\n  cursor: grabbing;\n}\n.ol-grab {\n  cursor: move;\n  cursor: -webkit-grab;\n  cursor: -moz-grab;\n  cursor: grab;\n}\n.ol-control {\n  position: absolute;\n  background-color: rgba(255,255,255,0.4);\n  border-radius: 4px;\n  padding: 2px;\n}\n.ol-control:hover {\n  background-color: rgba(255,255,255,0.6);\n}\n.ol-zoom {\n  top: .5em;\n  left: .5em;\n}\n.ol-rotate {\n  top: .5em;\n  right: .5em;\n  transition: opacity .25s linear, visibility 0s linear;\n}\n.ol-rotate.ol-hidden {\n  opacity: 0;\n  visibility: hidden;\n  transition: opacity .25s linear, visibility 0s linear .25s;\n}\n.ol-zoom-extent {\n  top: 4.643em;\n  left: .5em;\n}\n.ol-full-screen {\n  right: .5em;\n  top: .5em;\n}\n@media print {\n  .ol-control {\n    display: none;\n  }\n}\n\n.ol-control button {\n  display: block;\n  margin: 1px;\n  padding: 0;\n  color: white;\n  font-size: 1.14em;\n  font-weight: bold;\n  text-decoration: none;\n  text-align: center;\n  height: 1.375em;\n  width: 1.375em;\n  line-height: .4em;\n  background-color: rgba(0,60,136,0.5);\n  border: none;\n  border-radius: 2px;\n}\n.ol-control button::-moz-focus-inner {\n  border: none;\n  padding: 0;\n}\n.ol-zoom-extent button {\n  line-height: 1.4em;\n}\n.ol-compass {\n  display: block;\n  font-weight: normal;\n  font-size: 1.2em;\n  will-change: transform;\n}\n.ol-touch .ol-control button {\n  font-size: 1.5em;\n}\n.ol-touch .ol-zoom-extent {\n  top: 5.5em;\n}\n.ol-control button:hover,\n.ol-control button:focus {\n  text-decoration: none;\n  background-color: rgba(0,60,136,0.7);\n}\n.ol-zoom .ol-zoom-in {\n  border-radius: 2px 2px 0 0;\n}\n.ol-zoom .ol-zoom-out {\n  border-radius: 0 0 2px 2px;\n}\n\n\n.ol-attribution {\n  text-align: right;\n  bottom: .5em;\n  right: .5em;\n  max-width: calc(100% - 1.3em);\n}\n\n.ol-attribution ul {\n  margin: 0;\n  padding: 0 .5em;\n  font-size: .7rem;\n  line-height: 1.375em;\n  color: #000;\n  text-shadow: 0 0 2px #fff;\n}\n.ol-attribution li {\n  display: inline;\n  list-style: none;\n  line-height: inherit;\n}\n.ol-attribution li:not(:last-child):after {\n  content: " ";\n}\n.ol-attribution img {\n  max-height: 2em;\n  max-width: inherit;\n  vertical-align: middle;\n}\n.ol-attribution ul, .ol-attribution button {\n  display: inline-block;\n}\n.ol-attribution.ol-collapsed ul {\n  display: none;\n}\n.ol-attribution:not(.ol-collapsed) {\n  background: rgba(255,255,255,0.8);\n}\n.ol-attribution.ol-uncollapsible {\n  bottom: 0;\n  right: 0;\n  border-radius: 4px 0 0;\n  height: 1.1em;\n  line-height: 1em;\n}\n.ol-attribution.ol-uncollapsible img {\n  margin-top: -.2em;\n  max-height: 1.6em;\n}\n.ol-attribution.ol-uncollapsible button {\n  display: none;\n}\n\n.ol-zoomslider {\n  top: 4.5em;\n  left: .5em;\n  height: 200px;\n}\n.ol-zoomslider button {\n  position: relative;\n  height: 10px;\n}\n\n.ol-touch .ol-zoomslider {\n  top: 5.5em;\n}\n\n.ol-overviewmap {\n  left: 0.5em;\n  bottom: 0.5em;\n}\n.ol-overviewmap.ol-uncollapsible {\n  bottom: 0;\n  left: 0;\n  border-radius: 0 4px 0 0;\n}\n.ol-overviewmap .ol-overviewmap-map,\n.ol-overviewmap button {\n  display: inline-block;\n}\n.ol-overviewmap .ol-overviewmap-map {\n  border: 1px solid #7b98bc;\n  height: 150px;\n  margin: 2px;\n  width: 150px;\n}\n.ol-overviewmap:not(.ol-collapsed) button{\n  bottom: 1px;\n  left: 2px;\n  position: absolute;\n}\n.ol-overviewmap.ol-collapsed .ol-overviewmap-map,\n.ol-overviewmap.ol-uncollapsible button {\n  display: none;\n}\n.ol-overviewmap:not(.ol-collapsed) {\n  background: rgba(255,255,255,0.8);\n}\n.ol-overviewmap-box {\n  border: 2px dotted rgba(0,60,136,0.7);\n}\n\n.ol-overviewmap .ol-overviewmap-box:hover {\n  cursor: move;\n}\n\n:host #container {\n  position: absolute;\n  left: 0;\n  top: 0;\n  right: 0;\n  bottom: 0;\n  overflow: auto;\n  background: var(--myplugin-background, #fafafa);\n}\n:host #container .ol-zoom {\n  left: auto;\n  right: 0.5em;\n}\n',""])},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__(114),__webpack_require__(44),__webpack_require__(52),__webpack_require__(51),__webpack_require__(45),__webpack_require__(64),__webpack_require__(68),__webpack_require__(30),__webpack_require__(31);function util_abstract(){return function(){throw new Error("Unimplemented abstract method.")}()}var uidCounter_=0;function getUid(obj){return obj.ol_uid||(obj.ol_uid=String(++uidCounter_))}var ol_AssertionError=function(Error){function AssertionError(code){var message="Assertion failed. See https://openlayers.org/en/"+("v"+"5.3.2".split("-")[0])+"/doc/errors/#"+code+" for details.";Error.call(this,message),this.code=code,this.name="AssertionError",this.message=message}return Error&&(AssertionError.__proto__=Error),(AssertionError.prototype=Object.create(Error&&Error.prototype)).constructor=AssertionError}(Error),CollectionEventType_ADD="add",CollectionEventType_REMOVE="remove",ObjectEventType_PROPERTYCHANGE="propertychange",obj_assign="function"==typeof Object.assign?Object.assign:function(target,var_sources){var arguments$1=arguments;if(null==target)throw new TypeError("Cannot convert undefined or null to object");for(var output=Object(target),i=1,ii=arguments.length;i<ii;++i){var source=arguments$1[i];if(null!=source)for(var key in source)source.hasOwnProperty(key)&&(output[key]=source[key])}return output};function obj_clear(object){for(var property in object)delete object[property]}function getValues(object){var values=[];for(var property in object)values.push(object[property]);return values}function obj_isEmpty(object){var property;for(property in object)return!1;return!property}function findListener(listeners,listener,opt_this,opt_setDeleteIndex){for(var listenerObj,i=0,ii=listeners.length;i<ii;++i)if((listenerObj=listeners[i]).listener===listener&&listenerObj.bindTo===opt_this)return opt_setDeleteIndex&&(listenerObj.deleteIndex=i),listenerObj}function getListeners(target,type){var listenerMap=getListenerMap(target);return listenerMap?listenerMap[type]:void 0}function getListenerMap(target,opt_create){var listenerMap=target.ol_lm;return!listenerMap&&opt_create&&(listenerMap=target.ol_lm={}),listenerMap}function removeListeners(target,type){var listeners=getListeners(target,type);if(listeners){for(var i=0,ii=listeners.length;i<ii;++i)target.removeEventListener(type,listeners[i].boundListener),obj_clear(listeners[i]);listeners.length=0;var listenerMap=getListenerMap(target);listenerMap&&(delete listenerMap[type],0===Object.keys(listenerMap).length&&function(target){delete target.ol_lm}(target))}}function listen(target,type,listener,opt_this,opt_once){var listenerMap=getListenerMap(target,!0),listeners=listenerMap[type];listeners||(listeners=listenerMap[type]=[]);var listenerObj=findListener(listeners,listener,opt_this,!1);return listenerObj?opt_once||(listenerObj.callOnce=!1):(listenerObj={bindTo:opt_this,callOnce:!!opt_once,listener:listener,target:target,type:type},target.addEventListener(type,function(listenerObj){var boundListener=function(evt){var listener=listenerObj.listener,bindTo=listenerObj.bindTo||listenerObj.target;return listenerObj.callOnce&&unlistenByKey(listenerObj),listener.call(bindTo,evt)};return listenerObj.boundListener=boundListener}(listenerObj)),listeners.push(listenerObj)),listenerObj}function listenOnce(target,type,listener,opt_this){return listen(target,type,listener,opt_this,!0)}function unlisten(target,type,listener,opt_this){var listeners=getListeners(target,type);if(listeners){var listenerObj=findListener(listeners,listener,opt_this,!0);listenerObj&&unlistenByKey(listenerObj)}}function unlistenByKey(key){if(key&&key.target){key.target.removeEventListener(key.type,key.boundListener);var listeners=getListeners(key.target,key.type);if(listeners){var i="deleteIndex"in key?key.deleteIndex:listeners.indexOf(key);-1!==i&&listeners.splice(i,1),0===listeners.length&&removeListeners(key.target,key.type)}obj_clear(key)}}var Disposable_Disposable=function(){this.disposed_=!1};Disposable_Disposable.prototype.dispose=function(){this.disposed_||(this.disposed_=!0,this.disposeInternal())},Disposable_Disposable.prototype.disposeInternal=function(){};var ol_Disposable=Disposable_Disposable;function TRUE(){return!0}function FALSE(){return!1}function VOID(){}var Event=function(type){this.propagationStopped,this.type=type,this.target=null};function stopPropagation(evt){evt.stopPropagation()}Event.prototype.preventDefault=function(){this.propagationStopped=!0},Event.prototype.stopPropagation=function(){this.propagationStopped=!0};var events_Event=Event,events_Target=function(Disposable){function Target(){Disposable.call(this),this.pendingRemovals_={},this.dispatching_={},this.listeners_={}}return Disposable&&(Target.__proto__=Disposable),((Target.prototype=Object.create(Disposable&&Disposable.prototype)).constructor=Target).prototype.addEventListener=function(type,listener){var listeners=this.listeners_[type];listeners||(listeners=this.listeners_[type]=[]),-1===listeners.indexOf(listener)&&listeners.push(listener)},Target.prototype.dispatchEvent=function(event){var propagate,evt="string"==typeof event?new events_Event(event):event,type=evt.type,listeners=(evt.target=this).listeners_[type];if(listeners){type in this.dispatching_||(this.dispatching_[type]=0,this.pendingRemovals_[type]=0),++this.dispatching_[type];for(var i=0,ii=listeners.length;i<ii;++i)if(!1===listeners[i].call(this,evt)||evt.propagationStopped){propagate=!1;break}if(--this.dispatching_[type],0===this.dispatching_[type]){var pendingRemovals=this.pendingRemovals_[type];for(delete this.pendingRemovals_[type];pendingRemovals--;)this.removeEventListener(type,VOID);delete this.dispatching_[type]}return propagate}},Target.prototype.disposeInternal=function(){!function(target){var listenerMap=getListenerMap(target);if(listenerMap)for(var type in listenerMap)removeListeners(target,type)}(this)},Target.prototype.getListeners=function(type){return this.listeners_[type]},Target.prototype.hasListener=function(opt_type){return opt_type?opt_type in this.listeners_:0<Object.keys(this.listeners_).length},Target.prototype.removeEventListener=function(type,listener){var listeners=this.listeners_[type];if(listeners){var index=listeners.indexOf(listener);type in this.pendingRemovals_?(listeners[index]=VOID,++this.pendingRemovals_[type]):(listeners.splice(index,1),0===listeners.length&&delete this.listeners_[type])}},Target}(ol_Disposable),EventType={CHANGE:"change",CLEAR:"clear",CONTEXTMENU:"contextmenu",CLICK:"click",DBLCLICK:"dblclick",DRAGENTER:"dragenter",DRAGOVER:"dragover",DROP:"drop",ERROR:"error",KEYDOWN:"keydown",KEYPRESS:"keypress",LOAD:"load",MOUSEDOWN:"mousedown",MOUSEMOVE:"mousemove",MOUSEOUT:"mouseout",MOUSEUP:"mouseup",MOUSEWHEEL:"mousewheel",MSPOINTERDOWN:"MSPointerDown",RESIZE:"resize",TOUCHSTART:"touchstart",TOUCHMOVE:"touchmove",TOUCHEND:"touchend",WHEEL:"wheel"};var ol_Observable=function(EventTarget){function Observable(){EventTarget.call(this),this.revision_=0}return EventTarget&&(Observable.__proto__=EventTarget),((Observable.prototype=Object.create(EventTarget&&EventTarget.prototype)).constructor=Observable).prototype.changed=function(){++this.revision_,this.dispatchEvent(EventType.CHANGE)},Observable.prototype.getRevision=function(){return this.revision_},Observable.prototype.on=function(type,listener){if(Array.isArray(type)){for(var len=type.length,keys=new Array(len),i=0;i<len;++i)keys[i]=listen(this,type[i],listener);return keys}return listen(this,type,listener)},Observable.prototype.once=function(type,listener){if(Array.isArray(type)){for(var len=type.length,keys=new Array(len),i=0;i<len;++i)keys[i]=listenOnce(this,type[i],listener);return keys}return listenOnce(this,type,listener)},Observable.prototype.un=function(type,listener){if(Array.isArray(type))for(var i=0,ii=type.length;i<ii;++i)unlisten(this,type[i],listener);else unlisten(this,type,listener)},Observable}(events_Target),ObjectEvent=function(Event){function ObjectEvent(type,key,oldValue){Event.call(this,type),this.key=key,this.oldValue=oldValue}return Event&&(ObjectEvent.__proto__=Event),(ObjectEvent.prototype=Object.create(Event&&Event.prototype)).constructor=ObjectEvent}(events_Event),changeEventTypeCache={};function getChangeEventType(key){return changeEventTypeCache.hasOwnProperty(key)?changeEventTypeCache[key]:changeEventTypeCache[key]="change:"+key}var ol_Object=function(Observable){function BaseObject(opt_values){Observable.call(this),getUid(this),this.values_={},void 0!==opt_values&&this.setProperties(opt_values)}return Observable&&(BaseObject.__proto__=Observable),((BaseObject.prototype=Object.create(Observable&&Observable.prototype)).constructor=BaseObject).prototype.get=function(key){var value;return this.values_.hasOwnProperty(key)&&(value=this.values_[key]),value},BaseObject.prototype.getKeys=function(){return Object.keys(this.values_)},BaseObject.prototype.getProperties=function(){return obj_assign({},this.values_)},BaseObject.prototype.notify=function(key,oldValue){var eventType;eventType=getChangeEventType(key),this.dispatchEvent(new ObjectEvent(eventType,key,oldValue)),eventType=ObjectEventType_PROPERTYCHANGE,this.dispatchEvent(new ObjectEvent(eventType,key,oldValue))},BaseObject.prototype.set=function(key,value,opt_silent){if(opt_silent)this.values_[key]=value;else{var oldValue=this.values_[key];oldValue!==(this.values_[key]=value)&&this.notify(key,oldValue)}},BaseObject.prototype.setProperties=function(values,opt_silent){for(var key in values)this.set(key,values[key],opt_silent)},BaseObject.prototype.unset=function(key,opt_silent){if(key in this.values_){var oldValue=this.values_[key];delete this.values_[key],opt_silent||this.notify(key,oldValue)}},BaseObject}(ol_Observable),Property_LENGTH="length",CollectionEvent=function(Event){function CollectionEvent(type,opt_element){Event.call(this,type),this.element=opt_element}return Event&&(CollectionEvent.__proto__=Event),(CollectionEvent.prototype=Object.create(Event&&Event.prototype)).constructor=CollectionEvent}(events_Event),ol_Collection=function(BaseObject){function Collection(opt_array,opt_options){BaseObject.call(this);var options=opt_options||{};if(this.unique_=!!options.unique,this.array_=opt_array||[],this.unique_)for(var i=0,ii=this.array_.length;i<ii;++i)this.assertUnique_(this.array_[i],i);this.updateLength_()}return BaseObject&&(Collection.__proto__=BaseObject),((Collection.prototype=Object.create(BaseObject&&BaseObject.prototype)).constructor=Collection).prototype.clear=function(){for(;0<this.getLength();)this.pop()},Collection.prototype.extend=function(arr){for(var i=0,ii=arr.length;i<ii;++i)this.push(arr[i]);return this},Collection.prototype.forEach=function(f){for(var array=this.array_,i=0,ii=array.length;i<ii;++i)f(array[i],i,array)},Collection.prototype.getArray=function(){return this.array_},Collection.prototype.item=function(index){return this.array_[index]},Collection.prototype.getLength=function(){return this.get(Property_LENGTH)},Collection.prototype.insertAt=function(index,elem){this.unique_&&this.assertUnique_(elem),this.array_.splice(index,0,elem),this.updateLength_(),this.dispatchEvent(new CollectionEvent(CollectionEventType_ADD,elem))},Collection.prototype.pop=function(){return this.removeAt(this.getLength()-1)},Collection.prototype.push=function(elem){this.unique_&&this.assertUnique_(elem);var n=this.getLength();return this.insertAt(n,elem),this.getLength()},Collection.prototype.remove=function(elem){for(var arr=this.array_,i=0,ii=arr.length;i<ii;++i)if(arr[i]===elem)return this.removeAt(i)},Collection.prototype.removeAt=function(index){var prev=this.array_[index];return this.array_.splice(index,1),this.updateLength_(),this.dispatchEvent(new CollectionEvent(CollectionEventType_REMOVE,prev)),prev},Collection.prototype.setAt=function(index,elem){var n=this.getLength();if(index<n){this.unique_&&this.assertUnique_(elem,index);var prev=this.array_[index];this.array_[index]=elem,this.dispatchEvent(new CollectionEvent(CollectionEventType_REMOVE,prev)),this.dispatchEvent(new CollectionEvent(CollectionEventType_ADD,elem))}else{for(var j=n;j<index;++j)this.insertAt(j,void 0);this.insertAt(index,elem)}},Collection.prototype.updateLength_=function(){this.set(Property_LENGTH,this.array_.length)},Collection.prototype.assertUnique_=function(elem,opt_except){for(var i=0,ii=this.array_.length;i<ii;++i)if(this.array_[i]===elem&&i!==opt_except)throw new ol_AssertionError(58)},Collection}(ol_Object),ol_MapEvent=function(Event){function MapEvent(type,map,opt_frameState){Event.call(this,type),this.map=map,this.frameState=void 0!==opt_frameState?opt_frameState:null}return Event&&(MapEvent.__proto__=Event),(MapEvent.prototype=Object.create(Event&&Event.prototype)).constructor=MapEvent}(events_Event),ol_MapBrowserEvent=function(MapEvent){function MapBrowserEvent(type,map,browserEvent,opt_dragging,opt_frameState){MapEvent.call(this,type,map,opt_frameState),this.originalEvent=browserEvent,this.pixel=map.getEventPixel(browserEvent),this.coordinate=map.getCoordinateFromPixel(this.pixel),this.dragging=void 0!==opt_dragging&&opt_dragging}return MapEvent&&(MapBrowserEvent.__proto__=MapEvent),((MapBrowserEvent.prototype=Object.create(MapEvent&&MapEvent.prototype)).constructor=MapBrowserEvent).prototype.preventDefault=function(){MapEvent.prototype.preventDefault.call(this),this.originalEvent.preventDefault()},MapBrowserEvent.prototype.stopPropagation=function(){MapEvent.prototype.stopPropagation.call(this),this.originalEvent.stopPropagation()},MapBrowserEvent}(ol_MapEvent),ua="undefined"!=typeof navigator?navigator.userAgent.toLowerCase():"",FIREFOX=-1!==ua.indexOf("firefox"),SAFARI=-1!==ua.indexOf("safari")&&-1==ua.indexOf("chrom"),WEBKIT=-1!==ua.indexOf("webkit")&&-1==ua.indexOf("edge"),MAC=-1!==ua.indexOf("macintosh"),DEVICE_PIXEL_RATIO=window.devicePixelRatio||1,CANVAS_LINE_DASH=function(){var has=!1;try{has=!!document.createElement("canvas").getContext("2d").setLineDash}catch(e){}return has}(),TOUCH=(navigator,"ontouchstart"in window),POINTER="PointerEvent"in window,MSPOINTER=!!navigator.msPointerEnabled,MapBrowserEventType={SINGLECLICK:"singleclick",CLICK:EventType.CLICK,DBLCLICK:EventType.DBLCLICK,POINTERDRAG:"pointerdrag",POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"},ol_MapBrowserPointerEvent=function(MapBrowserEvent){function MapBrowserPointerEvent(type,map,pointerEvent,opt_dragging,opt_frameState){MapBrowserEvent.call(this,type,map,pointerEvent.originalEvent,opt_dragging,opt_frameState),this.pointerEvent=pointerEvent}return MapBrowserEvent&&(MapBrowserPointerEvent.__proto__=MapBrowserEvent),(MapBrowserPointerEvent.prototype=Object.create(MapBrowserEvent&&MapBrowserEvent.prototype)).constructor=MapBrowserPointerEvent}(ol_MapBrowserEvent),pointer_EventType_POINTERMOVE="pointermove",pointer_EventType_POINTERDOWN="pointerdown",pointer_EventType_POINTERUP="pointerup",pointer_EventType_POINTEROVER="pointerover",pointer_EventType_POINTEROUT="pointerout",pointer_EventType_POINTERENTER="pointerenter",pointer_EventType_POINTERLEAVE="pointerleave",pointer_EventType_POINTERCANCEL="pointercancel",EventSource_EventSource=function(dispatcher,mapping){this.dispatcher=dispatcher,this.mapping_=mapping};EventSource_EventSource.prototype.getEvents=function(){return Object.keys(this.mapping_)},EventSource_EventSource.prototype.getHandlerForEvent=function(eventType){return this.mapping_[eventType]};var pointer_EventSource=EventSource_EventSource,POINTER_ID=1,POINTER_TYPE="mouse";function mousedown(inEvent){if(!this.isEventSimulatedFromTouch_(inEvent)){POINTER_ID.toString()in this.pointerMap&&this.cancel(inEvent);var e=prepareEvent(inEvent,this.dispatcher);this.pointerMap[POINTER_ID.toString()]=inEvent,this.dispatcher.down(e,inEvent)}}function mousemove(inEvent){if(!this.isEventSimulatedFromTouch_(inEvent)){var e=prepareEvent(inEvent,this.dispatcher);this.dispatcher.move(e,inEvent)}}function mouseup(inEvent){if(!this.isEventSimulatedFromTouch_(inEvent)){var p=this.pointerMap[POINTER_ID.toString()];if(p&&p.button===inEvent.button){var e=prepareEvent(inEvent,this.dispatcher);this.dispatcher.up(e,inEvent),this.cleanupMouse()}}}function mouseover(inEvent){if(!this.isEventSimulatedFromTouch_(inEvent)){var e=prepareEvent(inEvent,this.dispatcher);this.dispatcher.enterOver(e,inEvent)}}function mouseout(inEvent){if(!this.isEventSimulatedFromTouch_(inEvent)){var e=prepareEvent(inEvent,this.dispatcher);this.dispatcher.leaveOut(e,inEvent)}}function prepareEvent(inEvent,dispatcher){var e=dispatcher.cloneEvent(inEvent,inEvent),pd=e.preventDefault;return e.preventDefault=function(){inEvent.preventDefault(),pd()},e.pointerId=POINTER_ID,e.isPrimary=!0,e.pointerType=POINTER_TYPE,e}var pointer_MouseSource=function(EventSource){function MouseSource(dispatcher){var mapping={mousedown:mousedown,mousemove:mousemove,mouseup:mouseup,mouseover:mouseover,mouseout:mouseout};EventSource.call(this,dispatcher,mapping),this.pointerMap=dispatcher.pointerMap,this.lastTouches=[]}return EventSource&&(MouseSource.__proto__=EventSource),((MouseSource.prototype=Object.create(EventSource&&EventSource.prototype)).constructor=MouseSource).prototype.isEventSimulatedFromTouch_=function(inEvent){for(var lts=this.lastTouches,x=inEvent.clientX,y=inEvent.clientY,i=0,l=lts.length,t=void 0;i<l&&(t=lts[i]);i++){var dx=Math.abs(x-t[0]),dy=Math.abs(y-t[1]);if(dx<=25&&dy<=25)return!0}return!1},MouseSource.prototype.cancel=function(inEvent){var e=prepareEvent(inEvent,this.dispatcher);this.dispatcher.cancel(e,inEvent),this.cleanupMouse()},MouseSource.prototype.cleanupMouse=function(){delete this.pointerMap[POINTER_ID.toString()]},MouseSource}(pointer_EventSource),POINTER_TYPES=["","unavailable","touch","pen","mouse"];function msPointerDown(inEvent){this.pointerMap[inEvent.pointerId.toString()]=inEvent;var e=this.prepareEvent_(inEvent);this.dispatcher.down(e,inEvent)}function msPointerMove(inEvent){var e=this.prepareEvent_(inEvent);this.dispatcher.move(e,inEvent)}function msPointerUp(inEvent){var e=this.prepareEvent_(inEvent);this.dispatcher.up(e,inEvent),this.cleanup(inEvent.pointerId)}function msPointerOut(inEvent){var e=this.prepareEvent_(inEvent);this.dispatcher.leaveOut(e,inEvent)}function msPointerOver(inEvent){var e=this.prepareEvent_(inEvent);this.dispatcher.enterOver(e,inEvent)}function msPointerCancel(inEvent){var e=this.prepareEvent_(inEvent);this.dispatcher.cancel(e,inEvent),this.cleanup(inEvent.pointerId)}function msLostPointerCapture(inEvent){var e=this.dispatcher.makeEvent("lostpointercapture",inEvent,inEvent);this.dispatcher.dispatchEvent(e)}function msGotPointerCapture(inEvent){var e=this.dispatcher.makeEvent("gotpointercapture",inEvent,inEvent);this.dispatcher.dispatchEvent(e)}var pointer_MsSource=function(EventSource){function MsSource(dispatcher){var mapping={MSPointerDown:msPointerDown,MSPointerMove:msPointerMove,MSPointerUp:msPointerUp,MSPointerOut:msPointerOut,MSPointerOver:msPointerOver,MSPointerCancel:msPointerCancel,MSGotPointerCapture:msGotPointerCapture,MSLostPointerCapture:msLostPointerCapture};EventSource.call(this,dispatcher,mapping),this.pointerMap=dispatcher.pointerMap}return EventSource&&(MsSource.__proto__=EventSource),((MsSource.prototype=Object.create(EventSource&&EventSource.prototype)).constructor=MsSource).prototype.prepareEvent_=function(inEvent){var e=inEvent;return"number"==typeof inEvent.pointerType&&((e=this.dispatcher.cloneEvent(inEvent,inEvent)).pointerType=POINTER_TYPES[inEvent.pointerType]),e},MsSource.prototype.cleanup=function(pointerId){delete this.pointerMap[pointerId.toString()]},MsSource}(pointer_EventSource);function pointerDown(inEvent){this.dispatcher.fireNativeEvent(inEvent)}function pointerMove(inEvent){this.dispatcher.fireNativeEvent(inEvent)}function pointerUp(inEvent){this.dispatcher.fireNativeEvent(inEvent)}function pointerOut(inEvent){this.dispatcher.fireNativeEvent(inEvent)}function pointerOver(inEvent){this.dispatcher.fireNativeEvent(inEvent)}function pointerCancel(inEvent){this.dispatcher.fireNativeEvent(inEvent)}function lostPointerCapture(inEvent){this.dispatcher.fireNativeEvent(inEvent)}function gotPointerCapture(inEvent){this.dispatcher.fireNativeEvent(inEvent)}var pointer_NativeSource=function(EventSource){function NativeSource(dispatcher){var mapping={pointerdown:pointerDown,pointermove:pointerMove,pointerup:pointerUp,pointerout:pointerOut,pointerover:pointerOver,pointercancel:pointerCancel,gotpointercapture:gotPointerCapture,lostpointercapture:lostPointerCapture};EventSource.call(this,dispatcher,mapping)}return EventSource&&(NativeSource.__proto__=EventSource),(NativeSource.prototype=Object.create(EventSource&&EventSource.prototype)).constructor=NativeSource}(pointer_EventSource),HAS_BUTTONS=!1,PointerEvent=function(_Event){function PointerEvent(type,originalEvent,opt_eventDict){_Event.call(this,type),this.originalEvent=originalEvent;var eventDict=opt_eventDict||{};this.buttons=function(eventDict){var buttons;if(eventDict.buttons||HAS_BUTTONS)buttons=eventDict.buttons;else switch(eventDict.which){case 1:buttons=1;break;case 2:buttons=4;break;case 3:buttons=2;break;default:buttons=0}return buttons}(eventDict),this.pressure=function(eventDict,buttons){var pressure=0;pressure=eventDict.pressure?eventDict.pressure:buttons?.5:0;return pressure}(eventDict,this.buttons),this.bubbles="bubbles"in eventDict&&eventDict.bubbles,this.cancelable="cancelable"in eventDict&&eventDict.cancelable,this.view="view"in eventDict?eventDict.view:null,this.detail="detail"in eventDict?eventDict.detail:null,this.screenX="screenX"in eventDict?eventDict.screenX:0,this.screenY="screenY"in eventDict?eventDict.screenY:0,this.clientX="clientX"in eventDict?eventDict.clientX:0,this.clientY="clientY"in eventDict?eventDict.clientY:0,this.ctrlKey="ctrlKey"in eventDict&&eventDict.ctrlKey,this.altKey="altKey"in eventDict&&eventDict.altKey,this.shiftKey="shiftKey"in eventDict&&eventDict.shiftKey,this.metaKey="metaKey"in eventDict&&eventDict.metaKey,this.button="button"in eventDict?eventDict.button:0,this.relatedTarget="relatedTarget"in eventDict?eventDict.relatedTarget:null,this.pointerId="pointerId"in eventDict?eventDict.pointerId:0,this.width="width"in eventDict?eventDict.width:0,this.height="height"in eventDict?eventDict.height:0,this.tiltX="tiltX"in eventDict?eventDict.tiltX:0,this.tiltY="tiltY"in eventDict?eventDict.tiltY:0,this.pointerType="pointerType"in eventDict?eventDict.pointerType:"",this.hwTimestamp="hwTimestamp"in eventDict?eventDict.hwTimestamp:0,this.isPrimary="isPrimary"in eventDict&&eventDict.isPrimary,originalEvent.preventDefault&&(this.preventDefault=function(){originalEvent.preventDefault()})}return _Event&&(PointerEvent.__proto__=_Event),(PointerEvent.prototype=Object.create(_Event&&_Event.prototype)).constructor=PointerEvent}(events_Event);!function(){try{var ev=new MouseEvent("click",{buttons:1});HAS_BUTTONS=1===ev.buttons}catch(e){}}();var pointer_PointerEvent=PointerEvent;function numberSafeCompareFunction(a,b){return b<a?1:a<b?-1:0}function linearFindNearest(arr,target,direction){var i,n=arr.length;if(arr[0]<=target)return 0;if(target<=arr[n-1])return n-1;if(0<direction){for(i=1;i<n;++i)if(arr[i]<target)return i-1}else if(direction<0){for(i=1;i<n;++i)if(arr[i]<=target)return i}else for(i=1;i<n;++i){if(arr[i]==target)return i;if(arr[i]<target)return arr[i-1]-target<target-arr[i]?i-1:i}return n-1}function reverseSubArray(arr,begin,end){for(;begin<end;){var tmp=arr[begin];arr[begin]=arr[end],arr[end]=tmp,++begin,--end}}function extend(arr,data){for(var extension=Array.isArray(data)?data:[data],length=extension.length,i=0;i<length;i++)arr[arr.length]=extension[i]}function equals(arr1,arr2){var len1=arr1.length;if(len1!==arr2.length)return!1;for(var i=0;i<len1;i++)if(arr1[i]!==arr2[i])return!1;return!0}function touchstart(inEvent){this.vacuumTouches_(inEvent),this.setPrimaryTouch_(inEvent.changedTouches[0]),this.dedupSynthMouse_(inEvent),this.clickCount_++,this.processTouches_(inEvent,this.overDown_)}function touchmove(inEvent){this.processTouches_(inEvent,this.moveOverOut_)}function touchend(inEvent){this.dedupSynthMouse_(inEvent),this.processTouches_(inEvent,this.upOut_)}function touchcancel(inEvent){this.processTouches_(inEvent,this.cancelOut_)}var pointer_TouchSource=function(EventSource){function TouchSource(dispatcher,mouseSource){var mapping={touchstart:touchstart,touchmove:touchmove,touchend:touchend,touchcancel:touchcancel};EventSource.call(this,dispatcher,mapping),this.pointerMap=dispatcher.pointerMap,this.mouseSource=mouseSource,this.firstTouchId_=void 0,this.clickCount_=0,this.resetId_,this.dedupTimeout_=2500}return EventSource&&(TouchSource.__proto__=EventSource),((TouchSource.prototype=Object.create(EventSource&&EventSource.prototype)).constructor=TouchSource).prototype.isPrimaryTouch_=function(inTouch){return this.firstTouchId_===inTouch.identifier},TouchSource.prototype.setPrimaryTouch_=function(inTouch){var count=Object.keys(this.pointerMap).length;(0===count||1===count&&POINTER_ID.toString()in this.pointerMap)&&(this.firstTouchId_=inTouch.identifier,this.cancelResetClickCount_())},TouchSource.prototype.removePrimaryPointer_=function(inPointer){inPointer.isPrimary&&(this.firstTouchId_=void 0,this.resetClickCount_())},TouchSource.prototype.resetClickCount_=function(){this.resetId_=setTimeout(this.resetClickCountHandler_.bind(this),200)},TouchSource.prototype.resetClickCountHandler_=function(){this.clickCount_=0,this.resetId_=void 0},TouchSource.prototype.cancelResetClickCount_=function(){void 0!==this.resetId_&&clearTimeout(this.resetId_)},TouchSource.prototype.touchToPointer_=function(browserEvent,inTouch){var e=this.dispatcher.cloneEvent(browserEvent,inTouch);return e.pointerId=inTouch.identifier+2,e.bubbles=!0,e.cancelable=!0,e.detail=this.clickCount_,e.button=0,e.buttons=1,e.width=inTouch.radiusX||0,e.height=inTouch.radiusY||0,e.pressure=inTouch.force||.5,e.isPrimary=this.isPrimaryTouch_(inTouch),e.pointerType="touch",e.clientX=inTouch.clientX,e.clientY=inTouch.clientY,e.screenX=inTouch.screenX,e.screenY=inTouch.screenY,e},TouchSource.prototype.processTouches_=function(inEvent,inFunction){var touches=Array.prototype.slice.call(inEvent.changedTouches),count=touches.length;function preventDefault(){inEvent.preventDefault()}for(var i=0;i<count;++i){var pointer=this.touchToPointer_(inEvent,touches[i]);pointer.preventDefault=preventDefault,inFunction.call(this,inEvent,pointer)}},TouchSource.prototype.findTouch_=function(touchList,searchId){for(var l=touchList.length,i=0;i<l;i++){if(touchList[i].identifier===searchId)return!0}return!1},TouchSource.prototype.vacuumTouches_=function(inEvent){var touchList=inEvent.touches,keys=Object.keys(this.pointerMap),count=keys.length;if(count>=touchList.length){for(var d=[],i=0;i<count;++i){var key=Number(keys[i]),value=this.pointerMap[key];key==POINTER_ID||this.findTouch_(touchList,key-2)||d.push(value.out)}for(var i$1=0;i$1<d.length;++i$1)this.cancelOut_(inEvent,d[i$1])}},TouchSource.prototype.overDown_=function(browserEvent,inPointer){this.pointerMap[inPointer.pointerId]={target:inPointer.target,out:inPointer,outTarget:inPointer.target},this.dispatcher.over(inPointer,browserEvent),this.dispatcher.enter(inPointer,browserEvent),this.dispatcher.down(inPointer,browserEvent)},TouchSource.prototype.moveOverOut_=function(browserEvent,inPointer){var event=inPointer,pointer=this.pointerMap[event.pointerId];if(pointer){var outEvent=pointer.out,outTarget=pointer.outTarget;this.dispatcher.move(event,browserEvent),outEvent&&outTarget!==event.target&&(outEvent.relatedTarget=event.target,event.relatedTarget=outTarget,outEvent.target=outTarget,event.target?(this.dispatcher.leaveOut(outEvent,browserEvent),this.dispatcher.enterOver(event,browserEvent)):(event.target=outTarget,event.relatedTarget=null,this.cancelOut_(browserEvent,event))),pointer.out=event,pointer.outTarget=event.target}},TouchSource.prototype.upOut_=function(browserEvent,inPointer){this.dispatcher.up(inPointer,browserEvent),this.dispatcher.out(inPointer,browserEvent),this.dispatcher.leave(inPointer,browserEvent),this.cleanUpPointer_(inPointer)},TouchSource.prototype.cancelOut_=function(browserEvent,inPointer){this.dispatcher.cancel(inPointer,browserEvent),this.dispatcher.out(inPointer,browserEvent),this.dispatcher.leave(inPointer,browserEvent),this.cleanUpPointer_(inPointer)},TouchSource.prototype.cleanUpPointer_=function(inPointer){delete this.pointerMap[inPointer.pointerId],this.removePrimaryPointer_(inPointer)},TouchSource.prototype.dedupSynthMouse_=function(inEvent){var lts=this.mouseSource.lastTouches,t=inEvent.changedTouches[0];if(this.isPrimaryTouch_(t)){var lt=[t.clientX,t.clientY];lts.push(lt),setTimeout(function(){var arr,obj,i;obj=lt,i=(arr=lts).indexOf(obj),-1<i&&arr.splice(i,1)},this.dedupTimeout_)}},TouchSource}(pointer_EventSource),CLONE_PROPS=[["bubbles",!1],["cancelable",!1],["view",null],["detail",null],["screenX",0],["screenY",0],["clientX",0],["clientY",0],["ctrlKey",!1],["altKey",!1],["shiftKey",!1],["metaKey",!1],["button",0],["relatedTarget",null],["buttons",0],["pointerId",0],["width",0],["height",0],["pressure",0],["tiltX",0],["tiltY",0],["pointerType",""],["hwTimestamp",0],["isPrimary",!1],["type",""],["target",null],["currentTarget",null],["which",0]],pointer_PointerEventHandler=function(EventTarget){function PointerEventHandler(element){EventTarget.call(this),this.element_=element,this.pointerMap={},this.eventMap_={},this.eventSourceList_=[],this.registerSources()}return EventTarget&&(PointerEventHandler.__proto__=EventTarget),((PointerEventHandler.prototype=Object.create(EventTarget&&EventTarget.prototype)).constructor=PointerEventHandler).prototype.registerSources=function(){if(POINTER)this.registerSource("native",new pointer_NativeSource(this));else if(MSPOINTER)this.registerSource("ms",new pointer_MsSource(this));else{var mouseSource=new pointer_MouseSource(this);this.registerSource("mouse",mouseSource),TOUCH&&this.registerSource("touch",new pointer_TouchSource(this,mouseSource))}this.register_()},PointerEventHandler.prototype.registerSource=function(name,source){var s=source,newEvents=s.getEvents();newEvents&&(newEvents.forEach(function(e){var handler=s.getHandlerForEvent(e);handler&&(this.eventMap_[e]=handler.bind(s))}.bind(this)),this.eventSourceList_.push(s))},PointerEventHandler.prototype.register_=function(){for(var l=this.eventSourceList_.length,i=0;i<l;i++){var eventSource=this.eventSourceList_[i];this.addEvents_(eventSource.getEvents())}},PointerEventHandler.prototype.unregister_=function(){for(var l=this.eventSourceList_.length,i=0;i<l;i++){var eventSource=this.eventSourceList_[i];this.removeEvents_(eventSource.getEvents())}},PointerEventHandler.prototype.eventHandler_=function(inEvent){var type=inEvent.type,handler=this.eventMap_[type];handler&&handler(inEvent)},PointerEventHandler.prototype.addEvents_=function(events){events.forEach(function(eventName){listen(this.element_,eventName,this.eventHandler_,this)}.bind(this))},PointerEventHandler.prototype.removeEvents_=function(events){events.forEach(function(e){unlisten(this.element_,e,this.eventHandler_,this)}.bind(this))},PointerEventHandler.prototype.cloneEvent=function(event,inEvent){for(var eventCopy={},i=0,ii=CLONE_PROPS.length;i<ii;i++){var p=CLONE_PROPS[i][0];eventCopy[p]=event[p]||inEvent[p]||CLONE_PROPS[i][1]}return eventCopy},PointerEventHandler.prototype.down=function(data,event){this.fireEvent(pointer_EventType_POINTERDOWN,data,event)},PointerEventHandler.prototype.move=function(data,event){this.fireEvent(pointer_EventType_POINTERMOVE,data,event)},PointerEventHandler.prototype.up=function(data,event){this.fireEvent(pointer_EventType_POINTERUP,data,event)},PointerEventHandler.prototype.enter=function(data,event){data.bubbles=!1,this.fireEvent(pointer_EventType_POINTERENTER,data,event)},PointerEventHandler.prototype.leave=function(data,event){data.bubbles=!1,this.fireEvent(pointer_EventType_POINTERLEAVE,data,event)},PointerEventHandler.prototype.over=function(data,event){data.bubbles=!0,this.fireEvent(pointer_EventType_POINTEROVER,data,event)},PointerEventHandler.prototype.out=function(data,event){data.bubbles=!0,this.fireEvent(pointer_EventType_POINTEROUT,data,event)},PointerEventHandler.prototype.cancel=function(data,event){this.fireEvent(pointer_EventType_POINTERCANCEL,data,event)},PointerEventHandler.prototype.leaveOut=function(data,event){this.out(data,event),this.contains_(data.target,data.relatedTarget)||this.leave(data,event)},PointerEventHandler.prototype.enterOver=function(data,event){this.over(data,event),this.contains_(data.target,data.relatedTarget)||this.enter(data,event)},PointerEventHandler.prototype.contains_=function(container,contained){return!(!container||!contained)&&container.contains(contained)},PointerEventHandler.prototype.makeEvent=function(inType,data,event){return new pointer_PointerEvent(inType,event,data)},PointerEventHandler.prototype.fireEvent=function(inType,data,event){var e=this.makeEvent(inType,data,event);this.dispatchEvent(e)},PointerEventHandler.prototype.fireNativeEvent=function(event){var e=this.makeEvent(event.type,event,event);this.dispatchEvent(e)},PointerEventHandler.prototype.wrapMouseEvent=function(eventType,event){return this.makeEvent(eventType,prepareEvent(event,this),event)},PointerEventHandler.prototype.disposeInternal=function(){this.unregister_(),EventTarget.prototype.disposeInternal.call(this)},PointerEventHandler}(events_Target),ol_MapBrowserEventHandler=function(EventTarget){function MapBrowserEventHandler(map,moveTolerance){EventTarget.call(this),this.map_=map,this.clickTimeoutId_,this.dragging_=!1,this.dragListenerKeys_=[],this.moveTolerance_=moveTolerance?moveTolerance*DEVICE_PIXEL_RATIO:DEVICE_PIXEL_RATIO,this.down_=null;var element=this.map_.getViewport();this.activePointers_=0,this.trackedTouches_={},this.pointerEventHandler_=new pointer_PointerEventHandler(element),this.documentPointerEventHandler_=null,this.pointerdownListenerKey_=listen(this.pointerEventHandler_,pointer_EventType_POINTERDOWN,this.handlePointerDown_,this),this.relayedListenerKey_=listen(this.pointerEventHandler_,pointer_EventType_POINTERMOVE,this.relayEvent_,this)}return EventTarget&&(MapBrowserEventHandler.__proto__=EventTarget),((MapBrowserEventHandler.prototype=Object.create(EventTarget&&EventTarget.prototype)).constructor=MapBrowserEventHandler).prototype.emulateClick_=function(pointerEvent){var newEvent=new ol_MapBrowserPointerEvent(MapBrowserEventType.CLICK,this.map_,pointerEvent);this.dispatchEvent(newEvent),void 0!==this.clickTimeoutId_?(clearTimeout(this.clickTimeoutId_),this.clickTimeoutId_=void 0,newEvent=new ol_MapBrowserPointerEvent(MapBrowserEventType.DBLCLICK,this.map_,pointerEvent),this.dispatchEvent(newEvent)):this.clickTimeoutId_=setTimeout(function(){this.clickTimeoutId_=void 0;var newEvent=new ol_MapBrowserPointerEvent(MapBrowserEventType.SINGLECLICK,this.map_,pointerEvent);this.dispatchEvent(newEvent)}.bind(this),250)},MapBrowserEventHandler.prototype.updateActivePointers_=function(pointerEvent){var event=pointerEvent;event.type==MapBrowserEventType.POINTERUP||event.type==MapBrowserEventType.POINTERCANCEL?delete this.trackedTouches_[event.pointerId]:event.type==MapBrowserEventType.POINTERDOWN&&(this.trackedTouches_[event.pointerId]=!0),this.activePointers_=Object.keys(this.trackedTouches_).length},MapBrowserEventHandler.prototype.handlePointerUp_=function(pointerEvent){this.updateActivePointers_(pointerEvent);var newEvent=new ol_MapBrowserPointerEvent(MapBrowserEventType.POINTERUP,this.map_,pointerEvent);this.dispatchEvent(newEvent),newEvent.propagationStopped||this.dragging_||!this.isMouseActionButton_(pointerEvent)||this.emulateClick_(this.down_),0===this.activePointers_&&(this.dragListenerKeys_.forEach(unlistenByKey),this.dragListenerKeys_.length=0,this.dragging_=!1,this.down_=null,this.documentPointerEventHandler_.dispose(),this.documentPointerEventHandler_=null)},MapBrowserEventHandler.prototype.isMouseActionButton_=function(pointerEvent){return 0===pointerEvent.button},MapBrowserEventHandler.prototype.handlePointerDown_=function(pointerEvent){this.updateActivePointers_(pointerEvent);var newEvent=new ol_MapBrowserPointerEvent(MapBrowserEventType.POINTERDOWN,this.map_,pointerEvent);this.dispatchEvent(newEvent),this.down_=pointerEvent,0===this.dragListenerKeys_.length&&(this.documentPointerEventHandler_=new pointer_PointerEventHandler(document),this.dragListenerKeys_.push(listen(this.documentPointerEventHandler_,MapBrowserEventType.POINTERMOVE,this.handlePointerMove_,this),listen(this.documentPointerEventHandler_,MapBrowserEventType.POINTERUP,this.handlePointerUp_,this),listen(this.pointerEventHandler_,MapBrowserEventType.POINTERCANCEL,this.handlePointerUp_,this)))},MapBrowserEventHandler.prototype.handlePointerMove_=function(pointerEvent){if(this.isMoving_(pointerEvent)){this.dragging_=!0;var newEvent=new ol_MapBrowserPointerEvent(MapBrowserEventType.POINTERDRAG,this.map_,pointerEvent,this.dragging_);this.dispatchEvent(newEvent)}pointerEvent.preventDefault()},MapBrowserEventHandler.prototype.relayEvent_=function(pointerEvent){var dragging=!(!this.down_||!this.isMoving_(pointerEvent));this.dispatchEvent(new ol_MapBrowserPointerEvent(pointerEvent.type,this.map_,pointerEvent,dragging))},MapBrowserEventHandler.prototype.isMoving_=function(pointerEvent){return this.dragging_||Math.abs(pointerEvent.clientX-this.down_.clientX)>this.moveTolerance_||Math.abs(pointerEvent.clientY-this.down_.clientY)>this.moveTolerance_},MapBrowserEventHandler.prototype.disposeInternal=function(){this.relayedListenerKey_&&(unlistenByKey(this.relayedListenerKey_),this.relayedListenerKey_=null),this.pointerdownListenerKey_&&(unlistenByKey(this.pointerdownListenerKey_),this.pointerdownListenerKey_=null),this.dragListenerKeys_.forEach(unlistenByKey),this.dragListenerKeys_.length=0,this.documentPointerEventHandler_&&(this.documentPointerEventHandler_.dispose(),this.documentPointerEventHandler_=null),this.pointerEventHandler_&&(this.pointerEventHandler_.dispose(),this.pointerEventHandler_=null),EventTarget.prototype.disposeInternal.call(this)},MapBrowserEventHandler}(events_Target),MapEventType_POSTRENDER="postrender",MapEventType_MOVESTART="movestart",MapEventType_MOVEEND="moveend",MapProperty={LAYERGROUP:"layergroup",SIZE:"size",TARGET:"target",VIEW:"view"},render_EventType_POSTCOMPOSE="postcompose",render_EventType_PRECOMPOSE="precompose",render_EventType_RENDER="render",render_EventType_RENDERCOMPLETE="rendercomplete",TileState_IDLE=0,TileState_LOADING=1,TileState_LOADED=2,TileState_ERROR=3,TileState_EMPTY=4,TileState_ABORT=5;function assert(assertion,errorCode){if(!assertion)throw new ol_AssertionError(errorCode)}var PriorityQueue_PriorityQueue=function(priorityFunction,keyFunction){this.priorityFunction_=priorityFunction,this.keyFunction_=keyFunction,this.elements_=[],this.priorities_=[],this.queuedElements_={}};PriorityQueue_PriorityQueue.prototype.clear=function(){this.elements_.length=0,this.priorities_.length=0,obj_clear(this.queuedElements_)},PriorityQueue_PriorityQueue.prototype.dequeue=function(){var elements=this.elements_,priorities=this.priorities_,element=elements[0];1==elements.length?(elements.length=0,priorities.length=0):(elements[0]=elements.pop(),priorities[0]=priorities.pop(),this.siftUp_(0));var elementKey=this.keyFunction_(element);return delete this.queuedElements_[elementKey],element},PriorityQueue_PriorityQueue.prototype.enqueue=function(element){assert(!(this.keyFunction_(element)in this.queuedElements_),31);var priority=this.priorityFunction_(element);return priority!=1/0&&(this.elements_.push(element),this.priorities_.push(priority),this.queuedElements_[this.keyFunction_(element)]=!0,this.siftDown_(0,this.elements_.length-1),!0)},PriorityQueue_PriorityQueue.prototype.getCount=function(){return this.elements_.length},PriorityQueue_PriorityQueue.prototype.getLeftChildIndex_=function(index){return 2*index+1},PriorityQueue_PriorityQueue.prototype.getRightChildIndex_=function(index){return 2*index+2},PriorityQueue_PriorityQueue.prototype.getParentIndex_=function(index){return index-1>>1},PriorityQueue_PriorityQueue.prototype.heapify_=function(){var i;for(i=(this.elements_.length>>1)-1;0<=i;i--)this.siftUp_(i)},PriorityQueue_PriorityQueue.prototype.isEmpty=function(){return 0===this.elements_.length},PriorityQueue_PriorityQueue.prototype.isKeyQueued=function(key){return key in this.queuedElements_},PriorityQueue_PriorityQueue.prototype.isQueued=function(element){return this.isKeyQueued(this.keyFunction_(element))},PriorityQueue_PriorityQueue.prototype.siftUp_=function(index){for(var elements=this.elements_,priorities=this.priorities_,count=elements.length,element=elements[index],priority=priorities[index],startIndex=index;index<count>>1;){var lIndex=this.getLeftChildIndex_(index),rIndex=this.getRightChildIndex_(index),smallerChildIndex=rIndex<count&&priorities[rIndex]<priorities[lIndex]?rIndex:lIndex;elements[index]=elements[smallerChildIndex],priorities[index]=priorities[smallerChildIndex],index=smallerChildIndex}elements[index]=element,priorities[index]=priority,this.siftDown_(startIndex,index)},PriorityQueue_PriorityQueue.prototype.siftDown_=function(startIndex,index){for(var elements=this.elements_,priorities=this.priorities_,element=elements[index],priority=priorities[index];startIndex<index;){var parentIndex=this.getParentIndex_(index);if(!(priorities[parentIndex]>priority))break;elements[index]=elements[parentIndex],priorities[index]=priorities[parentIndex],index=parentIndex}elements[index]=element,priorities[index]=priority},PriorityQueue_PriorityQueue.prototype.reprioritize=function(){var element,i,priority,priorityFunction=this.priorityFunction_,elements=this.elements_,priorities=this.priorities_,index=0,n=elements.length;for(i=0;i<n;++i)(priority=priorityFunction(element=elements[i]))==1/0?delete this.queuedElements_[this.keyFunction_(element)]:(priorities[index]=priority,elements[index++]=element);elements.length=index,priorities.length=index,this.heapify_()};var ol_TileQueue=function(PriorityQueue){function TileQueue(tilePriorityFunction,tileChangeCallback){PriorityQueue.call(this,function(element){return tilePriorityFunction.apply(null,element)},function(element){return element[0].getKey()}),this.tileChangeCallback_=tileChangeCallback,this.tilesLoading_=0,this.tilesLoadingKeys_={}}return PriorityQueue&&(TileQueue.__proto__=PriorityQueue),((TileQueue.prototype=Object.create(PriorityQueue&&PriorityQueue.prototype)).constructor=TileQueue).prototype.enqueue=function(element){var added=PriorityQueue.prototype.enqueue.call(this,element);added&&listen(element[0],EventType.CHANGE,this.handleTileChange,this);return added},TileQueue.prototype.getTilesLoading=function(){return this.tilesLoading_},TileQueue.prototype.handleTileChange=function(event){var tile=event.target,state=tile.getState();if(state===TileState_LOADED||state===TileState_ERROR||state===TileState_EMPTY||state===TileState_ABORT){unlisten(tile,EventType.CHANGE,this.handleTileChange,this);var tileKey=tile.getKey();tileKey in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[tileKey],--this.tilesLoading_),this.tileChangeCallback_()}},TileQueue.prototype.loadMoreTiles=function(maxTotalLoading,maxNewLoads){for(var state,tile,tileKey,newLoads=0,abortedTiles=!1;this.tilesLoading_<maxTotalLoading&&newLoads<maxNewLoads&&0<this.getCount();)tileKey=(tile=this.dequeue()[0]).getKey(),(state=tile.getState())===TileState_ABORT?abortedTiles=!0:state!==TileState_IDLE||tileKey in this.tilesLoadingKeys_||(this.tilesLoadingKeys_[tileKey]=!0,++this.tilesLoading_,++newLoads,tile.load());0===newLoads&&abortedTiles&&this.tileChangeCallback_()},TileQueue}(PriorityQueue_PriorityQueue),DEFAULT_MAX_ZOOM=42,DEFAULT_TILE_SIZE=256;function clamp(value,min,max){return Math.min(Math.max(value,min),max)}var cosh="cosh"in Math?Math.cosh:function(x){var y=Math.exp(x);return(y+1/y)/2};function squaredSegmentDistance(x,y,x1,y1,x2,y2){var dx=x2-x1,dy=y2-y1;if(0!==dx||0!==dy){var t=((x-x1)*dx+(y-y1)*dy)/(dx*dx+dy*dy);1<t?(x1=x2,y1=y2):0<t&&(x1+=dx*t,y1+=dy*t)}return math_squaredDistance(x,y,x1,y1)}function math_squaredDistance(x1,y1,x2,y2){var dx=x2-x1,dy=y2-y1;return dx*dx+dy*dy}function toRadians(angleInDegrees){return angleInDegrees*Math.PI/180}function modulo(a,b){var r=a%b;return r*b<0?r+b:r}function lerp(a,b,x){return a+x*(b-a)}function none(center){return center}function disable(rotation,delta){return void 0!==rotation?0:void 0}function rotationconstraint_none(rotation,delta){return void 0!==rotation?rotation+delta:void 0}var ViewHint_ANIMATING=0,ViewHint_INTERACTING=1,ViewProperty_CENTER="center",ViewProperty_RESOLUTION="resolution",ViewProperty_ROTATION="rotation";function add(coordinate,delta){return coordinate[0]+=delta[0],coordinate[1]+=delta[1],coordinate}function coordinate_rotate(coordinate,angle){var cosAngle=Math.cos(angle),sinAngle=Math.sin(angle),x=coordinate[0]*cosAngle-coordinate[1]*sinAngle,y=coordinate[1]*cosAngle+coordinate[0]*sinAngle;return coordinate[0]=x,coordinate[1]=y,coordinate}function coordinate_scale(coordinate,scale){return coordinate[0]*=scale,coordinate[1]*=scale,coordinate}function easeIn(t){return Math.pow(t,3)}function easeOut(t){return 1-easeIn(1-t)}function inAndOut(t){return 3*t*t-2*t*t*t}function linear(t){return t}var Corner={BOTTOM_LEFT:"bottom-left",BOTTOM_RIGHT:"bottom-right",TOP_LEFT:"top-left",TOP_RIGHT:"top-right"},Relationship={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16};function boundingExtent(coordinates){for(var extent=createEmpty(),i=0,ii=coordinates.length;i<ii;++i)extendCoordinate(extent,coordinates[i]);return extent}function buffer(extent,value,opt_extent){return opt_extent?(opt_extent[0]=extent[0]-value,opt_extent[1]=extent[1]-value,opt_extent[2]=extent[2]+value,opt_extent[3]=extent[3]+value,opt_extent):[extent[0]-value,extent[1]-value,extent[2]+value,extent[3]+value]}function extent_clone(extent,opt_extent){return opt_extent?(opt_extent[0]=extent[0],opt_extent[1]=extent[1],opt_extent[2]=extent[2],opt_extent[3]=extent[3],opt_extent):extent.slice()}function closestSquaredDistanceXY(extent,x,y){var dx,dy;return(dx=x<extent[0]?extent[0]-x:extent[2]<x?x-extent[2]:0)*dx+(dy=y<extent[1]?extent[1]-y:extent[3]<y?y-extent[3]:0)*dy}function containsCoordinate(extent,coordinate){return extent_containsXY(extent,coordinate[0],coordinate[1])}function containsExtent(extent1,extent2){return extent1[0]<=extent2[0]&&extent2[2]<=extent1[2]&&extent1[1]<=extent2[1]&&extent2[3]<=extent1[3]}function extent_containsXY(extent,x,y){return extent[0]<=x&&x<=extent[2]&&extent[1]<=y&&y<=extent[3]}function coordinateRelationship(extent,coordinate){var minX=extent[0],minY=extent[1],maxX=extent[2],maxY=extent[3],x=coordinate[0],y=coordinate[1],relationship=Relationship.UNKNOWN;return x<minX?relationship|=Relationship.LEFT:maxX<x&&(relationship|=Relationship.RIGHT),y<minY?relationship|=Relationship.BELOW:maxY<y&&(relationship|=Relationship.ABOVE),relationship===Relationship.UNKNOWN&&(relationship=Relationship.INTERSECTING),relationship}function createEmpty(){return[1/0,1/0,-1/0,-1/0]}function createOrUpdate(minX,minY,maxX,maxY,opt_extent){return opt_extent?(opt_extent[0]=minX,opt_extent[1]=minY,opt_extent[2]=maxX,opt_extent[3]=maxY,opt_extent):[minX,minY,maxX,maxY]}function createOrUpdateEmpty(opt_extent){return createOrUpdate(1/0,1/0,-1/0,-1/0,opt_extent)}function extent_equals(extent1,extent2){return extent1[0]==extent2[0]&&extent1[2]==extent2[2]&&extent1[1]==extent2[1]&&extent1[3]==extent2[3]}function extent_extend(extent1,extent2){return extent2[0]<extent1[0]&&(extent1[0]=extent2[0]),extent2[2]>extent1[2]&&(extent1[2]=extent2[2]),extent2[1]<extent1[1]&&(extent1[1]=extent2[1]),extent2[3]>extent1[3]&&(extent1[3]=extent2[3]),extent1}function extendCoordinate(extent,coordinate){coordinate[0]<extent[0]&&(extent[0]=coordinate[0]),coordinate[0]>extent[2]&&(extent[2]=coordinate[0]),coordinate[1]<extent[1]&&(extent[1]=coordinate[1]),coordinate[1]>extent[3]&&(extent[3]=coordinate[1])}function extendCoordinates(extent,coordinates){for(var i=0,ii=coordinates.length;i<ii;++i)extendCoordinate(extent,coordinates[i]);return extent}function extendFlatCoordinates(extent,flatCoordinates,offset,end,stride){for(;offset<end;offset+=stride)extendXY(extent,flatCoordinates[offset],flatCoordinates[offset+1]);return extent}function extendXY(extent,x,y){extent[0]=Math.min(extent[0],x),extent[1]=Math.min(extent[1],y),extent[2]=Math.max(extent[2],x),extent[3]=Math.max(extent[3],y)}function forEachCorner(extent,callback,opt_this){var val;return(val=callback.call(opt_this,getBottomLeft(extent)))?val:(val=callback.call(opt_this,getBottomRight(extent)))?val:(val=callback.call(opt_this,getTopRight(extent)))?val:(val=callback.call(opt_this,getTopLeft(extent)))||!1}function extent_getArea(extent){var area=0;return extent_isEmpty(extent)||(area=getWidth(extent)*getHeight(extent)),area}function getBottomLeft(extent){return[extent[0],extent[1]]}function getBottomRight(extent){return[extent[2],extent[1]]}function extent_getCenter(extent){return[(extent[0]+extent[2])/2,(extent[1]+extent[3])/2]}function getForViewAndSize(center,resolution,rotation,size,opt_extent){var dx=resolution*size[0]/2,dy=resolution*size[1]/2,cosRotation=Math.cos(rotation),sinRotation=Math.sin(rotation),xCos=dx*cosRotation,xSin=dx*sinRotation,yCos=dy*cosRotation,ySin=dy*sinRotation,x=center[0],y=center[1],x0=x-xCos+ySin,x1=x-xCos-ySin,x2=x+xCos-ySin,x3=x+xCos+ySin,y0=y-xSin-yCos,y1=y-xSin+yCos,y2=y+xSin+yCos,y3=y+xSin-yCos;return createOrUpdate(Math.min(x0,x1,x2,x3),Math.min(y0,y1,y2,y3),Math.max(x0,x1,x2,x3),Math.max(y0,y1,y2,y3),opt_extent)}function getHeight(extent){return extent[3]-extent[1]}function getIntersection(extent1,extent2,opt_extent){var intersection=opt_extent||[1/0,1/0,-1/0,-1/0];return extent_intersects(extent1,extent2)?(extent1[0]>extent2[0]?intersection[0]=extent1[0]:intersection[0]=extent2[0],extent1[1]>extent2[1]?intersection[1]=extent1[1]:intersection[1]=extent2[1],extent1[2]<extent2[2]?intersection[2]=extent1[2]:intersection[2]=extent2[2],extent1[3]<extent2[3]?intersection[3]=extent1[3]:intersection[3]=extent2[3]):createOrUpdateEmpty(intersection),intersection}function getTopLeft(extent){return[extent[0],extent[3]]}function getTopRight(extent){return[extent[2],extent[3]]}function getWidth(extent){return extent[2]-extent[0]}function extent_intersects(extent1,extent2){return extent1[0]<=extent2[2]&&extent1[2]>=extent2[0]&&extent1[1]<=extent2[3]&&extent1[3]>=extent2[1]}function extent_isEmpty(extent){return extent[2]<extent[0]||extent[3]<extent[1]}var GeometryType={POINT:"Point",LINE_STRING:"LineString",LINEAR_RING:"LinearRing",POLYGON:"Polygon",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon",GEOMETRY_COLLECTION:"GeometryCollection",CIRCLE:"Circle"},GeometryLayout={XY:"XY",XYZ:"XYZ",XYM:"XYM",XYZM:"XYZM"};function transform2D(flatCoordinates,offset,end,stride,transform,opt_dest){for(var dest=opt_dest||[],i=0,j=offset;j<end;j+=stride){var x=flatCoordinates[j],y=flatCoordinates[j+1];dest[i++]=transform[0]*x+transform[2]*y+transform[4],dest[i++]=transform[1]*x+transform[3]*y+transform[5]}return opt_dest&&dest.length!=i&&(dest.length=i),dest}
/**
 * @license
 * Latitude/longitude spherical geodesy formulae taken from
 * http://www.movable-type.co.uk/scripts/latlong.html
 * Licensed under CC-BY-3.0.
 */
var DEFAULT_RADIUS=6371008.8;function getDistance(c1,c2,opt_radius){var radius=opt_radius||DEFAULT_RADIUS,lat1=toRadians(c1[1]),lat2=toRadians(c2[1]),deltaLatBy2=(lat2-lat1)/2,deltaLonBy2=toRadians(c2[0]-c1[0])/2,a=Math.sin(deltaLatBy2)*Math.sin(deltaLatBy2)+Math.sin(deltaLonBy2)*Math.sin(deltaLonBy2)*Math.cos(lat1)*Math.cos(lat2);return 2*radius*Math.atan2(Math.sqrt(a),Math.sqrt(1-a))}var Units={DEGREES:"degrees",FEET:"ft",METERS:"m",PIXELS:"pixels",TILE_PIXELS:"tile-pixels",USFEET:"us-ft"},METERS_PER_UNIT={};METERS_PER_UNIT[Units.DEGREES]=2*Math.PI*6370997/360,METERS_PER_UNIT[Units.FEET]=.3048,METERS_PER_UNIT[Units.METERS]=1,METERS_PER_UNIT[Units.USFEET]=1200/3937;var proj_Units=Units,Projection_Projection=function(options){this.code_=options.code,this.units_=options.units,this.extent_=void 0!==options.extent?options.extent:null,this.worldExtent_=void 0!==options.worldExtent?options.worldExtent:null,this.axisOrientation_=void 0!==options.axisOrientation?options.axisOrientation:"enu",this.global_=void 0!==options.global&&options.global,this.canWrapX_=!(!this.global_||!this.extent_),this.getPointResolutionFunc_=options.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=options.metersPerUnit};Projection_Projection.prototype.canWrapX=function(){return this.canWrapX_},Projection_Projection.prototype.getCode=function(){return this.code_},Projection_Projection.prototype.getExtent=function(){return this.extent_},Projection_Projection.prototype.getUnits=function(){return this.units_},Projection_Projection.prototype.getMetersPerUnit=function(){return this.metersPerUnit_||METERS_PER_UNIT[this.units_]},Projection_Projection.prototype.getWorldExtent=function(){return this.worldExtent_},Projection_Projection.prototype.getAxisOrientation=function(){return this.axisOrientation_},Projection_Projection.prototype.isGlobal=function(){return this.global_},Projection_Projection.prototype.setGlobal=function(global){this.global_=global,this.canWrapX_=!(!global||!this.extent_)},Projection_Projection.prototype.getDefaultTileGrid=function(){return this.defaultTileGrid_},Projection_Projection.prototype.setDefaultTileGrid=function(tileGrid){this.defaultTileGrid_=tileGrid},Projection_Projection.prototype.setExtent=function(extent){this.extent_=extent,this.canWrapX_=!(!this.global_||!extent)},Projection_Projection.prototype.setWorldExtent=function(worldExtent){this.worldExtent_=worldExtent},Projection_Projection.prototype.setGetPointResolution=function(func){this.getPointResolutionFunc_=func},Projection_Projection.prototype.getPointResolutionFunc=function(){return this.getPointResolutionFunc_};var proj_Projection=Projection_Projection,RADIUS=6378137,HALF_SIZE=Math.PI*RADIUS,EXTENT=[-HALF_SIZE,-HALF_SIZE,HALF_SIZE,HALF_SIZE],WORLD_EXTENT=[-180,-85,180,85],epsg3857_EPSG3857Projection=function(Projection){function EPSG3857Projection(code){Projection.call(this,{code:code,units:proj_Units.METERS,extent:EXTENT,global:!0,worldExtent:WORLD_EXTENT,getPointResolution:function(resolution,point){return resolution/cosh(point[1]/RADIUS)}})}return Projection&&(EPSG3857Projection.__proto__=Projection),(EPSG3857Projection.prototype=Object.create(Projection&&Projection.prototype)).constructor=EPSG3857Projection}(proj_Projection),PROJECTIONS=[new epsg3857_EPSG3857Projection("EPSG:3857"),new epsg3857_EPSG3857Projection("EPSG:102100"),new epsg3857_EPSG3857Projection("EPSG:102113"),new epsg3857_EPSG3857Projection("EPSG:900913"),new epsg3857_EPSG3857Projection("urn:ogc:def:crs:EPSG:6.18:3:3857"),new epsg3857_EPSG3857Projection("urn:ogc:def:crs:EPSG::3857"),new epsg3857_EPSG3857Projection("http://www.opengis.net/gml/srs/epsg.xml#3857")];function fromEPSG4326(input,opt_output,opt_dimension){var length=input.length,dimension=1<opt_dimension?opt_dimension:2,output=opt_output;void 0===output&&(output=2<dimension?input.slice():new Array(length));for(var halfSize=HALF_SIZE,i=0;i<length;i+=dimension){output[i]=halfSize*input[i]/180;var y=RADIUS*Math.log(Math.tan(Math.PI*(input[i+1]+90)/360));halfSize<y?y=halfSize:y<-halfSize&&(y=-halfSize),output[i+1]=y}return output}function epsg3857_toEPSG4326(input,opt_output,opt_dimension){var length=input.length,dimension=1<opt_dimension?opt_dimension:2,output=opt_output;void 0===output&&(output=2<dimension?input.slice():new Array(length));for(var i=0;i<length;i+=dimension)output[i]=180*input[i]/HALF_SIZE,output[i+1]=360*Math.atan(Math.exp(input[i+1]/RADIUS))/Math.PI-90;return output}var epsg4326_EXTENT=[-180,-90,180,90],epsg4326_METERS_PER_UNIT=6378137*Math.PI/180,epsg4326_EPSG4326Projection=function(Projection){function EPSG4326Projection(code,opt_axisOrientation){Projection.call(this,{code:code,units:proj_Units.DEGREES,extent:epsg4326_EXTENT,axisOrientation:opt_axisOrientation,global:!0,metersPerUnit:epsg4326_METERS_PER_UNIT,worldExtent:epsg4326_EXTENT})}return Projection&&(EPSG4326Projection.__proto__=Projection),(EPSG4326Projection.prototype=Object.create(Projection&&Projection.prototype)).constructor=EPSG4326Projection}(proj_Projection),epsg4326_PROJECTIONS=[new epsg4326_EPSG4326Projection("CRS:84"),new epsg4326_EPSG4326Projection("EPSG:4326","neu"),new epsg4326_EPSG4326Projection("urn:ogc:def:crs:EPSG::4326","neu"),new epsg4326_EPSG4326Projection("urn:ogc:def:crs:EPSG:6.6:4326","neu"),new epsg4326_EPSG4326Projection("urn:ogc:def:crs:OGC:1.3:CRS84"),new epsg4326_EPSG4326Projection("urn:ogc:def:crs:OGC:2:84"),new epsg4326_EPSG4326Projection("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new epsg4326_EPSG4326Projection("urn:x-ogc:def:crs:EPSG:4326","neu")],projections_cache={};var projections2,forwardTransform,inverseTransform,transforms={};function transforms_add(source,destination,transformFn){var sourceCode=source.getCode(),destinationCode=destination.getCode();sourceCode in transforms||(transforms[sourceCode]={}),transforms[sourceCode][destinationCode]=transformFn}function cloneTransform(input,opt_output,opt_dimension){var output;if(void 0!==opt_output){for(var i=0,ii=input.length;i<ii;++i)opt_output[i]=input[i];output=opt_output}else output=input.slice();return output}function identityTransform(input,opt_output,opt_dimension){if(void 0!==opt_output&&input!==opt_output){for(var i=0,ii=input.length;i<ii;++i)opt_output[i]=input[i];input=opt_output}return input}function addProjection(projection){!function(code,projection){projections_cache[code]=projection}(projection.getCode(),projection),transforms_add(projection,projection,cloneTransform)}function proj_get(projectionLike){return"string"==typeof projectionLike?projections_cache[projectionLike]||null:projectionLike||null}function getPointResolution(projection,resolution,point,opt_units){var pointResolution,getter=(projection=proj_get(projection)).getPointResolutionFunc();if(getter)pointResolution=getter(resolution,point);else if(projection.getUnits()==proj_Units.DEGREES&&!opt_units||opt_units==proj_Units.DEGREES)pointResolution=resolution;else{var toEPSG4326=getTransformFromProjections(projection,proj_get("EPSG:4326")),vertices=[point[0]-resolution/2,point[1],point[0]+resolution/2,point[1],point[0],point[1]-resolution/2,point[0],point[1]+resolution/2];pointResolution=(getDistance((vertices=toEPSG4326(vertices,vertices,2)).slice(0,2),vertices.slice(2,4))+getDistance(vertices.slice(4,6),vertices.slice(6,8)))/2;var metersPerUnit=opt_units?METERS_PER_UNIT[opt_units]:projection.getMetersPerUnit();void 0!==metersPerUnit&&(pointResolution/=metersPerUnit)}return pointResolution}function addEquivalentProjections(projections){!function(projections){projections.forEach(addProjection)}(projections),projections.forEach(function(source){projections.forEach(function(destination){source!==destination&&transforms_add(source,destination,cloneTransform)})})}function createProjection(projection,defaultCode){return projection?"string"==typeof projection?proj_get(projection):projection:proj_get(defaultCode)}function fromLonLat(coordinate,opt_projection){return proj_transform(coordinate,"EPSG:4326",void 0!==opt_projection?opt_projection:"EPSG:3857")}function equivalent(projection1,projection2){if(projection1===projection2)return!0;var equalUnits=projection1.getUnits()===projection2.getUnits();return projection1.getCode()===projection2.getCode()?equalUnits:getTransformFromProjections(projection1,projection2)===cloneTransform&&equalUnits}function getTransformFromProjections(sourceProjection,destinationProjection){var transformFunc=function(sourceCode,destinationCode){var transform;return sourceCode in transforms&&destinationCode in transforms[sourceCode]&&(transform=transforms[sourceCode][destinationCode]),transform}(sourceProjection.getCode(),destinationProjection.getCode());return transformFunc||(transformFunc=identityTransform),transformFunc}function proj_getTransform(source,destination){return getTransformFromProjections(proj_get(source),proj_get(destination))}function proj_transform(coordinate,source,destination){return proj_getTransform(source,destination)(coordinate,void 0,coordinate.length)}addEquivalentProjections(PROJECTIONS),addEquivalentProjections(epsg4326_PROJECTIONS),projections2=PROJECTIONS,forwardTransform=fromEPSG4326,inverseTransform=epsg3857_toEPSG4326,epsg4326_PROJECTIONS.forEach(function(projection1){projections2.forEach(function(projection2){transforms_add(projection1,projection2,forwardTransform),transforms_add(projection2,projection1,inverseTransform)})});var tmp_=new Array(6);function transform_reset(transform){return transform_set(transform,1,0,0,1,0,0)}function multiply(transform1,transform2){var a1=transform1[0],b1=transform1[1],c1=transform1[2],d1=transform1[3],e1=transform1[4],f1=transform1[5],a2=transform2[0],b2=transform2[1],c2=transform2[2],d2=transform2[3],e2=transform2[4],f2=transform2[5];return transform1[0]=a1*a2+c1*b2,transform1[1]=b1*a2+d1*b2,transform1[2]=a1*c2+c1*d2,transform1[3]=b1*c2+d1*d2,transform1[4]=a1*e2+c1*f2+e1,transform1[5]=b1*e2+d1*f2+f1,transform1}function transform_set(transform,a,b,c,d,e,f){return transform[0]=a,transform[1]=b,transform[2]=c,transform[3]=d,transform[4]=e,transform[5]=f,transform}function setFromArray(transform1,transform2){return transform1[0]=transform2[0],transform1[1]=transform2[1],transform1[2]=transform2[2],transform1[3]=transform2[3],transform1[4]=transform2[4],transform1[5]=transform2[5],transform1}function apply(transform,coordinate){var x=coordinate[0],y=coordinate[1];return coordinate[0]=transform[0]*x+transform[2]*y+transform[4],coordinate[1]=transform[1]*x+transform[3]*y+transform[5],coordinate}function ol_transform_scale(transform,x,y){return multiply(transform,transform_set(tmp_,x,0,0,y,0,0))}function ol_transform_translate(transform,dx,dy){return multiply(transform,transform_set(tmp_,1,0,0,1,dx,dy))}function transform_compose(transform,dx1,dy1,sx,sy,angle,dx2,dy2){var sin=Math.sin(angle),cos=Math.cos(angle);return transform[0]=sx*cos,transform[1]=sy*sin,transform[2]=-sx*sin,transform[3]=sy*cos,transform[4]=dx2*sx*cos-dy2*sx*sin+dx1,transform[5]=dx2*sy*sin+dy2*sy*cos+dy1,transform}var tmpTransform=[1,0,0,1,0,0];function getStrideForLayout(layout){var stride;return layout==GeometryLayout.XY?stride=2:layout==GeometryLayout.XYZ||layout==GeometryLayout.XYM?stride=3:layout==GeometryLayout.XYZM&&(stride=4),stride}var geom_SimpleGeometry=function(Geometry){function SimpleGeometry(){Geometry.call(this),this.layout=GeometryLayout.XY,this.stride=2,this.flatCoordinates=null}return Geometry&&(SimpleGeometry.__proto__=Geometry),((SimpleGeometry.prototype=Object.create(Geometry&&Geometry.prototype)).constructor=SimpleGeometry).prototype.computeExtent=function(extent){return flatCoordinates=this.flatCoordinates,offset=0,end=this.flatCoordinates.length,stride=this.stride,extendFlatCoordinates(createOrUpdateEmpty(extent),flatCoordinates,offset,end,stride);var flatCoordinates,offset,end,stride},SimpleGeometry.prototype.getCoordinates=function(){return util_abstract()},SimpleGeometry.prototype.getFirstCoordinate=function(){return this.flatCoordinates.slice(0,this.stride)},SimpleGeometry.prototype.getFlatCoordinates=function(){return this.flatCoordinates},SimpleGeometry.prototype.getLastCoordinate=function(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)},SimpleGeometry.prototype.getLayout=function(){return this.layout},SimpleGeometry.prototype.getSimplifiedGeometry=function(squaredTolerance){if(this.simplifiedGeometryRevision!=this.getRevision()&&(obj_clear(this.simplifiedGeometryCache),this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),squaredTolerance<0||0!==this.simplifiedGeometryMaxMinSquaredTolerance&&squaredTolerance<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;var key=squaredTolerance.toString();if(this.simplifiedGeometryCache.hasOwnProperty(key))return this.simplifiedGeometryCache[key];var simplifiedGeometry=this.getSimplifiedGeometryInternal(squaredTolerance);return simplifiedGeometry.getFlatCoordinates().length<this.flatCoordinates.length?this.simplifiedGeometryCache[key]=simplifiedGeometry:(this.simplifiedGeometryMaxMinSquaredTolerance=squaredTolerance,this)},SimpleGeometry.prototype.getSimplifiedGeometryInternal=function(squaredTolerance){return this},SimpleGeometry.prototype.getStride=function(){return this.stride},SimpleGeometry.prototype.setFlatCoordinates=function(layout,flatCoordinates){this.stride=getStrideForLayout(layout),this.layout=layout,this.flatCoordinates=flatCoordinates},SimpleGeometry.prototype.setCoordinates=function(coordinates,opt_layout){util_abstract()},SimpleGeometry.prototype.setLayout=function(layout,coordinates,nesting){var stride;if(layout)stride=getStrideForLayout(layout);else{for(var i=0;i<nesting;++i){if(0===coordinates.length)return this.layout=GeometryLayout.XY,void(this.stride=2);coordinates=coordinates[0]}layout=function(stride){var layout;2==stride?layout=GeometryLayout.XY:3==stride?layout=GeometryLayout.XYZ:4==stride&&(layout=GeometryLayout.XYZM);return layout}(stride=coordinates.length)}this.layout=layout,this.stride=stride},SimpleGeometry.prototype.applyTransform=function(transformFn){this.flatCoordinates&&(transformFn(this.flatCoordinates,this.flatCoordinates,this.stride),this.changed())},SimpleGeometry.prototype.rotate=function(angle,anchor){var flatCoordinates=this.getFlatCoordinates();if(flatCoordinates){var stride=this.getStride();!function(flatCoordinates,offset,end,stride,angle,anchor,opt_dest){for(var dest=opt_dest||[],cos=Math.cos(angle),sin=Math.sin(angle),anchorX=anchor[0],anchorY=anchor[1],i=0,j=offset;j<end;j+=stride){var deltaX=flatCoordinates[j]-anchorX,deltaY=flatCoordinates[j+1]-anchorY;dest[i++]=anchorX+deltaX*cos-deltaY*sin,dest[i++]=anchorY+deltaX*sin+deltaY*cos;for(var k=j+2;k<j+stride;++k)dest[i++]=flatCoordinates[k]}opt_dest&&dest.length!=i&&(dest.length=i)}(flatCoordinates,0,flatCoordinates.length,stride,angle,anchor,flatCoordinates),this.changed()}},SimpleGeometry.prototype.scale=function(sx,opt_sy,opt_anchor){var sy=opt_sy;void 0===sy&&(sy=sx);var anchor=opt_anchor;anchor||(anchor=extent_getCenter(this.getExtent()));var flatCoordinates=this.getFlatCoordinates();if(flatCoordinates){var stride=this.getStride();!function(flatCoordinates,offset,end,stride,sx,sy,anchor,opt_dest){for(var dest=opt_dest||[],anchorX=anchor[0],anchorY=anchor[1],i=0,j=offset;j<end;j+=stride){var deltaX=flatCoordinates[j]-anchorX,deltaY=flatCoordinates[j+1]-anchorY;dest[i++]=anchorX+sx*deltaX,dest[i++]=anchorY+sy*deltaY;for(var k=j+2;k<j+stride;++k)dest[i++]=flatCoordinates[k]}opt_dest&&dest.length!=i&&(dest.length=i)}(flatCoordinates,0,flatCoordinates.length,stride,sx,sy,anchor,flatCoordinates),this.changed()}},SimpleGeometry.prototype.translate=function(deltaX,deltaY){var flatCoordinates=this.getFlatCoordinates();if(flatCoordinates){var stride=this.getStride();!function(flatCoordinates,offset,end,stride,deltaX,deltaY,opt_dest){for(var dest=opt_dest||[],i=0,j=offset;j<end;j+=stride){dest[i++]=flatCoordinates[j]+deltaX,dest[i++]=flatCoordinates[j+1]+deltaY;for(var k=j+2;k<j+stride;++k)dest[i++]=flatCoordinates[k]}opt_dest&&dest.length!=i&&(dest.length=i)}(flatCoordinates,0,flatCoordinates.length,stride,deltaX,deltaY,flatCoordinates),this.changed()}},SimpleGeometry}(function(BaseObject){function Geometry(){BaseObject.call(this),this.extent_=[1/0,1/0,-1/0,-1/0],this.extentRevision_=-1,this.simplifiedGeometryCache={},this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=0}return BaseObject&&(Geometry.__proto__=BaseObject),((Geometry.prototype=Object.create(BaseObject&&BaseObject.prototype)).constructor=Geometry).prototype.clone=function(){return util_abstract()},Geometry.prototype.closestPointXY=function(x,y,closestPoint,minSquaredDistance){return util_abstract()},Geometry.prototype.containsXY=function(x,y){return!1},Geometry.prototype.getClosestPoint=function(point,opt_closestPoint){var closestPoint=opt_closestPoint||[NaN,NaN];return this.closestPointXY(point[0],point[1],closestPoint,1/0),closestPoint},Geometry.prototype.intersectsCoordinate=function(coordinate){return this.containsXY(coordinate[0],coordinate[1])},Geometry.prototype.computeExtent=function(extent){return util_abstract()},Geometry.prototype.getExtent=function(opt_extent){return this.extentRevision_!=this.getRevision()&&(this.extent_=this.computeExtent(this.extent_),this.extentRevision_=this.getRevision()),function(extent,opt_extent){return opt_extent?(opt_extent[0]=extent[0],opt_extent[1]=extent[1],opt_extent[2]=extent[2],opt_extent[3]=extent[3],opt_extent):extent}(this.extent_,opt_extent)},Geometry.prototype.rotate=function(angle,anchor){util_abstract()},Geometry.prototype.scale=function(sx,opt_sy,opt_anchor){util_abstract()},Geometry.prototype.simplify=function(tolerance){return this.getSimplifiedGeometry(tolerance*tolerance)},Geometry.prototype.getSimplifiedGeometry=function(squaredTolerance){return util_abstract()},Geometry.prototype.getType=function(){return util_abstract()},Geometry.prototype.applyTransform=function(transformFn){util_abstract()},Geometry.prototype.intersectsExtent=function(extent){return util_abstract()},Geometry.prototype.translate=function(deltaX,deltaY){util_abstract()},Geometry.prototype.transform=function(source,destination){var sourceProj=proj_get(source),transformFn=sourceProj.getUnits()==proj_Units.TILE_PIXELS?function(inCoordinates,outCoordinates,stride){var pixelExtent=sourceProj.getExtent(),projectedExtent=sourceProj.getWorldExtent(),scale=getHeight(projectedExtent)/getHeight(pixelExtent);return transform_compose(tmpTransform,projectedExtent[0],projectedExtent[3],scale,-scale,0,0,0),transform2D(inCoordinates,0,inCoordinates.length,stride,tmpTransform,outCoordinates),proj_getTransform(sourceProj,destination)(inCoordinates,outCoordinates,stride)}:proj_getTransform(sourceProj,destination);return this.applyTransform(transformFn),this},Geometry}(ol_Object));function area_linearRing(flatCoordinates,offset,end,stride){for(var twiceArea=0,x1=flatCoordinates[end-stride],y1=flatCoordinates[end-stride+1];offset<end;offset+=stride){var x2=flatCoordinates[offset],y2=flatCoordinates[offset+1];twiceArea+=y1*x2-x1*y2,x1=x2,y1=y2}return twiceArea/2}function area_linearRings(flatCoordinates,offset,ends,stride){for(var area=0,i=0,ii=ends.length;i<ii;++i){var end=ends[i];area+=area_linearRing(flatCoordinates,offset,end,stride),offset=end}return area}function assignClosest(flatCoordinates,offset1,offset2,stride,x,y,closestPoint){var offset,x1=flatCoordinates[offset1],y1=flatCoordinates[offset1+1],dx=flatCoordinates[offset2]-x1,dy=flatCoordinates[offset2+1]-y1;if(0===dx&&0===dy)offset=offset1;else{var t=((x-x1)*dx+(y-y1)*dy)/(dx*dx+dy*dy);if(1<t)offset=offset2;else{if(0<t){for(var i=0;i<stride;++i)closestPoint[i]=lerp(flatCoordinates[offset1+i],flatCoordinates[offset2+i],t);return void(closestPoint.length=stride)}offset=offset1}}for(var i$1=0;i$1<stride;++i$1)closestPoint[i$1]=flatCoordinates[offset+i$1];closestPoint.length=stride}function maxSquaredDelta(flatCoordinates,offset,end,stride,max){var x1=flatCoordinates[offset],y1=flatCoordinates[offset+1];for(offset+=stride;offset<end;offset+=stride){var x2=flatCoordinates[offset],y2=flatCoordinates[offset+1],squaredDelta=math_squaredDistance(x1,y1,x2,y2);max<squaredDelta&&(max=squaredDelta),x1=x2,y1=y2}return max}function arrayMaxSquaredDelta(flatCoordinates,offset,ends,stride,max){for(var i=0,ii=ends.length;i<ii;++i){var end=ends[i];max=maxSquaredDelta(flatCoordinates,offset,end,stride,max),offset=end}return max}function assignClosestPoint(flatCoordinates,offset,end,stride,maxDelta,isRing,x,y,closestPoint,minSquaredDistance,opt_tmpPoint){if(offset==end)return minSquaredDistance;var i,squaredDistance;if(0===maxDelta){if((squaredDistance=math_squaredDistance(x,y,flatCoordinates[offset],flatCoordinates[offset+1]))<minSquaredDistance){for(i=0;i<stride;++i)closestPoint[i]=flatCoordinates[offset+i];return closestPoint.length=stride,squaredDistance}return minSquaredDistance}for(var tmpPoint=opt_tmpPoint||[NaN,NaN],index=offset+stride;index<end;)if(assignClosest(flatCoordinates,index-stride,index,stride,x,y,tmpPoint),(squaredDistance=math_squaredDistance(x,y,tmpPoint[0],tmpPoint[1]))<minSquaredDistance){for(minSquaredDistance=squaredDistance,i=0;i<stride;++i)closestPoint[i]=tmpPoint[i];index+=closestPoint.length=stride}else index+=stride*Math.max((Math.sqrt(squaredDistance)-Math.sqrt(minSquaredDistance))/maxDelta|0,1);if(isRing&&(assignClosest(flatCoordinates,end-stride,offset,stride,x,y,tmpPoint),(squaredDistance=math_squaredDistance(x,y,tmpPoint[0],tmpPoint[1]))<minSquaredDistance)){for(minSquaredDistance=squaredDistance,i=0;i<stride;++i)closestPoint[i]=tmpPoint[i];closestPoint.length=stride}return minSquaredDistance}function assignClosestArrayPoint(flatCoordinates,offset,ends,stride,maxDelta,isRing,x,y,closestPoint,minSquaredDistance,opt_tmpPoint){for(var tmpPoint=opt_tmpPoint||[NaN,NaN],i=0,ii=ends.length;i<ii;++i){var end=ends[i];minSquaredDistance=assignClosestPoint(flatCoordinates,offset,end,stride,maxDelta,isRing,x,y,closestPoint,minSquaredDistance,tmpPoint),offset=end}return minSquaredDistance}function deflateCoordinate(flatCoordinates,offset,coordinate,stride){for(var i=0,ii=coordinate.length;i<ii;++i)flatCoordinates[offset++]=coordinate[i];return offset}function deflateCoordinates(flatCoordinates,offset,coordinates,stride){for(var i=0,ii=coordinates.length;i<ii;++i)for(var coordinate=coordinates[i],j=0;j<stride;++j)flatCoordinates[offset++]=coordinate[j];return offset}function deflateCoordinatesArray(flatCoordinates,offset,coordinatess,stride,opt_ends){for(var ends=opt_ends||[],i=0,j=0,jj=coordinatess.length;j<jj;++j){var end=deflateCoordinates(flatCoordinates,offset,coordinatess[j],stride);offset=ends[i++]=end}return ends.length=i,ends}function inflateCoordinates(flatCoordinates,offset,end,stride,opt_coordinates){for(var coordinates=void 0!==opt_coordinates?opt_coordinates:[],i=0,j=offset;j<end;j+=stride)coordinates[i++]=flatCoordinates.slice(j,j+stride);return coordinates.length=i,coordinates}function inflateCoordinatesArray(flatCoordinates,offset,ends,stride,opt_coordinatess){for(var coordinatess=void 0!==opt_coordinatess?opt_coordinatess:[],i=0,j=0,jj=ends.length;j<jj;++j){var end=ends[j];coordinatess[i++]=inflateCoordinates(flatCoordinates,offset,end,stride,coordinatess[i]),offset=end}return coordinatess.length=i,coordinatess}function inflateMultiCoordinatesArray(flatCoordinates,offset,endss,stride,opt_coordinatesss){for(var coordinatesss=void 0!==opt_coordinatesss?opt_coordinatesss:[],i=0,j=0,jj=endss.length;j<jj;++j){var ends=endss[j];coordinatesss[i++]=inflateCoordinatesArray(flatCoordinates,offset,ends,stride,coordinatesss[i]),offset=ends[ends.length-1]}return coordinatesss.length=i,coordinatesss}function douglasPeucker(flatCoordinates,offset,end,stride,squaredTolerance,simplifiedFlatCoordinates,simplifiedOffset){var n=(end-offset)/stride;if(n<3){for(;offset<end;offset+=stride)simplifiedFlatCoordinates[simplifiedOffset++]=flatCoordinates[offset],simplifiedFlatCoordinates[simplifiedOffset++]=flatCoordinates[offset+1];return simplifiedOffset}var markers=new Array(n);markers[0]=1,markers[n-1]=1;for(var stack=[offset,end-stride],index=0;0<stack.length;){for(var last=stack.pop(),first=stack.pop(),maxSquaredDistance=0,x1=flatCoordinates[first],y1=flatCoordinates[first+1],x2=flatCoordinates[last],y2=flatCoordinates[last+1],i=first+stride;i<last;i+=stride){var squaredDistance=squaredSegmentDistance(flatCoordinates[i],flatCoordinates[i+1],x1,y1,x2,y2);maxSquaredDistance<squaredDistance&&(index=i,maxSquaredDistance=squaredDistance)}squaredTolerance<maxSquaredDistance&&(markers[(index-offset)/stride]=1,first+stride<index&&stack.push(first,index),index+stride<last&&stack.push(index,last))}for(var i$1=0;i$1<n;++i$1)markers[i$1]&&(simplifiedFlatCoordinates[simplifiedOffset++]=flatCoordinates[offset+i$1*stride],simplifiedFlatCoordinates[simplifiedOffset++]=flatCoordinates[offset+i$1*stride+1]);return simplifiedOffset}function snap(value,tolerance){return tolerance*Math.round(value/tolerance)}function quantize(flatCoordinates,offset,end,stride,tolerance,simplifiedFlatCoordinates,simplifiedOffset){if(offset==end)return simplifiedOffset;var x2,y2,x1=snap(flatCoordinates[offset],tolerance),y1=snap(flatCoordinates[offset+1],tolerance);offset+=stride,simplifiedFlatCoordinates[simplifiedOffset++]=x1,simplifiedFlatCoordinates[simplifiedOffset++]=y1;do{if(x2=snap(flatCoordinates[offset],tolerance),y2=snap(flatCoordinates[offset+1],tolerance),(offset+=stride)==end)return simplifiedFlatCoordinates[simplifiedOffset++]=x2,simplifiedFlatCoordinates[simplifiedOffset++]=y2,simplifiedOffset}while(x2==x1&&y2==y1);for(;offset<end;){var x3=snap(flatCoordinates[offset],tolerance),y3=snap(flatCoordinates[offset+1],tolerance);if(offset+=stride,x3!=x2||y3!=y2){var dx1=x2-x1,dy1=y2-y1,dx2=x3-x1,dy2=y3-y1;y2=(x2=(dx1*dy2==dy1*dx2&&(dx1<0&&dx2<dx1||dx1==dx2||0<dx1&&dx1<dx2)&&(dy1<0&&dy2<dy1||dy1==dy2||0<dy1&&dy1<dy2)||(x1=simplifiedFlatCoordinates[simplifiedOffset++]=x2,y1=simplifiedFlatCoordinates[simplifiedOffset++]=y2),x3),y3)}}return simplifiedFlatCoordinates[simplifiedOffset++]=x2,simplifiedFlatCoordinates[simplifiedOffset++]=y2,simplifiedOffset}function quantizeArray(flatCoordinates,offset,ends,stride,tolerance,simplifiedFlatCoordinates,simplifiedOffset,simplifiedEnds){for(var i=0,ii=ends.length;i<ii;++i){var end=ends[i];simplifiedOffset=quantize(flatCoordinates,offset,end,stride,tolerance,simplifiedFlatCoordinates,simplifiedOffset),simplifiedEnds.push(simplifiedOffset),offset=end}return simplifiedOffset}var geom_LinearRing=function(SimpleGeometry){function LinearRing(coordinates,opt_layout){SimpleGeometry.call(this),this.maxDelta_=-1,this.maxDeltaRevision_=-1,void 0===opt_layout||Array.isArray(coordinates[0])?this.setCoordinates(coordinates,opt_layout):this.setFlatCoordinates(opt_layout,coordinates)}return SimpleGeometry&&(LinearRing.__proto__=SimpleGeometry),((LinearRing.prototype=Object.create(SimpleGeometry&&SimpleGeometry.prototype)).constructor=LinearRing).prototype.clone=function(){return new LinearRing(this.flatCoordinates.slice(),this.layout)},LinearRing.prototype.closestPointXY=function(x,y,closestPoint,minSquaredDistance){return minSquaredDistance<closestSquaredDistanceXY(this.getExtent(),x,y)?minSquaredDistance:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(maxSquaredDelta(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),assignClosestPoint(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,x,y,closestPoint,minSquaredDistance))},LinearRing.prototype.getArea=function(){return area_linearRing(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},LinearRing.prototype.getCoordinates=function(){return inflateCoordinates(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},LinearRing.prototype.getSimplifiedGeometryInternal=function(squaredTolerance){var simplifiedFlatCoordinates=[];return simplifiedFlatCoordinates.length=douglasPeucker(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,squaredTolerance,simplifiedFlatCoordinates,0),new LinearRing(simplifiedFlatCoordinates,GeometryLayout.XY)},LinearRing.prototype.getType=function(){return GeometryType.LINEAR_RING},LinearRing.prototype.intersectsExtent=function(extent){return!1},LinearRing.prototype.setCoordinates=function(coordinates,opt_layout){this.setLayout(opt_layout,coordinates,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=deflateCoordinates(this.flatCoordinates,0,coordinates,this.stride),this.changed()},LinearRing}(geom_SimpleGeometry),geom_Point=function(SimpleGeometry){function Point(coordinates,opt_layout){SimpleGeometry.call(this),this.setCoordinates(coordinates,opt_layout)}return SimpleGeometry&&(Point.__proto__=SimpleGeometry),((Point.prototype=Object.create(SimpleGeometry&&SimpleGeometry.prototype)).constructor=Point).prototype.clone=function(){return new Point(this.flatCoordinates.slice(),this.layout)},Point.prototype.closestPointXY=function(x,y,closestPoint,minSquaredDistance){var flatCoordinates=this.flatCoordinates,squaredDistance=math_squaredDistance(x,y,flatCoordinates[0],flatCoordinates[1]);if(squaredDistance<minSquaredDistance){for(var stride=this.stride,i=0;i<stride;++i)closestPoint[i]=flatCoordinates[i];return closestPoint.length=stride,squaredDistance}return minSquaredDistance},Point.prototype.getCoordinates=function(){return this.flatCoordinates?this.flatCoordinates.slice():[]},Point.prototype.computeExtent=function(extent){return coordinate=this.flatCoordinates,opt_extent=extent,x=coordinate[0],y=coordinate[1],createOrUpdate(x,y,x,y,opt_extent);var coordinate,opt_extent,x,y},Point.prototype.getType=function(){return GeometryType.POINT},Point.prototype.intersectsExtent=function(extent){return extent_containsXY(extent,this.flatCoordinates[0],this.flatCoordinates[1])},Point.prototype.setCoordinates=function(coordinates,opt_layout){this.setLayout(opt_layout,coordinates,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=deflateCoordinate(this.flatCoordinates,0,coordinates,this.stride),this.changed()},Point}(geom_SimpleGeometry);function linearRingContainsExtent(flatCoordinates,offset,end,stride,extent){return!forEachCorner(extent,function(coordinate){return!linearRingContainsXY(flatCoordinates,offset,end,stride,coordinate[0],coordinate[1])})}function linearRingContainsXY(flatCoordinates,offset,end,stride,x,y){for(var wn=0,x1=flatCoordinates[end-stride],y1=flatCoordinates[end-stride+1];offset<end;offset+=stride){var x2=flatCoordinates[offset],y2=flatCoordinates[offset+1];y1<=y?y<y2&&0<(x2-x1)*(y-y1)-(x-x1)*(y2-y1)&&wn++:y2<=y&&(x2-x1)*(y-y1)-(x-x1)*(y2-y1)<0&&wn--,x1=x2,y1=y2}return 0!==wn}function linearRingsContainsXY(flatCoordinates,offset,ends,stride,x,y){if(0===ends.length)return!1;if(!linearRingContainsXY(flatCoordinates,offset,ends[0],stride,x,y))return!1;for(var i=1,ii=ends.length;i<ii;++i)if(linearRingContainsXY(flatCoordinates,ends[i-1],ends[i],stride,x,y))return!1;return!0}function getInteriorPointOfArray(flatCoordinates,offset,ends,stride,flatCenters,flatCentersOffset,opt_dest){for(var i,ii,x,x1,x2,y1,y2,y=flatCenters[flatCentersOffset+1],intersections=[],r=0,rr=ends.length;r<rr;++r){var end=ends[r];for(x1=flatCoordinates[end-stride],y1=flatCoordinates[end-stride+1],i=offset;i<end;i+=stride)x2=flatCoordinates[i],y2=flatCoordinates[i+1],(y<=y1&&y2<=y||y1<=y&&y<=y2)&&(x=(y-y1)/(y2-y1)*(x2-x1)+x1,intersections.push(x)),x1=x2,y1=y2}var pointX=NaN,maxSegmentLength=-1/0;for(intersections.sort(numberSafeCompareFunction),x1=intersections[0],i=1,ii=intersections.length;i<ii;++i){x2=intersections[i];var segmentLength=Math.abs(x2-x1);maxSegmentLength<segmentLength&&linearRingsContainsXY(flatCoordinates,offset,ends,stride,x=(x1+x2)/2,y)&&(pointX=x,maxSegmentLength=segmentLength),x1=x2}return isNaN(pointX)&&(pointX=flatCenters[flatCentersOffset]),opt_dest?(opt_dest.push(pointX,y,maxSegmentLength),opt_dest):[pointX,y,maxSegmentLength]}function intersectsLineString(flatCoordinates,offset,end,stride,extent){var coordinatesExtent=extendFlatCoordinates([1/0,1/0,-1/0,-1/0],flatCoordinates,offset,end,stride);return!!extent_intersects(extent,coordinatesExtent)&&(!!containsExtent(extent,coordinatesExtent)||(coordinatesExtent[0]>=extent[0]&&coordinatesExtent[2]<=extent[2]||(coordinatesExtent[1]>=extent[1]&&coordinatesExtent[3]<=extent[3]||function(flatCoordinates,offset,end,stride,callback,opt_this){for(var ret,point1=[flatCoordinates[offset],flatCoordinates[offset+1]],point2=[];offset+stride<end;offset+=stride){if(point2[0]=flatCoordinates[offset+stride],point2[1]=flatCoordinates[offset+stride+1],ret=callback.call(opt_this,point1,point2))return ret;point1[0]=point2[0],point1[1]=point2[1]}return!1}(flatCoordinates,offset,end,stride,function(point1,point2){return function(extent,start,end){var intersects=!1,startRel=coordinateRelationship(extent,start),endRel=coordinateRelationship(extent,end);if(startRel===Relationship.INTERSECTING||endRel===Relationship.INTERSECTING)intersects=!0;else{var x,y,minX=extent[0],minY=extent[1],maxX=extent[2],maxY=extent[3],startX=start[0],startY=start[1],endX=end[0],endY=end[1],slope=(endY-startY)/(endX-startX);endRel&Relationship.ABOVE&&!(startRel&Relationship.ABOVE)&&(intersects=minX<=(x=endX-(endY-maxY)/slope)&&x<=maxX),intersects||!(endRel&Relationship.RIGHT)||startRel&Relationship.RIGHT||(intersects=minY<=(y=endY-(endX-maxX)*slope)&&y<=maxY),intersects||!(endRel&Relationship.BELOW)||startRel&Relationship.BELOW||(intersects=minX<=(x=endX-(endY-minY)/slope)&&x<=maxX),intersects||!(endRel&Relationship.LEFT)||startRel&Relationship.LEFT||(intersects=minY<=(y=endY-(endX-minX)*slope)&&y<=maxY)}return intersects}(extent,point1,point2)}))))}function intersectsLinearRingArray(flatCoordinates,offset,ends,stride,extent){if(!function(flatCoordinates,offset,end,stride,extent){return!!(intersectsLineString(flatCoordinates,offset,end,stride,extent)||linearRingContainsXY(flatCoordinates,offset,end,stride,extent[0],extent[1])||linearRingContainsXY(flatCoordinates,offset,end,stride,extent[0],extent[3])||linearRingContainsXY(flatCoordinates,offset,end,stride,extent[2],extent[1])||linearRingContainsXY(flatCoordinates,offset,end,stride,extent[2],extent[3]))}(flatCoordinates,offset,ends[0],stride,extent))return!1;if(1===ends.length)return!0;for(var i=1,ii=ends.length;i<ii;++i)if(linearRingContainsExtent(flatCoordinates,ends[i-1],ends[i],stride,extent)&&!intersectsLineString(flatCoordinates,ends[i-1],ends[i],stride,extent))return!1;return!0}function reverse_coordinates(flatCoordinates,offset,end,stride){for(;offset<end-stride;){for(var i=0;i<stride;++i){var tmp=flatCoordinates[offset+i];flatCoordinates[offset+i]=flatCoordinates[end-stride+i],flatCoordinates[end-stride+i]=tmp}offset+=stride,end-=stride}}function linearRingIsClockwise(flatCoordinates,offset,end,stride){for(var edge=0,x1=flatCoordinates[end-stride],y1=flatCoordinates[end-stride+1];offset<end;offset+=stride){var x2=flatCoordinates[offset],y2=flatCoordinates[offset+1];edge+=(x2-x1)*(y2+y1),x1=x2,y1=y2}return 0<edge}function linearRingIsOriented(flatCoordinates,offset,ends,stride,opt_right){for(var right=void 0!==opt_right&&opt_right,i=0,ii=ends.length;i<ii;++i){var end=ends[i],isClockwise=linearRingIsClockwise(flatCoordinates,offset,end,stride);if(0===i){if(right&&isClockwise||!right&&!isClockwise)return!1}else if(right&&!isClockwise||!right&&isClockwise)return!1;offset=end}return!0}function orientLinearRings(flatCoordinates,offset,ends,stride,opt_right){for(var right=void 0!==opt_right&&opt_right,i=0,ii=ends.length;i<ii;++i){var end=ends[i],isClockwise=linearRingIsClockwise(flatCoordinates,offset,end,stride);(0===i?right&&isClockwise||!right&&!isClockwise:right&&!isClockwise||!right&&isClockwise)&&reverse_coordinates(flatCoordinates,offset,end,stride),offset=end}return offset}var Polygon_Polygon=function(SimpleGeometry){function Polygon(coordinates,opt_layout,opt_ends){SimpleGeometry.call(this),this.ends_=[],this.flatInteriorPointRevision_=-1,this.flatInteriorPoint_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,void 0!==opt_layout&&opt_ends?(this.setFlatCoordinates(opt_layout,coordinates),this.ends_=opt_ends):this.setCoordinates(coordinates,opt_layout)}return SimpleGeometry&&(Polygon.__proto__=SimpleGeometry),((Polygon.prototype=Object.create(SimpleGeometry&&SimpleGeometry.prototype)).constructor=Polygon).prototype.appendLinearRing=function(linearRing){this.flatCoordinates?extend(this.flatCoordinates,linearRing.getFlatCoordinates()):this.flatCoordinates=linearRing.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()},Polygon.prototype.clone=function(){return new Polygon(this.flatCoordinates.slice(),this.layout,this.ends_.slice())},Polygon.prototype.closestPointXY=function(x,y,closestPoint,minSquaredDistance){return minSquaredDistance<closestSquaredDistanceXY(this.getExtent(),x,y)?minSquaredDistance:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(arrayMaxSquaredDelta(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),assignClosestArrayPoint(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,x,y,closestPoint,minSquaredDistance))},Polygon.prototype.containsXY=function(x,y){return linearRingsContainsXY(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,x,y)},Polygon.prototype.getArea=function(){return area_linearRings(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)},Polygon.prototype.getCoordinates=function(opt_right){var flatCoordinates;return void 0!==opt_right?orientLinearRings(flatCoordinates=this.getOrientedFlatCoordinates().slice(),0,this.ends_,this.stride,opt_right):flatCoordinates=this.flatCoordinates,inflateCoordinatesArray(flatCoordinates,0,this.ends_,this.stride)},Polygon.prototype.getEnds=function(){return this.ends_},Polygon.prototype.getFlatInteriorPoint=function(){if(this.flatInteriorPointRevision_!=this.getRevision()){var flatCenter=extent_getCenter(this.getExtent());this.flatInteriorPoint_=getInteriorPointOfArray(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,flatCenter,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_},Polygon.prototype.getInteriorPoint=function(){return new geom_Point(this.getFlatInteriorPoint(),GeometryLayout.XYM)},Polygon.prototype.getLinearRingCount=function(){return this.ends_.length},Polygon.prototype.getLinearRing=function(index){return index<0||this.ends_.length<=index?null:new geom_LinearRing(this.flatCoordinates.slice(0===index?0:this.ends_[index-1],this.ends_[index]),this.layout)},Polygon.prototype.getLinearRings=function(){for(var layout=this.layout,flatCoordinates=this.flatCoordinates,ends=this.ends_,linearRings=[],offset=0,i=0,ii=ends.length;i<ii;++i){var end=ends[i],linearRing=new geom_LinearRing(flatCoordinates.slice(offset,end),layout);linearRings.push(linearRing),offset=end}return linearRings},Polygon.prototype.getOrientedFlatCoordinates=function(){if(this.orientedRevision_!=this.getRevision()){var flatCoordinates=this.flatCoordinates;linearRingIsOriented(flatCoordinates,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=flatCoordinates:(this.orientedFlatCoordinates_=flatCoordinates.slice(),this.orientedFlatCoordinates_.length=orientLinearRings(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_},Polygon.prototype.getSimplifiedGeometryInternal=function(squaredTolerance){var simplifiedFlatCoordinates=[],simplifiedEnds=[];return simplifiedFlatCoordinates.length=quantizeArray(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(squaredTolerance),simplifiedFlatCoordinates,0,simplifiedEnds),new Polygon(simplifiedFlatCoordinates,GeometryLayout.XY,simplifiedEnds)},Polygon.prototype.getType=function(){return GeometryType.POLYGON},Polygon.prototype.intersectsExtent=function(extent){return intersectsLinearRingArray(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,extent)},Polygon.prototype.setCoordinates=function(coordinates,opt_layout){this.setLayout(opt_layout,coordinates,2),this.flatCoordinates||(this.flatCoordinates=[]);var ends=deflateCoordinatesArray(this.flatCoordinates,0,coordinates,this.stride,this.ends_);this.flatCoordinates.length=0===ends.length?0:ends[ends.length-1],this.changed()},Polygon}(geom_SimpleGeometry),geom_Polygon=Polygon_Polygon;function fromExtent(extent){var minX=extent[0],minY=extent[1],maxX=extent[2],maxY=extent[3],flatCoordinates=[minX,minY,minX,maxY,maxX,maxY,maxX,minY,minX,minY];return new Polygon_Polygon(flatCoordinates,GeometryLayout.XY,[flatCoordinates.length])}function animationCallback(callback,returnValue){setTimeout(function(){callback(returnValue)},0)}function isNoopAnimation(animation){return!(animation.sourceCenter&&animation.targetCenter&&!function(coordinate1,coordinate2){for(var equals=!0,i=coordinate1.length-1;0<=i;--i)if(coordinate1[i]!=coordinate2[i]){equals=!1;break}return equals}(animation.sourceCenter,animation.targetCenter))&&(animation.sourceResolution===animation.targetResolution&&animation.sourceRotation===animation.targetRotation)}var ol_View=function(BaseObject){function View(opt_options){BaseObject.call(this);var options=obj_assign({},opt_options);this.hints_=[0,0],this.animations_=[],this.updateAnimationKey_,this.updateAnimations_=this.updateAnimations_.bind(this),this.projection_=createProjection(options.projection,"EPSG:3857"),this.applyOptions_(options)}return BaseObject&&(View.__proto__=BaseObject),((View.prototype=Object.create(BaseObject&&BaseObject.prototype)).constructor=View).prototype.applyOptions_=function(options){var properties={};properties[ViewProperty_CENTER]=void 0!==options.center?options.center:null;var resolutionConstraintInfo=function(options){var resolutionConstraint,maxResolution,minResolution,minZoom=void 0!==options.minZoom?options.minZoom:0,maxZoom=void 0!==options.maxZoom?options.maxZoom:28,zoomFactor=void 0!==options.zoomFactor?options.zoomFactor:2;if(void 0!==options.resolutions){var resolutions=options.resolutions;maxResolution=resolutions[minZoom],minResolution=void 0!==resolutions[maxZoom]?resolutions[maxZoom]:resolutions[resolutions.length-1],resolutionConstraint=function(resolutions){return function(resolution,delta,direction){if(void 0!==resolution){var z=linearFindNearest(resolutions,resolution,direction);z=clamp(z+delta,0,resolutions.length-1);var index=Math.floor(z);if(z!=index&&index<resolutions.length-1){var power=resolutions[index]/resolutions[index+1];return resolutions[index]/Math.pow(power,z-index)}return resolutions[index]}}}(resolutions)}else{var projection=createProjection(options.projection,"EPSG:3857"),extent=projection.getExtent(),size=extent?Math.max(getWidth(extent),getHeight(extent)):360*METERS_PER_UNIT[proj_Units.DEGREES]/projection.getMetersPerUnit(),defaultMaxResolution=size/DEFAULT_TILE_SIZE/Math.pow(2,0),defaultMinResolution=defaultMaxResolution/Math.pow(2,28);void 0!==(maxResolution=options.maxResolution)?minZoom=0:maxResolution=defaultMaxResolution/Math.pow(zoomFactor,minZoom),void 0===(minResolution=options.minResolution)&&(minResolution=void 0!==options.maxZoom?void 0!==options.maxResolution?maxResolution/Math.pow(zoomFactor,maxZoom):defaultMaxResolution/Math.pow(zoomFactor,maxZoom):defaultMinResolution),maxZoom=minZoom+Math.floor(Math.log(maxResolution/minResolution)/Math.log(zoomFactor)),minResolution=maxResolution/Math.pow(zoomFactor,maxZoom-minZoom),resolutionConstraint=function(power,maxResolution,opt_maxLevel){return function(resolution,delta,direction){if(void 0!==resolution){var offset=-direction/2+.5,oldLevel=Math.floor(Math.log(maxResolution/resolution)/Math.log(power)+offset),newLevel=Math.max(oldLevel+delta,0);return void 0!==opt_maxLevel&&(newLevel=Math.min(newLevel,opt_maxLevel)),maxResolution/Math.pow(power,newLevel)}}}(zoomFactor,maxResolution,maxZoom-minZoom)}return{constraint:resolutionConstraint,maxResolution:maxResolution,minResolution:minResolution,minZoom:minZoom,zoomFactor:zoomFactor}}(options);this.maxResolution_=resolutionConstraintInfo.maxResolution,this.minResolution_=resolutionConstraintInfo.minResolution,this.zoomFactor_=resolutionConstraintInfo.zoomFactor,this.resolutions_=options.resolutions,this.minZoom_=resolutionConstraintInfo.minZoom;var centerConstraint=function(options){return void 0!==options.extent?(extent=options.extent,function(center){return center?[clamp(center[0],extent[0],extent[2]),clamp(center[1],extent[1],extent[3])]:void 0}):none;var extent}(options),resolutionConstraint=resolutionConstraintInfo.constraint,rotationConstraint=function(options){{if(void 0===options.enableRotation||options.enableRotation){var constrainRotation=options.constrainRotation;return void 0===constrainRotation||!0===constrainRotation?(tolerance=opt_tolerance||toRadians(5),function(rotation,delta){return void 0!==rotation?Math.abs(rotation+delta)<=tolerance?0:rotation+delta:void 0}):!1===constrainRotation?rotationconstraint_none:"number"==typeof constrainRotation?(n=constrainRotation,theta=2*Math.PI/n,function(rotation,delta){return void 0!==rotation?rotation=Math.floor((rotation+delta)/theta+.5)*theta:void 0}):rotationconstraint_none}return disable}var n,theta;var opt_tolerance,tolerance}(options);this.constraints_={center:centerConstraint,resolution:resolutionConstraint,rotation:rotationConstraint},void 0!==options.resolution?properties[ViewProperty_RESOLUTION]=options.resolution:void 0!==options.zoom&&(properties[ViewProperty_RESOLUTION]=this.constrainResolution(this.maxResolution_,options.zoom-this.minZoom_),this.resolutions_&&(properties[ViewProperty_RESOLUTION]=clamp(Number(this.getResolution()||properties[ViewProperty_RESOLUTION]),this.minResolution_,this.maxResolution_))),properties[ViewProperty_ROTATION]=void 0!==options.rotation?options.rotation:0,this.setProperties(properties),this.options_=options},View.prototype.getUpdatedOptions_=function(newOptions){var options=obj_assign({},this.options_);return void 0!==options.resolution?options.resolution=this.getResolution():options.zoom=this.getZoom(),options.center=this.getCenter(),options.rotation=this.getRotation(),obj_assign({},options,newOptions)},View.prototype.animate=function(var_args){var callback,arguments$1=arguments,animationCount=arguments.length;if(1<animationCount&&"function"==typeof arguments[animationCount-1]&&(callback=arguments[animationCount-1],--animationCount),!this.isDef()){var state=arguments[animationCount-1];return state.center&&this.setCenter(state.center),void 0!==state.zoom&&this.setZoom(state.zoom),void 0!==state.rotation&&this.setRotation(state.rotation),void(callback&&animationCallback(callback,!0))}for(var start=Date.now(),center=this.getCenter().slice(),resolution=this.getResolution(),rotation=this.getRotation(),series=[],i=0;i<animationCount;++i){var options=arguments$1[i],animation={start:start,complete:!1,anchor:options.anchor,duration:void 0!==options.duration?options.duration:1e3,easing:options.easing||inAndOut};if(options.center&&(animation.sourceCenter=center,animation.targetCenter=options.center,center=animation.targetCenter),void 0!==options.zoom?(animation.sourceResolution=resolution,animation.targetResolution=this.constrainResolution(this.maxResolution_,options.zoom-this.minZoom_,0),resolution=animation.targetResolution):options.resolution&&(animation.sourceResolution=resolution,animation.targetResolution=options.resolution,resolution=animation.targetResolution),void 0!==options.rotation){animation.sourceRotation=rotation;var delta=modulo(options.rotation-rotation+Math.PI,2*Math.PI)-Math.PI;animation.targetRotation=rotation+delta,rotation=animation.targetRotation}animation.callback=callback,isNoopAnimation(animation)?animation.complete=!0:start+=animation.duration,series.push(animation)}this.animations_.push(series),this.setHint(ViewHint_ANIMATING,1),this.updateAnimations_()},View.prototype.getAnimating=function(){return 0<this.hints_[ViewHint_ANIMATING]},View.prototype.getInteracting=function(){return 0<this.hints_[ViewHint_INTERACTING]},View.prototype.cancelAnimations=function(){this.setHint(ViewHint_ANIMATING,-this.hints_[ViewHint_ANIMATING]);for(var i=0,ii=this.animations_.length;i<ii;++i){var series=this.animations_[i];series[0].callback&&animationCallback(series[0].callback,!1)}this.animations_.length=0},View.prototype.updateAnimations_=function(){if(void 0!==this.updateAnimationKey_&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),this.getAnimating()){for(var now=Date.now(),more=!1,i=this.animations_.length-1;0<=i;--i){for(var series=this.animations_[i],seriesComplete=!0,j=0,jj=series.length;j<jj;++j){var animation=series[j];if(!animation.complete){var elapsed=now-animation.start,fraction=0<animation.duration?elapsed/animation.duration:1;1<=fraction?(animation.complete=!0,fraction=1):seriesComplete=!1;var progress=animation.easing(fraction);if(animation.sourceCenter){var x0=animation.sourceCenter[0],y0=animation.sourceCenter[1],x=x0+progress*(animation.targetCenter[0]-x0),y=y0+progress*(animation.targetCenter[1]-y0);this.set(ViewProperty_CENTER,[x,y])}if(animation.sourceResolution&&animation.targetResolution){var resolution=1===progress?animation.targetResolution:animation.sourceResolution+progress*(animation.targetResolution-animation.sourceResolution);animation.anchor&&this.set(ViewProperty_CENTER,this.calculateCenterZoom(resolution,animation.anchor)),this.set(ViewProperty_RESOLUTION,resolution)}if(void 0!==animation.sourceRotation&&void 0!==animation.targetRotation){var rotation=1===progress?modulo(animation.targetRotation+Math.PI,2*Math.PI)-Math.PI:animation.sourceRotation+progress*(animation.targetRotation-animation.sourceRotation);animation.anchor&&this.set(ViewProperty_CENTER,this.calculateCenterRotate(rotation,animation.anchor)),this.set(ViewProperty_ROTATION,rotation)}if(more=!0,!animation.complete)break}}if(seriesComplete){this.animations_[i]=null,this.setHint(ViewHint_ANIMATING,-1);var callback=series[0].callback;callback&&animationCallback(callback,!0)}}this.animations_=this.animations_.filter(Boolean),more&&void 0===this.updateAnimationKey_&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_))}},View.prototype.calculateCenterRotate=function(rotation,anchor){var center,currentCenter=this.getCenter();return void 0!==currentCenter&&(coordinate_rotate(center=[currentCenter[0]-anchor[0],currentCenter[1]-anchor[1]],rotation-this.getRotation()),add(center,anchor)),center},View.prototype.calculateCenterZoom=function(resolution,anchor){var center,currentCenter=this.getCenter(),currentResolution=this.getResolution();void 0!==currentCenter&&void 0!==currentResolution&&(center=[anchor[0]-resolution*(anchor[0]-currentCenter[0])/currentResolution,anchor[1]-resolution*(anchor[1]-currentCenter[1])/currentResolution]);return center},View.prototype.getSizeFromViewport_=function(){var size=[100,100],selector='.ol-viewport[data-view="'+getUid(this)+'"]',element=document.querySelector(selector);if(element){var metrics=getComputedStyle(element);size[0]=parseInt(metrics.width,10),size[1]=parseInt(metrics.height,10)}return size},View.prototype.constrainCenter=function(center){return this.constraints_.center(center)},View.prototype.constrainResolution=function(resolution,opt_delta,opt_direction){var delta=opt_delta||0,direction=opt_direction||0;return this.constraints_.resolution(resolution,delta,direction)},View.prototype.constrainRotation=function(rotation,opt_delta){var delta=opt_delta||0;return this.constraints_.rotation(rotation,delta)},View.prototype.getCenter=function(){return this.get(ViewProperty_CENTER)},View.prototype.getConstraints=function(){return this.constraints_},View.prototype.getHints=function(opt_hints){return void 0!==opt_hints?(opt_hints[0]=this.hints_[0],opt_hints[1]=this.hints_[1],opt_hints):this.hints_.slice()},View.prototype.calculateExtent=function(opt_size){var size=opt_size||this.getSizeFromViewport_(),center=this.getCenter();assert(center,1);var resolution=this.getResolution();assert(void 0!==resolution,2);var rotation=this.getRotation();return assert(void 0!==rotation,3),getForViewAndSize(center,resolution,rotation,size)},View.prototype.getMaxResolution=function(){return this.maxResolution_},View.prototype.getMinResolution=function(){return this.minResolution_},View.prototype.getMaxZoom=function(){return this.getZoomForResolution(this.minResolution_)},View.prototype.setMaxZoom=function(zoom){this.applyOptions_(this.getUpdatedOptions_({maxZoom:zoom}))},View.prototype.getMinZoom=function(){return this.getZoomForResolution(this.maxResolution_)},View.prototype.setMinZoom=function(zoom){this.applyOptions_(this.getUpdatedOptions_({minZoom:zoom}))},View.prototype.getProjection=function(){return this.projection_},View.prototype.getResolution=function(){return this.get(ViewProperty_RESOLUTION)},View.prototype.getResolutions=function(){return this.resolutions_},View.prototype.getResolutionForExtent=function(extent,opt_size){var size=opt_size||this.getSizeFromViewport_(),xResolution=getWidth(extent)/size[0],yResolution=getHeight(extent)/size[1];return Math.max(xResolution,yResolution)},View.prototype.getResolutionForValueFunction=function(opt_power){var power=opt_power||2,maxResolution=this.maxResolution_,minResolution=this.minResolution_,max=Math.log(maxResolution/minResolution)/Math.log(power);return function(value){return maxResolution/Math.pow(power,value*max)}},View.prototype.getRotation=function(){return this.get(ViewProperty_ROTATION)},View.prototype.getValueForResolutionFunction=function(opt_power){var power=opt_power||2,maxResolution=this.maxResolution_,minResolution=this.minResolution_,max=Math.log(maxResolution/minResolution)/Math.log(power);return function(resolution){return Math.log(maxResolution/resolution)/Math.log(power)/max}},View.prototype.getState=function(pixelRatio){var center=this.getCenter(),projection=this.getProjection(),resolution=this.getResolution(),pixelResolution=resolution/pixelRatio,rotation=this.getRotation();return{center:[Math.round(center[0]/pixelResolution)*pixelResolution,Math.round(center[1]/pixelResolution)*pixelResolution],projection:void 0!==projection?projection:null,resolution:resolution,rotation:rotation,zoom:this.getZoom()}},View.prototype.getZoom=function(){var zoom,resolution=this.getResolution();return void 0!==resolution&&(zoom=this.getZoomForResolution(resolution)),zoom},View.prototype.getZoomForResolution=function(resolution){var max,zoomFactor,offset=this.minZoom_||0;if(this.resolutions_){var nearest=linearFindNearest(this.resolutions_,resolution,1);offset=nearest,max=this.resolutions_[nearest],zoomFactor=nearest==this.resolutions_.length-1?2:max/this.resolutions_[nearest+1]}else max=this.maxResolution_,zoomFactor=this.zoomFactor_;return offset+Math.log(max/resolution)/Math.log(zoomFactor)},View.prototype.getResolutionForZoom=function(zoom){return this.constrainResolution(this.maxResolution_,zoom-this.minZoom_,0)},View.prototype.fit=function(geometryOrExtent,opt_options){var geometry,options=opt_options||{},size=options.size;size||(size=this.getSizeFromViewport_()),assert(Array.isArray(geometryOrExtent)||"function"==typeof geometryOrExtent.getSimplifiedGeometry,24),Array.isArray(geometryOrExtent)?(assert(!extent_isEmpty(geometryOrExtent),25),geometry=fromExtent(geometryOrExtent)):geometryOrExtent.getType()===GeometryType.CIRCLE?(geometry=fromExtent(geometryOrExtent=geometryOrExtent.getExtent())).rotate(this.getRotation(),extent_getCenter(geometryOrExtent)):geometry=geometryOrExtent;var minResolution,padding=void 0!==options.padding?options.padding:[0,0,0,0],constrainResolution=void 0===options.constrainResolution||options.constrainResolution,nearest=void 0!==options.nearest&&options.nearest;minResolution=void 0!==options.minResolution?options.minResolution:void 0!==options.maxZoom?this.constrainResolution(this.maxResolution_,options.maxZoom-this.minZoom_,0):0;for(var coords=geometry.getFlatCoordinates(),rotation=this.getRotation(),cosAngle=Math.cos(-rotation),sinAngle=Math.sin(-rotation),minRotX=1/0,minRotY=1/0,maxRotX=-1/0,maxRotY=-1/0,stride=geometry.getStride(),i=0,ii=coords.length;i<ii;i+=stride){var rotX=coords[i]*cosAngle-coords[i+1]*sinAngle,rotY=coords[i]*sinAngle+coords[i+1]*cosAngle;minRotX=Math.min(minRotX,rotX),minRotY=Math.min(minRotY,rotY),maxRotX=Math.max(maxRotX,rotX),maxRotY=Math.max(maxRotY,rotY)}var resolution=this.getResolutionForExtent([minRotX,minRotY,maxRotX,maxRotY],[size[0]-padding[1]-padding[3],size[1]-padding[0]-padding[2]]);if(resolution=isNaN(resolution)?minResolution:Math.max(resolution,minResolution),constrainResolution){var constrainedResolution=this.constrainResolution(resolution,0,0);!nearest&&constrainedResolution<resolution&&(constrainedResolution=this.constrainResolution(constrainedResolution,-1,0)),resolution=constrainedResolution}sinAngle=-sinAngle;var centerRotX=(minRotX+maxRotX)/2,centerRotY=(minRotY+maxRotY)/2,center=[(centerRotX+=(padding[1]-padding[3])/2*resolution)*cosAngle-(centerRotY+=(padding[0]-padding[2])/2*resolution)*sinAngle,centerRotY*cosAngle+centerRotX*sinAngle],callback=options.callback?options.callback:VOID;void 0!==options.duration?this.animate({resolution:resolution,center:center,duration:options.duration,easing:options.easing},callback):(this.setResolution(resolution),this.setCenter(center),animationCallback(callback,!0))},View.prototype.centerOn=function(coordinate,size,position){var rotation=this.getRotation(),cosAngle=Math.cos(-rotation),sinAngle=Math.sin(-rotation),rotX=coordinate[0]*cosAngle-coordinate[1]*sinAngle,rotY=coordinate[1]*cosAngle+coordinate[0]*sinAngle,resolution=this.getResolution(),centerX=(rotX+=(size[0]/2-position[0])*resolution)*cosAngle-(rotY+=(position[1]-size[1]/2)*resolution)*(sinAngle=-sinAngle),centerY=rotY*cosAngle+rotX*sinAngle;this.setCenter([centerX,centerY])},View.prototype.isDef=function(){return!!this.getCenter()&&void 0!==this.getResolution()},View.prototype.rotate=function(rotation,opt_anchor){if(void 0!==opt_anchor){var center=this.calculateCenterRotate(rotation,opt_anchor);this.setCenter(center)}this.setRotation(rotation)},View.prototype.setCenter=function(center){this.set(ViewProperty_CENTER,center),this.getAnimating()&&this.cancelAnimations()},View.prototype.setHint=function(hint,delta){return this.hints_[hint]+=delta,this.changed(),this.hints_[hint]},View.prototype.setResolution=function(resolution){this.set(ViewProperty_RESOLUTION,resolution),this.getAnimating()&&this.cancelAnimations()},View.prototype.setRotation=function(rotation){this.set(ViewProperty_ROTATION,rotation),this.getAnimating()&&this.cancelAnimations()},View.prototype.setZoom=function(zoom){this.setResolution(this.getResolutionForZoom(zoom))},View}(ol_Object);function createCanvasContext2D(opt_width,opt_height){var canvas=document.createElement("canvas");return opt_width&&(canvas.width=opt_width),opt_height&&(canvas.height=opt_height),canvas.getContext("2d")}function replaceNode(newNode,oldNode){var parent=oldNode.parentNode;parent&&parent.replaceChild(newNode,oldNode)}function removeNode(node){return node&&node.parentNode?node.parentNode.removeChild(node):null}var layer_Property_OPACITY="opacity",layer_Property_VISIBLE="visible",layer_Property_EXTENT="extent",layer_Property_Z_INDEX="zIndex",layer_Property_MAX_RESOLUTION="maxResolution",layer_Property_MIN_RESOLUTION="minResolution",layer_Property_SOURCE="source",Base=function(BaseObject){function BaseLayer(options){BaseObject.call(this);var properties=obj_assign({},options);properties[layer_Property_OPACITY]=void 0!==options.opacity?options.opacity:1,properties[layer_Property_VISIBLE]=void 0===options.visible||options.visible,properties[layer_Property_Z_INDEX]=options.zIndex,properties[layer_Property_MAX_RESOLUTION]=void 0!==options.maxResolution?options.maxResolution:1/0,properties[layer_Property_MIN_RESOLUTION]=void 0!==options.minResolution?options.minResolution:0,this.setProperties(properties),this.state_=null,this.type}return BaseObject&&(BaseLayer.__proto__=BaseObject),((BaseLayer.prototype=Object.create(BaseObject&&BaseObject.prototype)).constructor=BaseLayer).prototype.getType=function(){return this.type},BaseLayer.prototype.getLayerState=function(){var state=this.state_||{layer:this,managed:!0};return state.opacity=clamp(this.getOpacity(),0,1),state.sourceState=this.getSourceState(),state.visible=this.getVisible(),state.extent=this.getExtent(),state.zIndex=this.getZIndex()||0,state.maxResolution=this.getMaxResolution(),state.minResolution=Math.max(this.getMinResolution(),0),this.state_=state},BaseLayer.prototype.getLayersArray=function(opt_array){return util_abstract()},BaseLayer.prototype.getLayerStatesArray=function(opt_states){return util_abstract()},BaseLayer.prototype.getExtent=function(){return this.get(layer_Property_EXTENT)},BaseLayer.prototype.getMaxResolution=function(){return this.get(layer_Property_MAX_RESOLUTION)},BaseLayer.prototype.getMinResolution=function(){return this.get(layer_Property_MIN_RESOLUTION)},BaseLayer.prototype.getOpacity=function(){return this.get(layer_Property_OPACITY)},BaseLayer.prototype.getSourceState=function(){return util_abstract()},BaseLayer.prototype.getVisible=function(){return this.get(layer_Property_VISIBLE)},BaseLayer.prototype.getZIndex=function(){return this.get(layer_Property_Z_INDEX)},BaseLayer.prototype.setExtent=function(extent){this.set(layer_Property_EXTENT,extent)},BaseLayer.prototype.setMaxResolution=function(maxResolution){this.set(layer_Property_MAX_RESOLUTION,maxResolution)},BaseLayer.prototype.setMinResolution=function(minResolution){this.set(layer_Property_MIN_RESOLUTION,minResolution)},BaseLayer.prototype.setOpacity=function(opacity){this.set(layer_Property_OPACITY,opacity)},BaseLayer.prototype.setVisible=function(visible){this.set(layer_Property_VISIBLE,visible)},BaseLayer.prototype.setZIndex=function(zindex){this.set(layer_Property_Z_INDEX,zindex)},BaseLayer}(ol_Object),State_UNDEFINED="undefined",State_READY="ready",Group_Property_LAYERS="layers",Group=function(BaseLayer){function LayerGroup(opt_options){var options=opt_options||{},baseOptions=obj_assign({},options);delete baseOptions.layers;var layers=options.layers;BaseLayer.call(this,baseOptions),this.layersListenerKeys_=[],this.listenerKeys_={},listen(this,getChangeEventType(Group_Property_LAYERS),this.handleLayersChanged_,this),layers?Array.isArray(layers)?layers=new ol_Collection(layers.slice(),{unique:!0}):assert("function"==typeof layers.getArray,43):layers=new ol_Collection(void 0,{unique:!0}),this.setLayers(layers)}return BaseLayer&&(LayerGroup.__proto__=BaseLayer),((LayerGroup.prototype=Object.create(BaseLayer&&BaseLayer.prototype)).constructor=LayerGroup).prototype.handleLayerChange_=function(){this.changed()},LayerGroup.prototype.handleLayersChanged_=function(){this.layersListenerKeys_.forEach(unlistenByKey),this.layersListenerKeys_.length=0;var layers=this.getLayers();for(var id in this.layersListenerKeys_.push(listen(layers,CollectionEventType_ADD,this.handleLayersAdd_,this),listen(layers,CollectionEventType_REMOVE,this.handleLayersRemove_,this)),this.listenerKeys_)this.listenerKeys_[id].forEach(unlistenByKey);obj_clear(this.listenerKeys_);for(var layersArray=layers.getArray(),i=0,ii=layersArray.length;i<ii;i++){var layer=layersArray[i];this.listenerKeys_[getUid(layer)]=[listen(layer,ObjectEventType_PROPERTYCHANGE,this.handleLayerChange_,this),listen(layer,EventType.CHANGE,this.handleLayerChange_,this)]}this.changed()},LayerGroup.prototype.handleLayersAdd_=function(collectionEvent){var layer=collectionEvent.element;this.listenerKeys_[getUid(layer)]=[listen(layer,ObjectEventType_PROPERTYCHANGE,this.handleLayerChange_,this),listen(layer,EventType.CHANGE,this.handleLayerChange_,this)],this.changed()},LayerGroup.prototype.handleLayersRemove_=function(collectionEvent){var key=getUid(collectionEvent.element);this.listenerKeys_[key].forEach(unlistenByKey),delete this.listenerKeys_[key],this.changed()},LayerGroup.prototype.getLayers=function(){return this.get(Group_Property_LAYERS)},LayerGroup.prototype.setLayers=function(layers){this.set(Group_Property_LAYERS,layers)},LayerGroup.prototype.getLayersArray=function(opt_array){var array=void 0!==opt_array?opt_array:[];return this.getLayers().forEach(function(layer){layer.getLayersArray(array)}),array},LayerGroup.prototype.getLayerStatesArray=function(opt_states){var states=void 0!==opt_states?opt_states:[],pos=states.length;this.getLayers().forEach(function(layer){layer.getLayerStatesArray(states)});for(var ownLayerState=this.getLayerState(),i=pos,ii=states.length;i<ii;i++){var layerState=states[i];layerState.opacity*=ownLayerState.opacity,layerState.visible=layerState.visible&&ownLayerState.visible,layerState.maxResolution=Math.min(layerState.maxResolution,ownLayerState.maxResolution),layerState.minResolution=Math.max(layerState.minResolution,ownLayerState.minResolution),void 0!==ownLayerState.extent&&(void 0!==layerState.extent?layerState.extent=getIntersection(layerState.extent,ownLayerState.extent):layerState.extent=ownLayerState.extent)}return states},LayerGroup.prototype.getSourceState=function(){return State_READY},LayerGroup}(Base);function toSize(size,opt_size){return Array.isArray(size)?size:(void 0===opt_size?opt_size=[size,size]:opt_size[0]=opt_size[1]=size,opt_size)}var ol_PluggableMap=function(BaseObject){function PluggableMap(options){BaseObject.call(this);var optionsInternal=function(options){var keyboardEventTarget=null;void 0!==options.keyboardEventTarget&&(keyboardEventTarget="string"==typeof options.keyboardEventTarget?document.getElementById(options.keyboardEventTarget):options.keyboardEventTarget);var controls,interactions,overlays,values={},layerGroup=options.layers&&"function"==typeof options.layers.getLayers?options.layers:new Group({layers:options.layers});values[MapProperty.LAYERGROUP]=layerGroup,values[MapProperty.TARGET]=options.target,values[MapProperty.VIEW]=void 0!==options.view?options.view:new ol_View,void 0!==options.controls&&(controls=Array.isArray(options.controls)?new ol_Collection(options.controls.slice()):(assert("function"==typeof options.controls.getArray,47),options.controls));void 0!==options.interactions&&(interactions=Array.isArray(options.interactions)?new ol_Collection(options.interactions.slice()):(assert("function"==typeof options.interactions.getArray,48),options.interactions));overlays=void 0!==options.overlays?Array.isArray(options.overlays)?new ol_Collection(options.overlays.slice()):(assert("function"==typeof options.overlays.getArray,49),options.overlays):new ol_Collection;return{controls:controls,interactions:interactions,keyboardEventTarget:keyboardEventTarget,overlays:overlays,values:values}}(options);this.maxTilesLoading_=void 0!==options.maxTilesLoading?options.maxTilesLoading:16,this.loadTilesWhileAnimating_=void 0!==options.loadTilesWhileAnimating&&options.loadTilesWhileAnimating,this.loadTilesWhileInteracting_=void 0!==options.loadTilesWhileInteracting&&options.loadTilesWhileInteracting,this.pixelRatio_=void 0!==options.pixelRatio?options.pixelRatio:DEVICE_PIXEL_RATIO,this.animationDelayKey_,this.animationDelay_=function(){this.animationDelayKey_=void 0,this.renderFrame_.call(this,Date.now())}.bind(this),this.coordinateToPixelTransform_=[1,0,0,1,0,0],this.pixelToCoordinateTransform_=[1,0,0,1,0,0],this.frameIndex_=0,this.frameState_=null,this.previousExtent_=null,this.viewPropertyListenerKey_=null,this.viewChangeListenerKey_=null,this.layerGroupPropertyListenerKeys_=null,this.viewport_=document.createElement("div"),this.viewport_.className="ol-viewport"+(TOUCH?" ol-touch":""),this.viewport_.style.position="relative",this.viewport_.style.overflow="hidden",this.viewport_.style.width="100%",this.viewport_.style.height="100%",this.viewport_.style.msTouchAction="none",this.viewport_.style.touchAction="none",this.overlayContainer_=document.createElement("div"),this.overlayContainer_.className="ol-overlaycontainer",this.viewport_.appendChild(this.overlayContainer_),this.overlayContainerStopEvent_=document.createElement("div"),this.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent";for(var overlayEvents=[EventType.CLICK,EventType.DBLCLICK,EventType.MOUSEDOWN,EventType.TOUCHSTART,EventType.MSPOINTERDOWN,MapBrowserEventType.POINTERDOWN,EventType.MOUSEWHEEL,EventType.WHEEL],i=0,ii=overlayEvents.length;i<ii;++i)listen(this.overlayContainerStopEvent_,overlayEvents[i],stopPropagation);for(var key in this.viewport_.appendChild(this.overlayContainerStopEvent_),this.mapBrowserEventHandler_=new ol_MapBrowserEventHandler(this,options.moveTolerance),MapBrowserEventType)listen(this.mapBrowserEventHandler_,MapBrowserEventType[key],this.handleMapBrowserEvent,this);this.keyboardEventTarget_=optionsInternal.keyboardEventTarget,this.keyHandlerKeys_=null,listen(this.viewport_,EventType.CONTEXTMENU,this.handleBrowserEvent,this),listen(this.viewport_,EventType.WHEEL,this.handleBrowserEvent,this),listen(this.viewport_,EventType.MOUSEWHEEL,this.handleBrowserEvent,this),this.controls=optionsInternal.controls||new ol_Collection,this.interactions=optionsInternal.interactions||new ol_Collection,this.overlays_=optionsInternal.overlays,this.overlayIdIndex_={},this.renderer_=this.createRenderer(),this.handleResize_,this.focus_=null,this.postRenderFunctions_=[],this.tileQueue_=new ol_TileQueue(this.getTilePriority.bind(this),this.handleTileChange_.bind(this)),this.skippedFeatureUids_={},listen(this,getChangeEventType(MapProperty.LAYERGROUP),this.handleLayerGroupChanged_,this),listen(this,getChangeEventType(MapProperty.VIEW),this.handleViewChanged_,this),listen(this,getChangeEventType(MapProperty.SIZE),this.handleSizeChanged_,this),listen(this,getChangeEventType(MapProperty.TARGET),this.handleTargetChanged_,this),this.setProperties(optionsInternal.values),this.controls.forEach(function(control){control.setMap(this)}.bind(this)),listen(this.controls,CollectionEventType_ADD,function(event){event.element.setMap(this)},this),listen(this.controls,CollectionEventType_REMOVE,function(event){event.element.setMap(null)},this),this.interactions.forEach(function(interaction){interaction.setMap(this)}.bind(this)),listen(this.interactions,CollectionEventType_ADD,function(event){event.element.setMap(this)},this),listen(this.interactions,CollectionEventType_REMOVE,function(event){event.element.setMap(null)},this),this.overlays_.forEach(this.addOverlayInternal_.bind(this)),listen(this.overlays_,CollectionEventType_ADD,function(event){this.addOverlayInternal_(event.element)},this),listen(this.overlays_,CollectionEventType_REMOVE,function(event){var id=event.element.getId();void 0!==id&&delete this.overlayIdIndex_[id.toString()],event.element.setMap(null)},this)}return BaseObject&&(PluggableMap.__proto__=BaseObject),((PluggableMap.prototype=Object.create(BaseObject&&BaseObject.prototype)).constructor=PluggableMap).prototype.createRenderer=function(){throw new Error("Use a map type that has a createRenderer method")},PluggableMap.prototype.addControl=function(control){this.getControls().push(control)},PluggableMap.prototype.addInteraction=function(interaction){this.getInteractions().push(interaction)},PluggableMap.prototype.addLayer=function(layer){this.getLayerGroup().getLayers().push(layer)},PluggableMap.prototype.addOverlay=function(overlay){this.getOverlays().push(overlay)},PluggableMap.prototype.addOverlayInternal_=function(overlay){var id=overlay.getId();void 0!==id&&(this.overlayIdIndex_[id.toString()]=overlay),overlay.setMap(this)},PluggableMap.prototype.disposeInternal=function(){this.mapBrowserEventHandler_.dispose(),unlisten(this.viewport_,EventType.CONTEXTMENU,this.handleBrowserEvent,this),unlisten(this.viewport_,EventType.WHEEL,this.handleBrowserEvent,this),unlisten(this.viewport_,EventType.MOUSEWHEEL,this.handleBrowserEvent,this),void 0!==this.handleResize_&&(removeEventListener(EventType.RESIZE,this.handleResize_,!1),this.handleResize_=void 0),this.animationDelayKey_&&(cancelAnimationFrame(this.animationDelayKey_),this.animationDelayKey_=void 0),this.setTarget(null),BaseObject.prototype.disposeInternal.call(this)},PluggableMap.prototype.forEachFeatureAtPixel=function(pixel,callback,opt_options){if(this.frameState_){var coordinate=this.getCoordinateFromPixel(pixel),hitTolerance=void 0!==(opt_options=void 0!==opt_options?opt_options:{}).hitTolerance?opt_options.hitTolerance*this.frameState_.pixelRatio:0,layerFilter=void 0!==opt_options.layerFilter?opt_options.layerFilter:TRUE;return this.renderer_.forEachFeatureAtCoordinate(coordinate,this.frameState_,hitTolerance,callback,null,layerFilter,null)}},PluggableMap.prototype.getFeaturesAtPixel=function(pixel,opt_options){var features=null;return this.forEachFeatureAtPixel(pixel,function(feature){features||(features=[]),features.push(feature)},opt_options),features},PluggableMap.prototype.forEachLayerAtPixel=function(pixel,callback,opt_options){if(this.frameState_){var options=opt_options||{},hitTolerance=void 0!==options.hitTolerance?opt_options.hitTolerance*this.frameState_.pixelRatio:0,layerFilter=options.layerFilter||TRUE;return this.renderer_.forEachLayerAtPixel(pixel,this.frameState_,hitTolerance,callback,null,layerFilter,null)}},PluggableMap.prototype.hasFeatureAtPixel=function(pixel,opt_options){if(!this.frameState_)return!1;var coordinate=this.getCoordinateFromPixel(pixel),layerFilter=void 0!==(opt_options=void 0!==opt_options?opt_options:{}).layerFilter?opt_options.layerFilter:TRUE,hitTolerance=void 0!==opt_options.hitTolerance?opt_options.hitTolerance*this.frameState_.pixelRatio:0;return this.renderer_.hasFeatureAtCoordinate(coordinate,this.frameState_,hitTolerance,layerFilter,null)},PluggableMap.prototype.getEventCoordinate=function(event){return this.getCoordinateFromPixel(this.getEventPixel(event))},PluggableMap.prototype.getEventPixel=function(event){var viewportPosition=this.viewport_.getBoundingClientRect(),eventPosition="changedTouches"in event?event.changedTouches[0]:event;return[eventPosition.clientX-viewportPosition.left,eventPosition.clientY-viewportPosition.top]},PluggableMap.prototype.getTarget=function(){return this.get(MapProperty.TARGET)},PluggableMap.prototype.getTargetElement=function(){var target=this.getTarget();return void 0!==target?"string"==typeof target?document.getElementById(target):target:null},PluggableMap.prototype.getCoordinateFromPixel=function(pixel){var frameState=this.frameState_;return frameState?apply(frameState.pixelToCoordinateTransform,pixel.slice()):null},PluggableMap.prototype.getControls=function(){return this.controls},PluggableMap.prototype.getOverlays=function(){return this.overlays_},PluggableMap.prototype.getOverlayById=function(id){var overlay=this.overlayIdIndex_[id.toString()];return void 0!==overlay?overlay:null},PluggableMap.prototype.getInteractions=function(){return this.interactions},PluggableMap.prototype.getLayerGroup=function(){return this.get(MapProperty.LAYERGROUP)},PluggableMap.prototype.getLayers=function(){return this.getLayerGroup().getLayers()},PluggableMap.prototype.getPixelFromCoordinate=function(coordinate){var frameState=this.frameState_;return frameState?apply(frameState.coordinateToPixelTransform,coordinate.slice(0,2)):null},PluggableMap.prototype.getRenderer=function(){return this.renderer_},PluggableMap.prototype.getSize=function(){return this.get(MapProperty.SIZE)},PluggableMap.prototype.getView=function(){return this.get(MapProperty.VIEW)},PluggableMap.prototype.getViewport=function(){return this.viewport_},PluggableMap.prototype.getOverlayContainer=function(){return this.overlayContainer_},PluggableMap.prototype.getOverlayContainerStopEvent=function(){return this.overlayContainerStopEvent_},PluggableMap.prototype.getTilePriority=function(tile,tileSourceKey,tileCenter,tileResolution){var frameState=this.frameState_;if(!(frameState&&tileSourceKey in frameState.wantedTiles))return 1/0;if(!frameState.wantedTiles[tileSourceKey][tile.getKey()])return 1/0;var deltaX=tileCenter[0]-frameState.focus[0],deltaY=tileCenter[1]-frameState.focus[1];return 65536*Math.log(tileResolution)+Math.sqrt(deltaX*deltaX+deltaY*deltaY)/tileResolution},PluggableMap.prototype.handleBrowserEvent=function(browserEvent,opt_type){var type=opt_type||browserEvent.type,mapBrowserEvent=new ol_MapBrowserEvent(type,this,browserEvent);this.handleMapBrowserEvent(mapBrowserEvent)},PluggableMap.prototype.handleMapBrowserEvent=function(mapBrowserEvent){if(this.frameState_){this.focus_=mapBrowserEvent.coordinate,mapBrowserEvent.frameState=this.frameState_;var interactionsArray=this.getInteractions().getArray();if(!1!==this.dispatchEvent(mapBrowserEvent))for(var i=interactionsArray.length-1;0<=i;i--){var interaction=interactionsArray[i];if(interaction.getActive())if(!interaction.handleEvent(mapBrowserEvent))break}}},PluggableMap.prototype.handlePostRender=function(){var frameState=this.frameState_,tileQueue=this.tileQueue_;if(!tileQueue.isEmpty()){var maxTotalLoading=this.maxTilesLoading_,maxNewLoads=maxTotalLoading;if(frameState){var hints=frameState.viewHints;hints[ViewHint_ANIMATING]&&(maxTotalLoading=this.loadTilesWhileAnimating_?8:0,maxNewLoads=2),hints[ViewHint_INTERACTING]&&(maxTotalLoading=this.loadTilesWhileInteracting_?8:0,maxNewLoads=2)}tileQueue.getTilesLoading()<maxTotalLoading&&(tileQueue.reprioritize(),tileQueue.loadMoreTiles(maxTotalLoading,maxNewLoads))}!frameState||!this.hasListener(render_EventType_RENDERCOMPLETE)||frameState.animate||this.tileQueue_.getTilesLoading()||function getLoading(layers){for(var i=0,ii=layers.length;i<ii;++i){var layer=layers[i];if("function"==typeof layer.getLayers)return getLoading(layer.getLayers().getArray());var source=layer.getSource();if(source&&source.loading)return!0}return!1}(this.getLayers().getArray())||this.renderer_.dispatchRenderEvent(render_EventType_RENDERCOMPLETE,frameState);for(var postRenderFunctions=this.postRenderFunctions_,i=0,ii=postRenderFunctions.length;i<ii;++i)postRenderFunctions[i](this,frameState);postRenderFunctions.length=0},PluggableMap.prototype.handleSizeChanged_=function(){this.render()},PluggableMap.prototype.handleTargetChanged_=function(){var targetElement;if(this.getTarget()&&(targetElement=this.getTargetElement()),this.keyHandlerKeys_){for(var i=0,ii=this.keyHandlerKeys_.length;i<ii;++i)unlistenByKey(this.keyHandlerKeys_[i]);this.keyHandlerKeys_=null}if(targetElement){targetElement.appendChild(this.viewport_);var keyboardEventTarget=this.keyboardEventTarget_?this.keyboardEventTarget_:targetElement;this.keyHandlerKeys_=[listen(keyboardEventTarget,EventType.KEYDOWN,this.handleBrowserEvent,this),listen(keyboardEventTarget,EventType.KEYPRESS,this.handleBrowserEvent,this)],this.handleResize_||(this.handleResize_=this.updateSize.bind(this),addEventListener(EventType.RESIZE,this.handleResize_,!1))}else this.renderer_.removeLayerRenderers(),removeNode(this.viewport_),void 0!==this.handleResize_&&(removeEventListener(EventType.RESIZE,this.handleResize_,!1),this.handleResize_=void 0);this.updateSize()},PluggableMap.prototype.handleTileChange_=function(){this.render()},PluggableMap.prototype.handleViewPropertyChanged_=function(){this.render()},PluggableMap.prototype.handleViewChanged_=function(){this.viewPropertyListenerKey_&&(unlistenByKey(this.viewPropertyListenerKey_),this.viewPropertyListenerKey_=null),this.viewChangeListenerKey_&&(unlistenByKey(this.viewChangeListenerKey_),this.viewChangeListenerKey_=null);var view=this.getView();view&&(this.viewport_.setAttribute("data-view",getUid(view)),this.viewPropertyListenerKey_=listen(view,ObjectEventType_PROPERTYCHANGE,this.handleViewPropertyChanged_,this),this.viewChangeListenerKey_=listen(view,EventType.CHANGE,this.handleViewPropertyChanged_,this)),this.render()},PluggableMap.prototype.handleLayerGroupChanged_=function(){this.layerGroupPropertyListenerKeys_&&(this.layerGroupPropertyListenerKeys_.forEach(unlistenByKey),this.layerGroupPropertyListenerKeys_=null);var layerGroup=this.getLayerGroup();layerGroup&&(this.layerGroupPropertyListenerKeys_=[listen(layerGroup,ObjectEventType_PROPERTYCHANGE,this.render,this),listen(layerGroup,EventType.CHANGE,this.render,this)]),this.render()},PluggableMap.prototype.isRendered=function(){return!!this.frameState_},PluggableMap.prototype.renderSync=function(){this.animationDelayKey_&&cancelAnimationFrame(this.animationDelayKey_),this.animationDelay_()},PluggableMap.prototype.render=function(){void 0===this.animationDelayKey_&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))},PluggableMap.prototype.removeControl=function(control){return this.getControls().remove(control)},PluggableMap.prototype.removeInteraction=function(interaction){return this.getInteractions().remove(interaction)},PluggableMap.prototype.removeLayer=function(layer){return this.getLayerGroup().getLayers().remove(layer)},PluggableMap.prototype.removeOverlay=function(overlay){return this.getOverlays().remove(overlay)},PluggableMap.prototype.renderFrame_=function(time){var viewState,size=this.getSize(),view=this.getView(),extent=[1/0,1/0,-1/0,-1/0],previousFrameState=this.frameState_,frameState=null;if(void 0!==size&&function(size){return 0<size[0]&&0<size[1]}(size)&&view&&view.isDef()){for(var viewHints=view.getHints(this.frameState_?this.frameState_.viewHints:void 0),layerStatesArray=this.getLayerGroup().getLayerStatesArray(),layerStates={},i=0,ii=layerStatesArray.length;i<ii;++i)layerStates[getUid(layerStatesArray[i].layer)]=layerStatesArray[i];viewState=view.getState(this.pixelRatio_),frameState={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,extent:extent,focus:this.focus_?this.focus_:viewState.center,index:this.frameIndex_++,layerStates:layerStates,layerStatesArray:layerStatesArray,pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:size,skippedFeatureUids:this.skippedFeatureUids_,tileQueue:this.tileQueue_,time:time,usedTiles:{},viewState:viewState,viewHints:viewHints,wantedTiles:{}}}if(frameState&&(frameState.extent=getForViewAndSize(viewState.center,viewState.resolution,viewState.rotation,frameState.size,extent)),this.frameState_=frameState,this.renderer_.renderFrame(frameState),frameState){if(frameState.animate&&this.render(),Array.prototype.push.apply(this.postRenderFunctions_,frameState.postRenderFunctions),previousFrameState)(!this.previousExtent_||!extent_isEmpty(this.previousExtent_)&&!extent_equals(frameState.extent,this.previousExtent_))&&(this.dispatchEvent(new ol_MapEvent(MapEventType_MOVESTART,this,previousFrameState)),this.previousExtent_=createOrUpdateEmpty(this.previousExtent_));this.previousExtent_&&!frameState.viewHints[ViewHint_ANIMATING]&&!frameState.viewHints[ViewHint_INTERACTING]&&!extent_equals(frameState.extent,this.previousExtent_)&&(this.dispatchEvent(new ol_MapEvent(MapEventType_MOVEEND,this,frameState)),extent_clone(frameState.extent,this.previousExtent_))}this.dispatchEvent(new ol_MapEvent(MapEventType_POSTRENDER,this,frameState)),setTimeout(this.handlePostRender.bind(this),0)},PluggableMap.prototype.setLayerGroup=function(layerGroup){this.set(MapProperty.LAYERGROUP,layerGroup)},PluggableMap.prototype.setSize=function(size){this.set(MapProperty.SIZE,size)},PluggableMap.prototype.setTarget=function(target){this.set(MapProperty.TARGET,target)},PluggableMap.prototype.setView=function(view){this.set(MapProperty.VIEW,view)},PluggableMap.prototype.skipFeature=function(feature){this.skippedFeatureUids_[getUid(feature)]=!0,this.render()},PluggableMap.prototype.updateSize=function(){var targetElement=this.getTargetElement();if(targetElement){var computedStyle=getComputedStyle(targetElement);this.setSize([targetElement.offsetWidth-parseFloat(computedStyle.borderLeftWidth)-parseFloat(computedStyle.paddingLeft)-parseFloat(computedStyle.paddingRight)-parseFloat(computedStyle.borderRightWidth),targetElement.offsetHeight-parseFloat(computedStyle.borderTopWidth)-parseFloat(computedStyle.paddingTop)-parseFloat(computedStyle.paddingBottom)-parseFloat(computedStyle.borderBottomWidth)])}else this.setSize(void 0)},PluggableMap.prototype.unskipFeature=function(feature){delete this.skippedFeatureUids_[getUid(feature)],this.render()},PluggableMap}(ol_Object);var style,cache,control_Control=function(BaseObject){function Control(options){BaseObject.call(this),this.element=options.element?options.element:null,this.target_=null,this.map_=null,this.listenerKeys=[],this.render=options.render?options.render:VOID,options.target&&this.setTarget(options.target)}return BaseObject&&(Control.__proto__=BaseObject),((Control.prototype=Object.create(BaseObject&&BaseObject.prototype)).constructor=Control).prototype.disposeInternal=function(){removeNode(this.element),BaseObject.prototype.disposeInternal.call(this)},Control.prototype.getMap=function(){return this.map_},Control.prototype.setMap=function(map){this.map_&&removeNode(this.element);for(var i=0,ii=this.listenerKeys.length;i<ii;++i)unlistenByKey(this.listenerKeys[i]);(this.listenerKeys.length=0,this.map_=map,this.map_)&&((this.target_?this.target_:map.getOverlayContainerStopEvent()).appendChild(this.element),this.render!==VOID&&this.listenerKeys.push(listen(map,MapEventType_POSTRENDER,this.render,this)),map.render())},Control.prototype.setTarget=function(target){this.target_="string"==typeof target?document.getElementById(target):target},Control}(ol_Object),CLASS_HIDDEN="ol-hidden",getFontFamilies=(cache={},function(font){if(style||(style=document.createElement("div").style),!(font in cache)){style.font=font;var family=style.fontFamily;if(style.font="",!family)return null;cache[font]=family.split(/,\s?/)}return cache[font]});function visibleAtResolution(layerState,resolution){return layerState.visible&&resolution>=layerState.minResolution&&resolution<layerState.maxResolution}var layer_Layer=function(BaseLayer){function Layer(options){var baseOptions=obj_assign({},options);delete baseOptions.source,BaseLayer.call(this,baseOptions),this.mapPrecomposeKey_=null,this.mapRenderKey_=null,this.sourceChangeKey_=null,options.map&&this.setMap(options.map),listen(this,getChangeEventType(layer_Property_SOURCE),this.handleSourcePropertyChange_,this);var source=options.source?options.source:null;this.setSource(source)}return BaseLayer&&(Layer.__proto__=BaseLayer),((Layer.prototype=Object.create(BaseLayer&&BaseLayer.prototype)).constructor=Layer).prototype.getLayersArray=function(opt_array){var array=opt_array||[];return array.push(this),array},Layer.prototype.getLayerStatesArray=function(opt_states){var states=opt_states||[];return states.push(this.getLayerState()),states},Layer.prototype.getSource=function(){return this.get(layer_Property_SOURCE)||null},Layer.prototype.getSourceState=function(){var source=this.getSource();return source?source.getState():State_UNDEFINED},Layer.prototype.handleSourceChange_=function(){this.changed()},Layer.prototype.handleSourcePropertyChange_=function(){this.sourceChangeKey_&&(unlistenByKey(this.sourceChangeKey_),this.sourceChangeKey_=null);var source=this.getSource();source&&(this.sourceChangeKey_=listen(source,EventType.CHANGE,this.handleSourceChange_,this)),this.changed()},Layer.prototype.setMap=function(map){this.mapPrecomposeKey_&&(unlistenByKey(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),map||this.changed(),this.mapRenderKey_&&(unlistenByKey(this.mapRenderKey_),this.mapRenderKey_=null),map&&(this.mapPrecomposeKey_=listen(map,render_EventType_PRECOMPOSE,function(evt){var renderEvent=evt,layerState=this.getLayerState();layerState.managed=!1,void 0===this.getZIndex()&&(layerState.zIndex=1/0),renderEvent.frameState.layerStatesArray.push(layerState),renderEvent.frameState.layerStates[getUid(this)]=layerState},this),this.mapRenderKey_=listen(this,EventType.CHANGE,map.render,map),this.changed())},Layer.prototype.setSource=function(source){this.set(layer_Property_SOURCE,source)},Layer}(Base);function Attribution_render(mapEvent){this.updateElement_(mapEvent.frameState)}var control_Attribution=function(Control){function Attribution(opt_options){var options=opt_options||{};Control.call(this,{element:document.createElement("div"),render:options.render||Attribution_render,target:options.target}),this.ulElement_=document.createElement("ul"),this.collapsed_=void 0===options.collapsed||options.collapsed,this.overrideCollapsible_=void 0!==options.collapsible,this.collapsible_=void 0===options.collapsible||options.collapsible,this.collapsible_||(this.collapsed_=!1);var className=void 0!==options.className?options.className:"ol-attribution",tipLabel=void 0!==options.tipLabel?options.tipLabel:"Attributions",collapseLabel=void 0!==options.collapseLabel?options.collapseLabel:"Â»";"string"==typeof collapseLabel?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=collapseLabel):this.collapseLabel_=collapseLabel;var label=void 0!==options.label?options.label:"i";"string"==typeof label?(this.label_=document.createElement("span"),this.label_.textContent=label):this.label_=label;var activeLabel=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_,button=document.createElement("button");button.setAttribute("type","button"),button.title=tipLabel,button.appendChild(activeLabel),listen(button,EventType.CLICK,this.handleClick_,this);var cssClasses=className+" ol-unselectable ol-control"+(this.collapsed_&&this.collapsible_?" ol-collapsed":"")+(this.collapsible_?"":" ol-uncollapsible"),element=this.element;element.className=cssClasses,element.appendChild(this.ulElement_),element.appendChild(button),this.renderedAttributions_=[],this.renderedVisible_=!0}return Control&&(Attribution.__proto__=Control),((Attribution.prototype=Object.create(Control&&Control.prototype)).constructor=Attribution).prototype.collectSourceAttributions_=function(frameState){for(var lookup={},visibleAttributions=[],layerStatesArray=frameState.layerStatesArray,resolution=frameState.viewState.resolution,i=0,ii=layerStatesArray.length;i<ii;++i){var layerState=layerStatesArray[i];if(visibleAtResolution(layerState,resolution)){var source=layerState.layer.getSource();if(source){var attributionGetter=source.getAttributions();if(attributionGetter){var attributions=attributionGetter(frameState);if(attributions)if(this.overrideCollapsible_||!1!==source.getAttributionsCollapsible()||this.setCollapsible(!1),Array.isArray(attributions))for(var j=0,jj=attributions.length;j<jj;++j)attributions[j]in lookup||(visibleAttributions.push(attributions[j]),lookup[attributions[j]]=!0);else attributions in lookup||(visibleAttributions.push(attributions),lookup[attributions]=!0)}}}}return visibleAttributions},Attribution.prototype.updateElement_=function(frameState){if(frameState){var attributions=this.collectSourceAttributions_(frameState),visible=0<attributions.length;if(this.renderedVisible_!=visible&&(this.element.style.display=visible?"":"none",this.renderedVisible_=visible),!equals(attributions,this.renderedAttributions_)){!function(node){for(;node.lastChild;)node.removeChild(node.lastChild)}(this.ulElement_);for(var i=0,ii=attributions.length;i<ii;++i){var element=document.createElement("li");element.innerHTML=attributions[i],this.ulElement_.appendChild(element)}this.renderedAttributions_=attributions}}else this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1)},Attribution.prototype.handleClick_=function(event){event.preventDefault(),this.handleToggle_()},Attribution.prototype.handleToggle_=function(){this.element.classList.toggle("ol-collapsed"),this.collapsed_?replaceNode(this.collapseLabel_,this.label_):replaceNode(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_},Attribution.prototype.getCollapsible=function(){return this.collapsible_},Attribution.prototype.setCollapsible=function(collapsible){this.collapsible_!==collapsible&&(this.collapsible_=collapsible,this.element.classList.toggle("ol-uncollapsible"),!collapsible&&this.collapsed_&&this.handleToggle_())},Attribution.prototype.setCollapsed=function(collapsed){this.collapsible_&&this.collapsed_!==collapsed&&this.handleToggle_()},Attribution.prototype.getCollapsed=function(){return this.collapsed_},Attribution}(control_Control);function Rotate_render(mapEvent){var frameState=mapEvent.frameState;if(frameState){var rotation=frameState.viewState.rotation;if(rotation!=this.rotation_){var transform="rotate("+rotation+"rad)";if(this.autoHide_){var contains=this.element.classList.contains(CLASS_HIDDEN);contains||0!==rotation?contains&&0!==rotation&&this.element.classList.remove(CLASS_HIDDEN):this.element.classList.add(CLASS_HIDDEN)}this.label_.style.msTransform=transform,this.label_.style.webkitTransform=transform,this.label_.style.transform=transform}this.rotation_=rotation}}var control_Rotate=function(Control){function Rotate(opt_options){var options=opt_options||{};Control.call(this,{element:document.createElement("div"),render:options.render||Rotate_render,target:options.target});var className=void 0!==options.className?options.className:"ol-rotate",label=void 0!==options.label?options.label:"â§";this.label_=null,"string"==typeof label?(this.label_=document.createElement("span"),this.label_.className="ol-compass",this.label_.textContent=label):(this.label_=label,this.label_.classList.add("ol-compass"));var tipLabel=options.tipLabel?options.tipLabel:"Reset rotation",button=document.createElement("button");button.className=className+"-reset",button.setAttribute("type","button"),button.title=tipLabel,button.appendChild(this.label_),listen(button,EventType.CLICK,this.handleClick_,this);var cssClasses=className+" ol-unselectable ol-control",element=this.element;element.className=cssClasses,element.appendChild(button),this.callResetNorth_=options.resetNorth?options.resetNorth:void 0,this.duration_=void 0!==options.duration?options.duration:250,this.autoHide_=void 0===options.autoHide||options.autoHide,this.rotation_=void 0,this.autoHide_&&this.element.classList.add(CLASS_HIDDEN)}return Control&&(Rotate.__proto__=Control),((Rotate.prototype=Object.create(Control&&Control.prototype)).constructor=Rotate).prototype.handleClick_=function(event){event.preventDefault(),void 0!==this.callResetNorth_?this.callResetNorth_():this.resetNorth_()},Rotate.prototype.resetNorth_=function(){var view=this.getMap().getView();view&&void 0!==view.getRotation()&&(0<this.duration_?view.animate({rotation:0,duration:this.duration_,easing:easeOut}):view.setRotation(0))},Rotate}(control_Control),control_Zoom=function(Control){function Zoom(opt_options){var options=opt_options||{};Control.call(this,{element:document.createElement("div"),target:options.target});var className=void 0!==options.className?options.className:"ol-zoom",delta=void 0!==options.delta?options.delta:1,zoomInLabel=void 0!==options.zoomInLabel?options.zoomInLabel:"+",zoomOutLabel=void 0!==options.zoomOutLabel?options.zoomOutLabel:"â",zoomInTipLabel=void 0!==options.zoomInTipLabel?options.zoomInTipLabel:"Zoom in",zoomOutTipLabel=void 0!==options.zoomOutTipLabel?options.zoomOutTipLabel:"Zoom out",inElement=document.createElement("button");inElement.className=className+"-in",inElement.setAttribute("type","button"),inElement.title=zoomInTipLabel,inElement.appendChild("string"==typeof zoomInLabel?document.createTextNode(zoomInLabel):zoomInLabel),listen(inElement,EventType.CLICK,this.handleClick_.bind(this,delta));var outElement=document.createElement("button");outElement.className=className+"-out",outElement.setAttribute("type","button"),outElement.title=zoomOutTipLabel,outElement.appendChild("string"==typeof zoomOutLabel?document.createTextNode(zoomOutLabel):zoomOutLabel),listen(outElement,EventType.CLICK,this.handleClick_.bind(this,-delta));var cssClasses=className+" ol-unselectable ol-control",element=this.element;element.className=cssClasses,element.appendChild(inElement),element.appendChild(outElement),this.duration_=void 0!==options.duration?options.duration:250}return Control&&(Zoom.__proto__=Control),((Zoom.prototype=Object.create(Control&&Control.prototype)).constructor=Zoom).prototype.handleClick_=function(delta,event){event.preventDefault(),this.zoomByDelta_(delta)},Zoom.prototype.zoomByDelta_=function(delta){var view=this.getMap().getView();if(view){var currentResolution=view.getResolution();if(currentResolution){var newResolution=view.constrainResolution(currentResolution,delta);0<this.duration_?(view.getAnimating()&&view.cancelAnimations(),view.animate({resolution:newResolution,duration:this.duration_,easing:easeOut})):view.setResolution(newResolution)}}},Zoom}(control_Control);var Kinetic=function(decay,minVelocity,delay){this.decay_=decay,this.minVelocity_=minVelocity,this.delay_=delay,this.points_=[],this.angle_=0,this.initialVelocity_=0};Kinetic.prototype.begin=function(){this.points_.length=0,this.angle_=0,this.initialVelocity_=0},Kinetic.prototype.update=function(x,y){this.points_.push(x,y,Date.now())},Kinetic.prototype.end=function(){if(this.points_.length<6)return!1;var delay=Date.now()-this.delay_,lastIndex=this.points_.length-3;if(this.points_[lastIndex+2]<delay)return!1;for(var firstIndex=lastIndex-3;0<firstIndex&&this.points_[firstIndex+2]>delay;)firstIndex-=3;var duration=this.points_[lastIndex+2]-this.points_[firstIndex+2];if(duration<1e3/60)return!1;var dx=this.points_[lastIndex]-this.points_[firstIndex],dy=this.points_[lastIndex+1]-this.points_[firstIndex+1];return this.angle_=Math.atan2(dy,dx),this.initialVelocity_=Math.sqrt(dx*dx+dy*dy)/duration,this.initialVelocity_>this.minVelocity_},Kinetic.prototype.getDistance=function(){return(this.minVelocity_-this.initialVelocity_)/this.decay_},Kinetic.prototype.getAngle=function(){return this.angle_};var ol_Kinetic=Kinetic,interaction_Property_ACTIVE="active";function Interaction_rotate(view,rotation,opt_anchor,opt_duration){rotateWithoutConstraints(view,rotation=view.constrainRotation(rotation,0),opt_anchor,opt_duration)}function rotateWithoutConstraints(view,rotation,opt_anchor,opt_duration){if(void 0!==rotation){var currentRotation=view.getRotation(),currentCenter=view.getCenter();void 0!==currentRotation&&currentCenter&&0<opt_duration?view.animate({rotation:rotation,anchor:opt_anchor,duration:opt_duration,easing:easeOut}):view.rotate(rotation,opt_anchor)}}function zoomByDelta(view,delta,opt_anchor,opt_duration){var currentResolution=view.getResolution(),resolution=view.constrainResolution(currentResolution,delta,0);if(void 0!==resolution){var resolutions=view.getResolutions();resolution=clamp(resolution,view.getMinResolution()||resolutions[resolutions.length-1],view.getMaxResolution()||resolutions[0])}if(opt_anchor&&void 0!==resolution&&resolution!==currentResolution){var currentCenter=view.getCenter(),center=view.calculateCenterZoom(resolution,opt_anchor);center=view.constrainCenter(center),opt_anchor=[(resolution*currentCenter[0]-currentResolution*center[0])/(resolution-currentResolution),(resolution*currentCenter[1]-currentResolution*center[1])/(resolution-currentResolution)]}zoomWithoutConstraints(view,resolution,opt_anchor,opt_duration)}function zoomWithoutConstraints(view,resolution,opt_anchor,opt_duration){if(resolution){var currentResolution=view.getResolution(),currentCenter=view.getCenter();if(void 0!==currentResolution&&currentCenter&&resolution!==currentResolution&&opt_duration)view.animate({resolution:resolution,anchor:opt_anchor,duration:opt_duration,easing:easeOut});else{if(opt_anchor){var center=view.calculateCenterZoom(resolution,opt_anchor);view.setCenter(center)}view.setResolution(resolution)}}}var interaction_Interaction=function(BaseObject){function Interaction(options){BaseObject.call(this),options.handleEvent&&(this.handleEvent=options.handleEvent),this.map_=null,this.setActive(!0)}return BaseObject&&(Interaction.__proto__=BaseObject),((Interaction.prototype=Object.create(BaseObject&&BaseObject.prototype)).constructor=Interaction).prototype.getActive=function(){return this.get(interaction_Property_ACTIVE)},Interaction.prototype.getMap=function(){return this.map_},Interaction.prototype.handleEvent=function(mapBrowserEvent){return!0},Interaction.prototype.setActive=function(active){this.set(interaction_Property_ACTIVE,active)},Interaction.prototype.setMap=function(map){this.map_=map},Interaction}(ol_Object);function DoubleClickZoom_handleEvent(mapBrowserEvent){var stopEvent=!1;if(mapBrowserEvent.type==MapBrowserEventType.DBLCLICK){var browserEvent=mapBrowserEvent.originalEvent,map=mapBrowserEvent.map,anchor=mapBrowserEvent.coordinate,delta=browserEvent.shiftKey?-this.delta_:this.delta_;zoomByDelta(map.getView(),delta,anchor,this.duration_),mapBrowserEvent.preventDefault(),stopEvent=!0}return!stopEvent}var interaction_DoubleClickZoom=function(Interaction){function DoubleClickZoom(opt_options){Interaction.call(this,{handleEvent:DoubleClickZoom_handleEvent});var options=opt_options||{};this.delta_=options.delta?options.delta:1,this.duration_=void 0!==options.duration?options.duration:250}return Interaction&&(DoubleClickZoom.__proto__=Interaction),(DoubleClickZoom.prototype=Object.create(Interaction&&Interaction.prototype)).constructor=DoubleClickZoom}(interaction_Interaction),altShiftKeysOnly=function(mapBrowserEvent){var originalEvent=mapBrowserEvent.originalEvent;return originalEvent.altKey&&!(originalEvent.metaKey||originalEvent.ctrlKey)&&originalEvent.shiftKey},condition_focus=function(event){return event.target.getTargetElement()===document.activeElement},always=TRUE,mouseActionButton=function(mapBrowserEvent){var originalEvent=mapBrowserEvent.originalEvent;return 0==originalEvent.button&&!(WEBKIT&&MAC&&originalEvent.ctrlKey)},noModifierKeys=function(mapBrowserEvent){var originalEvent=mapBrowserEvent.originalEvent;return!originalEvent.altKey&&!(originalEvent.metaKey||originalEvent.ctrlKey)&&!originalEvent.shiftKey},shiftKeyOnly=function(mapBrowserEvent){var originalEvent=mapBrowserEvent.originalEvent;return!originalEvent.altKey&&!(originalEvent.metaKey||originalEvent.ctrlKey)&&originalEvent.shiftKey},targetNotEditable=function(mapBrowserEvent){var tagName=mapBrowserEvent.originalEvent.target.tagName;return"INPUT"!==tagName&&"SELECT"!==tagName&&"TEXTAREA"!==tagName},mouseOnly=function(mapBrowserEvent){var pointerEvent=mapBrowserEvent.pointerEvent;return assert(void 0!==pointerEvent,56),"mouse"==pointerEvent.pointerType};function Pointer_centroid(pointerEvents){for(var length=pointerEvents.length,clientX=0,clientY=0,i=0;i<length;i++)clientX+=pointerEvents[i].clientX,clientY+=pointerEvents[i].clientY;return[clientX/length,clientY/length]}var Pointer=function(Interaction){function PointerInteraction(opt_options){var options=opt_options||{};Interaction.call(this,options),options.handleDownEvent&&(this.handleDownEvent=options.handleDownEvent),options.handleDragEvent&&(this.handleDragEvent=options.handleDragEvent),options.handleMoveEvent&&(this.handleMoveEvent=options.handleMoveEvent),options.handleUpEvent&&(this.handleUpEvent=options.handleUpEvent),options.stopDown&&(this.stopDown=options.stopDown),this.handlingDownUpSequence=!1,this.trackedPointers_={},this.targetPointers=[]}return Interaction&&(PointerInteraction.__proto__=Interaction),((PointerInteraction.prototype=Object.create(Interaction&&Interaction.prototype)).constructor=PointerInteraction).prototype.handleDownEvent=function(mapBrowserEvent){return!1},PointerInteraction.prototype.handleDragEvent=function(mapBrowserEvent){},PointerInteraction.prototype.handleEvent=function(mapBrowserEvent){if(!mapBrowserEvent.pointerEvent)return!0;var stopEvent=!1;if(this.updateTrackedPointers_(mapBrowserEvent),this.handlingDownUpSequence){if(mapBrowserEvent.type==MapBrowserEventType.POINTERDRAG)this.handleDragEvent(mapBrowserEvent);else if(mapBrowserEvent.type==MapBrowserEventType.POINTERUP){var handledUp=this.handleUpEvent(mapBrowserEvent);this.handlingDownUpSequence=handledUp&&0<this.targetPointers.length}}else if(mapBrowserEvent.type==MapBrowserEventType.POINTERDOWN){var handled=this.handleDownEvent(mapBrowserEvent);handled&&mapBrowserEvent.preventDefault(),this.handlingDownUpSequence=handled,stopEvent=this.stopDown(handled)}else mapBrowserEvent.type==MapBrowserEventType.POINTERMOVE&&this.handleMoveEvent(mapBrowserEvent);return!stopEvent},PointerInteraction.prototype.handleMoveEvent=function(mapBrowserEvent){},PointerInteraction.prototype.handleUpEvent=function(mapBrowserEvent){return!1},PointerInteraction.prototype.stopDown=function(handled){return handled},PointerInteraction.prototype.updateTrackedPointers_=function(mapBrowserEvent){if(function(mapBrowserEvent){var type=mapBrowserEvent.type;return type===MapBrowserEventType.POINTERDOWN||type===MapBrowserEventType.POINTERDRAG||type===MapBrowserEventType.POINTERUP}(mapBrowserEvent)){var event=mapBrowserEvent.pointerEvent,id=event.pointerId.toString();mapBrowserEvent.type==MapBrowserEventType.POINTERUP?delete this.trackedPointers_[id]:mapBrowserEvent.type==MapBrowserEventType.POINTERDOWN?this.trackedPointers_[id]=event:id in this.trackedPointers_&&(this.trackedPointers_[id]=event),this.targetPointers=getValues(this.trackedPointers_)}},PointerInteraction}(interaction_Interaction),interaction_DragPan=function(PointerInteraction){function DragPan(opt_options){PointerInteraction.call(this,{stopDown:FALSE});var options=opt_options||{};this.kinetic_=options.kinetic,this.lastCentroid=null,this.lastPointersCount_,this.panning_=!1,this.condition_=options.condition?options.condition:noModifierKeys,this.noKinetic_=!1}return PointerInteraction&&(DragPan.__proto__=PointerInteraction),((DragPan.prototype=Object.create(PointerInteraction&&PointerInteraction.prototype)).constructor=DragPan).prototype.handleDragEvent=function(mapBrowserEvent){this.panning_||(this.panning_=!0,this.getMap().getView().setHint(ViewHint_INTERACTING,1));var targetPointers=this.targetPointers,centroid=Pointer_centroid(targetPointers);if(targetPointers.length==this.lastPointersCount_){if(this.kinetic_&&this.kinetic_.update(centroid[0],centroid[1]),this.lastCentroid){var deltaX=this.lastCentroid[0]-centroid[0],deltaY=centroid[1]-this.lastCentroid[1],view=mapBrowserEvent.map.getView(),center=[deltaX,deltaY];coordinate_scale(center,view.getResolution()),coordinate_rotate(center,view.getRotation()),add(center,view.getCenter()),center=view.constrainCenter(center),view.setCenter(center)}}else this.kinetic_&&this.kinetic_.begin();this.lastCentroid=centroid,this.lastPointersCount_=targetPointers.length},DragPan.prototype.handleUpEvent=function(mapBrowserEvent){var map=mapBrowserEvent.map,view=map.getView();if(0!==this.targetPointers.length)return this.kinetic_&&this.kinetic_.begin(),!(this.lastCentroid=null);if(!this.noKinetic_&&this.kinetic_&&this.kinetic_.end()){var distance=this.kinetic_.getDistance(),angle=this.kinetic_.getAngle(),center=view.getCenter(),centerpx=map.getPixelFromCoordinate(center),dest=map.getCoordinateFromPixel([centerpx[0]-distance*Math.cos(angle),centerpx[1]-distance*Math.sin(angle)]);view.animate({center:view.constrainCenter(dest),duration:500,easing:easeOut})}return this.panning_&&(this.panning_=!1,view.setHint(ViewHint_INTERACTING,-1)),!1},DragPan.prototype.handleDownEvent=function(mapBrowserEvent){if(0<this.targetPointers.length&&this.condition_(mapBrowserEvent)){var view=mapBrowserEvent.map.getView();return this.lastCentroid=null,view.getAnimating()&&view.setCenter(mapBrowserEvent.frameState.viewState.center),this.kinetic_&&this.kinetic_.begin(),this.noKinetic_=1<this.targetPointers.length,!0}return!1},DragPan}(Pointer),interaction_DragRotate=function(PointerInteraction){function DragRotate(opt_options){var options=opt_options||{};PointerInteraction.call(this,{stopDown:FALSE}),this.condition_=options.condition?options.condition:altShiftKeysOnly,this.lastAngle_=void 0,this.duration_=void 0!==options.duration?options.duration:250}return PointerInteraction&&(DragRotate.__proto__=PointerInteraction),((DragRotate.prototype=Object.create(PointerInteraction&&PointerInteraction.prototype)).constructor=DragRotate).prototype.handleDragEvent=function(mapBrowserEvent){if(mouseOnly(mapBrowserEvent)){var map=mapBrowserEvent.map,view=map.getView();if(view.getConstraints().rotation!==disable){var size=map.getSize(),offset=mapBrowserEvent.pixel,theta=Math.atan2(size[1]/2-offset[1],offset[0]-size[0]/2);if(void 0!==this.lastAngle_){var delta=theta-this.lastAngle_;rotateWithoutConstraints(view,view.getRotation()-delta)}this.lastAngle_=theta}}},DragRotate.prototype.handleUpEvent=function(mapBrowserEvent){if(!mouseOnly(mapBrowserEvent))return!0;var view=mapBrowserEvent.map.getView();return view.setHint(ViewHint_INTERACTING,-1),Interaction_rotate(view,view.getRotation(),void 0,this.duration_),!1},DragRotate.prototype.handleDownEvent=function(mapBrowserEvent){return!!mouseOnly(mapBrowserEvent)&&(!(!mouseActionButton(mapBrowserEvent)||!this.condition_(mapBrowserEvent))&&(mapBrowserEvent.map.getView().setHint(ViewHint_INTERACTING,1),!(this.lastAngle_=void 0)))},DragRotate}(Pointer),Box=function(Disposable){function RenderBox(className){Disposable.call(this),this.geometry_=null,this.element_=document.createElement("div"),this.element_.style.position="absolute",this.element_.className="ol-box "+className,this.map_=null,this.startPixel_=null,this.endPixel_=null}return Disposable&&(RenderBox.__proto__=Disposable),((RenderBox.prototype=Object.create(Disposable&&Disposable.prototype)).constructor=RenderBox).prototype.disposeInternal=function(){this.setMap(null)},RenderBox.prototype.render_=function(){var startPixel=this.startPixel_,endPixel=this.endPixel_,style=this.element_.style;style.left=Math.min(startPixel[0],endPixel[0])+"px",style.top=Math.min(startPixel[1],endPixel[1])+"px",style.width=Math.abs(endPixel[0]-startPixel[0])+"px",style.height=Math.abs(endPixel[1]-startPixel[1])+"px"},RenderBox.prototype.setMap=function(map){if(this.map_){this.map_.getOverlayContainer().removeChild(this.element_);var style=this.element_.style;style.left=style.top=style.width=style.height="inherit"}this.map_=map,this.map_&&this.map_.getOverlayContainer().appendChild(this.element_)},RenderBox.prototype.setPixels=function(startPixel,endPixel){this.startPixel_=startPixel,this.endPixel_=endPixel,this.createOrUpdateGeometry(),this.render_()},RenderBox.prototype.createOrUpdateGeometry=function(){var startPixel=this.startPixel_,endPixel=this.endPixel_,coordinates=[startPixel,[startPixel[0],endPixel[1]],endPixel,[endPixel[0],startPixel[1]]].map(this.map_.getCoordinateFromPixel,this.map_);coordinates[4]=coordinates[0].slice(),this.geometry_?this.geometry_.setCoordinates([coordinates]):this.geometry_=new geom_Polygon([coordinates])},RenderBox.prototype.getGeometry=function(){return this.geometry_},RenderBox}(ol_Disposable),DragBoxEventType_BOXSTART="boxstart",DragBoxEventType_BOXDRAG="boxdrag",DragBoxEventType_BOXEND="boxend",DragBoxEvent=function(Event){function DragBoxEvent(type,coordinate,mapBrowserEvent){Event.call(this,type),this.coordinate=coordinate,this.mapBrowserEvent=mapBrowserEvent}return Event&&(DragBoxEvent.__proto__=Event),(DragBoxEvent.prototype=Object.create(Event&&Event.prototype)).constructor=DragBoxEvent}(events_Event);function onBoxEnd(){var coordinates,opt_extent,map=this.getMap(),view=map.getView(),size=map.getSize(),extent=this.getGeometry().getExtent();if(this.out_){var mapExtent=view.calculateExtent(size),boxPixelExtent=(coordinates=[map.getPixelFromCoordinate(getBottomLeft(extent)),map.getPixelFromCoordinate(getTopRight(extent))],extendCoordinates(createOrUpdateEmpty(opt_extent),coordinates));!function(extent,value){var deltaX=(extent[2]-extent[0])/2*(value-1),deltaY=(extent[3]-extent[1])/2*(value-1);extent[0]-=deltaX,extent[2]+=deltaX,extent[1]-=deltaY,extent[3]+=deltaY}(mapExtent,1/view.getResolutionForExtent(boxPixelExtent,size)),extent=mapExtent}var resolution=view.constrainResolution(view.getResolutionForExtent(extent,size)),center=extent_getCenter(extent);center=view.constrainCenter(center),view.animate({resolution:resolution,center:center,duration:this.duration_,easing:easeOut})}var interaction_DragZoom=function(DragBox){function DragZoom(opt_options){var options=opt_options||{},condition=options.condition?options.condition:shiftKeyOnly;DragBox.call(this,{condition:condition,className:options.className||"ol-dragzoom",onBoxEnd:onBoxEnd}),this.duration_=void 0!==options.duration?options.duration:200,this.out_=void 0!==options.out&&options.out}return DragBox&&(DragZoom.__proto__=DragBox),(DragZoom.prototype=Object.create(DragBox&&DragBox.prototype)).constructor=DragZoom}(function(PointerInteraction){function DragBox(opt_options){PointerInteraction.call(this);var options=opt_options||{};this.box_=new Box(options.className||"ol-dragbox"),this.minArea_=void 0!==options.minArea?options.minArea:64,this.onBoxEnd_=options.onBoxEnd?options.onBoxEnd:VOID,this.startPixel_=null,this.condition_=options.condition?options.condition:always,this.boxEndCondition_=options.boxEndCondition?options.boxEndCondition:this.defaultBoxEndCondition}return PointerInteraction&&(DragBox.__proto__=PointerInteraction),((DragBox.prototype=Object.create(PointerInteraction&&PointerInteraction.prototype)).constructor=DragBox).prototype.defaultBoxEndCondition=function(mapBrowserEvent,startPixel,endPixel){var width=endPixel[0]-startPixel[0],height=endPixel[1]-startPixel[1];return width*width+height*height>=this.minArea_},DragBox.prototype.getGeometry=function(){return this.box_.getGeometry()},DragBox.prototype.handleDragEvent=function(mapBrowserEvent){mouseOnly(mapBrowserEvent)&&(this.box_.setPixels(this.startPixel_,mapBrowserEvent.pixel),this.dispatchEvent(new DragBoxEvent(DragBoxEventType_BOXDRAG,mapBrowserEvent.coordinate,mapBrowserEvent)))},DragBox.prototype.handleUpEvent=function(mapBrowserEvent){return!mouseOnly(mapBrowserEvent)||(this.box_.setMap(null),this.boxEndCondition_(mapBrowserEvent,this.startPixel_,mapBrowserEvent.pixel)&&(this.onBoxEnd_(mapBrowserEvent),this.dispatchEvent(new DragBoxEvent(DragBoxEventType_BOXEND,mapBrowserEvent.coordinate,mapBrowserEvent))),!1)},DragBox.prototype.handleDownEvent=function(mapBrowserEvent){return!!mouseOnly(mapBrowserEvent)&&(!(!mouseActionButton(mapBrowserEvent)||!this.condition_(mapBrowserEvent))&&(this.startPixel_=mapBrowserEvent.pixel,this.box_.setMap(mapBrowserEvent.map),this.box_.setPixels(this.startPixel_,this.startPixel_),this.dispatchEvent(new DragBoxEvent(DragBoxEventType_BOXSTART,mapBrowserEvent.coordinate,mapBrowserEvent)),!0))},DragBox}(Pointer)),KeyCode={LEFT:37,UP:38,RIGHT:39,DOWN:40};function KeyboardPan_handleEvent(mapBrowserEvent){var stopEvent=!1;if(mapBrowserEvent.type==EventType.KEYDOWN){var keyCode=mapBrowserEvent.originalEvent.keyCode;if(this.condition_(mapBrowserEvent)&&(keyCode==KeyCode.DOWN||keyCode==KeyCode.LEFT||keyCode==KeyCode.RIGHT||keyCode==KeyCode.UP)){var view=mapBrowserEvent.map.getView(),mapUnitsDelta=view.getResolution()*this.pixelDelta_,deltaX=0,deltaY=0;keyCode==KeyCode.DOWN?deltaY=-mapUnitsDelta:keyCode==KeyCode.LEFT?deltaX=-mapUnitsDelta:keyCode==KeyCode.RIGHT?deltaX=mapUnitsDelta:deltaY=mapUnitsDelta;var delta=[deltaX,deltaY];coordinate_rotate(delta,view.getRotation()),function(view,delta,opt_duration){var currentCenter=view.getCenter();if(currentCenter){var center=view.constrainCenter([currentCenter[0]+delta[0],currentCenter[1]+delta[1]]);opt_duration?view.animate({duration:opt_duration,easing:linear,center:center}):view.setCenter(center)}}(view,delta,this.duration_),mapBrowserEvent.preventDefault(),stopEvent=!0}}return!stopEvent}var interaction_KeyboardPan=function(Interaction){function KeyboardPan(opt_options){Interaction.call(this,{handleEvent:KeyboardPan_handleEvent});var options=opt_options||{};this.defaultCondition_=function(mapBrowserEvent){return noModifierKeys(mapBrowserEvent)&&targetNotEditable(mapBrowserEvent)},this.condition_=void 0!==options.condition?options.condition:this.defaultCondition_,this.duration_=void 0!==options.duration?options.duration:100,this.pixelDelta_=void 0!==options.pixelDelta?options.pixelDelta:128}return Interaction&&(KeyboardPan.__proto__=Interaction),(KeyboardPan.prototype=Object.create(Interaction&&Interaction.prototype)).constructor=KeyboardPan}(interaction_Interaction);function KeyboardZoom_handleEvent(mapBrowserEvent){var stopEvent=!1;if(mapBrowserEvent.type==EventType.KEYDOWN||mapBrowserEvent.type==EventType.KEYPRESS){var charCode=mapBrowserEvent.originalEvent.charCode;if(this.condition_(mapBrowserEvent)&&(charCode=="+".charCodeAt(0)||charCode=="-".charCodeAt(0))){var map=mapBrowserEvent.map,delta=charCode=="+".charCodeAt(0)?this.delta_:-this.delta_;zoomByDelta(map.getView(),delta,void 0,this.duration_),mapBrowserEvent.preventDefault(),stopEvent=!0}}return!stopEvent}var interaction_KeyboardZoom=function(Interaction){function KeyboardZoom(opt_options){Interaction.call(this,{handleEvent:KeyboardZoom_handleEvent});var options=opt_options||{};this.condition_=options.condition?options.condition:targetNotEditable,this.delta_=options.delta?options.delta:1,this.duration_=void 0!==options.duration?options.duration:100}return Interaction&&(KeyboardZoom.__proto__=Interaction),(KeyboardZoom.prototype=Object.create(Interaction&&Interaction.prototype)).constructor=KeyboardZoom}(interaction_Interaction),Mode_TRACKPAD="trackpad",Mode_WHEEL="wheel",interaction_MouseWheelZoom=function(Interaction){function MouseWheelZoom(opt_options){var options=opt_options||{};Interaction.call(this,options),this.delta_=0,this.duration_=void 0!==options.duration?options.duration:250,this.timeout_=void 0!==options.timeout?options.timeout:80,this.useAnchor_=void 0===options.useAnchor||options.useAnchor,this.constrainResolution_=options.constrainResolution||!1,this.condition_=options.condition?options.condition:always,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_,this.mode_=void 0,this.trackpadEventGap_=400,this.trackpadTimeoutId_,this.trackpadDeltaPerZoom_=300,this.trackpadZoomBuffer_=1.5}return Interaction&&(MouseWheelZoom.__proto__=Interaction),((MouseWheelZoom.prototype=Object.create(Interaction&&Interaction.prototype)).constructor=MouseWheelZoom).prototype.decrementInteractingHint_=function(){this.trackpadTimeoutId_=void 0,this.getMap().getView().setHint(ViewHint_INTERACTING,-1)},MouseWheelZoom.prototype.handleEvent=function(mapBrowserEvent){if(!this.condition_(mapBrowserEvent))return!0;var type=mapBrowserEvent.type;if(type!==EventType.WHEEL&&type!==EventType.MOUSEWHEEL)return!0;mapBrowserEvent.preventDefault();var delta,map=mapBrowserEvent.map,wheelEvent=mapBrowserEvent.originalEvent;if(this.useAnchor_&&(this.lastAnchor_=mapBrowserEvent.coordinate),mapBrowserEvent.type==EventType.WHEEL?(delta=wheelEvent.deltaY,FIREFOX&&wheelEvent.deltaMode===WheelEvent.DOM_DELTA_PIXEL&&(delta/=DEVICE_PIXEL_RATIO),wheelEvent.deltaMode===WheelEvent.DOM_DELTA_LINE&&(delta*=40)):mapBrowserEvent.type==EventType.MOUSEWHEEL&&(delta=-wheelEvent.wheelDeltaY,SAFARI&&(delta/=3)),0===delta)return!1;var now=Date.now();if(void 0===this.startTime_&&(this.startTime_=now),(!this.mode_||now-this.startTime_>this.trackpadEventGap_)&&(this.mode_=Math.abs(delta)<4?Mode_TRACKPAD:Mode_WHEEL),this.mode_===Mode_TRACKPAD){var view=map.getView();this.trackpadTimeoutId_?clearTimeout(this.trackpadTimeoutId_):view.setHint(ViewHint_INTERACTING,1),this.trackpadTimeoutId_=setTimeout(this.decrementInteractingHint_.bind(this),this.trackpadEventGap_);var resolution=view.getResolution()*Math.pow(2,delta/this.trackpadDeltaPerZoom_),minResolution=view.getMinResolution(),maxResolution=view.getMaxResolution(),rebound=0;if(resolution<minResolution?(resolution=Math.max(resolution,minResolution/this.trackpadZoomBuffer_),rebound=1):maxResolution<resolution&&(resolution=Math.min(resolution,maxResolution*this.trackpadZoomBuffer_),rebound=-1),this.lastAnchor_){var center=view.calculateCenterZoom(resolution,this.lastAnchor_);view.setCenter(view.constrainCenter(center))}return view.setResolution(resolution),0===rebound&&this.constrainResolution_&&view.animate({resolution:view.constrainResolution(resolution,0<delta?-1:1),easing:easeOut,anchor:this.lastAnchor_,duration:this.duration_}),0<rebound?view.animate({resolution:minResolution,easing:easeOut,anchor:this.lastAnchor_,duration:500}):rebound<0&&view.animate({resolution:maxResolution,easing:easeOut,anchor:this.lastAnchor_,duration:500}),this.startTime_=now,!1}this.delta_+=delta;var timeLeft=Math.max(this.timeout_-(now-this.startTime_),0);return clearTimeout(this.timeoutId_),this.timeoutId_=setTimeout(this.handleWheelZoom_.bind(this,map),timeLeft),!1},MouseWheelZoom.prototype.handleWheelZoom_=function(map){var view=map.getView();view.getAnimating()&&view.cancelAnimations();zoomByDelta(view,-clamp(this.delta_,-1,1),this.lastAnchor_,this.duration_),this.mode_=void 0,this.delta_=0,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_=void 0},MouseWheelZoom.prototype.setMouseAnchor=function(useAnchor){(this.useAnchor_=useAnchor)||(this.lastAnchor_=null)},MouseWheelZoom}(interaction_Interaction),interaction_PinchRotate=function(PointerInteraction){function PinchRotate(opt_options){var options=opt_options||{},pointerOptions=options;pointerOptions.stopDown||(pointerOptions.stopDown=FALSE),PointerInteraction.call(this,pointerOptions),this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.threshold_=void 0!==options.threshold?options.threshold:.3,this.duration_=void 0!==options.duration?options.duration:250}return PointerInteraction&&(PinchRotate.__proto__=PointerInteraction),((PinchRotate.prototype=Object.create(PointerInteraction&&PointerInteraction.prototype)).constructor=PinchRotate).prototype.handleDragEvent=function(mapBrowserEvent){var rotationDelta=0,touch0=this.targetPointers[0],touch1=this.targetPointers[1],angle=Math.atan2(touch1.clientY-touch0.clientY,touch1.clientX-touch0.clientX);if(void 0!==this.lastAngle_){var delta=angle-this.lastAngle_;this.rotationDelta_+=delta,!this.rotating_&&Math.abs(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0),rotationDelta=delta}this.lastAngle_=angle;var map=mapBrowserEvent.map,view=map.getView();if(view.getConstraints().rotation!==disable){var viewportPosition=map.getViewport().getBoundingClientRect(),centroid=Pointer_centroid(this.targetPointers);if(centroid[0]-=viewportPosition.left,centroid[1]-=viewportPosition.top,this.anchor_=map.getCoordinateFromPixel(centroid),this.rotating_){var rotation=view.getRotation();map.render(),rotateWithoutConstraints(view,rotation+rotationDelta,this.anchor_)}}},PinchRotate.prototype.handleUpEvent=function(mapBrowserEvent){if(this.targetPointers.length<2){var view=mapBrowserEvent.map.getView();if(view.setHint(ViewHint_INTERACTING,-1),this.rotating_)Interaction_rotate(view,view.getRotation(),this.anchor_,this.duration_);return!1}return!0},PinchRotate.prototype.handleDownEvent=function(mapBrowserEvent){if(2<=this.targetPointers.length){var map=mapBrowserEvent.map;return this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.handlingDownUpSequence||map.getView().setHint(ViewHint_INTERACTING,1),!0}return!1},PinchRotate}(Pointer),interaction_PinchZoom=function(PointerInteraction){function PinchZoom(opt_options){var options=opt_options||{},pointerOptions=options;pointerOptions.stopDown||(pointerOptions.stopDown=FALSE),PointerInteraction.call(this,pointerOptions),this.constrainResolution_=options.constrainResolution||!1,this.anchor_=null,this.duration_=void 0!==options.duration?options.duration:400,this.lastDistance_=void 0,this.lastScaleDelta_=1}return PointerInteraction&&(PinchZoom.__proto__=PointerInteraction),((PinchZoom.prototype=Object.create(PointerInteraction&&PointerInteraction.prototype)).constructor=PinchZoom).prototype.handleDragEvent=function(mapBrowserEvent){var scaleDelta=1,touch0=this.targetPointers[0],touch1=this.targetPointers[1],dx=touch0.clientX-touch1.clientX,dy=touch0.clientY-touch1.clientY,distance=Math.sqrt(dx*dx+dy*dy);void 0!==this.lastDistance_&&(scaleDelta=this.lastDistance_/distance),this.lastDistance_=distance;var map=mapBrowserEvent.map,view=map.getView(),resolution=view.getResolution(),maxResolution=view.getMaxResolution(),minResolution=view.getMinResolution(),newResolution=resolution*scaleDelta;maxResolution<newResolution?(scaleDelta=maxResolution/resolution,newResolution=maxResolution):newResolution<minResolution&&(scaleDelta=minResolution/resolution,newResolution=minResolution),1!=scaleDelta&&(this.lastScaleDelta_=scaleDelta);var viewportPosition=map.getViewport().getBoundingClientRect(),centroid=Pointer_centroid(this.targetPointers);centroid[0]-=viewportPosition.left,centroid[1]-=viewportPosition.top,this.anchor_=map.getCoordinateFromPixel(centroid),map.render(),zoomWithoutConstraints(view,newResolution,this.anchor_)},PinchZoom.prototype.handleUpEvent=function(mapBrowserEvent){if(this.targetPointers.length<2){var view=mapBrowserEvent.map.getView();view.setHint(ViewHint_INTERACTING,-1);var resolution=view.getResolution();if(this.constrainResolution_||resolution<view.getMinResolution()||resolution>view.getMaxResolution()){var direction=this.lastScaleDelta_-1;!function(view,resolution,opt_anchor,opt_duration,opt_direction){zoomWithoutConstraints(view,resolution=view.constrainResolution(resolution,0,opt_direction),opt_anchor,opt_duration)}(view,resolution,this.anchor_,this.duration_,direction)}return!1}return!0},PinchZoom.prototype.handleDownEvent=function(mapBrowserEvent){if(2<=this.targetPointers.length){var map=mapBrowserEvent.map;return this.anchor_=null,this.lastDistance_=void 0,this.lastScaleDelta_=1,this.handlingDownUpSequence||map.getView().setHint(ViewHint_INTERACTING,1),!0}return!1},PinchZoom}(Pointer);var ImageState={IDLE:0,LOADING:1,LOADED:2,ERROR:3},ol_ImageCanvas=function(ImageBase){function ImageCanvas(extent,resolution,pixelRatio,canvas,opt_loader){var state=void 0!==opt_loader?ImageState.IDLE:ImageState.LOADED;ImageBase.call(this,extent,resolution,pixelRatio,state),this.loader_=void 0!==opt_loader?opt_loader:null,this.canvas_=canvas,this.error_=null}return ImageBase&&(ImageCanvas.__proto__=ImageBase),((ImageCanvas.prototype=Object.create(ImageBase&&ImageBase.prototype)).constructor=ImageCanvas).prototype.getError=function(){return this.error_},ImageCanvas.prototype.handleLoad_=function(err){this.state=err?(this.error_=err,ImageState.ERROR):ImageState.LOADED,this.changed()},ImageCanvas.prototype.load=function(){this.state==ImageState.IDLE&&(this.state=ImageState.LOADING,this.changed(),this.loader_(this.handleLoad_.bind(this)))},ImageCanvas.prototype.getImage=function(){return this.canvas_},ImageCanvas}(function(EventTarget){function ImageBase(extent,resolution,pixelRatio,state){EventTarget.call(this),this.extent=extent,this.pixelRatio_=pixelRatio,this.resolution=resolution,this.state=state}return EventTarget&&(ImageBase.__proto__=EventTarget),((ImageBase.prototype=Object.create(EventTarget&&EventTarget.prototype)).constructor=ImageBase).prototype.changed=function(){this.dispatchEvent(EventType.CHANGE)},ImageBase.prototype.getExtent=function(){return this.extent},ImageBase.prototype.getImage=function(){return util_abstract()},ImageBase.prototype.getPixelRatio=function(){return this.pixelRatio_},ImageBase.prototype.getResolution=function(){return this.resolution},ImageBase.prototype.getState=function(){return this.state},ImageBase.prototype.load=function(){util_abstract()},ImageBase}(events_Target)),LayerType_IMAGE="IMAGE",LayerType_TILE="TILE",LayerType_VECTOR_TILE="VECTOR_TILE",LayerType_VECTOR="VECTOR",VectorRenderType_IMAGE="image",VectorRenderType_VECTOR="vector",render_Event=function(Event){function RenderEvent(type,opt_vectorContext,opt_frameState,opt_context,opt_glContext){Event.call(this,type),this.vectorContext=opt_vectorContext,this.frameState=opt_frameState,this.context=opt_context,this.glContext=opt_glContext}return Event&&(RenderEvent.__proto__=Event),(RenderEvent.prototype=Object.create(Event&&Event.prototype)).constructor=RenderEvent}(events_Event),structs_LRUCache=function(EventTarget){function LRUCache(opt_highWaterMark){EventTarget.call(this),this.highWaterMark=void 0!==opt_highWaterMark?opt_highWaterMark:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}return EventTarget&&(LRUCache.__proto__=EventTarget),((LRUCache.prototype=Object.create(EventTarget&&EventTarget.prototype)).constructor=LRUCache).prototype.canExpireCache=function(){return this.getCount()>this.highWaterMark},LRUCache.prototype.clear=function(){this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null,this.dispatchEvent(EventType.CLEAR)},LRUCache.prototype.containsKey=function(key){return this.entries_.hasOwnProperty(key)},LRUCache.prototype.forEach=function(f,opt_this){for(var entry=this.oldest_;entry;)f.call(opt_this,entry.value_,entry.key_,this),entry=entry.newer},LRUCache.prototype.get=function(key){var entry=this.entries_[key];return assert(void 0!==entry,15),entry===this.newest_?entry.value_:(entry===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(entry.newer.older=entry.older,entry.older.newer=entry.newer),entry.newer=null,entry.older=this.newest_,this.newest_.newer=entry,(this.newest_=entry).value_)},LRUCache.prototype.remove=function(key){var entry=this.entries_[key];return assert(void 0!==entry,15),entry===this.newest_?(this.newest_=entry.older,this.newest_&&(this.newest_.newer=null)):entry===this.oldest_?(this.oldest_=entry.newer,this.oldest_&&(this.oldest_.older=null)):(entry.newer.older=entry.older,entry.older.newer=entry.newer),delete this.entries_[key],--this.count_,entry.value_},LRUCache.prototype.getCount=function(){return this.count_},LRUCache.prototype.getKeys=function(){var entry,keys=new Array(this.count_),i=0;for(entry=this.newest_;entry;entry=entry.older)keys[i++]=entry.key_;return keys},LRUCache.prototype.getValues=function(){var entry,values=new Array(this.count_),i=0;for(entry=this.newest_;entry;entry=entry.older)values[i++]=entry.value_;return values},LRUCache.prototype.peekLast=function(){return this.oldest_.value_},LRUCache.prototype.peekLastKey=function(){return this.oldest_.key_},LRUCache.prototype.peekFirstKey=function(){return this.newest_.key_},LRUCache.prototype.pop=function(){var entry=this.oldest_;return delete this.entries_[entry.key_],entry.newer&&(entry.newer.older=null),this.oldest_=entry.newer,this.oldest_||(this.newest_=null),--this.count_,entry.value_},LRUCache.prototype.replace=function(key,value){this.get(key),this.entries_[key].value_=value},LRUCache.prototype.set=function(key,value){assert(!(key in this.entries_),16);var entry={key_:key,newer:null,older:this.newest_,value_:value};this.newest_?this.newest_.newer=entry:this.oldest_=entry,this.newest_=entry,this.entries_[key]=entry,++this.count_},LRUCache.prototype.setSize=function(size){this.highWaterMark=size},LRUCache.prototype.prune=function(){for(;this.canExpireCache();)this.pop()},LRUCache}(events_Target),defaultFillStyle=[0,0,0,1],defaultLineDash=[],defaultStrokeStyle=[0,0,0,1],defaultPadding=[0,0,0,0],labelCache=new structs_LRUCache,checkedFonts={},measureContext=null,textHeights={},checkFont=function(){var interval,referenceWidth,retries=60,checked=checkedFonts,size="32px ",referenceFonts=["monospace","serif"],len=referenceFonts.length,text="wmytzilWMYTZIL@#/&?$%10ï";function isAvailable(font){for(var context=getMeasureContext(),weight=100;weight<=700;weight+=300){for(var fontWeight=weight+" ",available=!0,i=0;i<len;++i){var referenceFont=referenceFonts[i];if(context.font=fontWeight+size+referenceFont,referenceWidth=context.measureText(text).width,font!=referenceFont){context.font=fontWeight+size+font+","+referenceFont;var width=context.measureText(text).width;available=available&&width!=referenceWidth}}if(available)return!0}return!1}function check(){var done=!0;for(var font in checked)checked[font]<retries&&(isAvailable(font)?(checked[font]=retries,obj_clear(textHeights),measureContext=null,labelCache.clear()):(++checked[font],done=!1));done&&(clearInterval(interval),interval=void 0)}return function(fontSpec){var fontFamilies=getFontFamilies(fontSpec);if(fontFamilies)for(var i=0,ii=fontFamilies.length;i<ii;++i){var fontFamily=fontFamilies[i];fontFamily in checked||(checked[fontFamily]=retries,isAvailable(fontFamily)||void(checked[fontFamily]=0)===interval&&(interval=setInterval(check,32)))}}}();function getMeasureContext(){return measureContext||(measureContext=createCanvasContext2D(1,1)),measureContext}var span,heights,measureTextHeight=(heights=textHeights,function(font){var height=heights[font];return null==height&&(span||((span=document.createElement("span")).textContent="M",span.style.margin=span.style.padding="0 !important",span.style.position="absolute !important",span.style.left="-99999px !important"),span.style.font=font,document.body.appendChild(span),height=heights[font]=span.offsetHeight,document.body.removeChild(span)),height});function measureTextWidth(font,text){var measureContext=getMeasureContext();return font!=measureContext.font&&(measureContext.font=font),measureContext.measureText(text).width}function rotateAtOffset(context,rotation,offsetX,offsetY){0!==rotation&&(context.translate(offsetX,offsetY),context.rotate(rotation),context.translate(-offsetX,-offsetY))}var resetTransform=[1,0,0,1,0,0];function drawImage(context,transform,opacity,image,originX,originY,w,h,x,y,scale){var alpha;1!=opacity&&(alpha=context.globalAlpha,context.globalAlpha=alpha*opacity),transform&&context.setTransform.apply(context,transform),context.drawImage(image,originX,originY,w,h,x,y,w*scale,h*scale),alpha&&(context.globalAlpha=alpha),transform&&context.setTransform.apply(context,resetTransform)}var HEX_COLOR_RE_=/^#([a-f0-9]{3}|[a-f0-9]{4}(?:[a-f0-9]{2}){0,2})$/i,NAMED_COLOR_RE_=/^([a-z]*)$/i;function asString(color){return"string"==typeof color?color:color_toString(color)}!function(){var cache={},cacheSize=0}();function normalize(color){return color[0]=clamp(color[0]+.5|0,0,255),color[1]=clamp(color[1]+.5|0,0,255),color[2]=clamp(color[2]+.5|0,0,255),color[3]=clamp(color[3],0,1),color}function color_toString(color){var r=color[0];r!=(0|r)&&(r=r+.5|0);var g=color[1];g!=(0|g)&&(g=g+.5|0);var b=color[2];return b!=(0|b)&&(b=b+.5|0),"rgba("+r+","+g+","+b+","+(void 0===color[3]?1:color[3])+")"}function asColorLike(color){return Array.isArray(color)?color_toString(color):color}var VectorContext_VectorContext=function(){};VectorContext_VectorContext.prototype.drawCustom=function(geometry,feature,renderer){},VectorContext_VectorContext.prototype.drawGeometry=function(geometry){},VectorContext_VectorContext.prototype.setStyle=function(style){},VectorContext_VectorContext.prototype.drawCircle=function(circleGeometry,feature){},VectorContext_VectorContext.prototype.drawFeature=function(feature,style){},VectorContext_VectorContext.prototype.drawGeometryCollection=function(geometryCollectionGeometry,feature){},VectorContext_VectorContext.prototype.drawLineString=function(lineStringGeometry,feature){},VectorContext_VectorContext.prototype.drawMultiLineString=function(multiLineStringGeometry,feature){},VectorContext_VectorContext.prototype.drawMultiPoint=function(multiPointGeometry,feature){},VectorContext_VectorContext.prototype.drawMultiPolygon=function(multiPolygonGeometry,feature){},VectorContext_VectorContext.prototype.drawPoint=function(pointGeometry,feature){},VectorContext_VectorContext.prototype.drawPolygon=function(polygonGeometry,feature){},VectorContext_VectorContext.prototype.drawText=function(geometry,feature){},VectorContext_VectorContext.prototype.setFillStrokeStyle=function(fillStyle,strokeStyle){},VectorContext_VectorContext.prototype.setImageStyle=function(imageStyle,opt_declutterGroup){},VectorContext_VectorContext.prototype.setTextStyle=function(textStyle,opt_declutterGroup){};var render_VectorContext=VectorContext_VectorContext,Immediate=function(VectorContext){function CanvasImmediateRenderer(context,pixelRatio,extent,transform,viewRotation){VectorContext.call(this),this.context_=context,this.pixelRatio_=pixelRatio,this.extent_=extent,this.transform_=transform,this.viewRotation_=viewRotation,this.contextFillState_=null,this.contextStrokeState_=null,this.contextTextState_=null,this.fillState_=null,this.strokeState_=null,this.image_=null,this.imageAnchorX_=0,this.imageAnchorY_=0,this.imageHeight_=0,this.imageOpacity_=0,this.imageOriginX_=0,this.imageOriginY_=0,this.imageRotateWithView_=!1,this.imageRotation_=0,this.imageScale_=0,this.imageWidth_=0,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=!1,this.textRotation_=0,this.textScale_=0,this.textFillState_=null,this.textStrokeState_=null,this.textState_=null,this.pixelCoordinates_=[],this.tmpLocalTransform_=[1,0,0,1,0,0]}return VectorContext&&(CanvasImmediateRenderer.__proto__=VectorContext),((CanvasImmediateRenderer.prototype=Object.create(VectorContext&&VectorContext.prototype)).constructor=CanvasImmediateRenderer).prototype.drawImages_=function(flatCoordinates,offset,end,stride){if(this.image_){var pixelCoordinates=transform2D(flatCoordinates,offset,end,2,this.transform_,this.pixelCoordinates_),context=this.context_,localTransform=this.tmpLocalTransform_,alpha=context.globalAlpha;1!=this.imageOpacity_&&(context.globalAlpha=alpha*this.imageOpacity_);var rotation=this.imageRotation_;this.imageRotateWithView_&&(rotation+=this.viewRotation_);for(var i=0,ii=pixelCoordinates.length;i<ii;i+=2){var x=pixelCoordinates[i]-this.imageAnchorX_,y=pixelCoordinates[i+1]-this.imageAnchorY_;if(0!==rotation||1!=this.imageScale_){var centerX=x+this.imageAnchorX_,centerY=y+this.imageAnchorY_;transform_compose(localTransform,centerX,centerY,this.imageScale_,this.imageScale_,rotation,-centerX,-centerY),context.setTransform.apply(context,localTransform)}context.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,x,y,this.imageWidth_,this.imageHeight_)}0===rotation&&1==this.imageScale_||context.setTransform(1,0,0,1,0,0),1!=this.imageOpacity_&&(context.globalAlpha=alpha)}},CanvasImmediateRenderer.prototype.drawText_=function(flatCoordinates,offset,end,stride){if(this.textState_&&""!==this.text_){this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);var pixelCoordinates=transform2D(flatCoordinates,offset,end,stride,this.transform_,this.pixelCoordinates_),context=this.context_,rotation=this.textRotation_;for(this.textRotateWithView_&&(rotation+=this.viewRotation_);offset<end;offset+=stride){var x=pixelCoordinates[offset]+this.textOffsetX_,y=pixelCoordinates[offset+1]+this.textOffsetY_;if(0!==rotation||1!=this.textScale_){var localTransform=transform_compose(this.tmpLocalTransform_,x,y,this.textScale_,this.textScale_,rotation,-x,-y);context.setTransform.apply(context,localTransform)}this.textStrokeState_&&context.strokeText(this.text_,x,y),this.textFillState_&&context.fillText(this.text_,x,y)}0===rotation&&1==this.textScale_||context.setTransform(1,0,0,1,0,0)}},CanvasImmediateRenderer.prototype.moveToLineTo_=function(flatCoordinates,offset,end,stride,close){var context=this.context_,pixelCoordinates=transform2D(flatCoordinates,offset,end,stride,this.transform_,this.pixelCoordinates_);context.moveTo(pixelCoordinates[0],pixelCoordinates[1]);var length=pixelCoordinates.length;close&&(length-=2);for(var i=2;i<length;i+=2)context.lineTo(pixelCoordinates[i],pixelCoordinates[i+1]);return close&&context.closePath(),end},CanvasImmediateRenderer.prototype.drawRings_=function(flatCoordinates,offset,ends,stride){for(var i=0,ii=ends.length;i<ii;++i)offset=this.moveToLineTo_(flatCoordinates,offset,ends[i],stride,!0);return offset},CanvasImmediateRenderer.prototype.drawCircle=function(geometry){if(extent_intersects(this.extent_,geometry.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);var pixelCoordinates=function(simpleGeometry,transform,opt_dest){var flatCoordinates=simpleGeometry.getFlatCoordinates();if(flatCoordinates){var stride=simpleGeometry.getStride();return transform2D(flatCoordinates,0,flatCoordinates.length,stride,transform,opt_dest)}return null}(geometry,this.transform_,this.pixelCoordinates_),dx=pixelCoordinates[2]-pixelCoordinates[0],dy=pixelCoordinates[3]-pixelCoordinates[1],radius=Math.sqrt(dx*dx+dy*dy),context=this.context_;context.beginPath(),context.arc(pixelCoordinates[0],pixelCoordinates[1],radius,0,2*Math.PI),this.fillState_&&context.fill(),this.strokeState_&&context.stroke()}""!==this.text_&&this.drawText_(geometry.getCenter(),0,2,2)}},CanvasImmediateRenderer.prototype.setStyle=function(style){this.setFillStrokeStyle(style.getFill(),style.getStroke()),this.setImageStyle(style.getImage()),this.setTextStyle(style.getText())},CanvasImmediateRenderer.prototype.drawGeometry=function(geometry){switch(geometry.getType()){case GeometryType.POINT:this.drawPoint(geometry);break;case GeometryType.LINE_STRING:this.drawLineString(geometry);break;case GeometryType.POLYGON:this.drawPolygon(geometry);break;case GeometryType.MULTI_POINT:this.drawMultiPoint(geometry);break;case GeometryType.MULTI_LINE_STRING:this.drawMultiLineString(geometry);break;case GeometryType.MULTI_POLYGON:this.drawMultiPolygon(geometry);break;case GeometryType.GEOMETRY_COLLECTION:this.drawGeometryCollection(geometry);break;case GeometryType.CIRCLE:this.drawCircle(geometry)}},CanvasImmediateRenderer.prototype.drawFeature=function(feature,style){var geometry=style.getGeometryFunction()(feature);geometry&&extent_intersects(this.extent_,geometry.getExtent())&&(this.setStyle(style),this.drawGeometry(geometry))},CanvasImmediateRenderer.prototype.drawGeometryCollection=function(geometry){for(var geometries=geometry.getGeometriesArray(),i=0,ii=geometries.length;i<ii;++i)this.drawGeometry(geometries[i])},CanvasImmediateRenderer.prototype.drawPoint=function(geometry){var flatCoordinates=geometry.getFlatCoordinates(),stride=geometry.getStride();this.image_&&this.drawImages_(flatCoordinates,0,flatCoordinates.length,stride),""!==this.text_&&this.drawText_(flatCoordinates,0,flatCoordinates.length,stride)},CanvasImmediateRenderer.prototype.drawMultiPoint=function(geometry){var flatCoordinates=geometry.getFlatCoordinates(),stride=geometry.getStride();this.image_&&this.drawImages_(flatCoordinates,0,flatCoordinates.length,stride),""!==this.text_&&this.drawText_(flatCoordinates,0,flatCoordinates.length,stride)},CanvasImmediateRenderer.prototype.drawLineString=function(geometry){if(extent_intersects(this.extent_,geometry.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);var context=this.context_,flatCoordinates=geometry.getFlatCoordinates();context.beginPath(),this.moveToLineTo_(flatCoordinates,0,flatCoordinates.length,geometry.getStride(),!1),context.stroke()}if(""!==this.text_){var flatMidpoint=geometry.getFlatMidpoint();this.drawText_(flatMidpoint,0,2,2)}}},CanvasImmediateRenderer.prototype.drawMultiLineString=function(geometry){var geometryExtent=geometry.getExtent();if(extent_intersects(this.extent_,geometryExtent)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);var context=this.context_,flatCoordinates=geometry.getFlatCoordinates(),offset=0,ends=geometry.getEnds(),stride=geometry.getStride();context.beginPath();for(var i=0,ii=ends.length;i<ii;++i)offset=this.moveToLineTo_(flatCoordinates,offset,ends[i],stride,!1);context.stroke()}if(""!==this.text_){var flatMidpoints=geometry.getFlatMidpoints();this.drawText_(flatMidpoints,0,flatMidpoints.length,2)}}},CanvasImmediateRenderer.prototype.drawPolygon=function(geometry){if(extent_intersects(this.extent_,geometry.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);var context=this.context_;context.beginPath(),this.drawRings_(geometry.getOrientedFlatCoordinates(),0,geometry.getEnds(),geometry.getStride()),this.fillState_&&context.fill(),this.strokeState_&&context.stroke()}if(""!==this.text_){var flatInteriorPoint=geometry.getFlatInteriorPoint();this.drawText_(flatInteriorPoint,0,2,2)}}},CanvasImmediateRenderer.prototype.drawMultiPolygon=function(geometry){if(extent_intersects(this.extent_,geometry.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);var context=this.context_,flatCoordinates=geometry.getOrientedFlatCoordinates(),offset=0,endss=geometry.getEndss(),stride=geometry.getStride();context.beginPath();for(var i=0,ii=endss.length;i<ii;++i){var ends=endss[i];offset=this.drawRings_(flatCoordinates,offset,ends,stride)}this.fillState_&&context.fill(),this.strokeState_&&context.stroke()}if(""!==this.text_){var flatInteriorPoints=geometry.getFlatInteriorPoints();this.drawText_(flatInteriorPoints,0,flatInteriorPoints.length,2)}}},CanvasImmediateRenderer.prototype.setContextFillState_=function(fillState){var context=this.context_,contextFillState=this.contextFillState_;contextFillState?contextFillState.fillStyle!=fillState.fillStyle&&(contextFillState.fillStyle=context.fillStyle=fillState.fillStyle):(context.fillStyle=fillState.fillStyle,this.contextFillState_={fillStyle:fillState.fillStyle})},CanvasImmediateRenderer.prototype.setContextStrokeState_=function(strokeState){var context=this.context_,contextStrokeState=this.contextStrokeState_;contextStrokeState?(contextStrokeState.lineCap!=strokeState.lineCap&&(contextStrokeState.lineCap=context.lineCap=strokeState.lineCap),CANVAS_LINE_DASH&&(equals(contextStrokeState.lineDash,strokeState.lineDash)||context.setLineDash(contextStrokeState.lineDash=strokeState.lineDash),contextStrokeState.lineDashOffset!=strokeState.lineDashOffset&&(contextStrokeState.lineDashOffset=context.lineDashOffset=strokeState.lineDashOffset)),contextStrokeState.lineJoin!=strokeState.lineJoin&&(contextStrokeState.lineJoin=context.lineJoin=strokeState.lineJoin),contextStrokeState.lineWidth!=strokeState.lineWidth&&(contextStrokeState.lineWidth=context.lineWidth=strokeState.lineWidth),contextStrokeState.miterLimit!=strokeState.miterLimit&&(contextStrokeState.miterLimit=context.miterLimit=strokeState.miterLimit),contextStrokeState.strokeStyle!=strokeState.strokeStyle&&(contextStrokeState.strokeStyle=context.strokeStyle=strokeState.strokeStyle)):(context.lineCap=strokeState.lineCap,CANVAS_LINE_DASH&&(context.setLineDash(strokeState.lineDash),context.lineDashOffset=strokeState.lineDashOffset),context.lineJoin=strokeState.lineJoin,context.lineWidth=strokeState.lineWidth,context.miterLimit=strokeState.miterLimit,context.strokeStyle=strokeState.strokeStyle,this.contextStrokeState_={lineCap:strokeState.lineCap,lineDash:strokeState.lineDash,lineDashOffset:strokeState.lineDashOffset,lineJoin:strokeState.lineJoin,lineWidth:strokeState.lineWidth,miterLimit:strokeState.miterLimit,strokeStyle:strokeState.strokeStyle})},CanvasImmediateRenderer.prototype.setContextTextState_=function(textState){var context=this.context_,contextTextState=this.contextTextState_,textAlign=textState.textAlign?textState.textAlign:"center";contextTextState?(contextTextState.font!=textState.font&&(contextTextState.font=context.font=textState.font),contextTextState.textAlign!=textAlign&&(contextTextState.textAlign=context.textAlign=textAlign),contextTextState.textBaseline!=textState.textBaseline&&(contextTextState.textBaseline=context.textBaseline=textState.textBaseline)):(context.font=textState.font,context.textAlign=textAlign,context.textBaseline=textState.textBaseline,this.contextTextState_={font:textState.font,textAlign:textAlign,textBaseline:textState.textBaseline})},CanvasImmediateRenderer.prototype.setFillStrokeStyle=function(fillStyle,strokeStyle){if(fillStyle){var fillStyleColor=fillStyle.getColor();this.fillState_={fillStyle:asColorLike(fillStyleColor||defaultFillStyle)}}else this.fillState_=null;if(strokeStyle){var strokeStyleColor=strokeStyle.getColor(),strokeStyleLineCap=strokeStyle.getLineCap(),strokeStyleLineDash=strokeStyle.getLineDash(),strokeStyleLineDashOffset=strokeStyle.getLineDashOffset(),strokeStyleLineJoin=strokeStyle.getLineJoin(),strokeStyleWidth=strokeStyle.getWidth(),strokeStyleMiterLimit=strokeStyle.getMiterLimit();this.strokeState_={lineCap:void 0!==strokeStyleLineCap?strokeStyleLineCap:"round",lineDash:strokeStyleLineDash||defaultLineDash,lineDashOffset:strokeStyleLineDashOffset||0,lineJoin:void 0!==strokeStyleLineJoin?strokeStyleLineJoin:"round",lineWidth:this.pixelRatio_*(void 0!==strokeStyleWidth?strokeStyleWidth:1),miterLimit:void 0!==strokeStyleMiterLimit?strokeStyleMiterLimit:10,strokeStyle:asColorLike(strokeStyleColor||defaultStrokeStyle)}}else this.strokeState_=null},CanvasImmediateRenderer.prototype.setImageStyle=function(imageStyle){if(imageStyle){var imageAnchor=imageStyle.getAnchor(),imageImage=imageStyle.getImage(1),imageOrigin=imageStyle.getOrigin(),imageSize=imageStyle.getSize();this.imageAnchorX_=imageAnchor[0],this.imageAnchorY_=imageAnchor[1],this.imageHeight_=imageSize[1],this.image_=imageImage,this.imageOpacity_=imageStyle.getOpacity(),this.imageOriginX_=imageOrigin[0],this.imageOriginY_=imageOrigin[1],this.imageRotateWithView_=imageStyle.getRotateWithView(),this.imageRotation_=imageStyle.getRotation(),this.imageScale_=imageStyle.getScale()*this.pixelRatio_,this.imageWidth_=imageSize[0]}else this.image_=null},CanvasImmediateRenderer.prototype.setTextStyle=function(textStyle){if(textStyle){var textFillStyle=textStyle.getFill();if(textFillStyle){var textFillStyleColor=textFillStyle.getColor();this.textFillState_={fillStyle:asColorLike(textFillStyleColor||defaultFillStyle)}}else this.textFillState_=null;var textStrokeStyle=textStyle.getStroke();if(textStrokeStyle){var textStrokeStyleColor=textStrokeStyle.getColor(),textStrokeStyleLineCap=textStrokeStyle.getLineCap(),textStrokeStyleLineDash=textStrokeStyle.getLineDash(),textStrokeStyleLineDashOffset=textStrokeStyle.getLineDashOffset(),textStrokeStyleLineJoin=textStrokeStyle.getLineJoin(),textStrokeStyleWidth=textStrokeStyle.getWidth(),textStrokeStyleMiterLimit=textStrokeStyle.getMiterLimit();this.textStrokeState_={lineCap:void 0!==textStrokeStyleLineCap?textStrokeStyleLineCap:"round",lineDash:textStrokeStyleLineDash||defaultLineDash,lineDashOffset:textStrokeStyleLineDashOffset||0,lineJoin:void 0!==textStrokeStyleLineJoin?textStrokeStyleLineJoin:"round",lineWidth:void 0!==textStrokeStyleWidth?textStrokeStyleWidth:1,miterLimit:void 0!==textStrokeStyleMiterLimit?textStrokeStyleMiterLimit:10,strokeStyle:asColorLike(textStrokeStyleColor||defaultStrokeStyle)}}else this.textStrokeState_=null;var textFont=textStyle.getFont(),textOffsetX=textStyle.getOffsetX(),textOffsetY=textStyle.getOffsetY(),textRotateWithView=textStyle.getRotateWithView(),textRotation=textStyle.getRotation(),textScale=textStyle.getScale(),textText=textStyle.getText(),textTextAlign=textStyle.getTextAlign(),textTextBaseline=textStyle.getTextBaseline();this.textState_={font:void 0!==textFont?textFont:"10px sans-serif",textAlign:void 0!==textTextAlign?textTextAlign:"center",textBaseline:void 0!==textTextBaseline?textTextBaseline:"middle"},this.text_=void 0!==textText?textText:"",this.textOffsetX_=void 0!==textOffsetX?this.pixelRatio_*textOffsetX:0,this.textOffsetY_=void 0!==textOffsetY?this.pixelRatio_*textOffsetY:0,this.textRotateWithView_=void 0!==textRotateWithView&&textRotateWithView,this.textRotation_=void 0!==textRotation?textRotation:0,this.textScale_=this.pixelRatio_*(void 0!==textScale?textScale:1)}else this.text_=""},CanvasImmediateRenderer}(render_VectorContext),IconImageCache=function(){this.cache_={},this.cacheSize_=0,this.maxCacheSize_=32};function getKey(src,crossOrigin,color){return crossOrigin+":"+src+":"+(color?asString(color):"null")}IconImageCache.prototype.clear=function(){this.cache_={},this.cacheSize_=0},IconImageCache.prototype.expire=function(){if(this.cacheSize_>this.maxCacheSize_){var i=0;for(var key in this.cache_){var iconImage=this.cache_[key];0!=(3&i++)||iconImage.hasListener()||(delete this.cache_[key],--this.cacheSize_)}}},IconImageCache.prototype.get=function(src,crossOrigin,color){var key=getKey(src,crossOrigin,color);return key in this.cache_?this.cache_[key]:null},IconImageCache.prototype.set=function(src,crossOrigin,color,iconImage){var key=getKey(src,crossOrigin,color);this.cache_[key]=iconImage,++this.cacheSize_},IconImageCache.prototype.setSize=function(maxCacheSize){this.maxCacheSize_=maxCacheSize,this.expire()};var shared=new IconImageCache;function expireIconCache(map,frameState){shared.expire()}function sortByZIndex(state1,state2){return state1.zIndex-state2.zIndex}var layerRendererConstructors=[],canvas_Map=function(MapRenderer){function CanvasMapRenderer(map){MapRenderer.call(this,map);var container=map.getViewport();this.context_=createCanvasContext2D(),this.canvas_=this.context_.canvas,this.canvas_.style.width="100%",this.canvas_.style.height="100%",this.canvas_.style.display="block",this.canvas_.className="ol-unselectable",container.insertBefore(this.canvas_,container.childNodes[0]||null),this.renderedVisible_=!0,this.transform_=[1,0,0,1,0,0]}return MapRenderer&&(CanvasMapRenderer.__proto__=MapRenderer),((CanvasMapRenderer.prototype=Object.create(MapRenderer&&MapRenderer.prototype)).constructor=CanvasMapRenderer).prototype.dispatchRenderEvent=function(type,frameState){var map=this.getMap(),context=this.context_;if(map.hasListener(type)){var extent=frameState.extent,pixelRatio=frameState.pixelRatio,rotation=frameState.viewState.rotation,transform=this.getTransform(frameState),vectorContext=new Immediate(context,pixelRatio,extent,transform,rotation),composeEvent=new render_Event(type,vectorContext,frameState,context,null);map.dispatchEvent(composeEvent)}},CanvasMapRenderer.prototype.getTransform=function(frameState){var viewState=frameState.viewState,dx1=this.canvas_.width/2,dy1=this.canvas_.height/2,sx=frameState.pixelRatio/viewState.resolution,sy=-sx,angle=-viewState.rotation,dx2=-viewState.center[0],dy2=-viewState.center[1];return transform_compose(this.transform_,dx1,dy1,sx,sy,angle,dx2,dy2)},CanvasMapRenderer.prototype.renderFrame=function(frameState){if(frameState){var context=this.context_,pixelRatio=frameState.pixelRatio,width=Math.round(frameState.size[0]*pixelRatio),height=Math.round(frameState.size[1]*pixelRatio);this.canvas_.width!=width||this.canvas_.height!=height?(this.canvas_.width=width,this.canvas_.height=height):context.clearRect(0,0,width,height);var rotation=frameState.viewState.rotation;this.calculateMatrices2D(frameState),this.dispatchRenderEvent(render_EventType_PRECOMPOSE,frameState);var layerStatesArray=frameState.layerStatesArray;!function(arr,compareFnc){var i,length=arr.length,tmp=Array(arr.length);for(i=0;i<length;i++)tmp[i]={index:i,value:arr[i]};for(tmp.sort(function(a,b){return compareFnc(a.value,b.value)||a.index-b.index}),i=0;i<arr.length;i++)arr[i]=tmp[i].value}(layerStatesArray,sortByZIndex),rotation&&(context.save(),rotateAtOffset(context,rotation,width/2,height/2));var i,ii,viewResolution=frameState.viewState.resolution;for(i=0,ii=layerStatesArray.length;i<ii;++i){var layerState=layerStatesArray[i],layer=layerState.layer,layerRenderer=this.getLayerRenderer(layer);visibleAtResolution(layerState,viewResolution)&&layerState.sourceState==State_READY&&(layerRenderer.prepareFrame(frameState,layerState)&&layerRenderer.composeFrame(frameState,layerState,context))}rotation&&context.restore(),this.dispatchRenderEvent(render_EventType_POSTCOMPOSE,frameState),this.renderedVisible_||(this.canvas_.style.display="",this.renderedVisible_=!0),this.scheduleRemoveUnusedLayerRenderers(frameState),this.scheduleExpireIconCache(frameState)}else this.renderedVisible_&&(this.canvas_.style.display="none",this.renderedVisible_=!1)},CanvasMapRenderer.prototype.forEachLayerAtPixel=function(pixel,frameState,hitTolerance,callback,thisArg,layerFilter,thisArg2){var result,i,viewResolution=frameState.viewState.resolution,layerStates=frameState.layerStatesArray,numLayers=layerStates.length,coordinate=apply(frameState.pixelToCoordinateTransform,pixel.slice());for(i=numLayers-1;0<=i;--i){var layerState=layerStates[i],layer=layerState.layer;if(visibleAtResolution(layerState,viewResolution)&&layerFilter.call(thisArg2,layer))if(result=this.getLayerRenderer(layer).forEachLayerAtCoordinate(coordinate,frameState,hitTolerance,callback,thisArg))return result}},CanvasMapRenderer.prototype.registerLayerRenderers=function(constructors){MapRenderer.prototype.registerLayerRenderers.call(this,constructors);for(var i=0,ii=constructors.length;i<ii;++i){var ctor=constructors[i];obj=ctor,0<=layerRendererConstructors.indexOf(obj)||layerRendererConstructors.push(ctor)}var obj},CanvasMapRenderer}(function(Disposable){function MapRenderer(map){Disposable.call(this),this.map_=map,this.layerRenderers_={},this.layerRendererListeners_={},this.layerRendererConstructors_=[]}return Disposable&&(MapRenderer.__proto__=Disposable),((MapRenderer.prototype=Object.create(Disposable&&Disposable.prototype)).constructor=MapRenderer).prototype.dispatchRenderEvent=function(type,frameState){util_abstract()},MapRenderer.prototype.registerLayerRenderers=function(constructors){this.layerRendererConstructors_.push.apply(this.layerRendererConstructors_,constructors)},MapRenderer.prototype.calculateMatrices2D=function(frameState){var viewState=frameState.viewState,coordinateToPixelTransform=frameState.coordinateToPixelTransform,pixelToCoordinateTransform=frameState.pixelToCoordinateTransform;transform_compose(coordinateToPixelTransform,frameState.size[0]/2,frameState.size[1]/2,1/viewState.resolution,-1/viewState.resolution,-viewState.rotation,-viewState.center[0],-viewState.center[1]),function(transform){var mat,det=(mat=transform)[0]*mat[3]-mat[1]*mat[2];assert(0!==det,32);var a=transform[0],b=transform[1],c=transform[2],d=transform[3],e=transform[4],f=transform[5];transform[0]=d/det,transform[1]=-b/det,transform[2]=-c/det,transform[3]=a/det,transform[4]=(c*f-d*e)/det,transform[5]=-(a*f-b*e)/det}(setFromArray(pixelToCoordinateTransform,coordinateToPixelTransform))},MapRenderer.prototype.removeLayerRenderers=function(){for(var key in this.layerRenderers_)this.removeLayerRendererByKey_(key).dispose()},MapRenderer.prototype.forEachFeatureAtCoordinate=function(coordinate,frameState,hitTolerance,callback,thisArg,layerFilter,thisArg2){var result,viewState=frameState.viewState,viewResolution=viewState.resolution;function forEachFeatureAtCoordinate(feature,layer){var managed=frameState.layerStates[getUid(layer)].managed;if(!(getUid(feature)in frameState.skippedFeatureUids)||managed)return callback.call(thisArg,feature,managed?layer:null)}var projection=viewState.projection,translatedCoordinate=coordinate;if(projection.canWrapX()){var projectionExtent=projection.getExtent(),worldWidth=getWidth(projectionExtent),x=coordinate[0];if(x<projectionExtent[0]||x>projectionExtent[2])translatedCoordinate=[x+worldWidth*Math.ceil((projectionExtent[0]-x)/worldWidth),coordinate[1]]}var i,layerStates=frameState.layerStatesArray;for(i=layerStates.length-1;0<=i;--i){var layerState=layerStates[i],layer=layerState.layer;if(visibleAtResolution(layerState,viewResolution)&&layerFilter.call(thisArg2,layer)){var layerRenderer=this.getLayerRenderer(layer),source=layer.getSource();if(source&&(result=layerRenderer.forEachFeatureAtCoordinate(source.getWrapX()?translatedCoordinate:coordinate,frameState,hitTolerance,forEachFeatureAtCoordinate)),result)return result}}},MapRenderer.prototype.forEachLayerAtPixel=function(pixel,frameState,hitTolerance,callback,thisArg,layerFilter,thisArg2){return util_abstract()},MapRenderer.prototype.hasFeatureAtCoordinate=function(coordinate,frameState,hitTolerance,layerFilter,thisArg){return void 0!==this.forEachFeatureAtCoordinate(coordinate,frameState,hitTolerance,TRUE,this,layerFilter,thisArg)},MapRenderer.prototype.getLayerRenderer=function(layer){var layerKey=getUid(layer);if(layerKey in this.layerRenderers_)return this.layerRenderers_[layerKey];for(var renderer,i=0,ii=this.layerRendererConstructors_.length;i<ii;++i){var candidate=this.layerRendererConstructors_[i];if(candidate.handles(layer)){renderer=candidate.create(this,layer);break}}if(!renderer)throw new Error("Unable to create renderer for layer: "+layer.getType());return this.layerRenderers_[layerKey]=renderer,this.layerRendererListeners_[layerKey]=listen(renderer,EventType.CHANGE,this.handleLayerRendererChange_,this),renderer},MapRenderer.prototype.getLayerRendererByKey=function(layerKey){return this.layerRenderers_[layerKey]},MapRenderer.prototype.getLayerRenderers=function(){return this.layerRenderers_},MapRenderer.prototype.getMap=function(){return this.map_},MapRenderer.prototype.handleLayerRendererChange_=function(){this.map_.render()},MapRenderer.prototype.removeLayerRendererByKey_=function(layerKey){var layerRenderer=this.layerRenderers_[layerKey];return delete this.layerRenderers_[layerKey],unlistenByKey(this.layerRendererListeners_[layerKey]),delete this.layerRendererListeners_[layerKey],layerRenderer},MapRenderer.prototype.removeUnusedLayerRenderers_=function(map,frameState){for(var layerKey in this.layerRenderers_)frameState&&layerKey in frameState.layerStates||this.removeLayerRendererByKey_(layerKey).dispose()},MapRenderer.prototype.renderFrame=function(frameState){util_abstract()},MapRenderer.prototype.scheduleExpireIconCache=function(frameState){frameState.postRenderFunctions.push(expireIconCache)},MapRenderer.prototype.scheduleRemoveUnusedLayerRenderers=function(frameState){for(var layerKey in this.layerRenderers_)if(!(layerKey in frameState.layerStates))return void frameState.postRenderFunctions.push(this.removeUnusedLayerRenderers_.bind(this))},MapRenderer}(ol_Disposable)),canvas_Layer=function(LayerRenderer){function CanvasLayerRenderer(layer){LayerRenderer.call(this,layer),this.renderedResolution,this.transform_=[1,0,0,1,0,0]}return LayerRenderer&&(CanvasLayerRenderer.__proto__=LayerRenderer),((CanvasLayerRenderer.prototype=Object.create(LayerRenderer&&LayerRenderer.prototype)).constructor=CanvasLayerRenderer).prototype.clip=function(context,frameState,extent){var pixelRatio=frameState.pixelRatio,width=frameState.size[0]*pixelRatio,height=frameState.size[1]*pixelRatio,rotation=frameState.viewState.rotation,topLeft=getTopLeft(extent),topRight=getTopRight(extent),bottomRight=getBottomRight(extent),bottomLeft=getBottomLeft(extent);apply(frameState.coordinateToPixelTransform,topLeft),apply(frameState.coordinateToPixelTransform,topRight),apply(frameState.coordinateToPixelTransform,bottomRight),apply(frameState.coordinateToPixelTransform,bottomLeft),context.save(),rotateAtOffset(context,-rotation,width/2,height/2),context.beginPath(),context.moveTo(topLeft[0]*pixelRatio,topLeft[1]*pixelRatio),context.lineTo(topRight[0]*pixelRatio,topRight[1]*pixelRatio),context.lineTo(bottomRight[0]*pixelRatio,bottomRight[1]*pixelRatio),context.lineTo(bottomLeft[0]*pixelRatio,bottomLeft[1]*pixelRatio),context.clip(),rotateAtOffset(context,rotation,width/2,height/2)},CanvasLayerRenderer.prototype.dispatchComposeEvent_=function(type,context,frameState,opt_transform){var layer=this.getLayer();if(layer.hasListener(type)){var width=frameState.size[0]*frameState.pixelRatio,height=frameState.size[1]*frameState.pixelRatio,rotation=frameState.viewState.rotation;rotateAtOffset(context,-rotation,width/2,height/2);var transform=void 0!==opt_transform?opt_transform:this.getTransform(frameState,0),render=new Immediate(context,frameState.pixelRatio,frameState.extent,transform,frameState.viewState.rotation),composeEvent=new render_Event(type,render,frameState,context,null);layer.dispatchEvent(composeEvent),rotateAtOffset(context,rotation,width/2,height/2)}},CanvasLayerRenderer.prototype.forEachLayerAtCoordinate=function(coordinate,frameState,hitTolerance,callback,thisArg){return this.forEachFeatureAtCoordinate(coordinate,frameState,hitTolerance,TRUE)?callback.call(thisArg,this.getLayer(),null):void 0},CanvasLayerRenderer.prototype.postCompose=function(context,frameState,layerState,opt_transform){this.dispatchComposeEvent_(render_EventType_POSTCOMPOSE,context,frameState,opt_transform)},CanvasLayerRenderer.prototype.preCompose=function(context,frameState,opt_transform){this.dispatchComposeEvent_(render_EventType_PRECOMPOSE,context,frameState,opt_transform)},CanvasLayerRenderer.prototype.dispatchRenderEvent=function(context,frameState,opt_transform){this.dispatchComposeEvent_(render_EventType_RENDER,context,frameState,opt_transform)},CanvasLayerRenderer.prototype.getTransform=function(frameState,offsetX){var viewState=frameState.viewState,pixelRatio=frameState.pixelRatio,dx1=pixelRatio*frameState.size[0]/2,dy1=pixelRatio*frameState.size[1]/2,sx=pixelRatio/viewState.resolution,sy=-sx,angle=-viewState.rotation,dx2=-viewState.center[0]+offsetX,dy2=-viewState.center[1];return transform_compose(this.transform_,dx1,dy1,sx,sy,angle,dx2,dy2)},CanvasLayerRenderer.prototype.composeFrame=function(frameState,layerState,context){util_abstract()},CanvasLayerRenderer.prototype.prepareFrame=function(frameState,layerState){return util_abstract()},CanvasLayerRenderer}(function(Observable){function LayerRenderer(layer){Observable.call(this),this.layer_=layer}return Observable&&(LayerRenderer.__proto__=Observable),((LayerRenderer.prototype=Object.create(Observable&&Observable.prototype)).constructor=LayerRenderer).prototype.createLoadedTileFinder=function(source,projection,tiles){return function(zoom,tileRange){return source.forEachLoadedTile(projection,zoom,tileRange,function(tile){tiles[zoom]||(tiles[zoom]={}),tiles[zoom][tile.tileCoord.toString()]=tile})}},LayerRenderer.prototype.forEachFeatureAtCoordinate=function(coordinate,frameState,hitTolerance,callback){},LayerRenderer.prototype.getLayer=function(){return this.layer_},LayerRenderer.prototype.handleImageChange_=function(event){event.target.getState()===ImageState.LOADED&&this.renderIfReadyAndVisible()},LayerRenderer.prototype.hasFeatureAtCoordinate=function(coordinate,frameState){return!1},LayerRenderer.prototype.loadImage=function(image){var imageState=image.getState();return imageState!=ImageState.LOADED&&imageState!=ImageState.ERROR&&listen(image,EventType.CHANGE,this.handleImageChange_,this),imageState==ImageState.IDLE&&(image.load(),imageState=image.getState()),imageState==ImageState.LOADED},LayerRenderer.prototype.renderIfReadyAndVisible=function(){var layer=this.getLayer();layer.getVisible()&&layer.getSourceState()==State_READY&&this.changed()},LayerRenderer.prototype.scheduleExpireCache=function(frameState,tileSource){if(tileSource.canExpireCache()){var postRenderFunction=function(tileSource,map,frameState){var tileSourceKey=getUid(tileSource);tileSourceKey in frameState.usedTiles&&tileSource.expireCache(frameState.viewState.projection,frameState.usedTiles[tileSourceKey])}.bind(null,tileSource);frameState.postRenderFunctions.push(postRenderFunction)}},LayerRenderer.prototype.updateUsedTiles=function(usedTiles,tileSource,z,tileRange){var tileSourceKey=getUid(tileSource),zKey=z.toString();tileSourceKey in usedTiles?zKey in usedTiles[tileSourceKey]?usedTiles[tileSourceKey][zKey].extend(tileRange):usedTiles[tileSourceKey][zKey]=tileRange:(usedTiles[tileSourceKey]={},usedTiles[tileSourceKey][zKey]=tileRange)},LayerRenderer.prototype.manageTilePyramid=function(frameState,tileSource,tileGrid,pixelRatio,projection,extent,currentZ,preload,opt_tileCallback,opt_this){var tileSourceKey=getUid(tileSource);tileSourceKey in frameState.wantedTiles||(frameState.wantedTiles[tileSourceKey]={});var tile,tileRange,tileResolution,x,y,z,wantedTiles=frameState.wantedTiles[tileSourceKey],tileQueue=frameState.tileQueue;for(z=tileGrid.getMinZoom();z<=currentZ;++z)for(tileRange=tileGrid.getTileRangeForExtentAndZ(extent,z,tileRange),tileResolution=tileGrid.getResolution(z),x=tileRange.minX;x<=tileRange.maxX;++x)for(y=tileRange.minY;y<=tileRange.maxY;++y)currentZ-z<=preload?((tile=tileSource.getTile(z,x,y,pixelRatio,projection)).getState()==TileState_IDLE&&(wantedTiles[tile.getKey()]=!0,tileQueue.isKeyQueued(tile.getKey())||tileQueue.enqueue([tile,tileSourceKey,tileGrid.getTileCoordCenter(tile.tileCoord),tileResolution])),void 0!==opt_tileCallback&&opt_tileCallback.call(opt_this,tile)):tileSource.useTile(z,x,y,projection)},LayerRenderer}(ol_Observable)),IntermediateCanvas=function(CanvasLayerRenderer){function IntermediateCanvasRenderer(layer){CanvasLayerRenderer.call(this,layer),this.coordinateToCanvasPixelTransform=[1,0,0,1,0,0],this.hitCanvasContext_=null}return CanvasLayerRenderer&&(IntermediateCanvasRenderer.__proto__=CanvasLayerRenderer),((IntermediateCanvasRenderer.prototype=Object.create(CanvasLayerRenderer&&CanvasLayerRenderer.prototype)).constructor=IntermediateCanvasRenderer).prototype.composeFrame=function(frameState,layerState,context){this.preCompose(context,frameState);var image=this.getImage();if(image){var extent=layerState.extent,clipped=void 0!==extent&&!containsExtent(extent,frameState.extent)&&extent_intersects(extent,frameState.extent);clipped&&this.clip(context,frameState,extent);var imageTransform=this.getImageTransform(),alpha=context.globalAlpha;context.globalAlpha=layerState.opacity;var dx=imageTransform[4],dy=imageTransform[5],dw=image.width*imageTransform[0],dh=image.height*imageTransform[3];.5<=dw&&.5<=dh&&context.drawImage(image,0,0,+image.width,+image.height,Math.round(dx),Math.round(dy),Math.round(dw),Math.round(dh)),context.globalAlpha=alpha,clipped&&context.restore()}this.postCompose(context,frameState,layerState)},IntermediateCanvasRenderer.prototype.getImage=function(){return util_abstract()},IntermediateCanvasRenderer.prototype.getImageTransform=function(){return util_abstract()},IntermediateCanvasRenderer.prototype.forEachLayerAtCoordinate=function(coordinate,frameState,hitTolerance,callback,thisArg){if(this.getImage()){var pixel=apply(this.coordinateToCanvasPixelTransform,coordinate.slice());coordinate_scale(pixel,frameState.viewState.resolution/this.renderedResolution),this.hitCanvasContext_||(this.hitCanvasContext_=createCanvasContext2D(1,1)),this.hitCanvasContext_.clearRect(0,0,1,1),this.hitCanvasContext_.drawImage(this.getImage(),pixel[0],pixel[1],1,1,0,0,1,1);var imageData=this.hitCanvasContext_.getImageData(0,0,1,1).data;return 0<imageData[3]?callback.call(thisArg,this.getLayer(),imageData):void 0}},IntermediateCanvasRenderer}(canvas_Layer),ImageLayer_CanvasImageLayerRenderer=function(IntermediateCanvasRenderer){function CanvasImageLayerRenderer(imageLayer){if(IntermediateCanvasRenderer.call(this,imageLayer),this.image_=null,this.imageTransform_=[1,0,0,1,0,0],this.skippedFeatures_=[],this.vectorRenderer_=null,imageLayer.getType()===LayerType_VECTOR)for(var i=0,ii=layerRendererConstructors.length;i<ii;++i){var ctor=layerRendererConstructors[i];if(ctor!==CanvasImageLayerRenderer&&ctor.handles(imageLayer)){this.vectorRenderer_=new ctor(imageLayer);break}}}return IntermediateCanvasRenderer&&(CanvasImageLayerRenderer.__proto__=IntermediateCanvasRenderer),((CanvasImageLayerRenderer.prototype=Object.create(IntermediateCanvasRenderer&&IntermediateCanvasRenderer.prototype)).constructor=CanvasImageLayerRenderer).prototype.disposeInternal=function(){this.vectorRenderer_&&this.vectorRenderer_.dispose(),IntermediateCanvasRenderer.prototype.disposeInternal.call(this)},CanvasImageLayerRenderer.prototype.getImage=function(){return this.image_?this.image_.getImage():null},CanvasImageLayerRenderer.prototype.getImageTransform=function(){return this.imageTransform_},CanvasImageLayerRenderer.prototype.prepareFrame=function(frameState,layerState){var image,pixelRatio=frameState.pixelRatio,size=frameState.size,viewState=frameState.viewState,viewCenter=viewState.center,viewResolution=viewState.resolution,imageSource=this.getLayer().getSource(),hints=frameState.viewHints,vectorRenderer=this.vectorRenderer_,renderedExtent=frameState.extent;if(vectorRenderer||void 0===layerState.extent||(renderedExtent=getIntersection(renderedExtent,layerState.extent)),!hints[ViewHint_ANIMATING]&&!hints[ViewHint_INTERACTING]&&!extent_isEmpty(renderedExtent)){var projection=viewState.projection,skippedFeatures=this.skippedFeatures_;if(vectorRenderer){var context=vectorRenderer.context,imageFrameState=obj_assign({},frameState,{size:[getWidth(renderedExtent)/viewResolution,getHeight(renderedExtent)/viewResolution],viewState:obj_assign({},frameState.viewState,{rotation:0})}),newSkippedFeatures=Object.keys(imageFrameState.skippedFeatureUids).sort();image=new ol_ImageCanvas(renderedExtent,viewResolution,pixelRatio,context.canvas,function(callback){!vectorRenderer.prepareFrame(imageFrameState,layerState)||!vectorRenderer.replayGroupChanged&&equals(skippedFeatures,newSkippedFeatures)||(context.canvas.width=imageFrameState.size[0]*pixelRatio,context.canvas.height=imageFrameState.size[1]*pixelRatio,vectorRenderer.compose(context,imageFrameState,layerState),skippedFeatures=newSkippedFeatures,callback())})}else image=imageSource.getImage(renderedExtent,viewResolution,pixelRatio,projection);image&&this.loadImage(image)&&(this.image_=image,this.skippedFeatures_=skippedFeatures)}if(this.image_){var imageExtent=(image=this.image_).getExtent(),imageResolution=image.getResolution(),imagePixelRatio=image.getPixelRatio(),scale=pixelRatio*imageResolution/(viewResolution*imagePixelRatio),transform=transform_compose(this.imageTransform_,pixelRatio*size[0]/2,pixelRatio*size[1]/2,scale,scale,0,imagePixelRatio*(imageExtent[0]-viewCenter[0])/imageResolution,imagePixelRatio*(viewCenter[1]-imageExtent[3])/imageResolution);transform_compose(this.coordinateToCanvasPixelTransform,pixelRatio*size[0]/2-transform[4],pixelRatio*size[1]/2-transform[5],pixelRatio/viewResolution,-pixelRatio/viewResolution,0,-viewCenter[0],-viewCenter[1]),this.renderedResolution=imageResolution*pixelRatio/imagePixelRatio}return!!this.image_},CanvasImageLayerRenderer.prototype.forEachFeatureAtCoordinate=function(coordinate,frameState,hitTolerance,callback){return this.vectorRenderer_?this.vectorRenderer_.forEachFeatureAtCoordinate(coordinate,frameState,hitTolerance,callback):IntermediateCanvasRenderer.prototype.forEachFeatureAtCoordinate.call(this,coordinate,frameState,hitTolerance,callback)},CanvasImageLayerRenderer}(IntermediateCanvas);ImageLayer_CanvasImageLayerRenderer.handles=function(layer){return layer.getType()===LayerType_IMAGE||layer.getType()===LayerType_VECTOR&&layer.getRenderMode()===VectorRenderType_IMAGE},ImageLayer_CanvasImageLayerRenderer.create=function(mapRenderer,layer){return new ImageLayer_CanvasImageLayerRenderer(layer)};var ImageLayer=ImageLayer_CanvasImageLayerRenderer,TileRange=function(minX,maxX,minY,maxY){this.minX=minX,this.maxX=maxX,this.minY=minY,this.maxY=maxY};function TileRange_createOrUpdate(minX,maxX,minY,maxY,tileRange){return void 0!==tileRange?(tileRange.minX=minX,tileRange.maxX=maxX,tileRange.minY=minY,tileRange.maxY=maxY,tileRange):new TileRange(minX,maxX,minY,maxY)}TileRange.prototype.contains=function(tileCoord){return this.containsXY(tileCoord[1],tileCoord[2])},TileRange.prototype.containsTileRange=function(tileRange){return this.minX<=tileRange.minX&&tileRange.maxX<=this.maxX&&this.minY<=tileRange.minY&&tileRange.maxY<=this.maxY},TileRange.prototype.containsXY=function(x,y){return this.minX<=x&&x<=this.maxX&&this.minY<=y&&y<=this.maxY},TileRange.prototype.equals=function(tileRange){return this.minX==tileRange.minX&&this.minY==tileRange.minY&&this.maxX==tileRange.maxX&&this.maxY==tileRange.maxY},TileRange.prototype.extend=function(tileRange){tileRange.minX<this.minX&&(this.minX=tileRange.minX),tileRange.maxX>this.maxX&&(this.maxX=tileRange.maxX),tileRange.minY<this.minY&&(this.minY=tileRange.minY),tileRange.maxY>this.maxY&&(this.maxY=tileRange.maxY)},TileRange.prototype.getHeight=function(){return this.maxY-this.minY+1},TileRange.prototype.getSize=function(){return[this.getWidth(),this.getHeight()]},TileRange.prototype.getWidth=function(){return this.maxX-this.minX+1},TileRange.prototype.intersects=function(tileRange){return this.minX<=tileRange.maxX&&this.maxX>=tileRange.minX&&this.minY<=tileRange.maxY&&this.maxY>=tileRange.minY};var ol_TileRange=TileRange,TileLayer_CanvasTileLayerRenderer=function(IntermediateCanvasRenderer){function CanvasTileLayerRenderer(tileLayer,opt_noContext){IntermediateCanvasRenderer.call(this,tileLayer),this.context=opt_noContext?null:createCanvasContext2D(),this.oversampling_,this.renderedExtent_=null,this.renderedRevision,this.renderedTiles=[],this.newTiles_=!1,this.tmpExtent=[1/0,1/0,-1/0,-1/0],this.tmpTileRange_=new ol_TileRange(0,0,0,0),this.imageTransform_=[1,0,0,1,0,0],this.zDirection=0}return IntermediateCanvasRenderer&&(CanvasTileLayerRenderer.__proto__=IntermediateCanvasRenderer),((CanvasTileLayerRenderer.prototype=Object.create(IntermediateCanvasRenderer&&IntermediateCanvasRenderer.prototype)).constructor=CanvasTileLayerRenderer).prototype.isDrawableTile_=function(tile){var tileLayer=this.getLayer(),tileState=tile.getState(),useInterimTilesOnError=tileLayer.getUseInterimTilesOnError();return tileState==TileState_LOADED||tileState==TileState_EMPTY||tileState==TileState_ERROR&&!useInterimTilesOnError},CanvasTileLayerRenderer.prototype.getTile=function(z,x,y,pixelRatio,projection){var tileLayer=this.getLayer(),tile=tileLayer.getSource().getTile(z,x,y,pixelRatio,projection);return tile.getState()==TileState_ERROR&&(tileLayer.getUseInterimTilesOnError()?0<tileLayer.getPreload()&&(this.newTiles_=!0):tile.setState(TileState_LOADED)),this.isDrawableTile_(tile)||(tile=tile.getInterimTile()),tile},CanvasTileLayerRenderer.prototype.prepareFrame=function(frameState,layerState){var pixelRatio=frameState.pixelRatio,size=frameState.size,viewState=frameState.viewState,projection=viewState.projection,viewResolution=viewState.resolution,viewCenter=viewState.center,tileLayer=this.getLayer(),tileSource=tileLayer.getSource(),sourceRevision=tileSource.getRevision(),tileGrid=tileSource.getTileGridForProjection(projection),z=tileGrid.getZForResolution(viewResolution,this.zDirection),tileResolution=tileGrid.getResolution(z),oversampling=Math.round(viewResolution/tileResolution)||1,extent=frameState.extent;if(void 0!==layerState.extent&&(extent=getIntersection(extent,layerState.extent)),extent_isEmpty(extent))return!1;var tileRange=tileGrid.getTileRangeForExtentAndZ(extent,z),imageExtent=tileGrid.getTileRangeExtent(z,tileRange),tilePixelRatio=tileSource.getTilePixelRatio(pixelRatio),tilesToDrawByZ={};tilesToDrawByZ[z]={};var tile,x,y,findLoadedTiles=this.createLoadedTileFinder(tileSource,projection,tilesToDrawByZ),hints=frameState.viewHints,animatingOrInteracting=hints[ViewHint_ANIMATING]||hints[ViewHint_INTERACTING],tmpExtent=this.tmpExtent,tmpTileRange=this.tmpTileRange_;for(this.newTiles_=!1,x=tileRange.minX;x<=tileRange.maxX;++x)for(y=tileRange.minY;y<=tileRange.maxY;++y)if(!(16<Date.now()-frameState.time&&animatingOrInteracting)){if(tile=this.getTile(z,x,y,pixelRatio,projection),this.isDrawableTile_(tile)){var uid=getUid(this);if(tile.getState()==TileState_LOADED){var inTransition=(tilesToDrawByZ[z][tile.tileCoord.toString()]=tile).inTransition(uid);this.newTiles_||!inTransition&&-1!==this.renderedTiles.indexOf(tile)||(this.newTiles_=!0)}if(1===tile.getAlpha(uid,frameState.time))continue}var childTileRange=tileGrid.getTileCoordChildTileRange(tile.tileCoord,tmpTileRange,tmpExtent),covered=!1;childTileRange&&(covered=findLoadedTiles(z+1,childTileRange)),covered||tileGrid.forEachTileCoordParentTileRange(tile.tileCoord,findLoadedTiles,null,tmpTileRange,tmpExtent)}var renderedResolution=tileResolution*pixelRatio/tilePixelRatio*oversampling;if(!(this.renderedResolution&&16<Date.now()-frameState.time&&animatingOrInteracting)&&(this.newTiles_||!this.renderedExtent_||!containsExtent(this.renderedExtent_,extent)||this.renderedRevision!=sourceRevision||oversampling!=this.oversampling_||!animatingOrInteracting&&renderedResolution!=this.renderedResolution)){var context=this.context;if(context){var tilePixelSize=tileSource.getTilePixelSize(z,pixelRatio,projection),width=Math.round(tileRange.getWidth()*tilePixelSize[0]/oversampling),height=Math.round(tileRange.getHeight()*tilePixelSize[1]/oversampling),canvas=context.canvas;canvas.width!=width||canvas.height!=height?(this.oversampling_=oversampling,canvas.width=width,canvas.height=height):((this.renderedExtent_&&!extent_equals(imageExtent,this.renderedExtent_)||this.renderedRevision!=sourceRevision)&&context.clearRect(0,0,width,height),oversampling=this.oversampling_)}this.renderedTiles.length=0;var currentScale,currentTilePixelSize,currentZ,i,ii,tileExtent,tileGutter,tilesToDraw,w,h,zs=Object.keys(tilesToDrawByZ).map(Number);for(zs.sort(function(a,b){return a===z?1:b===z?-1:b<a?1:a<b?-1:0}),i=0,ii=zs.length;i<ii;++i)for(var tileCoordKey in currentZ=zs[i],currentTilePixelSize=tileSource.getTilePixelSize(currentZ,pixelRatio,projection),currentScale=tileGrid.getResolution(currentZ)/tileResolution,tileGutter=tilePixelRatio*tileSource.getGutterForProjection(projection),tilesToDraw=tilesToDrawByZ[currentZ])tile=tilesToDraw[tileCoordKey],x=((tileExtent=tileGrid.getTileCoordExtent(tile.getTileCoord(),tmpExtent))[0]-imageExtent[0])/tileResolution*tilePixelRatio/oversampling,y=(imageExtent[3]-tileExtent[3])/tileResolution*tilePixelRatio/oversampling,w=currentTilePixelSize[0]*currentScale/oversampling,h=currentTilePixelSize[1]*currentScale/oversampling,this.drawTileImage(tile,frameState,layerState,x,y,w,h,tileGutter,z===currentZ),this.renderedTiles.push(tile);this.renderedRevision=sourceRevision,this.renderedResolution=tileResolution*pixelRatio/tilePixelRatio*oversampling,this.renderedExtent_=imageExtent}var scale=this.renderedResolution/viewResolution,transform=transform_compose(this.imageTransform_,pixelRatio*size[0]/2,pixelRatio*size[1]/2,scale,scale,0,(this.renderedExtent_[0]-viewCenter[0])/this.renderedResolution*pixelRatio,(viewCenter[1]-this.renderedExtent_[3])/this.renderedResolution*pixelRatio);return transform_compose(this.coordinateToCanvasPixelTransform,pixelRatio*size[0]/2-transform[4],pixelRatio*size[1]/2-transform[5],pixelRatio/viewResolution,-pixelRatio/viewResolution,0,-viewCenter[0],-viewCenter[1]),this.updateUsedTiles(frameState.usedTiles,tileSource,z,tileRange),this.manageTilePyramid(frameState,tileSource,tileGrid,pixelRatio,projection,extent,z,tileLayer.getPreload()),this.scheduleExpireCache(frameState,tileSource),0<this.renderedTiles.length},CanvasTileLayerRenderer.prototype.drawTileImage=function(tile,frameState,layerState,x,y,w,h,gutter,transition){var image=this.getTileImage(tile);if(image){var uid=getUid(this),alpha=transition?tile.getAlpha(uid,frameState.time):1,tileSource=this.getLayer().getSource();1!==alpha||tileSource.getOpaque(frameState.viewState.projection)||this.context.clearRect(x,y,w,h);var alphaChanged=alpha!==this.context.globalAlpha;alphaChanged&&(this.context.save(),this.context.globalAlpha=alpha),this.context.drawImage(image,gutter,gutter,image.width-2*gutter,image.height-2*gutter,x,y,w,h),alphaChanged&&this.context.restore(),1!==alpha?frameState.animate=!0:transition&&tile.endTransition(uid)}},CanvasTileLayerRenderer.prototype.getImage=function(){var context=this.context;return context?context.canvas:null},CanvasTileLayerRenderer.prototype.getImageTransform=function(){return this.imageTransform_},CanvasTileLayerRenderer.prototype.getTileImage=function(tile){return tile.getImage()},CanvasTileLayerRenderer}(IntermediateCanvas);TileLayer_CanvasTileLayerRenderer.handles=function(layer){return layer.getType()===LayerType_TILE},TileLayer_CanvasTileLayerRenderer.create=function(mapRenderer,layer){return new TileLayer_CanvasTileLayerRenderer(layer)},TileLayer_CanvasTileLayerRenderer.prototype.getLayer;var canvas_TileLayer=TileLayer_CanvasTileLayerRenderer,rbush=__webpack_require__(17),rbush_default=__webpack_require__.n(rbush),ReplayGroup_ReplayGroup=function(){};ReplayGroup_ReplayGroup.prototype.getReplay=function(zIndex,replayType){return util_abstract()},ReplayGroup_ReplayGroup.prototype.isEmpty=function(){return util_abstract()},ReplayGroup_ReplayGroup.prototype.addDeclutter=function(group){return util_abstract()};var render_ReplayGroup=ReplayGroup_ReplayGroup,ReplayType={CIRCLE:"Circle",DEFAULT:"Default",IMAGE:"Image",LINE_STRING:"LineString",POLYGON:"Polygon",TEXT:"Text"};function lineStringLength(flatCoordinates,offset,end,stride){for(var x1=flatCoordinates[offset],y1=flatCoordinates[offset+1],length=0,i=offset+stride;i<end;i+=stride){var x2=flatCoordinates[i],y2=flatCoordinates[i+1];length+=Math.sqrt((x2-x1)*(x2-x1)+(y2-y1)*(y2-y1)),x1=x2,y1=y2}return length}function drawTextOnPath(flatCoordinates,offset,end,stride,text,measure,startM,maxAngle){for(var data,index,previousAngle,result=[],reverse=flatCoordinates[offset]>flatCoordinates[end-stride],numChars=text.length,x1=flatCoordinates[offset],y1=flatCoordinates[offset+1],x2=flatCoordinates[offset+=stride],y2=flatCoordinates[offset+1],segmentM=0,segmentLength=Math.sqrt(Math.pow(x2-x1,2)+Math.pow(y2-y1,2)),chunk="",chunkLength=0,i=0;i<numChars;++i){index=reverse?numChars-i-1:i;var char=text.charAt(index),charLength=measure(chunk=reverse?char+chunk:chunk+char)-chunkLength;chunkLength+=charLength;for(var charM=startM+charLength/2;offset<end-stride&&segmentM+segmentLength<charM;)x1=x2,y1=y2,x2=flatCoordinates[offset+=stride],y2=flatCoordinates[offset+1],segmentM+=segmentLength,segmentLength=Math.sqrt(Math.pow(x2-x1,2)+Math.pow(y2-y1,2));var segmentPos=charM-segmentM,angle=Math.atan2(y2-y1,x2-x1);if(reverse&&(angle+=0<angle?-Math.PI:Math.PI),void 0!==previousAngle){var delta=angle-previousAngle;if(delta+=delta>Math.PI?-2*Math.PI:delta<-Math.PI?2*Math.PI:0,Math.abs(delta)>maxAngle)return null}var interpolate=segmentPos/segmentLength,x=lerp(x1,x2,interpolate),y=lerp(y1,y2,interpolate);previousAngle==angle?(reverse&&(data[0]=x,data[1]=y,data[2]=charLength/2),data[4]=chunk):(data=[x,y,(chunkLength=charLength)/2,angle,chunk=char],reverse?result.unshift(data):result.push(data),previousAngle=angle),startM+=charLength}return result}var Instruction={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},Instruction_fillInstruction=[Instruction.FILL],Instruction_strokeInstruction=[Instruction.STROKE],beginPathInstruction=[Instruction.BEGIN_PATH],closePathInstruction=[Instruction.CLOSE_PATH],canvas_Instruction=Instruction,ORDER=[ReplayType.POLYGON,ReplayType.CIRCLE,ReplayType.LINE_STRING,ReplayType.IMAGE,ReplayType.TEXT,ReplayType.DEFAULT],TEXT_ALIGN={left:0,end:0,center:.5,right:1,start:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1},Replay_tmpExtent=[1/0,1/0,-1/0,-1/0],Replay_tmpTransform=[1,0,0,1,0,0],Replay=function(VectorContext){function CanvasReplay(tolerance,maxExtent,resolution,pixelRatio,overlaps,declutterTree){VectorContext.call(this),this.declutterTree=declutterTree,this.tolerance=tolerance,this.maxExtent=maxExtent,this.overlaps=overlaps,this.pixelRatio=pixelRatio,this.maxLineWidth=0,this.resolution=resolution,this.alignFill_,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_=null,this.bufferedMaxExtent_=null,this.instructions=[],this.coordinates=[],this.coordinateCache_={},this.renderedTransform_=[1,0,0,1,0,0],this.hitDetectionInstructions=[],this.pixelCoordinates_=null,this.state={},this.viewRotation_=0}return VectorContext&&(CanvasReplay.__proto__=VectorContext),((CanvasReplay.prototype=Object.create(VectorContext&&VectorContext.prototype)).constructor=CanvasReplay).prototype.replayTextBackground_=function(context,p1,p2,p3,p4,fillInstruction,strokeInstruction){context.beginPath(),context.moveTo.apply(context,p1),context.lineTo.apply(context,p2),context.lineTo.apply(context,p3),context.lineTo.apply(context,p4),context.lineTo.apply(context,p1),fillInstruction&&(this.alignFill_=fillInstruction[2],this.fill_(context)),strokeInstruction&&(this.setStrokeStyle_(context,strokeInstruction),context.stroke())},CanvasReplay.prototype.replayImage_=function(context,x,y,image,anchorX,anchorY,declutterGroup,height,opacity,originX,originY,rotation,scale,snapToPixel,width,padding,fillInstruction,strokeInstruction){var fillStroke=fillInstruction||strokeInstruction;x-=anchorX*=scale,y-=anchorY*=scale;var p1,p2,p3,p4,w=width+originX>image.width?image.width-originX:width,h=height+originY>image.height?image.height-originY:height,boxW=padding[3]+w*scale+padding[1],boxH=padding[0]+h*scale+padding[2],boxX=x-padding[3],boxY=y-padding[0];(fillStroke||0!==rotation)&&(p1=[boxX,boxY],p2=[boxX+boxW,boxY],p3=[boxX+boxW,boxY+boxH],p4=[boxX,boxY+boxH]);var transform=null;if(0!==rotation){var centerX=x+anchorX,centerY=y+anchorY;transform=transform_compose(Replay_tmpTransform,centerX,centerY,1,1,rotation,-centerX,-centerY),createOrUpdateEmpty(Replay_tmpExtent),extendCoordinate(Replay_tmpExtent,apply(Replay_tmpTransform,p1)),extendCoordinate(Replay_tmpExtent,apply(Replay_tmpTransform,p2)),extendCoordinate(Replay_tmpExtent,apply(Replay_tmpTransform,p3)),extendCoordinate(Replay_tmpExtent,apply(Replay_tmpTransform,p4))}else createOrUpdate(boxX,boxY,boxX+boxW,boxY+boxH,Replay_tmpExtent);var canvas=context.canvas,strokePadding=strokeInstruction?strokeInstruction[2]*scale/2:0,intersects=Replay_tmpExtent[0]-strokePadding<=canvas.width&&0<=Replay_tmpExtent[2]+strokePadding&&Replay_tmpExtent[1]-strokePadding<=canvas.height&&0<=Replay_tmpExtent[3]+strokePadding;if(snapToPixel&&(x=Math.round(x),y=Math.round(y)),declutterGroup){if(!intersects&&1==declutterGroup[4])return;extent_extend(declutterGroup,Replay_tmpExtent);var declutterArgs=intersects?[context,transform?transform.slice(0):null,opacity,image,originX,originY,w,h,x,y,scale]:null;declutterArgs&&fillStroke&&declutterArgs.push(fillInstruction,strokeInstruction,p1,p2,p3,p4),declutterGroup.push(declutterArgs)}else intersects&&(fillStroke&&this.replayTextBackground_(context,p1,p2,p3,p4,fillInstruction,strokeInstruction),drawImage(context,transform,opacity,image,originX,originY,w,h,x,y,scale))},CanvasReplay.prototype.applyPixelRatio=function(dashArray){var pixelRatio=this.pixelRatio;return 1==pixelRatio?dashArray:dashArray.map(function(dash){return dash*pixelRatio})},CanvasReplay.prototype.appendFlatCoordinates=function(flatCoordinates,offset,end,stride,closed,skipFirst){var myEnd=this.coordinates.length,extent=this.getBufferedMaxExtent();skipFirst&&(offset+=stride);var i,lastRel,nextRel,lastCoord=[flatCoordinates[offset],flatCoordinates[offset+1]],nextCoord=[NaN,NaN],skipped=!0;for(i=offset+stride;i<end;i+=stride)nextCoord[0]=flatCoordinates[i],nextCoord[1]=flatCoordinates[i+1],skipped=(nextRel=coordinateRelationship(extent,nextCoord))!==lastRel?(skipped&&(this.coordinates[myEnd++]=lastCoord[0],this.coordinates[myEnd++]=lastCoord[1]),this.coordinates[myEnd++]=nextCoord[0],this.coordinates[myEnd++]=nextCoord[1],!1):nextRel!==Relationship.INTERSECTING||(this.coordinates[myEnd++]=nextCoord[0],this.coordinates[myEnd++]=nextCoord[1],!1),lastCoord[0]=nextCoord[0],lastCoord[1]=nextCoord[1],lastRel=nextRel;return(closed&&skipped||i===offset+stride)&&(this.coordinates[myEnd++]=lastCoord[0],this.coordinates[myEnd++]=lastCoord[1]),myEnd},CanvasReplay.prototype.drawCustomCoordinates_=function(flatCoordinates,offset,ends,stride,replayEnds){for(var i=0,ii=ends.length;i<ii;++i){var end=ends[i],replayEnd=this.appendFlatCoordinates(flatCoordinates,offset,end,stride,!1,!1);replayEnds.push(replayEnd),offset=end}return offset},CanvasReplay.prototype.drawCustom=function(geometry,feature,renderer){this.beginGeometry(geometry,feature);var flatCoordinates,replayEnd,replayEnds,replayEndss,offset,type=geometry.getType(),stride=geometry.getStride(),replayBegin=this.coordinates.length;if(type==GeometryType.MULTI_POLYGON){flatCoordinates=(geometry=geometry).getOrientedFlatCoordinates(),replayEndss=[];for(var endss=geometry.getEndss(),i=offset=0,ii=endss.length;i<ii;++i){var myEnds=[];offset=this.drawCustomCoordinates_(flatCoordinates,offset,endss[i],stride,myEnds),replayEndss.push(myEnds)}this.instructions.push([canvas_Instruction.CUSTOM,replayBegin,replayEndss,geometry,renderer,inflateMultiCoordinatesArray])}else type==GeometryType.POLYGON||type==GeometryType.MULTI_LINE_STRING?(replayEnds=[],flatCoordinates=type==GeometryType.POLYGON?geometry.getOrientedFlatCoordinates():geometry.getFlatCoordinates(),offset=this.drawCustomCoordinates_(flatCoordinates,0,geometry.getEnds(),stride,replayEnds),this.instructions.push([canvas_Instruction.CUSTOM,replayBegin,replayEnds,geometry,renderer,inflateCoordinatesArray])):type==GeometryType.LINE_STRING||type==GeometryType.MULTI_POINT?(flatCoordinates=geometry.getFlatCoordinates(),replayEnd=this.appendFlatCoordinates(flatCoordinates,0,flatCoordinates.length,stride,!1,!1),this.instructions.push([canvas_Instruction.CUSTOM,replayBegin,replayEnd,geometry,renderer,inflateCoordinates])):type==GeometryType.POINT&&(flatCoordinates=geometry.getFlatCoordinates(),this.coordinates.push(flatCoordinates[0],flatCoordinates[1]),replayEnd=this.coordinates.length,this.instructions.push([canvas_Instruction.CUSTOM,replayBegin,replayEnd,geometry,renderer]));this.endGeometry(geometry,feature)},CanvasReplay.prototype.beginGeometry=function(geometry,feature){this.beginGeometryInstruction1_=[canvas_Instruction.BEGIN_GEOMETRY,feature,0],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[canvas_Instruction.BEGIN_GEOMETRY,feature,0],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)},CanvasReplay.prototype.finish=function(){},CanvasReplay.prototype.fill_=function(context){if(this.alignFill_){var origin=apply(this.renderedTransform_,[0,0]),repeatSize=512*this.pixelRatio;context.translate(origin[0]%repeatSize,origin[1]%repeatSize),context.rotate(this.viewRotation_)}context.fill(),this.alignFill_&&context.setTransform.apply(context,resetTransform)},CanvasReplay.prototype.setStrokeStyle_=function(context,instruction){context.strokeStyle=instruction[1],context.lineWidth=instruction[2],context.lineCap=instruction[3],context.lineJoin=instruction[4],context.miterLimit=instruction[5],CANVAS_LINE_DASH&&(context.lineDashOffset=instruction[7],context.setLineDash(instruction[6]))},CanvasReplay.prototype.renderDeclutter_=function(declutterGroup,feature){if(declutterGroup&&5<declutterGroup.length){var groupCount=declutterGroup[4];if(1==groupCount||groupCount==declutterGroup.length-5){var box={minX:declutterGroup[0],minY:declutterGroup[1],maxX:declutterGroup[2],maxY:declutterGroup[3],value:feature};if(!this.declutterTree.collides(box)){this.declutterTree.insert(box);for(var j=5,jj=declutterGroup.length;j<jj;++j){var declutterData=declutterGroup[j];declutterData&&(11<declutterData.length&&this.replayTextBackground_(declutterData[0],declutterData[13],declutterData[14],declutterData[15],declutterData[16],declutterData[11],declutterData[12]),drawImage.apply(void 0,declutterData))}}declutterGroup.length=5,createOrUpdateEmpty(declutterGroup)}}},CanvasReplay.prototype.replay_=function(context,transform,skippedFeaturesHash,instructions,snapToPixel,featureCallback,opt_hitExtent){var pixelCoordinates;this.pixelCoordinates_&&equals(transform,this.renderedTransform_)?pixelCoordinates=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),pixelCoordinates=transform2D(this.coordinates,0,this.coordinates.length,2,transform,this.pixelCoordinates_),setFromArray(this.renderedTransform_,transform));for(var dd,anchorX,anchorY,prevX,prevY,roundX,roundY,declutterGroup,image,feature,x,y,skipFeatures=!obj_isEmpty(skippedFeaturesHash),i=0,ii=instructions.length,d=0,pendingFill=0,pendingStroke=0,lastFillInstruction=null,lastStrokeInstruction=null,coordinateCache=this.coordinateCache_,viewRotation=this.viewRotation_,state={context:context,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:viewRotation},batchSize=this.instructions!=instructions||this.overlaps?0:200;i<ii;){var instruction=instructions[i];switch(instruction[0]){case canvas_Instruction.BEGIN_GEOMETRY:feature=instruction[1],skipFeatures&&skippedFeaturesHash[getUid(feature)]||!feature.getGeometry()?i=instruction[2]:void 0===opt_hitExtent||extent_intersects(opt_hitExtent,feature.getGeometry().getExtent())?++i:i=instruction[2]+1;break;case canvas_Instruction.BEGIN_PATH:batchSize<pendingFill&&(this.fill_(context),pendingFill=0),batchSize<pendingStroke&&(context.stroke(),pendingStroke=0),pendingFill||pendingStroke||(context.beginPath(),prevX=prevY=NaN),++i;break;case canvas_Instruction.CIRCLE:var x1=pixelCoordinates[d=instruction[1]],y1=pixelCoordinates[d+1],dx=pixelCoordinates[d+2]-x1,dy=pixelCoordinates[d+3]-y1,r=Math.sqrt(dx*dx+dy*dy);context.moveTo(x1+r,y1),context.arc(x1,y1,r,0,2*Math.PI,!0),++i;break;case canvas_Instruction.CLOSE_PATH:context.closePath(),++i;break;case canvas_Instruction.CUSTOM:d=instruction[1],dd=instruction[2];var geometry=instruction[3],renderer=instruction[4],fn=6==instruction.length?instruction[5]:void 0;state.geometry=geometry,state.feature=feature,i in coordinateCache||(coordinateCache[i]=[]);var coords=coordinateCache[i];fn?fn(pixelCoordinates,d,dd,2,coords):(coords[0]=pixelCoordinates[d],coords[1]=pixelCoordinates[d+1],coords.length=2),renderer(coords,state),++i;break;case canvas_Instruction.DRAW_IMAGE:d=instruction[1],dd=instruction[2],image=instruction[3],anchorX=instruction[4],anchorY=instruction[5],declutterGroup=featureCallback?null:instruction[6];var height=instruction[7],opacity=instruction[8],originX=instruction[9],originY=instruction[10],rotateWithView=instruction[11],rotation=instruction[12],scale=instruction[13],width=instruction[14],padding=void 0,backgroundFill=void 0,backgroundStroke=void 0;for(16<instruction.length?(padding=instruction[15],backgroundFill=instruction[16],backgroundStroke=instruction[17]):(padding=defaultPadding,backgroundFill=backgroundStroke=!1),rotateWithView&&(rotation+=viewRotation);d<dd;d+=2)this.replayImage_(context,pixelCoordinates[d],pixelCoordinates[d+1],image,anchorX,anchorY,declutterGroup,height,opacity,originX,originY,rotation,scale,snapToPixel,width,padding,backgroundFill?lastFillInstruction:null,backgroundStroke?lastStrokeInstruction:null);this.renderDeclutter_(declutterGroup,feature),++i;break;case canvas_Instruction.DRAW_CHARS:var begin=instruction[1],end=instruction[2],baseline=instruction[3];declutterGroup=featureCallback?null:instruction[4];var overflow=instruction[5],fillKey=instruction[6],maxAngle=instruction[7],measure=instruction[8],offsetY=instruction[9],strokeKey=instruction[10],strokeWidth=instruction[11],text=instruction[12],textKey=instruction[13],textScale=instruction[14],pathLength=lineStringLength(pixelCoordinates,begin,end,2),textLength=measure(text);if(overflow||textLength<=pathLength){var textAlign=this.textStates[textKey].textAlign,parts=drawTextOnPath(pixelCoordinates,begin,end,2,text,measure,(pathLength-textLength)*TEXT_ALIGN[textAlign],maxAngle);if(parts){var c=void 0,cc=void 0,chars=void 0,label=void 0,part=void 0;if(strokeKey)for(c=0,cc=parts.length;c<cc;++c)chars=(part=parts[c])[4],label=this.getImage(chars,textKey,"",strokeKey),anchorX=part[2]+strokeWidth,anchorY=baseline*label.height+2*(.5-baseline)*strokeWidth-offsetY,this.replayImage_(context,part[0],part[1],label,anchorX,anchorY,declutterGroup,label.height,1,0,0,part[3],textScale,!1,label.width,defaultPadding,null,null);if(fillKey)for(c=0,cc=parts.length;c<cc;++c)chars=(part=parts[c])[4],label=this.getImage(chars,textKey,fillKey,""),anchorX=part[2],anchorY=baseline*label.height-offsetY,this.replayImage_(context,part[0],part[1],label,anchorX,anchorY,declutterGroup,label.height,1,0,0,part[3],textScale,!1,label.width,defaultPadding,null,null)}}this.renderDeclutter_(declutterGroup,feature),++i;break;case canvas_Instruction.END_GEOMETRY:if(void 0!==featureCallback){var result=featureCallback(feature=instruction[1]);if(result)return result}++i;break;case canvas_Instruction.FILL:batchSize?pendingFill++:this.fill_(context),++i;break;case canvas_Instruction.MOVE_TO_LINE_TO:for(d=instruction[1],dd=instruction[2],x=pixelCoordinates[d],roundY=(y=pixelCoordinates[d+1])+.5|0,(roundX=x+.5|0)===prevX&&roundY===prevY||(context.moveTo(x,y),prevX=roundX,prevY=roundY),d+=2;d<dd;d+=2)roundX=(x=pixelCoordinates[d])+.5|0,roundY=(y=pixelCoordinates[d+1])+.5|0,d!=dd-2&&roundX===prevX&&roundY===prevY||(context.lineTo(x,y),prevX=roundX,prevY=roundY);++i;break;case canvas_Instruction.SET_FILL_STYLE:lastFillInstruction=instruction,this.alignFill_=instruction[2],pendingFill&&(this.fill_(context),pendingFill=0,pendingStroke&&(context.stroke(),pendingStroke=0)),context.fillStyle=instruction[1],++i;break;case canvas_Instruction.SET_STROKE_STYLE:lastStrokeInstruction=instruction,pendingStroke&&(context.stroke(),pendingStroke=0),this.setStrokeStyle_(context,instruction),++i;break;case canvas_Instruction.STROKE:batchSize?pendingStroke++:context.stroke(),++i;break;default:++i}}pendingFill&&this.fill_(context),pendingStroke&&context.stroke()},CanvasReplay.prototype.replay=function(context,transform,viewRotation,skippedFeaturesHash,snapToPixel){this.viewRotation_=viewRotation,this.replay_(context,transform,skippedFeaturesHash,this.instructions,snapToPixel,void 0,void 0)},CanvasReplay.prototype.replayHitDetection=function(context,transform,viewRotation,skippedFeaturesHash,opt_featureCallback,opt_hitExtent){return this.viewRotation_=viewRotation,this.replay_(context,transform,skippedFeaturesHash,this.hitDetectionInstructions,!0,opt_featureCallback,opt_hitExtent)},CanvasReplay.prototype.reverseHitDetectionInstructions=function(){var i,hitDetectionInstructions=this.hitDetectionInstructions;hitDetectionInstructions.reverse();var instruction,type,n=hitDetectionInstructions.length,begin=-1;for(i=0;i<n;++i)(type=(instruction=hitDetectionInstructions[i])[0])==canvas_Instruction.END_GEOMETRY?begin=i:type==canvas_Instruction.BEGIN_GEOMETRY&&(instruction[2]=i,reverseSubArray(this.hitDetectionInstructions,begin,i),begin=-1)},CanvasReplay.prototype.setFillStrokeStyle=function(fillStyle,strokeStyle){var state=this.state;if(fillStyle){var fillStyleColor=fillStyle.getColor();state.fillStyle=asColorLike(fillStyleColor||defaultFillStyle)}else state.fillStyle=void 0;if(strokeStyle){var strokeStyleColor=strokeStyle.getColor();state.strokeStyle=asColorLike(strokeStyleColor||defaultStrokeStyle);var strokeStyleLineCap=strokeStyle.getLineCap();state.lineCap=void 0!==strokeStyleLineCap?strokeStyleLineCap:"round";var strokeStyleLineDash=strokeStyle.getLineDash();state.lineDash=strokeStyleLineDash?strokeStyleLineDash.slice():defaultLineDash;var strokeStyleLineDashOffset=strokeStyle.getLineDashOffset();state.lineDashOffset=strokeStyleLineDashOffset||0;var strokeStyleLineJoin=strokeStyle.getLineJoin();state.lineJoin=void 0!==strokeStyleLineJoin?strokeStyleLineJoin:"round";var strokeStyleWidth=strokeStyle.getWidth();state.lineWidth=void 0!==strokeStyleWidth?strokeStyleWidth:1;var strokeStyleMiterLimit=strokeStyle.getMiterLimit();state.miterLimit=void 0!==strokeStyleMiterLimit?strokeStyleMiterLimit:10,state.lineWidth>this.maxLineWidth&&(this.maxLineWidth=state.lineWidth,this.bufferedMaxExtent_=null)}else state.strokeStyle=void 0,state.lineCap=void 0,state.lineDash=null,state.lineDashOffset=void 0,state.lineJoin=void 0,state.lineWidth=void 0,state.miterLimit=void 0},CanvasReplay.prototype.createFill=function(state,geometry){var fillStyle=state.fillStyle,fillInstruction=[canvas_Instruction.SET_FILL_STYLE,fillStyle];return"string"!=typeof fillStyle&&fillInstruction.push(!0),fillInstruction},CanvasReplay.prototype.applyStroke=function(state){this.instructions.push(this.createStroke(state))},CanvasReplay.prototype.createStroke=function(state){return[canvas_Instruction.SET_STROKE_STYLE,state.strokeStyle,state.lineWidth*this.pixelRatio,state.lineCap,state.lineJoin,state.miterLimit,this.applyPixelRatio(state.lineDash),state.lineDashOffset*this.pixelRatio]},CanvasReplay.prototype.updateFillStyle=function(state,createFill,geometry){var fillStyle=state.fillStyle;"string"==typeof fillStyle&&state.currentFillStyle==fillStyle||(void 0!==fillStyle&&this.instructions.push(createFill.call(this,state,geometry)),state.currentFillStyle=fillStyle)},CanvasReplay.prototype.updateStrokeStyle=function(state,applyStroke){var strokeStyle=state.strokeStyle,lineCap=state.lineCap,lineDash=state.lineDash,lineDashOffset=state.lineDashOffset,lineJoin=state.lineJoin,lineWidth=state.lineWidth,miterLimit=state.miterLimit;(state.currentStrokeStyle!=strokeStyle||state.currentLineCap!=lineCap||lineDash!=state.currentLineDash&&!equals(state.currentLineDash,lineDash)||state.currentLineDashOffset!=lineDashOffset||state.currentLineJoin!=lineJoin||state.currentLineWidth!=lineWidth||state.currentMiterLimit!=miterLimit)&&(void 0!==strokeStyle&&applyStroke.call(this,state),state.currentStrokeStyle=strokeStyle,state.currentLineCap=lineCap,state.currentLineDash=lineDash,state.currentLineDashOffset=lineDashOffset,state.currentLineJoin=lineJoin,state.currentLineWidth=lineWidth,state.currentMiterLimit=miterLimit)},CanvasReplay.prototype.endGeometry=function(geometry,feature){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;var endGeometryInstruction=[canvas_Instruction.END_GEOMETRY,feature];this.instructions.push(endGeometryInstruction),this.hitDetectionInstructions.push(endGeometryInstruction)},CanvasReplay.prototype.getBufferedMaxExtent=function(){if(!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=extent_clone(this.maxExtent),0<this.maxLineWidth)){var width=this.resolution*(this.maxLineWidth+1)/2;buffer(this.bufferedMaxExtent_,width,this.bufferedMaxExtent_)}return this.bufferedMaxExtent_},CanvasReplay}(render_VectorContext),ImageReplay=function(CanvasReplay){function CanvasImageReplay(tolerance,maxExtent,resolution,pixelRatio,overlaps,declutterTree){CanvasReplay.call(this,tolerance,maxExtent,resolution,pixelRatio,overlaps,declutterTree),this.declutterGroup_=null,this.hitDetectionImage_=null,this.image_=null,this.anchorX_=void 0,this.anchorY_=void 0,this.height_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.scale_=void 0,this.width_=void 0}return CanvasReplay&&(CanvasImageReplay.__proto__=CanvasReplay),((CanvasImageReplay.prototype=Object.create(CanvasReplay&&CanvasReplay.prototype)).constructor=CanvasImageReplay).prototype.drawCoordinates_=function(flatCoordinates,offset,end,stride){return this.appendFlatCoordinates(flatCoordinates,offset,end,stride,!1,!1)},CanvasImageReplay.prototype.drawPoint=function(pointGeometry,feature){if(this.image_){this.beginGeometry(pointGeometry,feature);var flatCoordinates=pointGeometry.getFlatCoordinates(),stride=pointGeometry.getStride(),myBegin=this.coordinates.length,myEnd=this.drawCoordinates_(flatCoordinates,0,flatCoordinates.length,stride);this.instructions.push([canvas_Instruction.DRAW_IMAGE,myBegin,myEnd,this.image_,this.anchorX_,this.anchorY_,this.declutterGroup_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_*this.pixelRatio,this.width_]),this.hitDetectionInstructions.push([canvas_Instruction.DRAW_IMAGE,myBegin,myEnd,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.declutterGroup_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_]),this.endGeometry(pointGeometry,feature)}},CanvasImageReplay.prototype.drawMultiPoint=function(multiPointGeometry,feature){if(this.image_){this.beginGeometry(multiPointGeometry,feature);var flatCoordinates=multiPointGeometry.getFlatCoordinates(),stride=multiPointGeometry.getStride(),myBegin=this.coordinates.length,myEnd=this.drawCoordinates_(flatCoordinates,0,flatCoordinates.length,stride);this.instructions.push([canvas_Instruction.DRAW_IMAGE,myBegin,myEnd,this.image_,this.anchorX_,this.anchorY_,this.declutterGroup_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_*this.pixelRatio,this.width_]),this.hitDetectionInstructions.push([canvas_Instruction.DRAW_IMAGE,myBegin,myEnd,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.declutterGroup_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_]),this.endGeometry(multiPointGeometry,feature)}},CanvasImageReplay.prototype.finish=function(){this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0},CanvasImageReplay.prototype.setImageStyle=function(imageStyle,declutterGroup){var anchor=imageStyle.getAnchor(),size=imageStyle.getSize(),hitDetectionImage=imageStyle.getHitDetectionImage(1),image=imageStyle.getImage(1),origin=imageStyle.getOrigin();this.anchorX_=anchor[0],this.anchorY_=anchor[1],this.declutterGroup_=declutterGroup,this.hitDetectionImage_=hitDetectionImage,this.image_=image,this.height_=size[1],this.opacity_=imageStyle.getOpacity(),this.originX_=origin[0],this.originY_=origin[1],this.rotateWithView_=imageStyle.getRotateWithView(),this.rotation_=imageStyle.getRotation(),this.scale_=imageStyle.getScale(),this.width_=size[0]},CanvasImageReplay}(Replay),LineStringReplay=function(CanvasReplay){function CanvasLineStringReplay(tolerance,maxExtent,resolution,pixelRatio,overlaps,declutterTree){CanvasReplay.call(this,tolerance,maxExtent,resolution,pixelRatio,overlaps,declutterTree)}return CanvasReplay&&(CanvasLineStringReplay.__proto__=CanvasReplay),((CanvasLineStringReplay.prototype=Object.create(CanvasReplay&&CanvasReplay.prototype)).constructor=CanvasLineStringReplay).prototype.drawFlatCoordinates_=function(flatCoordinates,offset,end,stride){var myBegin=this.coordinates.length,myEnd=this.appendFlatCoordinates(flatCoordinates,offset,end,stride,!1,!1),moveToLineToInstruction=[canvas_Instruction.MOVE_TO_LINE_TO,myBegin,myEnd];return this.instructions.push(moveToLineToInstruction),this.hitDetectionInstructions.push(moveToLineToInstruction),end},CanvasLineStringReplay.prototype.drawLineString=function(lineStringGeometry,feature){var state=this.state,strokeStyle=state.strokeStyle,lineWidth=state.lineWidth;if(void 0!==strokeStyle&&void 0!==lineWidth){this.updateStrokeStyle(state,this.applyStroke),this.beginGeometry(lineStringGeometry,feature),this.hitDetectionInstructions.push([canvas_Instruction.SET_STROKE_STYLE,state.strokeStyle,state.lineWidth,state.lineCap,state.lineJoin,state.miterLimit,state.lineDash,state.lineDashOffset],beginPathInstruction);var flatCoordinates=lineStringGeometry.getFlatCoordinates(),stride=lineStringGeometry.getStride();this.drawFlatCoordinates_(flatCoordinates,0,flatCoordinates.length,stride),this.hitDetectionInstructions.push(Instruction_strokeInstruction),this.endGeometry(lineStringGeometry,feature)}},CanvasLineStringReplay.prototype.drawMultiLineString=function(multiLineStringGeometry,feature){var state=this.state,strokeStyle=state.strokeStyle,lineWidth=state.lineWidth;if(void 0!==strokeStyle&&void 0!==lineWidth){this.updateStrokeStyle(state,this.applyStroke),this.beginGeometry(multiLineStringGeometry,feature),this.hitDetectionInstructions.push([canvas_Instruction.SET_STROKE_STYLE,state.strokeStyle,state.lineWidth,state.lineCap,state.lineJoin,state.miterLimit,state.lineDash,state.lineDashOffset],beginPathInstruction);for(var ends=multiLineStringGeometry.getEnds(),flatCoordinates=multiLineStringGeometry.getFlatCoordinates(),stride=multiLineStringGeometry.getStride(),offset=0,i=0,ii=ends.length;i<ii;++i)offset=this.drawFlatCoordinates_(flatCoordinates,offset,ends[i],stride);this.hitDetectionInstructions.push(Instruction_strokeInstruction),this.endGeometry(multiLineStringGeometry,feature)}},CanvasLineStringReplay.prototype.finish=function(){var state=this.state;null!=state.lastStroke&&state.lastStroke!=this.coordinates.length&&this.instructions.push(Instruction_strokeInstruction),this.reverseHitDetectionInstructions(),this.state=null},CanvasLineStringReplay.prototype.applyStroke=function(state){null!=state.lastStroke&&state.lastStroke!=this.coordinates.length&&(this.instructions.push(Instruction_strokeInstruction),state.lastStroke=this.coordinates.length),state.lastStroke=0,CanvasReplay.prototype.applyStroke.call(this,state),this.instructions.push(beginPathInstruction)},CanvasLineStringReplay}(Replay),PolygonReplay_CanvasPolygonReplay=function(CanvasReplay){function CanvasPolygonReplay(tolerance,maxExtent,resolution,pixelRatio,overlaps,declutterTree){CanvasReplay.call(this,tolerance,maxExtent,resolution,pixelRatio,overlaps,declutterTree)}return CanvasReplay&&(CanvasPolygonReplay.__proto__=CanvasReplay),((CanvasPolygonReplay.prototype=Object.create(CanvasReplay&&CanvasReplay.prototype)).constructor=CanvasPolygonReplay).prototype.drawFlatCoordinatess_=function(flatCoordinates,offset,ends,stride){var state=this.state,fill=void 0!==state.fillStyle,stroke=null!=state.strokeStyle,numEnds=ends.length;this.instructions.push(beginPathInstruction),this.hitDetectionInstructions.push(beginPathInstruction);for(var i=0;i<numEnds;++i){var end=ends[i],myBegin=this.coordinates.length,myEnd=this.appendFlatCoordinates(flatCoordinates,offset,end,stride,!0,!stroke),moveToLineToInstruction=[canvas_Instruction.MOVE_TO_LINE_TO,myBegin,myEnd];this.instructions.push(moveToLineToInstruction),this.hitDetectionInstructions.push(moveToLineToInstruction),stroke&&(this.instructions.push(closePathInstruction),this.hitDetectionInstructions.push(closePathInstruction)),offset=end}return fill&&(this.instructions.push(Instruction_fillInstruction),this.hitDetectionInstructions.push(Instruction_fillInstruction)),stroke&&(this.instructions.push(Instruction_strokeInstruction),this.hitDetectionInstructions.push(Instruction_strokeInstruction)),offset},CanvasPolygonReplay.prototype.drawCircle=function(circleGeometry,feature){var state=this.state,fillStyle=state.fillStyle,strokeStyle=state.strokeStyle;if(void 0!==fillStyle||void 0!==strokeStyle){this.setFillStrokeStyles_(circleGeometry),this.beginGeometry(circleGeometry,feature),void 0!==state.fillStyle&&this.hitDetectionInstructions.push([canvas_Instruction.SET_FILL_STYLE,asString(defaultFillStyle)]),void 0!==state.strokeStyle&&this.hitDetectionInstructions.push([canvas_Instruction.SET_STROKE_STYLE,state.strokeStyle,state.lineWidth,state.lineCap,state.lineJoin,state.miterLimit,state.lineDash,state.lineDashOffset]);var flatCoordinates=circleGeometry.getFlatCoordinates(),stride=circleGeometry.getStride(),myBegin=this.coordinates.length;this.appendFlatCoordinates(flatCoordinates,0,flatCoordinates.length,stride,!1,!1);var circleInstruction=[canvas_Instruction.CIRCLE,myBegin];this.instructions.push(beginPathInstruction,circleInstruction),this.hitDetectionInstructions.push(beginPathInstruction,circleInstruction),this.hitDetectionInstructions.push(Instruction_fillInstruction),void 0!==state.fillStyle&&this.instructions.push(Instruction_fillInstruction),void 0!==state.strokeStyle&&(this.instructions.push(Instruction_strokeInstruction),this.hitDetectionInstructions.push(Instruction_strokeInstruction)),this.endGeometry(circleGeometry,feature)}},CanvasPolygonReplay.prototype.drawPolygon=function(polygonGeometry,feature){var state=this.state,fillStyle=state.fillStyle,strokeStyle=state.strokeStyle;if(void 0!==fillStyle||void 0!==strokeStyle){this.setFillStrokeStyles_(polygonGeometry),this.beginGeometry(polygonGeometry,feature),void 0!==state.fillStyle&&this.hitDetectionInstructions.push([canvas_Instruction.SET_FILL_STYLE,asString(defaultFillStyle)]),void 0!==state.strokeStyle&&this.hitDetectionInstructions.push([canvas_Instruction.SET_STROKE_STYLE,state.strokeStyle,state.lineWidth,state.lineCap,state.lineJoin,state.miterLimit,state.lineDash,state.lineDashOffset]);var ends=polygonGeometry.getEnds(),flatCoordinates=polygonGeometry.getOrientedFlatCoordinates(),stride=polygonGeometry.getStride();this.drawFlatCoordinatess_(flatCoordinates,0,ends,stride),this.endGeometry(polygonGeometry,feature)}},CanvasPolygonReplay.prototype.drawMultiPolygon=function(multiPolygonGeometry,feature){var state=this.state,fillStyle=state.fillStyle,strokeStyle=state.strokeStyle;if(void 0!==fillStyle||void 0!==strokeStyle){this.setFillStrokeStyles_(multiPolygonGeometry),this.beginGeometry(multiPolygonGeometry,feature),void 0!==state.fillStyle&&this.hitDetectionInstructions.push([canvas_Instruction.SET_FILL_STYLE,asString(defaultFillStyle)]),void 0!==state.strokeStyle&&this.hitDetectionInstructions.push([canvas_Instruction.SET_STROKE_STYLE,state.strokeStyle,state.lineWidth,state.lineCap,state.lineJoin,state.miterLimit,state.lineDash,state.lineDashOffset]);for(var endss=multiPolygonGeometry.getEndss(),flatCoordinates=multiPolygonGeometry.getOrientedFlatCoordinates(),stride=multiPolygonGeometry.getStride(),offset=0,i=0,ii=endss.length;i<ii;++i)offset=this.drawFlatCoordinatess_(flatCoordinates,offset,endss[i],stride);this.endGeometry(multiPolygonGeometry,feature)}},CanvasPolygonReplay.prototype.finish=function(){this.reverseHitDetectionInstructions(),this.state=null;var tolerance=this.tolerance;if(0!==tolerance)for(var coordinates=this.coordinates,i=0,ii=coordinates.length;i<ii;++i)coordinates[i]=snap(coordinates[i],tolerance)},CanvasPolygonReplay.prototype.setFillStrokeStyles_=function(geometry){var state=this.state;void 0!==state.fillStyle&&this.updateFillStyle(state,this.createFill,geometry),void 0!==state.strokeStyle&&this.updateStrokeStyle(state,this.applyStroke)},CanvasPolygonReplay}(Replay);function matchingChunk(maxAngle,flatCoordinates,offset,end,stride){var i,m12,m23,x1,y1,x12,y12,x23,y23,chunkStart=offset,chunkEnd=offset,chunkM=0,m=0,start=offset;for(i=offset;i<end;i+=stride){var x2=flatCoordinates[i],y2=flatCoordinates[i+1];void 0!==x1&&(x23=x2-x1,y23=y2-y1,m23=Math.sqrt(x23*x23+y23*y23),void 0!==x12&&(m+=m12,maxAngle<Math.acos((x12*x23+y12*y23)/(m12*m23))&&(chunkM<m&&(chunkM=m,chunkStart=start,chunkEnd=i),m=0,start=i-stride)),m12=m23,x12=x23,y12=y23),x1=x2,y1=y2}return chunkM<(m+=m23)?[start,i]:[chunkStart,chunkEnd]}var TextPlacement_LINE="line";var BATCH_CONSTRUCTORS={Circle:PolygonReplay_CanvasPolygonReplay,Default:Replay,Image:ImageReplay,LineString:LineStringReplay,Polygon:PolygonReplay_CanvasPolygonReplay,Text:function(CanvasReplay){function CanvasTextReplay(tolerance,maxExtent,resolution,pixelRatio,overlaps,declutterTree){CanvasReplay.call(this,tolerance,maxExtent,resolution,pixelRatio,overlaps,declutterTree),this.declutterGroup_,this.labels_=null,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=void 0,this.textRotation_=0,this.textFillState_=null,this.fillStates={},this.textStrokeState_=null,this.strokeStates={},this.textState_={},this.textStates={},this.textKey_="",this.fillKey_="",this.strokeKey_="",this.widths_={},labelCache.prune()}return CanvasReplay&&(CanvasTextReplay.__proto__=CanvasReplay),((CanvasTextReplay.prototype=Object.create(CanvasReplay&&CanvasReplay.prototype)).constructor=CanvasTextReplay).prototype.drawText=function(geometry,feature){var fillState=this.textFillState_,strokeState=this.textStrokeState_,textState=this.textState_;if(""!==this.text_&&textState&&(fillState||strokeState)){var i,ii,begin=this.coordinates.length,geometryType=geometry.getType(),flatCoordinates=null,end=2,stride=2;if(textState.placement===TextPlacement_LINE){if(!extent_intersects(this.getBufferedMaxExtent(),geometry.getExtent()))return;var ends;if(flatCoordinates=geometry.getFlatCoordinates(),stride=geometry.getStride(),geometryType==GeometryType.LINE_STRING)ends=[flatCoordinates.length];else if(geometryType==GeometryType.MULTI_LINE_STRING)ends=geometry.getEnds();else if(geometryType==GeometryType.POLYGON)ends=geometry.getEnds().slice(0,1);else if(geometryType==GeometryType.MULTI_POLYGON){var endss=geometry.getEndss();for(ends=[],i=0,ii=endss.length;i<ii;++i)ends.push(endss[i][0])}this.beginGeometry(geometry,feature);for(var flatEnd,textAlign=textState.textAlign,flatOffset=0,o=0,oo=ends.length;o<oo;++o){if(null==textAlign){var range=matchingChunk(textState.maxAngle,flatCoordinates,flatOffset,ends[o],stride);flatOffset=range[0],flatEnd=range[1]}else flatEnd=ends[o];for(i=flatOffset;i<flatEnd;i+=stride)this.coordinates.push(flatCoordinates[i],flatCoordinates[i+1]);end=this.coordinates.length,flatOffset=ends[o],this.drawChars_(begin,end,this.declutterGroup_),begin=end}this.endGeometry(geometry,feature)}else{var label=this.getImage(this.text_,this.textKey_,this.fillKey_,this.strokeKey_),width=label.width/this.pixelRatio;switch(geometryType){case GeometryType.POINT:case GeometryType.MULTI_POINT:end=(flatCoordinates=geometry.getFlatCoordinates()).length;break;case GeometryType.LINE_STRING:flatCoordinates=geometry.getFlatMidpoint();break;case GeometryType.CIRCLE:flatCoordinates=geometry.getCenter();break;case GeometryType.MULTI_LINE_STRING:end=(flatCoordinates=geometry.getFlatMidpoints()).length;break;case GeometryType.POLYGON:if(flatCoordinates=geometry.getFlatInteriorPoint(),!textState.overflow&&flatCoordinates[2]/this.resolution<width)return;stride=3;break;case GeometryType.MULTI_POLYGON:var interiorPoints=geometry.getFlatInteriorPoints();for(flatCoordinates=[],i=0,ii=interiorPoints.length;i<ii;i+=3)(textState.overflow||interiorPoints[i+2]/this.resolution>=width)&&flatCoordinates.push(interiorPoints[i],interiorPoints[i+1]);if(0==(end=flatCoordinates.length))return}end=this.appendFlatCoordinates(flatCoordinates,0,end,stride,!1,!1),(textState.backgroundFill||textState.backgroundStroke)&&(this.setFillStrokeStyle(textState.backgroundFill,textState.backgroundStroke),textState.backgroundFill&&(this.updateFillStyle(this.state,this.createFill,geometry),this.hitDetectionInstructions.push(this.createFill(this.state,geometry))),textState.backgroundStroke&&(this.updateStrokeStyle(this.state,this.applyStroke),this.hitDetectionInstructions.push(this.createStroke(this.state)))),this.beginGeometry(geometry,feature),this.drawTextImage_(label,begin,end),this.endGeometry(geometry,feature)}}},CanvasTextReplay.prototype.getImage=function(text,textKey,fillKey,strokeKey){var label,key=strokeKey+textKey+text+fillKey+this.pixelRatio;if(!labelCache.containsKey(key)){var strokeState=strokeKey?this.strokeStates[strokeKey]||this.textStrokeState_:null,fillState=fillKey?this.fillStates[fillKey]||this.textFillState_:null,textState=this.textStates[textKey]||this.textState_,pixelRatio=this.pixelRatio,scale=textState.scale*pixelRatio,align=TEXT_ALIGN[textState.textAlign||"center"],strokeWidth=strokeKey&&strokeState.lineWidth?strokeState.lineWidth:0,lines=text.split("\n"),numLines=lines.length,widths=[],width=function(font,lines,widths){for(var numLines=lines.length,width=0,i=0;i<numLines;++i){var currentWidth=measureTextWidth(font,lines[i]);width=Math.max(width,currentWidth),widths.push(currentWidth)}return width}(textState.font,lines,widths),lineHeight=measureTextHeight(textState.font),height=lineHeight*numLines,renderWidth=width+strokeWidth,context=createCanvasContext2D(Math.ceil(renderWidth*scale),Math.ceil((height+strokeWidth)*scale));label=context.canvas,labelCache.set(key,label),1!=scale&&context.scale(scale,scale),context.font=textState.font,strokeKey&&(context.strokeStyle=strokeState.strokeStyle,context.lineWidth=strokeWidth,context.lineCap=strokeState.lineCap,context.lineJoin=strokeState.lineJoin,context.miterLimit=strokeState.miterLimit,CANVAS_LINE_DASH&&strokeState.lineDash.length&&(context.setLineDash(strokeState.lineDash),context.lineDashOffset=strokeState.lineDashOffset)),fillKey&&(context.fillStyle=fillState.fillStyle),context.textBaseline="middle",context.textAlign="center";var i,leftRight=.5-align,x=align*label.width/scale+leftRight*strokeWidth;if(strokeKey)for(i=0;i<numLines;++i)context.strokeText(lines[i],x+leftRight*widths[i],.5*(strokeWidth+lineHeight)+i*lineHeight);if(fillKey)for(i=0;i<numLines;++i)context.fillText(lines[i],x+leftRight*widths[i],.5*(strokeWidth+lineHeight)+i*lineHeight)}return labelCache.get(key)},CanvasTextReplay.prototype.drawTextImage_=function(label,begin,end){var textState=this.textState_,strokeState=this.textStrokeState_,pixelRatio=this.pixelRatio,align=TEXT_ALIGN[textState.textAlign||"center"],baseline=TEXT_ALIGN[textState.textBaseline],strokeWidth=strokeState&&strokeState.lineWidth?strokeState.lineWidth:0,anchorX=align*label.width/pixelRatio+2*(.5-align)*strokeWidth,anchorY=baseline*label.height/pixelRatio+2*(.5-baseline)*strokeWidth;this.instructions.push([canvas_Instruction.DRAW_IMAGE,begin,end,label,(anchorX-this.textOffsetX_)*pixelRatio,(anchorY-this.textOffsetY_)*pixelRatio,this.declutterGroup_,label.height,1,0,0,this.textRotateWithView_,this.textRotation_,1,label.width,textState.padding==defaultPadding?defaultPadding:textState.padding.map(function(p){return p*pixelRatio}),!!textState.backgroundFill,!!textState.backgroundStroke]),this.hitDetectionInstructions.push([canvas_Instruction.DRAW_IMAGE,begin,end,label,(anchorX-this.textOffsetX_)*pixelRatio,(anchorY-this.textOffsetY_)*pixelRatio,this.declutterGroup_,label.height,1,0,0,this.textRotateWithView_,this.textRotation_,1/pixelRatio,label.width,textState.padding,!!textState.backgroundFill,!!textState.backgroundStroke])},CanvasTextReplay.prototype.drawChars_=function(begin,end,declutterGroup){var strokeState=this.textStrokeState_,textState=this.textState_,fillState=this.textFillState_,strokeKey=this.strokeKey_;strokeState&&(strokeKey in this.strokeStates||(this.strokeStates[strokeKey]={strokeStyle:strokeState.strokeStyle,lineCap:strokeState.lineCap,lineDashOffset:strokeState.lineDashOffset,lineWidth:strokeState.lineWidth,lineJoin:strokeState.lineJoin,miterLimit:strokeState.miterLimit,lineDash:strokeState.lineDash}));var textKey=this.textKey_;this.textKey_ in this.textStates||(this.textStates[this.textKey_]={font:textState.font,textAlign:textState.textAlign||"center",scale:textState.scale});var fillKey=this.fillKey_;fillState&&(fillKey in this.fillStates||(this.fillStates[fillKey]={fillStyle:fillState.fillStyle}));var pixelRatio=this.pixelRatio,baseline=TEXT_ALIGN[textState.textBaseline],offsetY=this.textOffsetY_*pixelRatio,text=this.text_,font=textState.font,textScale=textState.scale,strokeWidth=strokeState?strokeState.lineWidth*textScale/2:0,widths=this.widths_[font];widths||(this.widths_[font]=widths={}),this.instructions.push([canvas_Instruction.DRAW_CHARS,begin,end,baseline,declutterGroup,textState.overflow,fillKey,textState.maxAngle,function(text){var width=widths[text];return width||(width=widths[text]=measureTextWidth(font,text)),width*textScale*pixelRatio},offsetY,strokeKey,strokeWidth*pixelRatio,text,textKey,1]),this.hitDetectionInstructions.push([canvas_Instruction.DRAW_CHARS,begin,end,baseline,declutterGroup,textState.overflow,fillKey,textState.maxAngle,function(text){var width=widths[text];return width||(width=widths[text]=measureTextWidth(font,text)),width*textScale},offsetY,strokeKey,strokeWidth,text,textKey,1/pixelRatio])},CanvasTextReplay.prototype.setTextStyle=function(textStyle,declutterGroup){var textState,fillState,strokeState;if(textStyle){this.declutterGroup_=declutterGroup;var textFillStyle=textStyle.getFill();textFillStyle?((fillState=this.textFillState_)||(fillState=this.textFillState_={}),fillState.fillStyle=asColorLike(textFillStyle.getColor()||defaultFillStyle)):fillState=this.textFillState_=null;var textStrokeStyle=textStyle.getStroke();if(textStrokeStyle){(strokeState=this.textStrokeState_)||(strokeState=this.textStrokeState_={});var lineDash=textStrokeStyle.getLineDash(),lineDashOffset=textStrokeStyle.getLineDashOffset(),lineWidth=textStrokeStyle.getWidth(),miterLimit=textStrokeStyle.getMiterLimit();strokeState.lineCap=textStrokeStyle.getLineCap()||"round",strokeState.lineDash=lineDash?lineDash.slice():defaultLineDash,strokeState.lineDashOffset=void 0===lineDashOffset?0:lineDashOffset,strokeState.lineJoin=textStrokeStyle.getLineJoin()||"round",strokeState.lineWidth=void 0===lineWidth?1:lineWidth,strokeState.miterLimit=void 0===miterLimit?10:miterLimit,strokeState.strokeStyle=asColorLike(textStrokeStyle.getColor()||defaultStrokeStyle)}else strokeState=this.textStrokeState_=null;textState=this.textState_;var font=textStyle.getFont()||"10px sans-serif";checkFont(font);var textScale=textStyle.getScale();textState.overflow=textStyle.getOverflow(),textState.font=font,textState.maxAngle=textStyle.getMaxAngle(),textState.placement=textStyle.getPlacement(),textState.textAlign=textStyle.getTextAlign(),textState.textBaseline=textStyle.getTextBaseline()||"middle",textState.backgroundFill=textStyle.getBackgroundFill(),textState.backgroundStroke=textStyle.getBackgroundStroke(),textState.padding=textStyle.getPadding()||defaultPadding,textState.scale=void 0===textScale?1:textScale;var textOffsetX=textStyle.getOffsetX(),textOffsetY=textStyle.getOffsetY(),textRotateWithView=textStyle.getRotateWithView(),textRotation=textStyle.getRotation();this.text_=textStyle.getText()||"",this.textOffsetX_=void 0===textOffsetX?0:textOffsetX,this.textOffsetY_=void 0===textOffsetY?0:textOffsetY,this.textRotateWithView_=void 0!==textRotateWithView&&textRotateWithView,this.textRotation_=void 0===textRotation?0:textRotation,this.strokeKey_=strokeState?("string"==typeof strokeState.strokeStyle?strokeState.strokeStyle:getUid(strokeState.strokeStyle))+strokeState.lineCap+strokeState.lineDashOffset+"|"+strokeState.lineWidth+strokeState.lineJoin+strokeState.miterLimit+"["+strokeState.lineDash.join()+"]":"",this.textKey_=textState.font+textState.scale+(textState.textAlign||"?"),this.fillKey_=fillState?"string"==typeof fillState.fillStyle?fillState.fillStyle:"|"+getUid(fillState.fillStyle):""}else this.text_=""},CanvasTextReplay}(Replay)},ReplayGroup_CanvasReplayGroup=function(ReplayGroup){function CanvasReplayGroup(tolerance,maxExtent,resolution,pixelRatio,overlaps,declutterTree,opt_renderBuffer){ReplayGroup.call(this),this.declutterTree_=declutterTree,this.declutterGroup_=null,this.tolerance_=tolerance,this.maxExtent_=maxExtent,this.overlaps_=overlaps,this.pixelRatio_=pixelRatio,this.resolution_=resolution,this.renderBuffer_=opt_renderBuffer,this.replaysByZIndex_={},this.hitDetectionContext_=createCanvasContext2D(1,1),this.hitDetectionTransform_=[1,0,0,1,0,0]}return ReplayGroup&&(CanvasReplayGroup.__proto__=ReplayGroup),((CanvasReplayGroup.prototype=Object.create(ReplayGroup&&ReplayGroup.prototype)).constructor=CanvasReplayGroup).prototype.addDeclutter=function(group){var declutter=null;return this.declutterTree_&&(group?(declutter=this.declutterGroup_)[4]++:(declutter=this.declutterGroup_=[1/0,1/0,-1/0,-1/0]).push(1)),declutter},CanvasReplayGroup.prototype.clip=function(context,transform){var flatClipCoords=this.getClipCoords(transform);context.beginPath(),context.moveTo(flatClipCoords[0],flatClipCoords[1]),context.lineTo(flatClipCoords[2],flatClipCoords[3]),context.lineTo(flatClipCoords[4],flatClipCoords[5]),context.lineTo(flatClipCoords[6],flatClipCoords[7]),context.clip()},CanvasReplayGroup.prototype.hasReplays=function(replays){for(var zIndex in this.replaysByZIndex_)for(var candidates=this.replaysByZIndex_[zIndex],i=0,ii=replays.length;i<ii;++i)if(replays[i]in candidates)return!0;return!1},CanvasReplayGroup.prototype.finish=function(){for(var zKey in this.replaysByZIndex_){var replays=this.replaysByZIndex_[zKey];for(var replayKey in replays)replays[replayKey].finish()}},CanvasReplayGroup.prototype.forEachFeatureAtCoordinate=function(coordinate,resolution,rotation,hitTolerance,skippedFeaturesHash,callback,declutterReplays){var hitExtent,contextSize=2*(hitTolerance=Math.round(hitTolerance))+1,transform=transform_compose(this.hitDetectionTransform_,hitTolerance+.5,hitTolerance+.5,1/resolution,-1/resolution,-rotation,-coordinate[0],-coordinate[1]),context=this.hitDetectionContext_;context.canvas.width!==contextSize||context.canvas.height!==contextSize?(context.canvas.width=contextSize,context.canvas.height=contextSize):context.clearRect(0,0,contextSize,contextSize),void 0!==this.renderBuffer_&&(extendCoordinate(hitExtent=[1/0,1/0,-1/0,-1/0],coordinate),buffer(hitExtent,resolution*(this.renderBuffer_+hitTolerance),hitExtent));var declutteredFeatures,replayType,mask=function(radius){if(void 0!==circleArrayCache[radius])return circleArrayCache[radius];for(var arraySize=2*radius+1,arr=new Array(arraySize),i=0;i<arraySize;i++)arr[i]=new Array(arraySize);var x=radius,y=0,error=0;for(;y<=x;)fillCircleArrayRowToMiddle(arr,radius+x,radius+y),fillCircleArrayRowToMiddle(arr,radius+y,radius+x),fillCircleArrayRowToMiddle(arr,radius-y,radius+x),fillCircleArrayRowToMiddle(arr,radius-x,radius+y),fillCircleArrayRowToMiddle(arr,radius-x,radius-y),fillCircleArrayRowToMiddle(arr,radius-y,radius-x),fillCircleArrayRowToMiddle(arr,radius+y,radius-x),fillCircleArrayRowToMiddle(arr,radius+x,radius-y),0<2*((error+=1+2*++y)-x)+1&&(error+=1-2*(x-=1));return circleArrayCache[radius]=arr}(hitTolerance);function featureCallback(feature){for(var imageData=context.getImageData(0,0,contextSize,contextSize).data,i=0;i<contextSize;i++)for(var j=0;j<contextSize;j++)if(mask[i][j]&&0<imageData[4*(j*contextSize+i)+3]){var result=void 0;return(!declutteredFeatures||replayType!=ReplayType.IMAGE&&replayType!=ReplayType.TEXT||-1!==declutteredFeatures.indexOf(feature))&&(result=callback(feature)),result||void context.clearRect(0,0,contextSize,contextSize)}}this.declutterTree_&&(declutteredFeatures=this.declutterTree_.all().map(function(entry){return entry.value}));var i,j,replays,replay,result,zs=Object.keys(this.replaysByZIndex_).map(Number);for(zs.sort(numberSafeCompareFunction),i=zs.length-1;0<=i;--i){var zIndexKey=zs[i].toString();for(replays=this.replaysByZIndex_[zIndexKey],j=ORDER.length-1;0<=j;--j)if(void 0!==(replay=replays[replayType=ORDER[j]]))if(!declutterReplays||replayType!=ReplayType.IMAGE&&replayType!=ReplayType.TEXT){if(result=replay.replayHitDetection(context,transform,rotation,skippedFeaturesHash,featureCallback,hitExtent))return result}else{var declutter=declutterReplays[zIndexKey];declutter?declutter.push(replay,transform.slice(0)):declutterReplays[zIndexKey]=[replay,transform.slice(0)]}}},CanvasReplayGroup.prototype.getClipCoords=function(transform){var maxExtent=this.maxExtent_,minX=maxExtent[0],minY=maxExtent[1],maxX=maxExtent[2],maxY=maxExtent[3],flatClipCoords=[minX,minY,minX,maxY,maxX,maxY,maxX,minY];return transform2D(flatClipCoords,0,8,2,transform,flatClipCoords),flatClipCoords},CanvasReplayGroup.prototype.getReplay=function(zIndex,replayType){var zIndexKey=void 0!==zIndex?zIndex.toString():"0",replays=this.replaysByZIndex_[zIndexKey];void 0===replays&&(replays={},this.replaysByZIndex_[zIndexKey]=replays);var replay=replays[replayType];void 0===replay&&(replay=new BATCH_CONSTRUCTORS[replayType](this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_,this.overlaps_,this.declutterTree_),replays[replayType]=replay);return replay},CanvasReplayGroup.prototype.getReplays=function(){return this.replaysByZIndex_},CanvasReplayGroup.prototype.isEmpty=function(){return obj_isEmpty(this.replaysByZIndex_)},CanvasReplayGroup.prototype.replay=function(context,transform,viewRotation,skippedFeaturesHash,snapToPixel,opt_replayTypes,opt_declutterReplays){var zs=Object.keys(this.replaysByZIndex_).map(Number);zs.sort(numberSafeCompareFunction),context.save(),this.clip(context,transform);var i,ii,j,jj,replays,replay,replayTypes=opt_replayTypes||ORDER;for(i=0,ii=zs.length;i<ii;++i){var zIndexKey=zs[i].toString();for(replays=this.replaysByZIndex_[zIndexKey],j=0,jj=replayTypes.length;j<jj;++j){var replayType=replayTypes[j];if(replay=replays[replayType],void 0!==replay)if(!opt_declutterReplays||replayType!=ReplayType.IMAGE&&replayType!=ReplayType.TEXT)replay.replay(context,transform,viewRotation,skippedFeaturesHash,snapToPixel);else{var declutter=opt_declutterReplays[zIndexKey];declutter?declutter.push(replay,transform.slice(0)):opt_declutterReplays[zIndexKey]=[replay,transform.slice(0)]}}}context.restore()},CanvasReplayGroup}(render_ReplayGroup),circleArrayCache={0:[[!0]]};function fillCircleArrayRowToMiddle(array,x,y){var i,radius=Math.floor(array.length/2);if(radius<=x)for(i=radius;i<x;i++)array[i][y]=!0;else if(x<radius)for(i=x+1;i<radius;i++)array[i][y]=!0}var canvas_ReplayGroup=ReplayGroup_CanvasReplayGroup,SIMPLIFY_TOLERANCE=.5,GEOMETRY_RENDERERS={Point:function(replayGroup,geometry,style,feature){var imageStyle=style.getImage();if(imageStyle){if(imageStyle.getImageState()!=ImageState.LOADED)return;var imageReplay=replayGroup.getReplay(style.getZIndex(),ReplayType.IMAGE);imageReplay.setImageStyle(imageStyle,replayGroup.addDeclutter(!1)),imageReplay.drawPoint(geometry,feature)}var textStyle=style.getText();if(textStyle){var textReplay=replayGroup.getReplay(style.getZIndex(),ReplayType.TEXT);textReplay.setTextStyle(textStyle,replayGroup.addDeclutter(!!imageStyle)),textReplay.drawText(geometry,feature)}},LineString:function(replayGroup,geometry,style,feature){var strokeStyle=style.getStroke();if(strokeStyle){var lineStringReplay=replayGroup.getReplay(style.getZIndex(),ReplayType.LINE_STRING);lineStringReplay.setFillStrokeStyle(null,strokeStyle),lineStringReplay.drawLineString(geometry,feature)}var textStyle=style.getText();if(textStyle){var textReplay=replayGroup.getReplay(style.getZIndex(),ReplayType.TEXT);textReplay.setTextStyle(textStyle,replayGroup.addDeclutter(!1)),textReplay.drawText(geometry,feature)}},Polygon:function(replayGroup,geometry,style,feature){var fillStyle=style.getFill(),strokeStyle=style.getStroke();if(fillStyle||strokeStyle){var polygonReplay=replayGroup.getReplay(style.getZIndex(),ReplayType.POLYGON);polygonReplay.setFillStrokeStyle(fillStyle,strokeStyle),polygonReplay.drawPolygon(geometry,feature)}var textStyle=style.getText();if(textStyle){var textReplay=replayGroup.getReplay(style.getZIndex(),ReplayType.TEXT);textReplay.setTextStyle(textStyle,replayGroup.addDeclutter(!1)),textReplay.drawText(geometry,feature)}},MultiPoint:function(replayGroup,geometry,style,feature){var imageStyle=style.getImage();if(imageStyle){if(imageStyle.getImageState()!=ImageState.LOADED)return;var imageReplay=replayGroup.getReplay(style.getZIndex(),ReplayType.IMAGE);imageReplay.setImageStyle(imageStyle,replayGroup.addDeclutter(!1)),imageReplay.drawMultiPoint(geometry,feature)}var textStyle=style.getText();if(textStyle){var textReplay=replayGroup.getReplay(style.getZIndex(),ReplayType.TEXT);textReplay.setTextStyle(textStyle,replayGroup.addDeclutter(!!imageStyle)),textReplay.drawText(geometry,feature)}},MultiLineString:function(replayGroup,geometry,style,feature){var strokeStyle=style.getStroke();if(strokeStyle){var lineStringReplay=replayGroup.getReplay(style.getZIndex(),ReplayType.LINE_STRING);lineStringReplay.setFillStrokeStyle(null,strokeStyle),lineStringReplay.drawMultiLineString(geometry,feature)}var textStyle=style.getText();if(textStyle){var textReplay=replayGroup.getReplay(style.getZIndex(),ReplayType.TEXT);textReplay.setTextStyle(textStyle,replayGroup.addDeclutter(!1)),textReplay.drawText(geometry,feature)}},MultiPolygon:function(replayGroup,geometry,style,feature){var fillStyle=style.getFill(),strokeStyle=style.getStroke();if(strokeStyle||fillStyle){var polygonReplay=replayGroup.getReplay(style.getZIndex(),ReplayType.POLYGON);polygonReplay.setFillStrokeStyle(fillStyle,strokeStyle),polygonReplay.drawMultiPolygon(geometry,feature)}var textStyle=style.getText();if(textStyle){var textReplay=replayGroup.getReplay(style.getZIndex(),ReplayType.TEXT);textReplay.setTextStyle(textStyle,replayGroup.addDeclutter(!1)),textReplay.drawText(geometry,feature)}},GeometryCollection:function(replayGroup,geometry,style,feature){var i,ii,geometries=geometry.getGeometriesArray();for(i=0,ii=geometries.length;i<ii;++i){var geometryRenderer=GEOMETRY_RENDERERS[geometries[i].getType()];geometryRenderer(replayGroup,geometries[i],style,feature)}},Circle:function(replayGroup,geometry,style,feature){var fillStyle=style.getFill(),strokeStyle=style.getStroke();if(fillStyle||strokeStyle){var circleReplay=replayGroup.getReplay(style.getZIndex(),ReplayType.CIRCLE);circleReplay.setFillStrokeStyle(fillStyle,strokeStyle),circleReplay.drawCircle(geometry,feature)}var textStyle=style.getText();if(textStyle){var textReplay=replayGroup.getReplay(style.getZIndex(),ReplayType.TEXT);textReplay.setTextStyle(textStyle,replayGroup.addDeclutter(!1)),textReplay.drawText(geometry,feature)}}};function defaultOrder(feature1,feature2){return parseInt(getUid(feature1),10)-parseInt(getUid(feature2),10)}function getSquaredTolerance(resolution,pixelRatio){var tolerance=getTolerance(resolution,pixelRatio);return tolerance*tolerance}function getTolerance(resolution,pixelRatio){return SIMPLIFY_TOLERANCE*resolution/pixelRatio}function renderFeature(replayGroup,feature,style,squaredTolerance,listener,thisArg){var loading=!1,imageStyle=style.getImage();if(imageStyle){var imageState=imageStyle.getImageState();imageState==ImageState.LOADED||imageState==ImageState.ERROR?imageStyle.unlistenImageChange(listener,thisArg):(imageState==ImageState.IDLE&&imageStyle.load(),imageState=imageStyle.getImageState(),imageStyle.listenImageChange(listener,thisArg),loading=!0)}return function(replayGroup,feature,style,squaredTolerance){var geometry=style.getGeometryFunction()(feature);if(!geometry)return;var simplifiedGeometry=geometry.getSimplifiedGeometry(squaredTolerance);if(style.getRenderer())!function renderGeometry(replayGroup,geometry,style,feature){if(geometry.getType()==GeometryType.GEOMETRY_COLLECTION){for(var geometries=geometry.getGeometries(),i=0,ii=geometries.length;i<ii;++i)renderGeometry(replayGroup,geometries[i],style,feature);return}var replay=replayGroup.getReplay(style.getZIndex(),ReplayType.DEFAULT);replay.drawCustom(geometry,feature,style.getRenderer())}(replayGroup,simplifiedGeometry,style,feature);else{var geometryRenderer=GEOMETRY_RENDERERS[simplifiedGeometry.getType()];geometryRenderer(replayGroup,simplifiedGeometry,style,feature)}}(replayGroup,feature,style,squaredTolerance),loading}var VectorLayer_CanvasVectorLayerRenderer=function(CanvasLayerRenderer){function CanvasVectorLayerRenderer(vectorLayer){CanvasLayerRenderer.call(this,vectorLayer),this.declutterTree_=vectorLayer.getDeclutter()?rbush_default()(9,void 0):null,this.dirty_=!1,this.renderedRevision_=-1,this.renderedResolution_=NaN,this.renderedExtent_=[1/0,1/0,-1/0,-1/0],this.renderedRenderOrder_=null,this.replayGroup_=null,this.replayGroupChanged=!0,this.context=createCanvasContext2D(),listen(labelCache,EventType.CLEAR,this.handleFontsChanged_,this)}return CanvasLayerRenderer&&(CanvasVectorLayerRenderer.__proto__=CanvasLayerRenderer),((CanvasVectorLayerRenderer.prototype=Object.create(CanvasLayerRenderer&&CanvasLayerRenderer.prototype)).constructor=CanvasVectorLayerRenderer).prototype.disposeInternal=function(){unlisten(labelCache,EventType.CLEAR,this.handleFontsChanged_,this),CanvasLayerRenderer.prototype.disposeInternal.call(this)},CanvasVectorLayerRenderer.prototype.compose=function(context,frameState,layerState){var extent=frameState.extent,pixelRatio=frameState.pixelRatio,skippedFeatureUids=layerState.managed?frameState.skippedFeatureUids:{},viewState=frameState.viewState,projection=viewState.projection,rotation=viewState.rotation,projectionExtent=projection.getExtent(),vectorSource=this.getLayer().getSource(),transform=this.getTransform(frameState,0),clipExtent=layerState.extent,clipped=void 0!==clipExtent;clipped&&this.clip(context,frameState,clipExtent);var replayGroup=this.replayGroup_;if(replayGroup&&!replayGroup.isEmpty()){this.declutterTree_&&this.declutterTree_.clear();var replayContext,layer=this.getLayer(),drawOffsetX=0,drawOffsetY=0,transparentLayer=1!==layerState.opacity,hasRenderListeners=layer.hasListener(render_EventType_RENDER);if(transparentLayer||hasRenderListeners){var drawWidth=context.canvas.width,drawHeight=context.canvas.height;if(rotation){var drawSize=Math.round(Math.sqrt(drawWidth*drawWidth+drawHeight*drawHeight));drawOffsetX=(drawSize-drawWidth)/2,drawOffsetY=(drawSize-drawHeight)/2,drawWidth=drawHeight=drawSize}this.context.canvas.width=drawWidth,this.context.canvas.height=drawHeight,replayContext=this.context}else replayContext=context;var alpha=replayContext.globalAlpha;transparentLayer||(replayContext.globalAlpha=layerState.opacity),replayContext!=context&&replayContext.translate(drawOffsetX,drawOffsetY);var viewHints=frameState.viewHints,snapToPixel=!(viewHints[ViewHint_ANIMATING]||viewHints[ViewHint_INTERACTING]),width=frameState.size[0]*pixelRatio,height=frameState.size[1]*pixelRatio;if(rotateAtOffset(replayContext,-rotation,width/2,height/2),replayGroup.replay(replayContext,transform,rotation,skippedFeatureUids,snapToPixel),vectorSource.getWrapX()&&projection.canWrapX()&&!containsExtent(projectionExtent,extent)){for(var offsetX,startX=extent[0],worldWidth=getWidth(projectionExtent),world=0;startX<projectionExtent[0];)offsetX=worldWidth*--world,transform=this.getTransform(frameState,offsetX),replayGroup.replay(replayContext,transform,rotation,skippedFeatureUids,snapToPixel),startX+=worldWidth;for(world=0,startX=extent[2];startX>projectionExtent[2];)offsetX=worldWidth*++world,transform=this.getTransform(frameState,offsetX),replayGroup.replay(replayContext,transform,rotation,skippedFeatureUids,snapToPixel),startX-=worldWidth}if(rotateAtOffset(replayContext,rotation,width/2,height/2),hasRenderListeners&&this.dispatchRenderEvent(replayContext,frameState,transform),replayContext!=context){if(transparentLayer){var mainContextAlpha=context.globalAlpha;context.globalAlpha=layerState.opacity,context.drawImage(replayContext.canvas,-drawOffsetX,-drawOffsetY),context.globalAlpha=mainContextAlpha}else context.drawImage(replayContext.canvas,-drawOffsetX,-drawOffsetY);replayContext.translate(-drawOffsetX,-drawOffsetY)}transparentLayer||(replayContext.globalAlpha=alpha)}clipped&&context.restore()},CanvasVectorLayerRenderer.prototype.composeFrame=function(frameState,layerState,context){var transform=this.getTransform(frameState,0);this.preCompose(context,frameState,transform),this.compose(context,frameState,layerState),this.postCompose(context,frameState,layerState,transform)},CanvasVectorLayerRenderer.prototype.forEachFeatureAtCoordinate=function(coordinate,frameState,hitTolerance,callback,thisArg){if(this.replayGroup_){var resolution=frameState.viewState.resolution,rotation=frameState.viewState.rotation,layer=this.getLayer(),features={};return this.replayGroup_.forEachFeatureAtCoordinate(coordinate,resolution,rotation,hitTolerance,{},function(feature){var key=getUid(feature);if(!(key in features))return features[key]=!0,callback.call(thisArg,feature,layer)},null)}},CanvasVectorLayerRenderer.prototype.handleFontsChanged_=function(event){var layer=this.getLayer();layer.getVisible()&&this.replayGroup_&&layer.changed()},CanvasVectorLayerRenderer.prototype.handleStyleImageChange_=function(event){this.renderIfReadyAndVisible()},CanvasVectorLayerRenderer.prototype.prepareFrame=function(frameState,layerState){var vectorLayer=this.getLayer(),vectorSource=vectorLayer.getSource(),animating=frameState.viewHints[ViewHint_ANIMATING],interacting=frameState.viewHints[ViewHint_INTERACTING],updateWhileAnimating=vectorLayer.getUpdateWhileAnimating(),updateWhileInteracting=vectorLayer.getUpdateWhileInteracting();if(!this.dirty_&&!updateWhileAnimating&&animating||!updateWhileInteracting&&interacting)return!0;var frameStateExtent=frameState.extent,viewState=frameState.viewState,projection=viewState.projection,resolution=viewState.resolution,pixelRatio=frameState.pixelRatio,vectorLayerRevision=vectorLayer.getRevision(),vectorLayerRenderBuffer=vectorLayer.getRenderBuffer(),vectorLayerRenderOrder=vectorLayer.getRenderOrder();void 0===vectorLayerRenderOrder&&(vectorLayerRenderOrder=defaultOrder);var extent=buffer(frameStateExtent,vectorLayerRenderBuffer*resolution),projectionExtent=viewState.projection.getExtent();if(vectorSource.getWrapX()&&viewState.projection.canWrapX()&&!containsExtent(projectionExtent,frameState.extent)){var worldWidth=getWidth(projectionExtent),gutter=Math.max(getWidth(extent)/2,worldWidth);extent[0]=projectionExtent[0]-gutter,extent[2]=projectionExtent[2]+gutter}if(!this.dirty_&&this.renderedResolution_==resolution&&this.renderedRevision_==vectorLayerRevision&&this.renderedRenderOrder_==vectorLayerRenderOrder&&containsExtent(this.renderedExtent_,extent))return!(this.replayGroupChanged=!1);this.replayGroup_=null,this.dirty_=!1;var replayGroup=new canvas_ReplayGroup(getTolerance(resolution,pixelRatio),extent,resolution,pixelRatio,vectorSource.getOverlaps(),this.declutterTree_,vectorLayer.getRenderBuffer());vectorSource.loadFeatures(extent,resolution,projection);var render=function(feature){var styles,styleFunction=feature.getStyleFunction()||vectorLayer.getStyleFunction();if(styleFunction&&(styles=styleFunction(feature,resolution)),styles){var dirty=this.renderFeature(feature,resolution,pixelRatio,styles,replayGroup);this.dirty_=this.dirty_||dirty}}.bind(this);if(vectorLayerRenderOrder){var features=[];vectorSource.forEachFeatureInExtent(extent,function(feature){features.push(feature)}),features.sort(vectorLayerRenderOrder);for(var i=0,ii=features.length;i<ii;++i)render(features[i])}else vectorSource.forEachFeatureInExtent(extent,render);return replayGroup.finish(),this.renderedResolution_=resolution,this.renderedRevision_=vectorLayerRevision,this.renderedRenderOrder_=vectorLayerRenderOrder,this.renderedExtent_=extent,this.replayGroup_=replayGroup,this.replayGroupChanged=!0},CanvasVectorLayerRenderer.prototype.renderFeature=function(feature,resolution,pixelRatio,styles,replayGroup){if(!styles)return!1;var loading=!1;if(Array.isArray(styles))for(var i=0,ii=styles.length;i<ii;++i)loading=renderFeature(replayGroup,feature,styles[i],getSquaredTolerance(resolution,pixelRatio),this.handleStyleImageChange_,this)||loading;else loading=renderFeature(replayGroup,feature,styles,getSquaredTolerance(resolution,pixelRatio),this.handleStyleImageChange_,this);return loading},CanvasVectorLayerRenderer}(canvas_Layer);VectorLayer_CanvasVectorLayerRenderer.handles=function(layer){return layer.getType()===LayerType_VECTOR},VectorLayer_CanvasVectorLayerRenderer.create=function(mapRenderer,layer){return new VectorLayer_CanvasVectorLayerRenderer(layer)};var canvas_VectorLayer=VectorLayer_CanvasVectorLayerRenderer,VectorTileRenderType_IMAGE="image",VectorTileRenderType_VECTOR="vector",IMAGE_REPLAYS={image:[ReplayType.POLYGON,ReplayType.CIRCLE,ReplayType.LINE_STRING,ReplayType.IMAGE,ReplayType.TEXT],hybrid:[ReplayType.POLYGON,ReplayType.LINE_STRING]},VECTOR_REPLAYS={image:[ReplayType.DEFAULT],hybrid:[ReplayType.IMAGE,ReplayType.TEXT,ReplayType.DEFAULT],vector:ORDER},VectorTileLayer_CanvasVectorTileLayerRenderer=function(CanvasTileLayerRenderer){function CanvasVectorTileLayerRenderer(layer){CanvasTileLayerRenderer.call(this,layer,!0),this.declutterTree_=layer.getDeclutter()?rbush_default()(9,void 0):null,this.dirty_=!1,this.renderedLayerRevision_,this.tmpTransform_=[1,0,0,1,0,0];var renderMode=layer.getRenderMode();this.zDirection=renderMode===VectorTileRenderType_VECTOR?1:0,renderMode!==VectorTileRenderType_VECTOR&&(this.context=createCanvasContext2D()),listen(labelCache,EventType.CLEAR,this.handleFontsChanged_,this)}return CanvasTileLayerRenderer&&(CanvasVectorTileLayerRenderer.__proto__=CanvasTileLayerRenderer),((CanvasVectorTileLayerRenderer.prototype=Object.create(CanvasTileLayerRenderer&&CanvasTileLayerRenderer.prototype)).constructor=CanvasVectorTileLayerRenderer).prototype.disposeInternal=function(){unlisten(labelCache,EventType.CLEAR,this.handleFontsChanged_,this),CanvasTileLayerRenderer.prototype.disposeInternal.call(this)},CanvasVectorTileLayerRenderer.prototype.getTile=function(z,x,y,pixelRatio,projection){var tile=CanvasTileLayerRenderer.prototype.getTile.call(this,z,x,y,pixelRatio,projection);return tile.getState()===TileState_LOADED&&(this.createReplayGroup_(tile,pixelRatio,projection),this.context&&this.renderTileImage_(tile,pixelRatio,projection)),tile},CanvasVectorTileLayerRenderer.prototype.getTileImage=function(tile){var tileLayer=this.getLayer();return tile.getImage(tileLayer)},CanvasVectorTileLayerRenderer.prototype.prepareFrame=function(frameState,layerState){var layerRevision=this.getLayer().getRevision();return this.renderedLayerRevision_!=layerRevision&&(this.renderedTiles.length=0),this.renderedLayerRevision_=layerRevision,CanvasTileLayerRenderer.prototype.prepareFrame.call(this,frameState,layerState)},CanvasVectorTileLayerRenderer.prototype.createReplayGroup_=function(tile,pixelRatio,projection){var this$1=this,layer=this.getLayer(),revision=layer.getRevision(),renderOrder=layer.getRenderOrder()||null,replayState=tile.getReplayState(layer);if(replayState.dirty||replayState.renderedRevision!=revision||replayState.renderedRenderOrder!=renderOrder){for(var source=layer.getSource(),sourceTileGrid=source.getTileGrid(),resolution=source.getTileGridForProjection(projection).getResolution(tile.tileCoord[0]),tileExtent=tile.extent,loop=function(t,tt){var sourceTile=tile.getTile(tile.tileKeys[t]);if(sourceTile.getState()==TileState_LOADED){var sourceTileCoord=sourceTile.tileCoord,sourceTileExtent=sourceTileGrid.getTileCoordExtent(sourceTileCoord),sharedExtent=getIntersection(tileExtent,sourceTileExtent),bufferedExtent=extent_equals(sourceTileExtent,sharedExtent)?null:buffer(sharedExtent,layer.getRenderBuffer()*resolution,this$1.tmpExtent),tileProjection=sourceTile.getProjection(),reproject=!1;equivalent(projection,tileProjection)||(reproject=!0,sourceTile.setProjection(projection)),replayState.dirty=!1;var replayGroup=new canvas_ReplayGroup(0,sharedExtent,resolution,pixelRatio,source.getOverlaps(),this$1.declutterTree_,layer.getRenderBuffer()),squaredTolerance=getSquaredTolerance(resolution,pixelRatio),render=function(feature){var styles,styleFunction=feature.getStyleFunction()||layer.getStyleFunction();if(styleFunction&&(styles=styleFunction(feature,resolution)),styles){var dirty=this.renderFeature(feature,squaredTolerance,styles,replayGroup);this.dirty_=this.dirty_||dirty,replayState.dirty=replayState.dirty||dirty}},features=sourceTile.getFeatures();renderOrder&&renderOrder!==replayState.renderedRenderOrder&&features.sort(renderOrder);for(var i=0,ii=features.length;i<ii;++i){var feature=features[i];reproject&&(tileProjection.getUnits()==proj_Units.TILE_PIXELS&&(tileProjection.setWorldExtent(sourceTileExtent),tileProjection.setExtent(sourceTile.getExtent())),feature.getGeometry().transform(tileProjection,projection)),bufferedExtent&&!extent_intersects(bufferedExtent,feature.getGeometry().getExtent())||render.call(this$1,feature)}replayGroup.finish(),sourceTile.setReplayGroup(layer,tile.tileCoord.toString(),replayGroup)}},t=0,tt=tile.tileKeys.length;t<tt;++t)loop(t);replayState.renderedRevision=revision,replayState.renderedRenderOrder=renderOrder}},CanvasVectorTileLayerRenderer.prototype.forEachFeatureAtCoordinate=function(coordinate,frameState,hitTolerance,callback,thisArg){var resolution=frameState.viewState.resolution,rotation=frameState.viewState.rotation;hitTolerance=null==hitTolerance?0:hitTolerance;var bufferedExtent,found,i,ii,layer=this.getLayer(),features={},renderedTiles=this.renderedTiles;for(i=0,ii=renderedTiles.length;i<ii;++i){var tile=renderedTiles[i];if(containsCoordinate(bufferedExtent=buffer(tile.extent,hitTolerance*resolution,bufferedExtent),coordinate))for(var t=0,tt=tile.tileKeys.length;t<tt;++t){var sourceTile=tile.getTile(tile.tileKeys[t]);if(sourceTile.getState()==TileState_LOADED){var replayGroup=sourceTile.getReplayGroup(layer,tile.tileCoord.toString());found=found||replayGroup.forEachFeatureAtCoordinate(coordinate,resolution,rotation,hitTolerance,{},function(feature){var key=getUid(feature);if(!(key in features))return features[key]=!0,callback.call(thisArg,feature,layer)},null)}}}return found},CanvasVectorTileLayerRenderer.prototype.getReplayTransform_=function(tile,frameState){var tileGrid=this.getLayer().getSource().getTileGrid(),tileCoord=tile.tileCoord,tileResolution=tileGrid.getResolution(tileCoord[0]),viewState=frameState.viewState,pixelRatio=frameState.pixelRatio,renderResolution=viewState.resolution/pixelRatio,tileExtent=tileGrid.getTileCoordExtent(tileCoord,this.tmpExtent),center=viewState.center,origin=getTopLeft(tileExtent),size=frameState.size,offsetX=Math.round(pixelRatio*size[0]/2),offsetY=Math.round(pixelRatio*size[1]/2);return transform_compose(this.tmpTransform_,offsetX,offsetY,tileResolution/renderResolution,tileResolution/renderResolution,viewState.rotation,(origin[0]-center[0])/tileResolution,(center[1]-origin[1])/tileResolution)},CanvasVectorTileLayerRenderer.prototype.handleFontsChanged_=function(event){var layer=this.getLayer();layer.getVisible()&&void 0!==this.renderedLayerRevision_&&layer.changed()},CanvasVectorTileLayerRenderer.prototype.handleStyleImageChange_=function(event){this.renderIfReadyAndVisible()},CanvasVectorTileLayerRenderer.prototype.postCompose=function(context,frameState,layerState){var layer=this.getLayer(),renderMode=layer.getRenderMode();if(renderMode!=VectorTileRenderType_IMAGE){var offsetX,offsetY,declutterReplays=layer.getDeclutter()?{}:null,source=layer.getSource(),replayTypes=VECTOR_REPLAYS[renderMode],pixelRatio=frameState.pixelRatio,rotation=frameState.viewState.rotation,size=frameState.size;rotation&&rotateAtOffset(context,-rotation,offsetX=Math.round(pixelRatio*size[0]/2),offsetY=Math.round(pixelRatio*size[1]/2)),declutterReplays&&this.declutterTree_.clear();for(var viewHints=frameState.viewHints,snapToPixel=!(viewHints[ViewHint_ANIMATING]||viewHints[ViewHint_INTERACTING]),tiles=this.renderedTiles,tileGrid=source.getTileGridForProjection(frameState.viewState.projection),clips=[],zs=[],i=tiles.length-1;0<=i;--i){var tile=tiles[i];if(tile.getState()!=TileState_ABORT)for(var tileCoord=tile.tileCoord,worldOffset=tileGrid.getTileCoordExtent(tileCoord,this.tmpExtent)[0]-tile.extent[0],transform=void 0,t=0,tt=tile.tileKeys.length;t<tt;++t){var sourceTile=tile.getTile(tile.tileKeys[t]);if(sourceTile.getState()==TileState_LOADED){var replayGroup=sourceTile.getReplayGroup(layer,tileCoord.toString());if(replayGroup&&replayGroup.hasReplays(replayTypes)){transform||(transform=this.getTransform(frameState,worldOffset));var currentZ=sourceTile.tileCoord[0],currentClip=replayGroup.getClipCoords(transform);context.save(),context.globalAlpha=layerState.opacity;for(var j=0,jj=clips.length;j<jj;++j){var clip=clips[j];currentZ<zs[j]&&(context.beginPath(),context.moveTo(currentClip[0],currentClip[1]),context.lineTo(currentClip[2],currentClip[3]),context.lineTo(currentClip[4],currentClip[5]),context.lineTo(currentClip[6],currentClip[7]),context.moveTo(clip[6],clip[7]),context.lineTo(clip[4],clip[5]),context.lineTo(clip[2],clip[3]),context.lineTo(clip[0],clip[1]),context.clip())}replayGroup.replay(context,transform,rotation,{},snapToPixel,replayTypes,declutterReplays),context.restore(),clips.push(currentClip),zs.push(currentZ)}}}}declutterReplays&&function(declutterReplays,context,rotation,snapToPixel){for(var zs=Object.keys(declutterReplays).map(Number).sort(numberSafeCompareFunction),skippedFeatureUids={},z=0,zz=zs.length;z<zz;++z)for(var replayData=declutterReplays[zs[z].toString()],i=0,ii=replayData.length;i<ii;){var replay=replayData[i++],transform=replayData[i++];replay.replay(context,transform,rotation,skippedFeatureUids,snapToPixel)}}(declutterReplays,context,rotation,snapToPixel),rotation&&rotateAtOffset(context,rotation,offsetX,offsetY)}CanvasTileLayerRenderer.prototype.postCompose.call(this,context,frameState,layerState)},CanvasVectorTileLayerRenderer.prototype.renderFeature=function(feature,squaredTolerance,styles,replayGroup){if(!styles)return!1;var loading=!1;if(Array.isArray(styles))for(var i=0,ii=styles.length;i<ii;++i)loading=renderFeature(replayGroup,feature,styles[i],squaredTolerance,this.handleStyleImageChange_,this)||loading;else loading=renderFeature(replayGroup,feature,styles,squaredTolerance,this.handleStyleImageChange_,this);return loading},CanvasVectorTileLayerRenderer.prototype.renderTileImage_=function(tile,pixelRatio,projection){var layer=this.getLayer(),replayState=tile.getReplayState(layer),revision=layer.getRevision(),replays=IMAGE_REPLAYS[layer.getRenderMode()];if(replays&&replayState.renderedTileRevision!==revision){replayState.renderedTileRevision=revision;var tileCoord=tile.wrappedTileCoord,z=tileCoord[0],source=layer.getSource(),tileGrid=source.getTileGridForProjection(projection),resolution=tileGrid.getResolution(z),context=tile.getContext(layer),size=source.getTilePixelSize(z,pixelRatio,projection);context.canvas.width=size[0],context.canvas.height=size[1];for(var tileExtent=tileGrid.getTileCoordExtent(tileCoord,this.tmpExtent),i=0,ii=tile.tileKeys.length;i<ii;++i){var sourceTile=tile.getTile(tile.tileKeys[i]);if(sourceTile.getState()==TileState_LOADED){var pixelScale=pixelRatio/resolution,transform=transform_reset(this.tmpTransform_);ol_transform_scale(transform,pixelScale,-pixelScale),ol_transform_translate(transform,-tileExtent[0],-tileExtent[3]),sourceTile.getReplayGroup(layer,tile.tileCoord.toString()).replay(context,transform,0,{},!0,replays)}}}},CanvasVectorTileLayerRenderer}(canvas_TileLayer);VectorTileLayer_CanvasVectorTileLayerRenderer.handles=function(layer){return layer.getType()===LayerType_VECTOR_TILE},VectorTileLayer_CanvasVectorTileLayerRenderer.create=function(mapRenderer,layer){return new VectorTileLayer_CanvasVectorTileLayerRenderer(layer)};var VectorTileLayer=VectorTileLayer_CanvasVectorTileLayerRenderer,ol_Map=function(PluggableMap){function Map(options){(options=obj_assign({},options)).controls||(options.controls=function(opt_options){var options=opt_options||{},controls=new ol_Collection;return(void 0===options.zoom||options.zoom)&&controls.push(new control_Zoom(options.zoomOptions)),(void 0===options.rotate||options.rotate)&&controls.push(new control_Rotate(options.rotateOptions)),(void 0===options.attribution||options.attribution)&&controls.push(new control_Attribution(options.attributionOptions)),controls}()),options.interactions||(options.interactions=function(opt_options){var options=opt_options||{},interactions=new ol_Collection,kinetic=new ol_Kinetic(-.005,.05,100);return(void 0===options.altShiftDragRotate||options.altShiftDragRotate)&&interactions.push(new interaction_DragRotate),(void 0===options.doubleClickZoom||options.doubleClickZoom)&&interactions.push(new interaction_DoubleClickZoom({delta:options.zoomDelta,duration:options.zoomDuration})),(void 0===options.dragPan||options.dragPan)&&interactions.push(new interaction_DragPan({condition:options.onFocusOnly?condition_focus:void 0,kinetic:kinetic})),(void 0===options.pinchRotate||options.pinchRotate)&&interactions.push(new interaction_PinchRotate),(void 0===options.pinchZoom||options.pinchZoom)&&interactions.push(new interaction_PinchZoom({constrainResolution:options.constrainResolution,duration:options.zoomDuration})),(void 0===options.keyboard||options.keyboard)&&(interactions.push(new interaction_KeyboardPan),interactions.push(new interaction_KeyboardZoom({delta:options.zoomDelta,duration:options.zoomDuration}))),(void 0===options.mouseWheelZoom||options.mouseWheelZoom)&&interactions.push(new interaction_MouseWheelZoom({condition:options.onFocusOnly?condition_focus:void 0,constrainResolution:options.constrainResolution,duration:options.zoomDuration})),(void 0===options.shiftDragZoom||options.shiftDragZoom)&&interactions.push(new interaction_DragZoom({duration:options.zoomDuration})),interactions}()),PluggableMap.call(this,options)}return PluggableMap&&(Map.__proto__=PluggableMap),((Map.prototype=Object.create(PluggableMap&&PluggableMap.prototype)).constructor=Map).prototype.createRenderer=function(){var renderer=new canvas_Map(this);return renderer.registerLayerRenderers([ImageLayer,canvas_TileLayer,canvas_VectorLayer,VectorTileLayer]),renderer},Map}(ol_PluggableMap),TileProperty_PRELOAD="preload",TileProperty_USE_INTERIM_TILES_ON_ERROR="useInterimTilesOnError",Tile_TileLayer=function(Layer){function TileLayer(opt_options){var options=opt_options||{},baseOptions=obj_assign({},options);delete baseOptions.preload,delete baseOptions.useInterimTilesOnError,Layer.call(this,baseOptions),this.setPreload(void 0!==options.preload?options.preload:0),this.setUseInterimTilesOnError(void 0===options.useInterimTilesOnError||options.useInterimTilesOnError),this.type=LayerType_TILE}return Layer&&(TileLayer.__proto__=Layer),((TileLayer.prototype=Object.create(Layer&&Layer.prototype)).constructor=TileLayer).prototype.getPreload=function(){return this.get(TileProperty_PRELOAD)},TileLayer.prototype.setPreload=function(preload){this.set(TileProperty_PRELOAD,preload)},TileLayer.prototype.getUseInterimTilesOnError=function(){return this.get(TileProperty_USE_INTERIM_TILES_ON_ERROR)},TileLayer.prototype.setUseInterimTilesOnError=function(useInterimTilesOnError){this.set(TileProperty_USE_INTERIM_TILES_ON_ERROR,useInterimTilesOnError)},TileLayer}(layer_Layer);Tile_TileLayer.prototype.getSource;var layer_Tile=Tile_TileLayer,Image_ImageStyle=function(options){this.opacity_=options.opacity,this.rotateWithView_=options.rotateWithView,this.rotation_=options.rotation,this.scale_=options.scale};Image_ImageStyle.prototype.clone=function(){return new Image_ImageStyle({opacity:this.getOpacity(),scale:this.getScale(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView()})},Image_ImageStyle.prototype.getOpacity=function(){return this.opacity_},Image_ImageStyle.prototype.getRotateWithView=function(){return this.rotateWithView_},Image_ImageStyle.prototype.getRotation=function(){return this.rotation_},Image_ImageStyle.prototype.getScale=function(){return this.scale_},Image_ImageStyle.prototype.getSnapToPixel=function(){return!1},Image_ImageStyle.prototype.getAnchor=function(){return util_abstract()},Image_ImageStyle.prototype.getImage=function(pixelRatio){return util_abstract()},Image_ImageStyle.prototype.getHitDetectionImage=function(pixelRatio){return util_abstract()},Image_ImageStyle.prototype.getImageState=function(){return util_abstract()},Image_ImageStyle.prototype.getImageSize=function(){return util_abstract()},Image_ImageStyle.prototype.getHitDetectionImageSize=function(){return util_abstract()},Image_ImageStyle.prototype.getOrigin=function(){return util_abstract()},Image_ImageStyle.prototype.getSize=function(){return util_abstract()},Image_ImageStyle.prototype.setOpacity=function(opacity){this.opacity_=opacity},Image_ImageStyle.prototype.setRotateWithView=function(rotateWithView){this.rotateWithView_=rotateWithView},Image_ImageStyle.prototype.setRotation=function(rotation){this.rotation_=rotation},Image_ImageStyle.prototype.setScale=function(scale){this.scale_=scale},Image_ImageStyle.prototype.setSnapToPixel=function(snapToPixel){},Image_ImageStyle.prototype.listenImageChange=function(listener,thisArg){return util_abstract()},Image_ImageStyle.prototype.load=function(){util_abstract()},Image_ImageStyle.prototype.unlistenImageChange=function(listener,thisArg){util_abstract()};var style_Circle=function(RegularShape){function CircleStyle(opt_options){var options=opt_options||{};RegularShape.call(this,{points:1/0,fill:options.fill,radius:options.radius,stroke:options.stroke,atlasManager:options.atlasManager})}return RegularShape&&(CircleStyle.__proto__=RegularShape),((CircleStyle.prototype=Object.create(RegularShape&&RegularShape.prototype)).constructor=CircleStyle).prototype.clone=function(){var style=new CircleStyle({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),atlasManager:this.atlasManager_});return style.setOpacity(this.getOpacity()),style.setScale(this.getScale()),style},CircleStyle.prototype.setRadius=function(radius){this.radius_=radius,this.render_(this.atlasManager_)},CircleStyle}(function(ImageStyle){function RegularShape(options){var rotateWithView=void 0!==options.rotateWithView&&options.rotateWithView;ImageStyle.call(this,{opacity:1,rotateWithView:rotateWithView,rotation:void 0!==options.rotation?options.rotation:0,scale:1}),this.checksums_=null,this.canvas_=null,this.hitDetectionCanvas_=null,this.fill_=void 0!==options.fill?options.fill:null,this.origin_=[0,0],this.points_=options.points,this.radius_=void 0!==options.radius?options.radius:options.radius1,this.radius2_=options.radius2,this.angle_=void 0!==options.angle?options.angle:0,this.stroke_=void 0!==options.stroke?options.stroke:null,this.anchor_=null,this.size_=null,this.imageSize_=null,this.hitDetectionImageSize_=null,this.atlasManager_=options.atlasManager,this.render_(this.atlasManager_)}return ImageStyle&&(RegularShape.__proto__=ImageStyle),((RegularShape.prototype=Object.create(ImageStyle&&ImageStyle.prototype)).constructor=RegularShape).prototype.clone=function(){var style=new RegularShape({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),atlasManager:this.atlasManager_});return style.setOpacity(this.getOpacity()),style.setScale(this.getScale()),style},RegularShape.prototype.getAnchor=function(){return this.anchor_},RegularShape.prototype.getAngle=function(){return this.angle_},RegularShape.prototype.getFill=function(){return this.fill_},RegularShape.prototype.getHitDetectionImage=function(pixelRatio){return this.hitDetectionCanvas_},RegularShape.prototype.getImage=function(pixelRatio){return this.canvas_},RegularShape.prototype.getImageSize=function(){return this.imageSize_},RegularShape.prototype.getHitDetectionImageSize=function(){return this.hitDetectionImageSize_},RegularShape.prototype.getImageState=function(){return ImageState.LOADED},RegularShape.prototype.getOrigin=function(){return this.origin_},RegularShape.prototype.getPoints=function(){return this.points_},RegularShape.prototype.getRadius=function(){return this.radius_},RegularShape.prototype.getRadius2=function(){return this.radius2_},RegularShape.prototype.getSize=function(){return this.size_},RegularShape.prototype.getStroke=function(){return this.stroke_},RegularShape.prototype.listenImageChange=function(listener,thisArg){},RegularShape.prototype.load=function(){},RegularShape.prototype.unlistenImageChange=function(listener,thisArg){},RegularShape.prototype.render_=function(atlasManager){var imageSize,strokeStyle,lineCap="",lineJoin="",miterLimit=0,lineDash=null,lineDashOffset=0,strokeWidth=0;this.stroke_&&(null===(strokeStyle=this.stroke_.getColor())&&(strokeStyle=defaultStrokeStyle),strokeStyle=asColorLike(strokeStyle),void 0===(strokeWidth=this.stroke_.getWidth())&&(strokeWidth=1),lineDash=this.stroke_.getLineDash(),lineDashOffset=this.stroke_.getLineDashOffset(),CANVAS_LINE_DASH||(lineDash=null,lineDashOffset=0),void 0===(lineJoin=this.stroke_.getLineJoin())&&(lineJoin="round"),void 0===(lineCap=this.stroke_.getLineCap())&&(lineCap="round"),void 0===(miterLimit=this.stroke_.getMiterLimit())&&(miterLimit=10));var size=2*(this.radius_+strokeWidth)+1,renderOptions={strokeStyle:strokeStyle,strokeWidth:strokeWidth,size:size,lineCap:lineCap,lineDash:lineDash,lineDashOffset:lineDashOffset,lineJoin:lineJoin,miterLimit:miterLimit};if(void 0===atlasManager){var context=createCanvasContext2D(size,size);this.canvas_=context.canvas,imageSize=size=this.canvas_.width,this.draw_(renderOptions,context,0,0),this.createHitDetectionCanvas_(renderOptions)}else{size=Math.round(size);var renderHitDetectionCallback,hasCustomHitDetectionImage=!this.fill_;hasCustomHitDetectionImage&&(renderHitDetectionCallback=this.drawHitDetectionCanvas_.bind(this,renderOptions));var id=this.getChecksum(),info=atlasManager.add(id,size,size,this.draw_.bind(this,renderOptions),renderHitDetectionCallback);this.canvas_=info.image,this.origin_=[info.offsetX,info.offsetY],imageSize=info.image.width,this.hitDetectionImageSize_=hasCustomHitDetectionImage?(this.hitDetectionCanvas_=info.hitImage,[info.hitImage.width,info.hitImage.height]):(this.hitDetectionCanvas_=this.canvas_,[imageSize,imageSize])}this.anchor_=[size/2,size/2],this.size_=[size,size],this.imageSize_=[imageSize,imageSize]},RegularShape.prototype.draw_=function(renderOptions,context,x,y){var i,angle0,radiusC;context.setTransform(1,0,0,1,0,0),context.translate(x,y),context.beginPath();var points=this.points_;if(points===1/0)context.arc(renderOptions.size/2,renderOptions.size/2,this.radius_,0,2*Math.PI,!0);else{var radius2=void 0!==this.radius2_?this.radius2_:this.radius_;for(radius2!==this.radius_&&(points*=2),i=0;i<=points;i++)angle0=2*i*Math.PI/points-Math.PI/2+this.angle_,radiusC=i%2==0?this.radius_:radius2,context.lineTo(renderOptions.size/2+radiusC*Math.cos(angle0),renderOptions.size/2+radiusC*Math.sin(angle0))}if(this.fill_){var color=this.fill_.getColor();null===color&&(color=defaultFillStyle),context.fillStyle=asColorLike(color),context.fill()}this.stroke_&&(context.strokeStyle=renderOptions.strokeStyle,context.lineWidth=renderOptions.strokeWidth,renderOptions.lineDash&&(context.setLineDash(renderOptions.lineDash),context.lineDashOffset=renderOptions.lineDashOffset),context.lineCap=renderOptions.lineCap,context.lineJoin=renderOptions.lineJoin,context.miterLimit=renderOptions.miterLimit,context.stroke()),context.closePath()},RegularShape.prototype.createHitDetectionCanvas_=function(renderOptions){if(this.hitDetectionImageSize_=[renderOptions.size,renderOptions.size],this.fill_)this.hitDetectionCanvas_=this.canvas_;else{var context=createCanvasContext2D(renderOptions.size,renderOptions.size);this.hitDetectionCanvas_=context.canvas,this.drawHitDetectionCanvas_(renderOptions,context,0,0)}},RegularShape.prototype.drawHitDetectionCanvas_=function(renderOptions,context,x,y){context.setTransform(1,0,0,1,0,0),context.translate(x,y),context.beginPath();var points=this.points_;if(points===1/0)context.arc(renderOptions.size/2,renderOptions.size/2,this.radius_,0,2*Math.PI,!0);else{var i,radiusC,angle0,radius2=void 0!==this.radius2_?this.radius2_:this.radius_;for(radius2!==this.radius_&&(points*=2),i=0;i<=points;i++)angle0=2*i*Math.PI/points-Math.PI/2+this.angle_,radiusC=i%2==0?this.radius_:radius2,context.lineTo(renderOptions.size/2+radiusC*Math.cos(angle0),renderOptions.size/2+radiusC*Math.sin(angle0))}context.fillStyle=asString(defaultFillStyle),context.fill(),this.stroke_&&(context.strokeStyle=renderOptions.strokeStyle,context.lineWidth=renderOptions.strokeWidth,renderOptions.lineDash&&(context.setLineDash(renderOptions.lineDash),context.lineDashOffset=renderOptions.lineDashOffset),context.stroke()),context.closePath()},RegularShape.prototype.getChecksum=function(){var strokeChecksum=this.stroke_?this.stroke_.getChecksum():"-",fillChecksum=this.fill_?this.fill_.getChecksum():"-";if(!this.checksums_||strokeChecksum!=this.checksums_[1]||fillChecksum!=this.checksums_[2]||this.radius_!=this.checksums_[3]||this.radius2_!=this.checksums_[4]||this.angle_!=this.checksums_[5]||this.points_!=this.checksums_[6]){var checksum="r"+strokeChecksum+fillChecksum+(void 0!==this.radius_?this.radius_.toString():"-")+(void 0!==this.radius2_?this.radius2_.toString():"-")+(void 0!==this.angle_?this.angle_.toString():"-")+(void 0!==this.points_?this.points_.toString():"-");this.checksums_=[checksum,strokeChecksum,fillChecksum,this.radius_,this.radius2_,this.angle_,this.points_]}return this.checksums_[0]},RegularShape}(Image_ImageStyle)),Fill=function(opt_options){var options=opt_options||{};this.color_=void 0!==options.color?options.color:null,this.checksum_=void 0};Fill.prototype.clone=function(){var color=this.getColor();return new Fill({color:Array.isArray(color)?color.slice():color||void 0})},Fill.prototype.getColor=function(){return this.color_},Fill.prototype.setColor=function(color){this.color_=color,this.checksum_=void 0},Fill.prototype.getChecksum=function(){if(void 0===this.checksum_){var color=this.color_;color?Array.isArray(color)||"string"==typeof color?this.checksum_="f"+asString(color):this.checksum_=getUid(this.color_):this.checksum_="f-"}return this.checksum_};var style_Fill=Fill,Stroke=function(opt_options){var options=opt_options||{};this.color_=void 0!==options.color?options.color:null,this.lineCap_=options.lineCap,this.lineDash_=void 0!==options.lineDash?options.lineDash:null,this.lineDashOffset_=options.lineDashOffset,this.lineJoin_=options.lineJoin,this.miterLimit_=options.miterLimit,this.width_=options.width,this.checksum_=void 0};Stroke.prototype.clone=function(){var color=this.getColor();return new Stroke({color:Array.isArray(color)?color.slice():color||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})},Stroke.prototype.getColor=function(){return this.color_},Stroke.prototype.getLineCap=function(){return this.lineCap_},Stroke.prototype.getLineDash=function(){return this.lineDash_},Stroke.prototype.getLineDashOffset=function(){return this.lineDashOffset_},Stroke.prototype.getLineJoin=function(){return this.lineJoin_},Stroke.prototype.getMiterLimit=function(){return this.miterLimit_},Stroke.prototype.getWidth=function(){return this.width_},Stroke.prototype.setColor=function(color){this.color_=color,this.checksum_=void 0},Stroke.prototype.setLineCap=function(lineCap){this.lineCap_=lineCap,this.checksum_=void 0},Stroke.prototype.setLineDash=function(lineDash){this.lineDash_=lineDash,this.checksum_=void 0},Stroke.prototype.setLineDashOffset=function(lineDashOffset){this.lineDashOffset_=lineDashOffset,this.checksum_=void 0},Stroke.prototype.setLineJoin=function(lineJoin){this.lineJoin_=lineJoin,this.checksum_=void 0},Stroke.prototype.setMiterLimit=function(miterLimit){this.miterLimit_=miterLimit,this.checksum_=void 0},Stroke.prototype.setWidth=function(width){this.width_=width,this.checksum_=void 0},Stroke.prototype.getChecksum=function(){return void 0===this.checksum_&&(this.checksum_="s",this.color_?"string"==typeof this.color_?this.checksum_+=this.color_:this.checksum_+=getUid(this.color_):this.checksum_+="-",this.checksum_+=","+(void 0!==this.lineCap_?this.lineCap_.toString():"-")+","+(this.lineDash_?this.lineDash_.toString():"-")+","+(void 0!==this.lineDashOffset_?this.lineDashOffset_:"-")+","+(void 0!==this.lineJoin_?this.lineJoin_:"-")+","+(void 0!==this.miterLimit_?this.miterLimit_.toString():"-")+","+(void 0!==this.width_?this.width_.toString():"-")),this.checksum_};var style_Stroke=Stroke,Style=function(opt_options){var options=opt_options||{};this.geometry_=null,this.geometryFunction_=defaultGeometryFunction,void 0!==options.geometry&&this.setGeometry(options.geometry),this.fill_=void 0!==options.fill?options.fill:null,this.image_=void 0!==options.image?options.image:null,this.renderer_=void 0!==options.renderer?options.renderer:null,this.stroke_=void 0!==options.stroke?options.stroke:null,this.text_=void 0!==options.text?options.text:null,this.zIndex_=options.zIndex};Style.prototype.clone=function(){var geometry=this.getGeometry();return geometry&&"object"==typeof geometry&&(geometry=geometry.clone()),new Style({geometry:geometry,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})},Style.prototype.getRenderer=function(){return this.renderer_},Style.prototype.setRenderer=function(renderer){this.renderer_=renderer},Style.prototype.getGeometry=function(){return this.geometry_},Style.prototype.getGeometryFunction=function(){return this.geometryFunction_},Style.prototype.getFill=function(){return this.fill_},Style.prototype.setFill=function(fill){this.fill_=fill},Style.prototype.getImage=function(){return this.image_},Style.prototype.setImage=function(image){this.image_=image},Style.prototype.getStroke=function(){return this.stroke_},Style.prototype.setStroke=function(stroke){this.stroke_=stroke},Style.prototype.getText=function(){return this.text_},Style.prototype.setText=function(text){this.text_=text},Style.prototype.getZIndex=function(){return this.zIndex_},Style.prototype.setGeometry=function(geometry){"function"==typeof geometry?this.geometryFunction_=geometry:"string"==typeof geometry?this.geometryFunction_=function(feature){return feature.get(geometry)}:geometry?void 0!==geometry&&(this.geometryFunction_=function(){return geometry}):this.geometryFunction_=defaultGeometryFunction,this.geometry_=geometry},Style.prototype.setZIndex=function(zIndex){this.zIndex_=zIndex};var defaultStyles=null;function createDefaultStyle(feature,resolution){if(!defaultStyles){var fill=new style_Fill({color:"rgba(255,255,255,0.4)"}),stroke=new style_Stroke({color:"#3399CC",width:1.25});defaultStyles=[new Style({image:new style_Circle({fill:fill,stroke:stroke,radius:5}),fill:fill,stroke:stroke})]}return defaultStyles}function defaultGeometryFunction(feature){return feature.getGeometry()}var style_Style=Style,Vector_Property_RENDER_ORDER="renderOrder",Vector_VectorLayer=function(Layer){function VectorLayer(opt_options){var options=opt_options||{},baseOptions=obj_assign({},options);delete baseOptions.style,delete baseOptions.renderBuffer,delete baseOptions.updateWhileAnimating,delete baseOptions.updateWhileInteracting,Layer.call(this,baseOptions),this.declutter_=void 0!==options.declutter&&options.declutter,this.renderBuffer_=void 0!==options.renderBuffer?options.renderBuffer:100,this.style_=null,this.styleFunction_=void 0,this.setStyle(options.style),this.updateWhileAnimating_=void 0!==options.updateWhileAnimating&&options.updateWhileAnimating,this.updateWhileInteracting_=void 0!==options.updateWhileInteracting&&options.updateWhileInteracting,this.renderMode_=options.renderMode||VectorRenderType_VECTOR,this.type=LayerType_VECTOR}return Layer&&(VectorLayer.__proto__=Layer),((VectorLayer.prototype=Object.create(Layer&&Layer.prototype)).constructor=VectorLayer).prototype.getDeclutter=function(){return this.declutter_},VectorLayer.prototype.setDeclutter=function(declutter){this.declutter_=declutter},VectorLayer.prototype.getRenderBuffer=function(){return this.renderBuffer_},VectorLayer.prototype.getRenderOrder=function(){return this.get(Vector_Property_RENDER_ORDER)},VectorLayer.prototype.getStyle=function(){return this.style_},VectorLayer.prototype.getStyleFunction=function(){return this.styleFunction_},VectorLayer.prototype.getUpdateWhileAnimating=function(){return this.updateWhileAnimating_},VectorLayer.prototype.getUpdateWhileInteracting=function(){return this.updateWhileInteracting_},VectorLayer.prototype.setRenderOrder=function(renderOrder){this.set(Vector_Property_RENDER_ORDER,renderOrder)},VectorLayer.prototype.setStyle=function(style){this.style_=void 0!==style?style:createDefaultStyle,this.styleFunction_=null===style?void 0:function(obj){var styleFunction;if("function"==typeof obj)styleFunction=obj;else{var styles;styles=Array.isArray(obj)?obj:(assert("function"==typeof obj.getZIndex,41),[obj]),styleFunction=function(){return styles}}return styleFunction}(this.style_),this.changed()},VectorLayer.prototype.getRenderMode=function(){return this.renderMode_},VectorLayer}(layer_Layer);Vector_VectorLayer.prototype.getSource;var Vector=Vector_VectorLayer,FormatType={ARRAY_BUFFER:"arraybuffer",JSON:"json",TEXT:"text",XML:"xml"};function featureloader_xhr(url,format){return function(url,format,success,failure){return function(extent,resolution,projection){var xhr=new XMLHttpRequest;xhr.open("GET","function"==typeof url?url(extent,resolution,projection):url,!0),format.getType()==FormatType.ARRAY_BUFFER&&(xhr.responseType="arraybuffer"),xhr.onload=function(event){if(!xhr.status||200<=xhr.status&&xhr.status<300){var source,type=format.getType();type==FormatType.JSON||type==FormatType.TEXT?source=xhr.responseText:type==FormatType.XML?(source=xhr.responseXML)||(source=(new DOMParser).parseFromString(xhr.responseText,"application/xml")):type==FormatType.ARRAY_BUFFER&&(source=xhr.response),source?success.call(this,format.readFeatures(source,{featureProjection:projection}),format.readProjection(source),format.getLastExtent()):failure.call(this)}else failure.call(this)}.bind(this),xhr.onerror=function(){failure.call(this)}.bind(this),xhr.send()}}(url,format,function(features,dataProjection){"function"==typeof this.addFeatures&&this.addFeatures(features)},VOID)}function loadingstrategy_all(extent,resolution){return[[-1/0,-1/0,1/0,1/0]]}function adaptAttributions(attributionLike){return attributionLike?Array.isArray(attributionLike)?function(frameState){return attributionLike}:"function"==typeof attributionLike?attributionLike:function(frameState){return[attributionLike]}:null}var source_Source=function(BaseObject){function Source(options){BaseObject.call(this),this.projection_=proj_get(options.projection),this.attributions_=adaptAttributions(options.attributions),this.attributionsCollapsible_=void 0===options.attributionsCollapsible||options.attributionsCollapsible,this.loading=!1,this.state_=void 0!==options.state?options.state:State_READY,this.wrapX_=void 0!==options.wrapX&&options.wrapX}return BaseObject&&(Source.__proto__=BaseObject),((Source.prototype=Object.create(BaseObject&&BaseObject.prototype)).constructor=Source).prototype.getAttributions=function(){return this.attributions_},Source.prototype.getAttributionsCollapsible=function(){return this.attributionsCollapsible_},Source.prototype.getProjection=function(){return this.projection_},Source.prototype.getResolutions=function(){return util_abstract()},Source.prototype.getState=function(){return this.state_},Source.prototype.getWrapX=function(){return this.wrapX_},Source.prototype.refresh=function(){this.changed()},Source.prototype.setAttributions=function(attributions){this.attributions_=adaptAttributions(attributions),this.changed()},Source.prototype.setState=function(state){this.state_=state,this.changed()},Source}(ol_Object),VectorEventType_ADDFEATURE="addfeature",VectorEventType_CHANGEFEATURE="changefeature",VectorEventType_CLEAR="clear",VectorEventType_REMOVEFEATURE="removefeature",RBush_RBush=function(opt_maxEntries){this.rbush_=rbush_default()(opt_maxEntries,void 0),this.items_={}};RBush_RBush.prototype.insert=function(extent,value){var item={minX:extent[0],minY:extent[1],maxX:extent[2],maxY:extent[3],value:value};this.rbush_.insert(item),this.items_[getUid(value)]=item},RBush_RBush.prototype.load=function(extents,values){for(var items=new Array(values.length),i=0,l=values.length;i<l;i++){var extent=extents[i],value=values[i],item={minX:extent[0],minY:extent[1],maxX:extent[2],maxY:extent[3],value:value};items[i]=item,this.items_[getUid(value)]=item}this.rbush_.load(items)},RBush_RBush.prototype.remove=function(value){var uid=getUid(value),item=this.items_[uid];return delete this.items_[uid],null!==this.rbush_.remove(item)},RBush_RBush.prototype.update=function(extent,value){var item=this.items_[getUid(value)];extent_equals([item.minX,item.minY,item.maxX,item.maxY],extent)||(this.remove(value),this.insert(extent,value))},RBush_RBush.prototype.getAll=function(){return this.rbush_.all().map(function(item){return item.value})},RBush_RBush.prototype.getInExtent=function(extent){var bbox={minX:extent[0],minY:extent[1],maxX:extent[2],maxY:extent[3]};return this.rbush_.search(bbox).map(function(item){return item.value})},RBush_RBush.prototype.forEach=function(callback,opt_this){return this.forEach_(this.getAll(),callback,opt_this)},RBush_RBush.prototype.forEachInExtent=function(extent,callback,opt_this){return this.forEach_(this.getInExtent(extent),callback,opt_this)},RBush_RBush.prototype.forEach_=function(values,callback,opt_this){for(var result,i=0,l=values.length;i<l;i++)if(result=callback.call(opt_this,values[i]))return result;return result},RBush_RBush.prototype.isEmpty=function(){return obj_isEmpty(this.items_)},RBush_RBush.prototype.clear=function(){this.rbush_.clear(),this.items_={}},RBush_RBush.prototype.getExtent=function(opt_extent){var data=this.rbush_.toJSON();return createOrUpdate(data.minX,data.minY,data.maxX,data.maxY,opt_extent)},RBush_RBush.prototype.concat=function(rbush){for(var i in this.rbush_.load(rbush.rbush_.all()),rbush.items_)this.items_[i]=rbush.items_[i]};var structs_RBush=RBush_RBush,VectorSourceEvent=function(Event){function VectorSourceEvent(type,opt_feature){Event.call(this,type),this.feature=opt_feature}return Event&&(VectorSourceEvent.__proto__=Event),(VectorSourceEvent.prototype=Object.create(Event&&Event.prototype)).constructor=VectorSourceEvent}(events_Event),source_Vector=function(Source){function VectorSource(opt_options){var options=opt_options||{};Source.call(this,{attributions:options.attributions,projection:void 0,state:State_READY,wrapX:void 0===options.wrapX||options.wrapX}),this.loader_=VOID,this.format_=options.format,this.overlaps_=null==options.overlaps||options.overlaps,this.url_=options.url,void 0!==options.loader?this.loader_=options.loader:void 0!==this.url_&&(assert(this.format_,7),this.loader_=featureloader_xhr(this.url_,this.format_)),this.strategy_=void 0!==options.strategy?options.strategy:loadingstrategy_all;var collection,features,useSpatialIndex=void 0===options.useSpatialIndex||options.useSpatialIndex;this.featuresRtree_=useSpatialIndex?new structs_RBush:null,this.loadedExtentsRtree_=new structs_RBush,this.nullGeometryFeatures_={},this.idIndex_={},this.undefIdIndex_={},this.featureChangeKeys_={},this.featuresCollection_=null,Array.isArray(options.features)?features=options.features:options.features&&(features=(collection=options.features).getArray()),useSpatialIndex||void 0!==collection||(collection=new ol_Collection(features)),void 0!==features&&this.addFeaturesInternal(features),void 0!==collection&&this.bindFeaturesCollection_(collection)}return Source&&(VectorSource.__proto__=Source),((VectorSource.prototype=Object.create(Source&&Source.prototype)).constructor=VectorSource).prototype.addFeature=function(feature){this.addFeatureInternal(feature),this.changed()},VectorSource.prototype.addFeatureInternal=function(feature){var featureKey=getUid(feature);if(this.addToIndex_(featureKey,feature)){this.setupChangeEvents_(featureKey,feature);var geometry=feature.getGeometry();if(geometry){var extent=geometry.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(extent,feature)}else this.nullGeometryFeatures_[featureKey]=feature;this.dispatchEvent(new VectorSourceEvent(VectorEventType_ADDFEATURE,feature))}},VectorSource.prototype.setupChangeEvents_=function(featureKey,feature){this.featureChangeKeys_[featureKey]=[listen(feature,EventType.CHANGE,this.handleFeatureChange_,this),listen(feature,ObjectEventType_PROPERTYCHANGE,this.handleFeatureChange_,this)]},VectorSource.prototype.addToIndex_=function(featureKey,feature){var valid=!0,id=feature.getId();return void 0!==id?id.toString()in this.idIndex_?valid=!1:this.idIndex_[id.toString()]=feature:(assert(!(featureKey in this.undefIdIndex_),30),this.undefIdIndex_[featureKey]=feature),valid},VectorSource.prototype.addFeatures=function(features){this.addFeaturesInternal(features),this.changed()},VectorSource.prototype.addFeaturesInternal=function(features){for(var extents=[],newFeatures=[],geometryFeatures=[],i=0,length=features.length;i<length;i++){var feature=features[i],featureKey=getUid(feature);this.addToIndex_(featureKey,feature)&&newFeatures.push(feature)}for(var i$1=0,length$1=newFeatures.length;i$1<length$1;i$1++){var feature$1=newFeatures[i$1],featureKey$1=getUid(feature$1);this.setupChangeEvents_(featureKey$1,feature$1);var geometry=feature$1.getGeometry();if(geometry){var extent=geometry.getExtent();extents.push(extent),geometryFeatures.push(feature$1)}else this.nullGeometryFeatures_[featureKey$1]=feature$1}this.featuresRtree_&&this.featuresRtree_.load(extents,geometryFeatures);for(var i$2=0,length$2=newFeatures.length;i$2<length$2;i$2++)this.dispatchEvent(new VectorSourceEvent(VectorEventType_ADDFEATURE,newFeatures[i$2]))},VectorSource.prototype.bindFeaturesCollection_=function(collection){var modifyingCollection=!1;listen(this,VectorEventType_ADDFEATURE,function(evt){modifyingCollection||(modifyingCollection=!0,collection.push(evt.feature),modifyingCollection=!1)}),listen(this,VectorEventType_REMOVEFEATURE,function(evt){modifyingCollection||(modifyingCollection=!0,collection.remove(evt.feature),modifyingCollection=!1)}),listen(collection,CollectionEventType_ADD,function(evt){modifyingCollection||(modifyingCollection=!0,this.addFeature(evt.element),modifyingCollection=!1)},this),listen(collection,CollectionEventType_REMOVE,function(evt){modifyingCollection||(modifyingCollection=!0,this.removeFeature(evt.element),modifyingCollection=!1)},this),this.featuresCollection_=collection},VectorSource.prototype.clear=function(opt_fast){if(opt_fast){for(var featureId in this.featureChangeKeys_){this.featureChangeKeys_[featureId].forEach(unlistenByKey)}this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.undefIdIndex_={})}else if(this.featuresRtree_)for(var id in this.featuresRtree_.forEach(this.removeFeatureInternal,this),this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[id]);this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.loadedExtentsRtree_.clear(),this.nullGeometryFeatures_={};var clearEvent=new VectorSourceEvent(VectorEventType_CLEAR);this.dispatchEvent(clearEvent),this.changed()},VectorSource.prototype.forEachFeature=function(callback){if(this.featuresRtree_)return this.featuresRtree_.forEach(callback);this.featuresCollection_&&this.featuresCollection_.forEach(callback)},VectorSource.prototype.forEachFeatureAtCoordinateDirect=function(coordinate,callback){var extent=[coordinate[0],coordinate[1],coordinate[0],coordinate[1]];return this.forEachFeatureInExtent(extent,function(feature){return feature.getGeometry().intersectsCoordinate(coordinate)?callback(feature):void 0})},VectorSource.prototype.forEachFeatureInExtent=function(extent,callback){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(extent,callback);this.featuresCollection_&&this.featuresCollection_.forEach(callback)},VectorSource.prototype.forEachFeatureIntersectingExtent=function(extent,callback){return this.forEachFeatureInExtent(extent,function(feature){if(feature.getGeometry().intersectsExtent(extent)){var result=callback(feature);if(result)return result}})},VectorSource.prototype.getFeaturesCollection=function(){return this.featuresCollection_},VectorSource.prototype.getFeatures=function(){var features;return this.featuresCollection_?features=this.featuresCollection_.getArray():this.featuresRtree_&&(features=this.featuresRtree_.getAll(),obj_isEmpty(this.nullGeometryFeatures_)||extend(features,getValues(this.nullGeometryFeatures_))),features},VectorSource.prototype.getFeaturesAtCoordinate=function(coordinate){var features=[];return this.forEachFeatureAtCoordinateDirect(coordinate,function(feature){features.push(feature)}),features},VectorSource.prototype.getFeaturesInExtent=function(extent){return this.featuresRtree_.getInExtent(extent)},VectorSource.prototype.getClosestFeatureToCoordinate=function(coordinate,opt_filter){var x=coordinate[0],y=coordinate[1],closestFeature=null,closestPoint=[NaN,NaN],minSquaredDistance=1/0,extent=[-1/0,-1/0,1/0,1/0],filter=opt_filter||TRUE;return this.featuresRtree_.forEachInExtent(extent,function(feature){if(filter(feature)){var geometry=feature.getGeometry(),previousMinSquaredDistance=minSquaredDistance;if((minSquaredDistance=geometry.closestPointXY(x,y,closestPoint,minSquaredDistance))<previousMinSquaredDistance){closestFeature=feature;var minDistance=Math.sqrt(minSquaredDistance);extent[0]=x-minDistance,extent[1]=y-minDistance,extent[2]=x+minDistance,extent[3]=y+minDistance}}}),closestFeature},VectorSource.prototype.getExtent=function(opt_extent){return this.featuresRtree_.getExtent(opt_extent)},VectorSource.prototype.getFeatureById=function(id){var feature=this.idIndex_[id.toString()];return void 0!==feature?feature:null},VectorSource.prototype.getFormat=function(){return this.format_},VectorSource.prototype.getOverlaps=function(){return this.overlaps_},VectorSource.prototype.getUrl=function(){return this.url_},VectorSource.prototype.handleFeatureChange_=function(event){var feature=event.target,featureKey=getUid(feature),geometry=feature.getGeometry();if(geometry){var extent=geometry.getExtent();featureKey in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[featureKey],this.featuresRtree_&&this.featuresRtree_.insert(extent,feature)):this.featuresRtree_&&this.featuresRtree_.update(extent,feature)}else featureKey in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(feature),this.nullGeometryFeatures_[featureKey]=feature);var id=feature.getId();if(void 0!==id){var sid=id.toString();featureKey in this.undefIdIndex_?(delete this.undefIdIndex_[featureKey],this.idIndex_[sid]=feature):this.idIndex_[sid]!==feature&&(this.removeFromIdIndex_(feature),this.idIndex_[sid]=feature)}else featureKey in this.undefIdIndex_||(this.removeFromIdIndex_(feature),this.undefIdIndex_[featureKey]=feature);this.changed(),this.dispatchEvent(new VectorSourceEvent(VectorEventType_CHANGEFEATURE,feature))},VectorSource.prototype.hasFeature=function(feature){var id=feature.getId();return void 0!==id?id in this.idIndex_:getUid(feature)in this.undefIdIndex_},VectorSource.prototype.isEmpty=function(){return this.featuresRtree_.isEmpty()&&obj_isEmpty(this.nullGeometryFeatures_)},VectorSource.prototype.loadFeatures=function(extent,resolution,projection){var this$1=this,loadedExtentsRtree=this.loadedExtentsRtree_,extentsToLoad=this.strategy_(extent,resolution);this.loading=!1;for(var loop=function(i,ii){var extentToLoad=extentsToLoad[i];loadedExtentsRtree.forEachInExtent(extentToLoad,function(object){return containsExtent(object.extent,extentToLoad)})||(this$1.loader_.call(this$1,extentToLoad,resolution,projection),loadedExtentsRtree.insert(extentToLoad,{extent:extentToLoad.slice()}),this$1.loading=this$1.loader_!==VOID)},i=0,ii=extentsToLoad.length;i<ii;++i)loop(i)},VectorSource.prototype.removeLoadedExtent=function(extent){var obj,loadedExtentsRtree=this.loadedExtentsRtree_;loadedExtentsRtree.forEachInExtent(extent,function(object){if(extent_equals(object.extent,extent))return obj=object,!0}),obj&&loadedExtentsRtree.remove(obj)},VectorSource.prototype.removeFeature=function(feature){var featureKey=getUid(feature);featureKey in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[featureKey]:this.featuresRtree_&&this.featuresRtree_.remove(feature),this.removeFeatureInternal(feature),this.changed()},VectorSource.prototype.removeFeatureInternal=function(feature){var featureKey=getUid(feature);this.featureChangeKeys_[featureKey].forEach(unlistenByKey),delete this.featureChangeKeys_[featureKey];var id=feature.getId();void 0!==id?delete this.idIndex_[id.toString()]:delete this.undefIdIndex_[featureKey],this.dispatchEvent(new VectorSourceEvent(VectorEventType_REMOVEFEATURE,feature))},VectorSource.prototype.removeFromIdIndex_=function(feature){var removed=!1;for(var id in this.idIndex_)if(this.idIndex_[id]===feature){delete this.idIndex_[id],removed=!0;break}return removed},VectorSource.prototype.setLoader=function(loader){this.loader_=loader},VectorSource}(source_Source),ol_Tile=function(EventTarget){function Tile(tileCoord,state,opt_options){EventTarget.call(this);var options=opt_options||{};this.tileCoord=tileCoord,this.state=state,this.interimTile=null,this.key="",this.transition_=void 0===options.transition?250:options.transition,this.transitionStarts_={}}return EventTarget&&(Tile.__proto__=EventTarget),((Tile.prototype=Object.create(EventTarget&&EventTarget.prototype)).constructor=Tile).prototype.changed=function(){this.dispatchEvent(EventType.CHANGE)},Tile.prototype.getKey=function(){return this.key+"/"+this.tileCoord},Tile.prototype.getInterimTile=function(){if(!this.interimTile)return this;var tile=this.interimTile;do{if(tile.getState()==TileState_LOADED)return tile;tile=tile.interimTile}while(tile);return this},Tile.prototype.refreshInterimChain=function(){if(this.interimTile){var tile=this.interimTile,prev=this;do{if(tile.getState()==TileState_LOADED){tile.interimTile=null;break}tile.getState()==TileState_LOADING?prev=tile:tile.getState()==TileState_IDLE?prev.interimTile=tile.interimTile:prev=tile,tile=prev.interimTile}while(tile)}},Tile.prototype.getTileCoord=function(){return this.tileCoord},Tile.prototype.getState=function(){return this.state},Tile.prototype.setState=function(state){this.state=state,this.changed()},Tile.prototype.load=function(){},Tile.prototype.getAlpha=function(id,time){if(!this.transition_)return 1;var start=this.transitionStarts_[id];if(start){if(-1===start)return 1}else start=time,this.transitionStarts_[id]=start;var delta=time-start+1e3/60;return delta>=this.transition_?1:easeIn(delta/this.transition_)},Tile.prototype.inTransition=function(id){return!!this.transition_&&-1!==this.transitionStarts_[id]},Tile.prototype.endTransition=function(id){this.transition_&&(this.transitionStarts_[id]=-1)},Tile}(events_Target);function getBlankImage(){var ctx=createCanvasContext2D(1,1);return ctx.fillStyle="rgba(0,0,0,0)",ctx.fillRect(0,0,1,1),ctx.canvas}var ol_ImageTile=function(Tile){function ImageTile(tileCoord,state,src,crossOrigin,tileLoadFunction,opt_options){Tile.call(this,tileCoord,state,opt_options),this.crossOrigin_=crossOrigin,this.src_=src,this.image_=new Image,null!==crossOrigin&&(this.image_.crossOrigin=crossOrigin),this.imageListenerKeys_=null,this.tileLoadFunction_=tileLoadFunction}return Tile&&(ImageTile.__proto__=Tile),((ImageTile.prototype=Object.create(Tile&&Tile.prototype)).constructor=ImageTile).prototype.disposeInternal=function(){this.state==TileState_LOADING&&(this.unlistenImage_(),this.image_=getBlankImage()),this.interimTile&&this.interimTile.dispose(),this.state=TileState_ABORT,this.changed(),Tile.prototype.disposeInternal.call(this)},ImageTile.prototype.getImage=function(){return this.image_},ImageTile.prototype.getKey=function(){return this.src_},ImageTile.prototype.handleImageError_=function(){this.state=TileState_ERROR,this.unlistenImage_(),this.image_=getBlankImage(),this.changed()},ImageTile.prototype.handleImageLoad_=function(){var image=this.image_;image.naturalWidth&&image.naturalHeight?this.state=TileState_LOADED:this.state=TileState_EMPTY,this.unlistenImage_(),this.changed()},ImageTile.prototype.load=function(){this.state==TileState_ERROR&&(this.state=TileState_IDLE,this.image_=new Image,null!==this.crossOrigin_&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==TileState_IDLE&&(this.state=TileState_LOADING,this.changed(),this.imageListenerKeys_=[listenOnce(this.image_,EventType.ERROR,this.handleImageError_,this),listenOnce(this.image_,EventType.LOAD,this.handleImageLoad_,this)],this.tileLoadFunction_(this,this.src_))},ImageTile.prototype.unlistenImage_=function(){this.imageListenerKeys_.forEach(unlistenByKey),this.imageListenerKeys_=null},ImageTile}(ol_Tile);function tilecoord_createOrUpdate(z,x,y,opt_tileCoord){return void 0!==opt_tileCoord?(opt_tileCoord[0]=z,opt_tileCoord[1]=x,opt_tileCoord[2]=y,opt_tileCoord):[z,x,y]}function getKeyZXY(z,x,y){return z+"/"+x+"/"+y}function tilecoord_getKey(tileCoord){return getKeyZXY(tileCoord[0],tileCoord[1],tileCoord[2])}var ol_TileCache=function(LRUCache){function TileCache(opt_highWaterMark){LRUCache.call(this,opt_highWaterMark)}return LRUCache&&(TileCache.__proto__=LRUCache),((TileCache.prototype=Object.create(LRUCache&&LRUCache.prototype)).constructor=TileCache).prototype.expireCache=function(usedTiles){for(;this.canExpireCache();){var tile=this.peekLast(),zKey=tile.tileCoord[0].toString();if(zKey in usedTiles&&usedTiles[zKey].contains(tile.tileCoord))break;this.pop().dispose()}},TileCache.prototype.pruneExceptNewestZ=function(){if(0!==this.getCount()){var z=function(key){return key.split("/").map(Number)}(this.peekFirstKey())[0];this.forEach(function(tile){tile.tileCoord[0]!==z&&(this.remove(tilecoord_getKey(tile.tileCoord)),tile.dispose())},this)}},TileCache}(structs_LRUCache);function enlargeClipPoint(centroidX,centroidY,x,y){var dX=x-centroidX,dY=y-centroidY,distance=Math.sqrt(dX*dX+dY*dY);return[Math.round(x+dX/distance),Math.round(y+dY/distance)]}function reproj_render(width,height,pixelRatio,sourceResolution,sourceExtent,targetResolution,targetExtent,triangulation,sources,gutter,opt_renderEdges){var context=createCanvasContext2D(Math.round(pixelRatio*width),Math.round(pixelRatio*height));if(0===sources.length)return context.canvas;context.scale(pixelRatio,pixelRatio);var sourceDataExtent=[1/0,1/0,-1/0,-1/0];sources.forEach(function(src,i,arr){extent_extend(sourceDataExtent,src.extent)});var canvasWidthInUnits=getWidth(sourceDataExtent),canvasHeightInUnits=getHeight(sourceDataExtent),stitchContext=createCanvasContext2D(Math.round(pixelRatio*canvasWidthInUnits/sourceResolution),Math.round(pixelRatio*canvasHeightInUnits/sourceResolution)),stitchScale=pixelRatio/sourceResolution;sources.forEach(function(src,i,arr){var xPos=src.extent[0]-sourceDataExtent[0],yPos=-(src.extent[3]-sourceDataExtent[3]),srcWidth=getWidth(src.extent),srcHeight=getHeight(src.extent);stitchContext.drawImage(src.image,gutter,gutter,src.image.width-2*gutter,src.image.height-2*gutter,xPos*stitchScale,yPos*stitchScale,srcWidth*stitchScale,srcHeight*stitchScale)});var targetTopLeft=getTopLeft(targetExtent);return triangulation.getTriangles().forEach(function(triangle,i,arr){var source=triangle.source,target=triangle.target,x0=source[0][0],y0=source[0][1],x1=source[1][0],y1=source[1][1],x2=source[2][0],y2=source[2][1],u0=(target[0][0]-targetTopLeft[0])/targetResolution,v0=-(target[0][1]-targetTopLeft[1])/targetResolution,u1=(target[1][0]-targetTopLeft[0])/targetResolution,v1=-(target[1][1]-targetTopLeft[1])/targetResolution,u2=(target[2][0]-targetTopLeft[0])/targetResolution,v2=-(target[2][1]-targetTopLeft[1])/targetResolution,sourceNumericalShiftX=x0,sourceNumericalShiftY=y0,affineCoefs=function(mat){for(var n=mat.length,i=0;i<n;i++){for(var maxRow=i,maxEl=Math.abs(mat[i][i]),r=i+1;r<n;r++){var absValue=Math.abs(mat[r][i]);maxEl<absValue&&(maxEl=absValue,maxRow=r)}if(0===maxEl)return null;var tmp=mat[maxRow];mat[maxRow]=mat[i],mat[i]=tmp;for(var j=i+1;j<n;j++)for(var coef=-mat[j][i]/mat[i][i],k=i;k<n+1;k++)i==k?mat[j][k]=0:mat[j][k]+=coef*mat[i][k]}for(var x=new Array(n),l=n-1;0<=l;l--){x[l]=mat[l][n]/mat[l][l];for(var m=l-1;0<=m;m--)mat[m][n]-=mat[m][l]*x[l]}return x}([[x1-=sourceNumericalShiftX,y1-=sourceNumericalShiftY,y0=x0=0,0,u1-u0],[x2-=sourceNumericalShiftX,y2-=sourceNumericalShiftY,0,0,u2-u0],[0,0,x1,y1,v1-v0],[0,0,x2,y2,v2-v0]]);if(affineCoefs){context.save(),context.beginPath();var centroidX=(u0+u1+u2)/3,centroidY=(v0+v1+v2)/3,p0=enlargeClipPoint(centroidX,centroidY,u0,v0),p1=enlargeClipPoint(centroidX,centroidY,u1,v1),p2=enlargeClipPoint(centroidX,centroidY,u2,v2);context.moveTo(p1[0],p1[1]),context.lineTo(p0[0],p0[1]),context.lineTo(p2[0],p2[1]),context.clip(),context.transform(affineCoefs[0],affineCoefs[2],affineCoefs[1],affineCoefs[3],u0,v0),context.translate(sourceDataExtent[0]-sourceNumericalShiftX,sourceDataExtent[3]-sourceNumericalShiftY),context.scale(sourceResolution/pixelRatio,-sourceResolution/pixelRatio),context.drawImage(stitchContext.canvas,0,0),context.restore()}}),opt_renderEdges&&(context.save(),context.strokeStyle="black",context.lineWidth=1,triangulation.getTriangles().forEach(function(triangle,i,arr){var target=triangle.target,u0=(target[0][0]-targetTopLeft[0])/targetResolution,v0=-(target[0][1]-targetTopLeft[1])/targetResolution,u1=(target[1][0]-targetTopLeft[0])/targetResolution,v1=-(target[1][1]-targetTopLeft[1])/targetResolution,u2=(target[2][0]-targetTopLeft[0])/targetResolution,v2=-(target[2][1]-targetTopLeft[1])/targetResolution;context.beginPath(),context.moveTo(u1,v1),context.lineTo(u0,v0),context.lineTo(u2,v2),context.closePath(),context.stroke()}),context.restore()),context.canvas}var Triangulation_Triangulation=function(sourceProj,targetProj,targetExtent,maxSourceExtent,errorThreshold){this.sourceProj_=sourceProj,this.targetProj_=targetProj;var transformInvCache={},transformInv=proj_getTransform(this.targetProj_,this.sourceProj_);this.transformInv_=function(c){var key=c[0]+"/"+c[1];return transformInvCache[key]||(transformInvCache[key]=transformInv(c)),transformInvCache[key]},this.maxSourceExtent_=maxSourceExtent,this.errorThresholdSquared_=errorThreshold*errorThreshold,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!maxSourceExtent&&!!this.sourceProj_.getExtent()&&getWidth(maxSourceExtent)==getWidth(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?getWidth(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?getWidth(this.targetProj_.getExtent()):null;var destinationTopLeft=getTopLeft(targetExtent),destinationTopRight=getTopRight(targetExtent),destinationBottomRight=getBottomRight(targetExtent),destinationBottomLeft=getBottomLeft(targetExtent),sourceTopLeft=this.transformInv_(destinationTopLeft),sourceTopRight=this.transformInv_(destinationTopRight),sourceBottomRight=this.transformInv_(destinationBottomRight),sourceBottomLeft=this.transformInv_(destinationBottomLeft);if(this.addQuad_(destinationTopLeft,destinationTopRight,destinationBottomRight,destinationBottomLeft,sourceTopLeft,sourceTopRight,sourceBottomRight,sourceBottomLeft,10),this.wrapsXInSource_){var leftBound=1/0;this.triangles_.forEach(function(triangle,i,arr){leftBound=Math.min(leftBound,triangle.source[0][0],triangle.source[1][0],triangle.source[2][0])}),this.triangles_.forEach(function(triangle){if(Math.max(triangle.source[0][0],triangle.source[1][0],triangle.source[2][0])-leftBound>this.sourceWorldWidth_/2){var newTriangle=[[triangle.source[0][0],triangle.source[0][1]],[triangle.source[1][0],triangle.source[1][1]],[triangle.source[2][0],triangle.source[2][1]]];newTriangle[0][0]-leftBound>this.sourceWorldWidth_/2&&(newTriangle[0][0]-=this.sourceWorldWidth_),newTriangle[1][0]-leftBound>this.sourceWorldWidth_/2&&(newTriangle[1][0]-=this.sourceWorldWidth_),newTriangle[2][0]-leftBound>this.sourceWorldWidth_/2&&(newTriangle[2][0]-=this.sourceWorldWidth_);var minX=Math.min(newTriangle[0][0],newTriangle[1][0],newTriangle[2][0]);Math.max(newTriangle[0][0],newTriangle[1][0],newTriangle[2][0])-minX<this.sourceWorldWidth_/2&&(triangle.source=newTriangle)}}.bind(this))}transformInvCache={}};Triangulation_Triangulation.prototype.addTriangle_=function(a,b,c,aSrc,bSrc,cSrc){this.triangles_.push({source:[aSrc,bSrc,cSrc],target:[a,b,c]})},Triangulation_Triangulation.prototype.addQuad_=function(a,b,c,d,aSrc,bSrc,cSrc,dSrc,maxSubdivision){var sourceQuadExtent=boundingExtent([aSrc,bSrc,cSrc,dSrc]),sourceCoverageX=this.sourceWorldWidth_?getWidth(sourceQuadExtent)/this.sourceWorldWidth_:null,sourceWorldWidth=this.sourceWorldWidth_,wrapsX=this.sourceProj_.canWrapX()&&.5<sourceCoverageX&&sourceCoverageX<1,needsSubdivision=!1;if(0<maxSubdivision){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_)needsSubdivision=.25<getWidth(boundingExtent([a,b,c,d]))/this.targetWorldWidth_||needsSubdivision;!wrapsX&&this.sourceProj_.isGlobal()&&sourceCoverageX&&(needsSubdivision=.25<sourceCoverageX||needsSubdivision)}if(needsSubdivision||!this.maxSourceExtent_||extent_intersects(sourceQuadExtent,this.maxSourceExtent_)){if(!(needsSubdivision||isFinite(aSrc[0])&&isFinite(aSrc[1])&&isFinite(bSrc[0])&&isFinite(bSrc[1])&&isFinite(cSrc[0])&&isFinite(cSrc[1])&&isFinite(dSrc[0])&&isFinite(dSrc[1]))){if(!(0<maxSubdivision))return;needsSubdivision=!0}if(0<maxSubdivision){if(!needsSubdivision){var dx,center=[(a[0]+c[0])/2,(a[1]+c[1])/2],centerSrc=this.transformInv_(center);if(wrapsX)dx=(modulo(aSrc[0],sourceWorldWidth)+modulo(cSrc[0],sourceWorldWidth))/2-modulo(centerSrc[0],sourceWorldWidth);else dx=(aSrc[0]+cSrc[0])/2-centerSrc[0];var dy=(aSrc[1]+cSrc[1])/2-centerSrc[1];needsSubdivision=dx*dx+dy*dy>this.errorThresholdSquared_}if(needsSubdivision){if(Math.abs(a[0]-c[0])<=Math.abs(a[1]-c[1])){var bc=[(b[0]+c[0])/2,(b[1]+c[1])/2],bcSrc=this.transformInv_(bc),da=[(d[0]+a[0])/2,(d[1]+a[1])/2],daSrc=this.transformInv_(da);this.addQuad_(a,b,bc,da,aSrc,bSrc,bcSrc,daSrc,maxSubdivision-1),this.addQuad_(da,bc,c,d,daSrc,bcSrc,cSrc,dSrc,maxSubdivision-1)}else{var ab=[(a[0]+b[0])/2,(a[1]+b[1])/2],abSrc=this.transformInv_(ab),cd=[(c[0]+d[0])/2,(c[1]+d[1])/2],cdSrc=this.transformInv_(cd);this.addQuad_(a,ab,cd,d,aSrc,abSrc,cdSrc,dSrc,maxSubdivision-1),this.addQuad_(ab,b,c,cd,abSrc,bSrc,cSrc,cdSrc,maxSubdivision-1)}return}}if(wrapsX){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}this.addTriangle_(a,c,d,aSrc,cSrc,dSrc),this.addTriangle_(a,b,c,aSrc,bSrc,cSrc)}},Triangulation_Triangulation.prototype.calculateSourceExtent=function(){var extent=[1/0,1/0,-1/0,-1/0];return this.triangles_.forEach(function(triangle,i,arr){var src=triangle.source;extendCoordinate(extent,src[0]),extendCoordinate(extent,src[1]),extendCoordinate(extent,src[2])}),extent},Triangulation_Triangulation.prototype.getTriangles=function(){return this.triangles_};var reproj_Triangulation=Triangulation_Triangulation,reproj_Tile=function(Tile){function ReprojTile(sourceProj,sourceTileGrid,targetProj,targetTileGrid,tileCoord,wrappedTileCoord,pixelRatio,gutter,getTileFunction,opt_errorThreshold,opt_renderEdges){Tile.call(this,tileCoord,TileState_IDLE),this.renderEdges_=void 0!==opt_renderEdges&&opt_renderEdges,this.pixelRatio_=pixelRatio,this.gutter_=gutter,this.canvas_=null,this.sourceTileGrid_=sourceTileGrid,this.targetTileGrid_=targetTileGrid,this.wrappedTileCoord_=wrappedTileCoord||tileCoord,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0;var targetExtent=targetTileGrid.getTileCoordExtent(this.wrappedTileCoord_),maxTargetExtent=this.targetTileGrid_.getExtent(),maxSourceExtent=this.sourceTileGrid_.getExtent(),limitedTargetExtent=maxTargetExtent?getIntersection(targetExtent,maxTargetExtent):targetExtent;if(0!==extent_getArea(limitedTargetExtent)){var sourceProjExtent=sourceProj.getExtent();sourceProjExtent&&(maxSourceExtent=maxSourceExtent?getIntersection(maxSourceExtent,sourceProjExtent):sourceProjExtent);var targetResolution=targetTileGrid.getResolution(this.wrappedTileCoord_[0]),sourceResolution=function(sourceProj,targetProj,targetCenter,targetResolution){var sourceCenter=proj_transform(targetCenter,targetProj,sourceProj),sourceResolution=getPointResolution(targetProj,targetResolution,targetCenter),targetMetersPerUnit=targetProj.getMetersPerUnit();void 0!==targetMetersPerUnit&&(sourceResolution*=targetMetersPerUnit);var sourceMetersPerUnit=sourceProj.getMetersPerUnit();void 0!==sourceMetersPerUnit&&(sourceResolution/=sourceMetersPerUnit);var sourceExtent=sourceProj.getExtent();if(!sourceExtent||containsCoordinate(sourceExtent,sourceCenter)){var compensationFactor=getPointResolution(sourceProj,sourceResolution,sourceCenter)/sourceResolution;isFinite(compensationFactor)&&0<compensationFactor&&(sourceResolution/=compensationFactor)}return sourceResolution}(sourceProj,targetProj,extent_getCenter(limitedTargetExtent),targetResolution);if(!isFinite(sourceResolution)||sourceResolution<=0)this.state=TileState_EMPTY;else{var errorThresholdInPixels=void 0!==opt_errorThreshold?opt_errorThreshold:.5;if(this.triangulation_=new reproj_Triangulation(sourceProj,targetProj,limitedTargetExtent,maxSourceExtent,sourceResolution*errorThresholdInPixels),0!==this.triangulation_.getTriangles().length){this.sourceZ_=sourceTileGrid.getZForResolution(sourceResolution);var sourceExtent=this.triangulation_.calculateSourceExtent();if(maxSourceExtent&&(sourceProj.canWrapX()?(sourceExtent[1]=clamp(sourceExtent[1],maxSourceExtent[1],maxSourceExtent[3]),sourceExtent[3]=clamp(sourceExtent[3],maxSourceExtent[1],maxSourceExtent[3])):sourceExtent=getIntersection(sourceExtent,maxSourceExtent)),extent_getArea(sourceExtent)){for(var sourceRange=sourceTileGrid.getTileRangeForExtentAndZ(sourceExtent,this.sourceZ_),srcX=sourceRange.minX;srcX<=sourceRange.maxX;srcX++)for(var srcY=sourceRange.minY;srcY<=sourceRange.maxY;srcY++){var tile=getTileFunction(this.sourceZ_,srcX,srcY,pixelRatio);tile&&this.sourceTiles_.push(tile)}0===this.sourceTiles_.length&&(this.state=TileState_EMPTY)}else this.state=TileState_EMPTY}else this.state=TileState_EMPTY}}else this.state=TileState_EMPTY}return Tile&&(ReprojTile.__proto__=Tile),((ReprojTile.prototype=Object.create(Tile&&Tile.prototype)).constructor=ReprojTile).prototype.disposeInternal=function(){this.state==TileState_LOADING&&this.unlistenSources_(),Tile.prototype.disposeInternal.call(this)},ReprojTile.prototype.getImage=function(){return this.canvas_},ReprojTile.prototype.reproject_=function(){var sources=[];if(this.sourceTiles_.forEach(function(tile,i,arr){tile&&tile.getState()==TileState_LOADED&&sources.push({extent:this.sourceTileGrid_.getTileCoordExtent(tile.tileCoord),image:tile.getImage()})}.bind(this)),(this.sourceTiles_.length=0)===sources.length)this.state=TileState_ERROR;else{var z=this.wrappedTileCoord_[0],size=this.targetTileGrid_.getTileSize(z),width="number"==typeof size?size:size[0],height="number"==typeof size?size:size[1],targetResolution=this.targetTileGrid_.getResolution(z),sourceResolution=this.sourceTileGrid_.getResolution(this.sourceZ_),targetExtent=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=reproj_render(width,height,this.pixelRatio_,sourceResolution,this.sourceTileGrid_.getExtent(),targetResolution,targetExtent,this.triangulation_,sources,this.gutter_,this.renderEdges_),this.state=TileState_LOADED}this.changed()},ReprojTile.prototype.load=function(){if(this.state==TileState_IDLE){this.state=TileState_LOADING,this.changed();var leftToLoad=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(function(tile,i,arr){var state=tile.getState();if(state==TileState_IDLE||state==TileState_LOADING){leftToLoad++;var sourceListenKey=listen(tile,EventType.CHANGE,function(e){var state=tile.getState();state!=TileState_LOADED&&state!=TileState_ERROR&&state!=TileState_EMPTY||(unlistenByKey(sourceListenKey),0===--leftToLoad&&(this.unlistenSources_(),this.reproject_()))},this);this.sourcesListenerKeys_.push(sourceListenKey)}}.bind(this)),this.sourceTiles_.forEach(function(tile,i,arr){tile.getState()==TileState_IDLE&&tile.load()}),0===leftToLoad&&setTimeout(this.reproject_.bind(this),0)}},ReprojTile.prototype.unlistenSources_=function(){this.sourcesListenerKeys_.forEach(unlistenByKey),this.sourcesListenerKeys_=null},ReprojTile}(ol_Tile);function createFromTemplate(template,tileGrid){var zRegEx=/\{z\}/g,xRegEx=/\{x\}/g,yRegEx=/\{y\}/g,dashYRegEx=/\{-y\}/g;return function(tileCoord,pixelRatio,projection){return tileCoord?template.replace(zRegEx,tileCoord[0].toString()).replace(xRegEx,tileCoord[1].toString()).replace(yRegEx,function(){return(-tileCoord[2]-1).toString()}).replace(dashYRegEx,function(){var z=tileCoord[0],range=tileGrid.getFullTileRange(z);return assert(range,55),(range.getHeight()+tileCoord[2]).toString()}):void 0}}function createFromTemplates(templates,tileGrid){for(var len=templates.length,tileUrlFunctions=new Array(len),i=0;i<len;++i)tileUrlFunctions[i]=createFromTemplate(templates[i],tileGrid);return function(tileUrlFunctions){return 1!==tileUrlFunctions.length?function(tileCoord,pixelRatio,projection){if(tileCoord){var index=modulo(function(tileCoord){return(tileCoord[1]<<tileCoord[0])+tileCoord[2]}(tileCoord),tileUrlFunctions.length);return tileUrlFunctions[index](tileCoord,pixelRatio,projection)}}:tileUrlFunctions[0]}(tileUrlFunctions)}function nullTileUrlFunction(tileCoord,pixelRatio,projection){}var tmpTileCoord=[0,0,0],TileGrid_TileGrid=function(options){var arr,opt_strict,compare,zoomFactor;if(this.minZoom=void 0!==options.minZoom?options.minZoom:0,this.resolutions_=options.resolutions,assert((arr=this.resolutions_,opt_strict=!0,compare=function(a,b){return b-a}||numberSafeCompareFunction,arr.every(function(currentVal,index){if(0===index)return!0;var res=compare(arr[index-1],currentVal);return!(0<res||opt_strict&&0===res)})),17),!options.origins)for(var i=0,ii=this.resolutions_.length-1;i<ii;++i)if(zoomFactor){if(this.resolutions_[i]/this.resolutions_[i+1]!==zoomFactor){zoomFactor=void 0;break}}else zoomFactor=this.resolutions_[i]/this.resolutions_[i+1];this.zoomFactor_=zoomFactor,this.maxZoom=this.resolutions_.length-1,this.origin_=void 0!==options.origin?options.origin:null,this.origins_=null,void 0!==options.origins&&(this.origins_=options.origins,assert(this.origins_.length==this.resolutions_.length,20));var extent=options.extent;void 0===extent||this.origin_||this.origins_||(this.origin_=getTopLeft(extent)),assert(!this.origin_&&this.origins_||this.origin_&&!this.origins_,18),this.tileSizes_=null,void 0!==options.tileSizes&&(this.tileSizes_=options.tileSizes,assert(this.tileSizes_.length==this.resolutions_.length,19)),this.tileSize_=void 0!==options.tileSize?options.tileSize:this.tileSizes_?null:DEFAULT_TILE_SIZE,assert(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,22),this.extent_=void 0!==extent?extent:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],void 0!==options.sizes?this.fullTileRanges_=options.sizes.map(function(size,z){return new ol_TileRange(Math.min(0,size[0]),Math.max(size[0]-1,-1),Math.min(0,size[1]),Math.max(size[1]-1,-1))},this):extent&&this.calculateTileRanges_(extent)};TileGrid_TileGrid.prototype.forEachTileCoord=function(extent,zoom,callback){for(var tileRange=this.getTileRangeForExtentAndZ(extent,zoom),i=tileRange.minX,ii=tileRange.maxX;i<=ii;++i)for(var j=tileRange.minY,jj=tileRange.maxY;j<=jj;++j)callback([zoom,i,j])},TileGrid_TileGrid.prototype.forEachTileCoordParentTileRange=function(tileCoord,callback,opt_this,opt_tileRange,opt_extent){var tileRange,x,y,tileCoordExtent=null,z=tileCoord[0]-1;for(2===this.zoomFactor_?(x=tileCoord[1],y=tileCoord[2]):tileCoordExtent=this.getTileCoordExtent(tileCoord,opt_extent);z>=this.minZoom;){if(tileRange=2===this.zoomFactor_?TileRange_createOrUpdate(x=Math.floor(x/2),x,y=Math.floor(y/2),y,opt_tileRange):this.getTileRangeForExtentAndZ(tileCoordExtent,z,opt_tileRange),callback.call(opt_this,z,tileRange))return!0;--z}return!1},TileGrid_TileGrid.prototype.getExtent=function(){return this.extent_},TileGrid_TileGrid.prototype.getMaxZoom=function(){return this.maxZoom},TileGrid_TileGrid.prototype.getMinZoom=function(){return this.minZoom},TileGrid_TileGrid.prototype.getOrigin=function(z){return this.origin_?this.origin_:this.origins_[z]},TileGrid_TileGrid.prototype.getResolution=function(z){return this.resolutions_[z]},TileGrid_TileGrid.prototype.getResolutions=function(){return this.resolutions_},TileGrid_TileGrid.prototype.getTileCoordChildTileRange=function(tileCoord,opt_tileRange,opt_extent){if(tileCoord[0]<this.maxZoom){if(2===this.zoomFactor_){var minX=2*tileCoord[1],minY=2*tileCoord[2];return TileRange_createOrUpdate(minX,minX+1,minY,minY+1,opt_tileRange)}var tileCoordExtent=this.getTileCoordExtent(tileCoord,opt_extent);return this.getTileRangeForExtentAndZ(tileCoordExtent,tileCoord[0]+1,opt_tileRange)}return null},TileGrid_TileGrid.prototype.getTileRangeExtent=function(z,tileRange,opt_extent){var origin=this.getOrigin(z),resolution=this.getResolution(z),tileSize=toSize(this.getTileSize(z),this.tmpSize_),minX=origin[0]+tileRange.minX*tileSize[0]*resolution,maxX=origin[0]+(tileRange.maxX+1)*tileSize[0]*resolution;return createOrUpdate(minX,origin[1]+tileRange.minY*tileSize[1]*resolution,maxX,origin[1]+(tileRange.maxY+1)*tileSize[1]*resolution,opt_extent)},TileGrid_TileGrid.prototype.getTileRangeForExtentAndZ=function(extent,z,opt_tileRange){var tileCoord=tmpTileCoord;this.getTileCoordForXYAndZ_(extent[0],extent[1],z,!1,tileCoord);var minX=tileCoord[1],minY=tileCoord[2];return this.getTileCoordForXYAndZ_(extent[2],extent[3],z,!0,tileCoord),TileRange_createOrUpdate(minX,tileCoord[1],minY,tileCoord[2],opt_tileRange)},TileGrid_TileGrid.prototype.getTileCoordCenter=function(tileCoord){var origin=this.getOrigin(tileCoord[0]),resolution=this.getResolution(tileCoord[0]),tileSize=toSize(this.getTileSize(tileCoord[0]),this.tmpSize_);return[origin[0]+(tileCoord[1]+.5)*tileSize[0]*resolution,origin[1]+(tileCoord[2]+.5)*tileSize[1]*resolution]},TileGrid_TileGrid.prototype.getTileCoordExtent=function(tileCoord,opt_extent){var origin=this.getOrigin(tileCoord[0]),resolution=this.getResolution(tileCoord[0]),tileSize=toSize(this.getTileSize(tileCoord[0]),this.tmpSize_),minX=origin[0]+tileCoord[1]*tileSize[0]*resolution,minY=origin[1]+tileCoord[2]*tileSize[1]*resolution;return createOrUpdate(minX,minY,minX+tileSize[0]*resolution,minY+tileSize[1]*resolution,opt_extent)},TileGrid_TileGrid.prototype.getTileCoordForCoordAndResolution=function(coordinate,resolution,opt_tileCoord){return this.getTileCoordForXYAndResolution_(coordinate[0],coordinate[1],resolution,!1,opt_tileCoord)},TileGrid_TileGrid.prototype.getTileCoordForXYAndResolution_=function(x,y,resolution,reverseIntersectionPolicy,opt_tileCoord){var z=this.getZForResolution(resolution),scale=resolution/this.getResolution(z),origin=this.getOrigin(z),tileSize=toSize(this.getTileSize(z),this.tmpSize_),adjustX=reverseIntersectionPolicy?.5:0,adjustY=reverseIntersectionPolicy?0:.5,xFromOrigin=Math.floor((x-origin[0])/resolution+adjustX),yFromOrigin=Math.floor((y-origin[1])/resolution+adjustY),tileCoordX=scale*xFromOrigin/tileSize[0],tileCoordY=scale*yFromOrigin/tileSize[1];return tilecoord_createOrUpdate(z,tileCoordX,tileCoordY=reverseIntersectionPolicy?(tileCoordX=Math.ceil(tileCoordX)-1,Math.ceil(tileCoordY)-1):(tileCoordX=Math.floor(tileCoordX),Math.floor(tileCoordY)),opt_tileCoord)},TileGrid_TileGrid.prototype.getTileCoordForXYAndZ_=function(x,y,z,reverseIntersectionPolicy,opt_tileCoord){var origin=this.getOrigin(z),resolution=this.getResolution(z),tileSize=toSize(this.getTileSize(z),this.tmpSize_),adjustX=reverseIntersectionPolicy?.5:0,adjustY=reverseIntersectionPolicy?0:.5,xFromOrigin=Math.floor((x-origin[0])/resolution+adjustX),yFromOrigin=Math.floor((y-origin[1])/resolution+adjustY),tileCoordX=xFromOrigin/tileSize[0],tileCoordY=yFromOrigin/tileSize[1];return tilecoord_createOrUpdate(z,tileCoordX,tileCoordY=reverseIntersectionPolicy?(tileCoordX=Math.ceil(tileCoordX)-1,Math.ceil(tileCoordY)-1):(tileCoordX=Math.floor(tileCoordX),Math.floor(tileCoordY)),opt_tileCoord)},TileGrid_TileGrid.prototype.getTileCoordForCoordAndZ=function(coordinate,z,opt_tileCoord){return this.getTileCoordForXYAndZ_(coordinate[0],coordinate[1],z,!1,opt_tileCoord)},TileGrid_TileGrid.prototype.getTileCoordResolution=function(tileCoord){return this.resolutions_[tileCoord[0]]},TileGrid_TileGrid.prototype.getTileSize=function(z){return this.tileSize_?this.tileSize_:this.tileSizes_[z]},TileGrid_TileGrid.prototype.getFullTileRange=function(z){return this.fullTileRanges_?this.fullTileRanges_[z]:null},TileGrid_TileGrid.prototype.getZForResolution=function(resolution,opt_direction){return clamp(linearFindNearest(this.resolutions_,resolution,opt_direction||0),this.minZoom,this.maxZoom)},TileGrid_TileGrid.prototype.calculateTileRanges_=function(extent){for(var length=this.resolutions_.length,fullTileRanges=new Array(length),z=this.minZoom;z<length;++z)fullTileRanges[z]=this.getTileRangeForExtentAndZ(extent,z);this.fullTileRanges_=fullTileRanges};var tilegrid_TileGrid=TileGrid_TileGrid;function getForProjection(projection){var tileGrid=projection.getDefaultTileGrid();return tileGrid||(tileGrid=function(projection,opt_maxZoom,opt_tileSize,opt_corner){return function(extent,opt_maxZoom,opt_tileSize,opt_corner){var corner=void 0!==opt_corner?opt_corner:Corner.TOP_LEFT,resolutions=resolutionsFromExtent(extent,opt_maxZoom,opt_tileSize);return new tilegrid_TileGrid({extent:extent,origin:function(extent,corner){var coordinate;return corner===Corner.BOTTOM_LEFT?coordinate=getBottomLeft(extent):corner===Corner.BOTTOM_RIGHT?coordinate=getBottomRight(extent):corner===Corner.TOP_LEFT?coordinate=getTopLeft(extent):corner===Corner.TOP_RIGHT?coordinate=getTopRight(extent):assert(!1,13),coordinate}(extent,corner),resolutions:resolutions,tileSize:opt_tileSize})}(extentFromProjection(projection),opt_maxZoom,opt_tileSize,opt_corner)}(projection),projection.setDefaultTileGrid(tileGrid)),tileGrid}function resolutionsFromExtent(extent,opt_maxZoom,opt_tileSize){for(var maxZoom=void 0!==opt_maxZoom?opt_maxZoom:DEFAULT_MAX_ZOOM,height=getHeight(extent),width=getWidth(extent),tileSize=toSize(void 0!==opt_tileSize?opt_tileSize:DEFAULT_TILE_SIZE),maxResolution=Math.max(width/tileSize[0],height/tileSize[1]),length=maxZoom+1,resolutions=new Array(length),z=0;z<length;++z)resolutions[z]=maxResolution/Math.pow(2,z);return resolutions}function extentFromProjection(projection){var extent=(projection=proj_get(projection)).getExtent();if(!extent){var half=180*METERS_PER_UNIT[proj_Units.DEGREES]/projection.getMetersPerUnit();extent=createOrUpdate(-half,-half,half,half)}return extent}var Tile_TileSource=function(Source){function TileSource(options){Source.call(this,{attributions:options.attributions,attributionsCollapsible:options.attributionsCollapsible,projection:options.projection,state:options.state,wrapX:options.wrapX}),this.opaque_=void 0!==options.opaque&&options.opaque,this.tilePixelRatio_=void 0!==options.tilePixelRatio?options.tilePixelRatio:1,this.tileGrid=void 0!==options.tileGrid?options.tileGrid:null,this.tileCache=new ol_TileCache(options.cacheSize),this.tmpSize=[0,0],this.key_=options.key||"",this.tileOptions={transition:options.transition}}return Source&&(TileSource.__proto__=Source),((TileSource.prototype=Object.create(Source&&Source.prototype)).constructor=TileSource).prototype.canExpireCache=function(){return this.tileCache.canExpireCache()},TileSource.prototype.expireCache=function(projection,usedTiles){var tileCache=this.getTileCacheForProjection(projection);tileCache&&tileCache.expireCache(usedTiles)},TileSource.prototype.forEachLoadedTile=function(projection,z,tileRange,callback){var tileCache=this.getTileCacheForProjection(projection);if(!tileCache)return!1;for(var tile,tileCoordKey,loaded,covered=!0,x=tileRange.minX;x<=tileRange.maxX;++x)for(var y=tileRange.minY;y<=tileRange.maxY;++y)tileCoordKey=getKeyZXY(z,x,y),loaded=!1,tileCache.containsKey(tileCoordKey)&&(loaded=(tile=tileCache.get(tileCoordKey)).getState()===TileState_LOADED)&&(loaded=!1!==callback(tile)),loaded||(covered=!1);return covered},TileSource.prototype.getGutterForProjection=function(projection){return 0},TileSource.prototype.getKey=function(){return this.key_},TileSource.prototype.setKey=function(key){this.key_!==key&&(this.key_=key,this.changed())},TileSource.prototype.getOpaque=function(projection){return this.opaque_},TileSource.prototype.getResolutions=function(){return this.tileGrid.getResolutions()},TileSource.prototype.getTile=function(z,x,y,pixelRatio,projection){return util_abstract()},TileSource.prototype.getTileGrid=function(){return this.tileGrid},TileSource.prototype.getTileGridForProjection=function(projection){return this.tileGrid?this.tileGrid:getForProjection(projection)},TileSource.prototype.getTileCacheForProjection=function(projection){var thisProj=this.getProjection();return thisProj&&!equivalent(thisProj,projection)?null:this.tileCache},TileSource.prototype.getTilePixelRatio=function(pixelRatio){return this.tilePixelRatio_},TileSource.prototype.getTilePixelSize=function(z,pixelRatio,projection){var size,ratio,opt_size,tileGrid=this.getTileGridForProjection(projection),tilePixelRatio=this.getTilePixelRatio(pixelRatio),tileSize=toSize(tileGrid.getTileSize(z),this.tmpSize);return 1==tilePixelRatio?tileSize:(size=tileSize,ratio=tilePixelRatio,void 0===(opt_size=this.tmpSize)&&(opt_size=[0,0]),opt_size[0]=size[0]*ratio+.5|0,opt_size[1]=size[1]*ratio+.5|0,opt_size)},TileSource.prototype.getTileCoordForTileUrlFunction=function(tileCoord,opt_projection){var projection=void 0!==opt_projection?opt_projection:this.getProjection(),tileGrid=this.getTileGridForProjection(projection);return this.getWrapX()&&projection.isGlobal()&&(tileCoord=function(tileGrid,tileCoord,projection){var z=tileCoord[0],center=tileGrid.getTileCoordCenter(tileCoord),projectionExtent=extentFromProjection(projection);if(containsCoordinate(projectionExtent,center))return tileCoord;var worldWidth=getWidth(projectionExtent),worldsAway=Math.ceil((projectionExtent[0]-center[0])/worldWidth);return center[0]+=worldWidth*worldsAway,tileGrid.getTileCoordForCoordAndZ(center,z)}(tileGrid,tileCoord,projection)),function(tileCoord,tileGrid){var z=tileCoord[0],x=tileCoord[1],y=tileCoord[2];if(tileGrid.getMinZoom()>z||z>tileGrid.getMaxZoom())return!1;var tileRange,extent=tileGrid.getExtent();return!(tileRange=extent?tileGrid.getTileRangeForExtentAndZ(extent,z):tileGrid.getFullTileRange(z))||tileRange.containsXY(x,y)}(tileCoord,tileGrid)?tileCoord:null},TileSource.prototype.refresh=function(){this.tileCache.clear(),this.changed()},TileSource.prototype.useTile=function(z,x,y,projection){},TileSource}(source_Source),TileSourceEvent=function(Event){function TileSourceEvent(type,tile){Event.call(this,type),this.tile=tile}return Event&&(TileSourceEvent.__proto__=Event),(TileSourceEvent.prototype=Object.create(Event&&Event.prototype)).constructor=TileSourceEvent}(events_Event),TileEventType_TILELOADSTART="tileloadstart",TileEventType_TILELOADEND="tileloadend",TileEventType_TILELOADERROR="tileloaderror";function defaultTileLoadFunction(imageTile,src){imageTile.getImage().src=src}var source_OSM=function(XYZ){function OSM(opt_options){var attributions,options=opt_options||{};attributions=void 0!==options.attributions?options.attributions:['&#169; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors.'];var crossOrigin=void 0!==options.crossOrigin?options.crossOrigin:"anonymous",url=void 0!==options.url?options.url:"https://{a-c}.tile.openstreetmap.org/{z}/{x}/{y}.png";XYZ.call(this,{attributions:attributions,cacheSize:options.cacheSize,crossOrigin:crossOrigin,opaque:void 0===options.opaque||options.opaque,maxZoom:void 0!==options.maxZoom?options.maxZoom:19,reprojectionErrorThreshold:options.reprojectionErrorThreshold,tileLoadFunction:options.tileLoadFunction,url:url,wrapX:options.wrapX,attributionsCollapsible:!1})}return XYZ&&(OSM.__proto__=XYZ),(OSM.prototype=Object.create(XYZ&&XYZ.prototype)).constructor=OSM}(function(TileImage){function XYZ(opt_options){var options=opt_options||{},projection=void 0!==options.projection?options.projection:"EPSG:3857",tileGrid=void 0!==options.tileGrid?options.tileGrid:function(opt_options){var xyzOptions=opt_options||{},extent=xyzOptions.extent||proj_get("EPSG:3857").getExtent(),gridOptions={extent:extent,minZoom:xyzOptions.minZoom,tileSize:xyzOptions.tileSize,resolutions:resolutionsFromExtent(extent,xyzOptions.maxZoom,xyzOptions.tileSize)};return new tilegrid_TileGrid(gridOptions)}({extent:extentFromProjection(projection),maxZoom:options.maxZoom,minZoom:options.minZoom,tileSize:options.tileSize});TileImage.call(this,{attributions:options.attributions,cacheSize:options.cacheSize,crossOrigin:options.crossOrigin,opaque:options.opaque,projection:projection,reprojectionErrorThreshold:options.reprojectionErrorThreshold,tileGrid:tileGrid,tileLoadFunction:options.tileLoadFunction,tilePixelRatio:options.tilePixelRatio,tileUrlFunction:options.tileUrlFunction,url:options.url,urls:options.urls,wrapX:void 0===options.wrapX||options.wrapX,transition:options.transition,attributionsCollapsible:options.attributionsCollapsible})}return TileImage&&(XYZ.__proto__=TileImage),(XYZ.prototype=Object.create(TileImage&&TileImage.prototype)).constructor=XYZ}(function(UrlTile){function TileImage(options){UrlTile.call(this,{attributions:options.attributions,cacheSize:options.cacheSize,opaque:options.opaque,projection:options.projection,state:options.state,tileGrid:options.tileGrid,tileLoadFunction:options.tileLoadFunction?options.tileLoadFunction:defaultTileLoadFunction,tilePixelRatio:options.tilePixelRatio,tileUrlFunction:options.tileUrlFunction,url:options.url,urls:options.urls,wrapX:options.wrapX,transition:options.transition,key:options.key,attributionsCollapsible:options.attributionsCollapsible}),this.crossOrigin=void 0!==options.crossOrigin?options.crossOrigin:null,this.tileClass=void 0!==options.tileClass?options.tileClass:ol_ImageTile,this.tileCacheForProjection={},this.tileGridForProjection={},this.reprojectionErrorThreshold_=options.reprojectionErrorThreshold,this.renderReprojectionEdges_=!1}return UrlTile&&(TileImage.__proto__=UrlTile),((TileImage.prototype=Object.create(UrlTile&&UrlTile.prototype)).constructor=TileImage).prototype.canExpireCache=function(){if(this.tileCache.canExpireCache())return!0;for(var key in this.tileCacheForProjection)if(this.tileCacheForProjection[key].canExpireCache())return!0;return!1},TileImage.prototype.expireCache=function(projection,usedTiles){var usedTileCache=this.getTileCacheForProjection(projection);for(var id in this.tileCache.expireCache(this.tileCache==usedTileCache?usedTiles:{}),this.tileCacheForProjection){var tileCache=this.tileCacheForProjection[id];tileCache.expireCache(tileCache==usedTileCache?usedTiles:{})}},TileImage.prototype.getGutterForProjection=function(projection){return this.getProjection()&&projection&&!equivalent(this.getProjection(),projection)?0:this.getGutter()},TileImage.prototype.getGutter=function(){return 0},TileImage.prototype.getOpaque=function(projection){return!(this.getProjection()&&projection&&!equivalent(this.getProjection(),projection))&&UrlTile.prototype.getOpaque.call(this,projection)},TileImage.prototype.getTileGridForProjection=function(projection){var thisProj=this.getProjection();if(!this.tileGrid||thisProj&&!equivalent(thisProj,projection)){var projKey=getUid(projection);return projKey in this.tileGridForProjection||(this.tileGridForProjection[projKey]=getForProjection(projection)),this.tileGridForProjection[projKey]}return this.tileGrid},TileImage.prototype.getTileCacheForProjection=function(projection){var thisProj=this.getProjection();if(!thisProj||equivalent(thisProj,projection))return this.tileCache;var projKey=getUid(projection);return projKey in this.tileCacheForProjection||(this.tileCacheForProjection[projKey]=new ol_TileCache(this.tileCache.highWaterMark)),this.tileCacheForProjection[projKey]},TileImage.prototype.createTile_=function(z,x,y,pixelRatio,projection,key){var tileCoord=[z,x,y],urlTileCoord=this.getTileCoordForTileUrlFunction(tileCoord,projection),tileUrl=urlTileCoord?this.tileUrlFunction(urlTileCoord,pixelRatio,projection):void 0,tile=new this.tileClass(tileCoord,void 0!==tileUrl?TileState_IDLE:TileState_EMPTY,void 0!==tileUrl?tileUrl:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return tile.key=key,listen(tile,EventType.CHANGE,this.handleTileChange,this),tile},TileImage.prototype.getTile=function(z,x,y,pixelRatio,projection){var sourceProjection=this.getProjection();if(sourceProjection&&projection&&!equivalent(sourceProjection,projection)){var tile,cache=this.getTileCacheForProjection(projection),tileCoord=[z,x,y],tileCoordKey=tilecoord_getKey(tileCoord);cache.containsKey(tileCoordKey)&&(tile=cache.get(tileCoordKey));var key=this.getKey();if(tile&&tile.key==key)return tile;var sourceTileGrid=this.getTileGridForProjection(sourceProjection),targetTileGrid=this.getTileGridForProjection(projection),wrappedTileCoord=this.getTileCoordForTileUrlFunction(tileCoord,projection),newTile=new reproj_Tile(sourceProjection,sourceTileGrid,projection,targetTileGrid,tileCoord,wrappedTileCoord,this.getTilePixelRatio(pixelRatio),this.getGutter(),function(z,x,y,pixelRatio){return this.getTileInternal(z,x,y,pixelRatio,sourceProjection)}.bind(this),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_);return newTile.key=key,tile?(newTile.interimTile=tile,newTile.refreshInterimChain(),cache.replace(tileCoordKey,newTile)):cache.set(tileCoordKey,newTile),newTile}return this.getTileInternal(z,x,y,pixelRatio,sourceProjection||projection)},TileImage.prototype.getTileInternal=function(z,x,y,pixelRatio,projection){var tile=null,tileCoordKey=getKeyZXY(z,x,y),key=this.getKey();if(this.tileCache.containsKey(tileCoordKey)){if((tile=this.tileCache.get(tileCoordKey)).key!=key){var interimTile=tile;tile=this.createTile_(z,x,y,pixelRatio,projection,key),interimTile.getState()==TileState_IDLE?tile.interimTile=interimTile.interimTile:tile.interimTile=interimTile,tile.refreshInterimChain(),this.tileCache.replace(tileCoordKey,tile)}}else tile=this.createTile_(z,x,y,pixelRatio,projection,key),this.tileCache.set(tileCoordKey,tile);return tile},TileImage.prototype.setRenderReprojectionEdges=function(render){if(this.renderReprojectionEdges_!=render){for(var id in this.renderReprojectionEdges_=render,this.tileCacheForProjection)this.tileCacheForProjection[id].clear();this.changed()}},TileImage.prototype.setTileGridForProjection=function(projection,tilegrid){var proj=proj_get(projection);if(proj){var projKey=getUid(proj);projKey in this.tileGridForProjection||(this.tileGridForProjection[projKey]=tilegrid)}},TileImage}(function(TileSource){function UrlTile(options){TileSource.call(this,{attributions:options.attributions,cacheSize:options.cacheSize,opaque:options.opaque,projection:options.projection,state:options.state,tileGrid:options.tileGrid,tilePixelRatio:options.tilePixelRatio,wrapX:options.wrapX,transition:options.transition,key:options.key,attributionsCollapsible:options.attributionsCollapsible}),this.generateTileUrlFunction_=!options.tileUrlFunction,this.tileLoadFunction=options.tileLoadFunction,this.tileUrlFunction=options.tileUrlFunction?options.tileUrlFunction.bind(this):nullTileUrlFunction,this.urls=null,options.urls?this.setUrls(options.urls):options.url&&this.setUrl(options.url),options.tileUrlFunction&&this.setTileUrlFunction(options.tileUrlFunction,this.key_),this.tileLoadingKeys_={}}return TileSource&&(UrlTile.__proto__=TileSource),((UrlTile.prototype=Object.create(TileSource&&TileSource.prototype)).constructor=UrlTile).prototype.getTileLoadFunction=function(){return this.tileLoadFunction},UrlTile.prototype.getTileUrlFunction=function(){return this.tileUrlFunction},UrlTile.prototype.getUrls=function(){return this.urls},UrlTile.prototype.handleTileChange=function(event){var type,tile=event.target,uid=getUid(tile),tileState=tile.getState();tileState==TileState_LOADING?(this.tileLoadingKeys_[uid]=!0,type=TileEventType_TILELOADSTART):uid in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[uid],type=tileState==TileState_ERROR?TileEventType_TILELOADERROR:tileState==TileState_LOADED||tileState==TileState_ABORT?TileEventType_TILELOADEND:void 0),null!=type&&this.dispatchEvent(new TileSourceEvent(type,tile))},UrlTile.prototype.setTileLoadFunction=function(tileLoadFunction){this.tileCache.clear(),this.tileLoadFunction=tileLoadFunction,this.changed()},UrlTile.prototype.setTileUrlFunction=function(tileUrlFunction,key){this.tileUrlFunction=tileUrlFunction,this.tileCache.pruneExceptNewestZ(),void 0!==key?this.setKey(key):this.changed()},UrlTile.prototype.setUrl=function(url){var urls=this.urls=function(url){var urls=[],match=/\{([a-z])-([a-z])\}/.exec(url);if(match){var charCode,startCharCode=match[1].charCodeAt(0),stopCharCode=match[2].charCodeAt(0);for(charCode=startCharCode;charCode<=stopCharCode;++charCode)urls.push(url.replace(match[0],String.fromCharCode(charCode)));return urls}if(match=match=/\{(\d+)-(\d+)\}/.exec(url)){for(var stop=parseInt(match[2],10),i=parseInt(match[1],10);i<=stop;i++)urls.push(url.replace(match[0],i.toString()));return urls}return urls.push(url),urls}(url);this.setUrls(urls)},UrlTile.prototype.setUrls=function(urls){var key=(this.urls=urls).join("\n");this.generateTileUrlFunction_?this.setTileUrlFunction(createFromTemplates(urls,this.tileGrid),key):this.setKey(key)},UrlTile.prototype.useTile=function(z,x,y){var tileCoordKey=getKeyZXY(z,x,y);this.tileCache.containsKey(tileCoordKey)&&this.tileCache.get(tileCoordKey)},UrlTile}(Tile_TileSource)))),Circle_Circle=function(SimpleGeometry){function Circle(center,opt_radius,opt_layout){if(SimpleGeometry.call(this),void 0!==opt_layout&&void 0===opt_radius)this.setFlatCoordinates(opt_layout,center);else{var radius=opt_radius||0;this.setCenterAndRadius(center,radius,opt_layout)}}return SimpleGeometry&&(Circle.__proto__=SimpleGeometry),((Circle.prototype=Object.create(SimpleGeometry&&SimpleGeometry.prototype)).constructor=Circle).prototype.clone=function(){return new Circle(this.flatCoordinates.slice(),void 0,this.layout)},Circle.prototype.closestPointXY=function(x,y,closestPoint,minSquaredDistance){var flatCoordinates=this.flatCoordinates,dx=x-flatCoordinates[0],dy=y-flatCoordinates[1],squaredDistance=dx*dx+dy*dy;if(squaredDistance<minSquaredDistance){if(0===squaredDistance)for(var i=0;i<this.stride;++i)closestPoint[i]=flatCoordinates[i];else{var delta=this.getRadius()/Math.sqrt(squaredDistance);closestPoint[0]=flatCoordinates[0]+delta*dx,closestPoint[1]=flatCoordinates[1]+delta*dy;for(var i$1=2;i$1<this.stride;++i$1)closestPoint[i$1]=flatCoordinates[i$1]}return closestPoint.length=this.stride,squaredDistance}return minSquaredDistance},Circle.prototype.containsXY=function(x,y){var flatCoordinates=this.flatCoordinates,dx=x-flatCoordinates[0],dy=y-flatCoordinates[1];return dx*dx+dy*dy<=this.getRadiusSquared_()},Circle.prototype.getCenter=function(){return this.flatCoordinates.slice(0,this.stride)},Circle.prototype.computeExtent=function(extent){var flatCoordinates=this.flatCoordinates,radius=flatCoordinates[this.stride]-flatCoordinates[0];return createOrUpdate(flatCoordinates[0]-radius,flatCoordinates[1]-radius,flatCoordinates[0]+radius,flatCoordinates[1]+radius,extent)},Circle.prototype.getRadius=function(){return Math.sqrt(this.getRadiusSquared_())},Circle.prototype.getRadiusSquared_=function(){var dx=this.flatCoordinates[this.stride]-this.flatCoordinates[0],dy=this.flatCoordinates[this.stride+1]-this.flatCoordinates[1];return dx*dx+dy*dy},Circle.prototype.getType=function(){return GeometryType.CIRCLE},Circle.prototype.intersectsExtent=function(extent){if(extent_intersects(extent,this.getExtent())){var center=this.getCenter();return extent[0]<=center[0]&&extent[2]>=center[0]||(extent[1]<=center[1]&&extent[3]>=center[1]||forEachCorner(extent,this.intersectsCoordinate,this))}return!1},Circle.prototype.setCenter=function(center){var stride=this.stride,radius=this.flatCoordinates[stride]-this.flatCoordinates[0],flatCoordinates=center.slice();flatCoordinates[stride]=flatCoordinates[0]+radius;for(var i=1;i<stride;++i)flatCoordinates[stride+i]=center[i];this.setFlatCoordinates(this.layout,flatCoordinates),this.changed()},Circle.prototype.setCenterAndRadius=function(center,radius,opt_layout){this.setLayout(opt_layout,center,0),this.flatCoordinates||(this.flatCoordinates=[]);var flatCoordinates=this.flatCoordinates,offset=deflateCoordinate(flatCoordinates,0,center,this.stride);flatCoordinates[offset++]=flatCoordinates[0]+radius;for(var i=1,ii=this.stride;i<ii;++i)flatCoordinates[offset++]=flatCoordinates[i];flatCoordinates.length=offset,this.changed()},Circle.prototype.getCoordinates=function(){return null},Circle.prototype.setCoordinates=function(coordinates,opt_layout){},Circle.prototype.setRadius=function(radius){this.flatCoordinates[this.stride]=this.flatCoordinates[0]+radius,this.changed()},Circle}(geom_SimpleGeometry);Circle_Circle.prototype.transform;var geom_Circle=Circle_Circle;var ol_Feature=function(BaseObject){function Feature(opt_geometryOrProperties){if(BaseObject.call(this),this.id_=void 0,this.geometryName_="geometry",this.style_=null,this.styleFunction_=void 0,this.geometryChangeKey_=null,listen(this,getChangeEventType(this.geometryName_),this.handleGeometryChanged_,this),opt_geometryOrProperties)if("function"==typeof opt_geometryOrProperties.getSimplifiedGeometry){var geometry=opt_geometryOrProperties;this.setGeometry(geometry)}else{var properties=opt_geometryOrProperties;this.setProperties(properties)}}return BaseObject&&(Feature.__proto__=BaseObject),((Feature.prototype=Object.create(BaseObject&&BaseObject.prototype)).constructor=Feature).prototype.clone=function(){var clone=new Feature(this.getProperties());clone.setGeometryName(this.getGeometryName());var geometry=this.getGeometry();geometry&&clone.setGeometry(geometry.clone());var style=this.getStyle();return style&&clone.setStyle(style),clone},Feature.prototype.getGeometry=function(){return this.get(this.geometryName_)},Feature.prototype.getId=function(){return this.id_},Feature.prototype.getGeometryName=function(){return this.geometryName_},Feature.prototype.getStyle=function(){return this.style_},Feature.prototype.getStyleFunction=function(){return this.styleFunction_},Feature.prototype.handleGeometryChange_=function(){this.changed()},Feature.prototype.handleGeometryChanged_=function(){this.geometryChangeKey_&&(unlistenByKey(this.geometryChangeKey_),this.geometryChangeKey_=null);var geometry=this.getGeometry();geometry&&(this.geometryChangeKey_=listen(geometry,EventType.CHANGE,this.handleGeometryChange_,this)),this.changed()},Feature.prototype.setGeometry=function(geometry){this.set(this.geometryName_,geometry)},Feature.prototype.setStyle=function(style){this.style_=style,this.styleFunction_=style?function(obj){{if("function"==typeof obj)return obj;var styles;if(Array.isArray(obj))styles=obj;else{assert("function"==typeof obj.getZIndex,41);var style=obj;styles=[style]}return function(){return styles}}}(style):void 0,this.changed()},Feature.prototype.setId=function(id){this.id_=id,this.changed()},Feature.prototype.setGeometryName=function(name){unlisten(this,getChangeEventType(this.geometryName_),this.handleGeometryChanged_,this),this.geometryName_=name,listen(this,getChangeEventType(this.geometryName_),this.handleGeometryChanged_,this),this.handleGeometryChanged_()},Feature}(ol_Object),MIN_SIZE=2e3,MAX_SIZE=2e4,DEFAULT_SIZE=5e3,PRIVATE=Symbol("map-view-data"),CATEGORY_COLORS=["1f77b4","0366d6","ff7f0e","2ca02c","d62728","9467bd","8c564b","e377c2","7f7f7f","bcbd22","17becf"];function mapView(container,config){var data=function(config){var points=[];return config.data.forEach(function(row,i){if(!((row.__ROW_PATH__?row.__ROW_PATH__.length:0)<config.row_pivot.length)){var group=row.__ROW_PATH__?row.__ROW_PATH__.join(","):"".concat(i),rowPoints={};Object.keys(row).filter(function(key){return"__ROW_PATH__"!==key&&null!==row[key]}).forEach(function(key){var split=key.split("|"),category=1<split.length?split.slice(0,split.length-1).join(","):"__default__";rowPoints[category]=rowPoints[category]||{group:group},rowPoints[category][split[split.length-1]]=row[key]}),Object.keys(rowPoints).forEach(function(key){var rowPoint=rowPoints[key],cols=config.aggregate.map(function(a){return rowPoint[a.column]});points.push({cols:cols,group:rowPoint.group,category:key})})}}),points}(config),extents=function(data){var extents=null;return data.forEach(function(point){extents=extents?point.cols.map(function(c,i){return c?{min:Math.min(c,extents[i].min),max:Math.max(c,extents[i].max)}:extents[i]}):point.cols.map(function(c){return{min:c,max:c}})}),extents}(data),map=function(container,extents){if(!container[PRIVATE]){var size=container.getBoundingClientRect(),pExtents=[fromLonLat([extents[0].min,extents[1].min]),fromLonLat([extents[0].max,extents[1].max])],center=[(pExtents[0][0]+pExtents[1][0])/2,(pExtents[0][1]+pExtents[1][1])/2],resolution=Math.max(Math.abs(pExtents[1][0]-pExtents[0][0])/size.width,Math.abs(pExtents[1][1]-pExtents[0][1])/size.height),vectorSource=new source_Vector({features:[]}),map=new ol_Map({target:container,layers:[new layer_Tile({source:new source_OSM}),new Vector({source:vectorSource})],view:new ol_View({center:center,resolution:resolution}),projection:""});container[PRIVATE]={map:map,vectorSource:vectorSource}}return container[PRIVATE]}(container,extents),colorMap=function(data){var colIndex=0,categories={};return data.forEach(function(point){if(!categories[point.category]){var col=CATEGORY_COLORS[colIndex];categories[point.category]=[col.substring(0,2),col.substring(2,4),col.substring(4,6)].map(function(c){return parseInt(c,16)}),++colIndex>=CATEGORY_COLORS.length&&(colIndex=0)}}),function(point){return categories[point.category]}}(data),sizeMap=function(extents){if(2<extents.length){var range=extents[2].max-extents[2].min;return function(point){return(point.cols[2]-extents[2].min)/range*(MAX_SIZE-MIN_SIZE)+MIN_SIZE}}return function(){return DEFAULT_SIZE}}(extents);map.vectorSource.clear(),map.vectorSource.addFeatures(data.map(function(point){return function(point,colorMap,sizeMap){var feature=new ol_Feature(new geom_Circle(fromLonLat(point.cols),sizeMap(point))),color=colorMap(point).join(",");return feature.setStyle(new style_Style({stroke:new style_Stroke({color:"rgb(".concat(color,")")}),fill:new style_Fill({color:"rgba(".concat(color,", 0.5)")})})),feature}(point,colorMap,sizeMap)}))}mapView.plugin={type:"map_view",name:"Map",max_size:25e3,initial:{type:"number",count:2,names:["Longitude","Latitude","Size"]}};var views=[mapView];__webpack_exports__.a=views},,,,,,,,,,function(module,exports,__webpack_require__){__webpack_require__(84),module.exports=__webpack_require__(131)},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),function(global){__webpack_require__.d(__webpack_exports__,"PRIVATE",function(){return PRIVATE});__webpack_require__(49),__webpack_require__(51),__webpack_require__(52),__webpack_require__(41),__webpack_require__(92),__webpack_require__(54),__webpack_require__(44),__webpack_require__(110),__webpack_require__(63),__webpack_require__(45),__webpack_require__(64),__webpack_require__(30),__webpack_require__(31);var _views_views__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(73),_package_json__WEBPACK_IMPORTED_MODULE_15__=(__webpack_require__(121),__webpack_require__(21));function _slicedToArray(arr,i){return function(arr){if(Array.isArray(arr))return arr}(arr)||function(arr,i){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}var PRIVATE=Symbol(_package_json__WEBPACK_IMPORTED_MODULE_15__.a),DEFAULT_PLUGIN_SETTINGS={initial:{type:"number",count:1},selectMode:"select"};function resizeView(){this[PRIVATE]&&this[PRIVATE].view&&this[PRIVATE].view.resize()}function deleteView(){this[PRIVATE]&&this[PRIVATE].view&&this[PRIVATE].view.remove()}function save(){if(this[PRIVATE]&&this[PRIVATE].chart)return this[PRIVATE].chart.getSettings()}function restore(settings){getOrCreatePlugin.call(this).setSettings(settings)}function getOrCreatePlugin(){return this[PRIVATE]=this[PRIVATE]||{},this[PRIVATE].view||(this[PRIVATE].view=document.createElement(_package_json__WEBPACK_IMPORTED_MODULE_15__.a)),this[PRIVATE].view}function getElement(div){var perspective_d3fc_element=getOrCreatePlugin.call(this);return document.body.contains(perspective_d3fc_element)||(div.innerHTML="",div.appendChild(perspective_d3fc_element)),perspective_d3fc_element}_views_views__WEBPACK_IMPORTED_MODULE_13__.a.forEach(function(view){var viewEntryPoint,fn,_ref;global.registerPlugin(view.plugin.type,function(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{},ownKeys=Object.keys(source);"function"==typeof Object.getOwnPropertySymbols&&(ownKeys=ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function(sym){return Object.getOwnPropertyDescriptor(source,sym).enumerable}))),ownKeys.forEach(function(key){_defineProperty(target,key,source[key])})}return target}({},DEFAULT_PLUGIN_SETTINGS,view.plugin,{create:(viewEntryPoint=view,fn=regeneratorRuntime.mark(function _callee(el,view,task){var _ref2,_ref3,tschema,schema,data,config;return regeneratorRuntime.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.next=2,Promise.all([this._table.schema(),view.schema(),view.to_json(),view.get_config()]);case 2:if(_ref2=_context.sent,_ref3=_slicedToArray(_ref2,4),tschema=_ref3[0],schema=_ref3[1],data=_ref3[2],config=_ref3[3],task.cancelled)return _context.abrupt("return");_context.next=10;break;case 10:getElement.call(this,el).render(viewEntryPoint,Object.assign({schema:schema,tschema:tschema,data:data},config));case 11:case"end":return _context.stop()}},_callee,this)}),_ref=function(){var self=this,args=arguments;return new Promise(function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)})},function(_x,_x2,_x3){return _ref.apply(this,arguments)}),resize:resizeView,delete:deleteView,save:save,restore:restore}))})}.call(this,__webpack_require__(85))},function(module,exports){var g;g=function(){return this}();try{g=g||new Function("return this")()}catch(e){"object"==typeof window&&(g=window)}module.exports=g},function(module,exports,__webpack_require__){module.exports=__webpack_require__(23)("native-function-to-string",Function.toString)},function(module,exports,__webpack_require__){var speciesConstructor=__webpack_require__(88);module.exports=function(original,length){return new(speciesConstructor(original))(length)}},function(module,exports,__webpack_require__){var isObject=__webpack_require__(4),isArray=__webpack_require__(34),SPECIES=__webpack_require__(0)("species");module.exports=function(original){var C;return isArray(original)&&("function"!=typeof(C=original.constructor)||C!==Array&&!isArray(C.prototype)||(C=void 0),isObject(C)&&null===(C=C[SPECIES])&&(C=void 0)),void 0===C?Array:C}},function(module,exports,__webpack_require__){var toIObject=__webpack_require__(16),toLength=__webpack_require__(26),toAbsoluteIndex=__webpack_require__(90);module.exports=function(IS_INCLUDES){return function($this,el,fromIndex){var value,O=toIObject($this),length=toLength(O.length),index=toAbsoluteIndex(fromIndex,length);if(IS_INCLUDES&&el!=el){for(;index<length;)if((value=O[index++])!=value)return!0}else for(;index<length;index++)if((IS_INCLUDES||index in O)&&O[index]===el)return IS_INCLUDES||index||0;return!IS_INCLUDES&&-1}}},function(module,exports,__webpack_require__){var toInteger=__webpack_require__(37),max=Math.max,min=Math.min;module.exports=function(index,length){return(index=toInteger(index))<0?max(index+length,0):min(index,length)}},function(module,exports,__webpack_require__){var $export=__webpack_require__(1),core=__webpack_require__(11),fails=__webpack_require__(5);module.exports=function(KEY,exec){var fn=(core.Object||{})[KEY]||Object[KEY],exp={};exp[KEY]=exec(fn),$export($export.S+$export.F*fails(function(){fn(1)}),"Object",exp)}},function(module,exports,__webpack_require__){var $export=__webpack_require__(1);$export($export.S+$export.F,"Object",{assign:__webpack_require__(93)})},function(module,exports,__webpack_require__){"use strict";var getKeys=__webpack_require__(15),gOPS=__webpack_require__(42),pIE=__webpack_require__(27),toObject=__webpack_require__(24),IObject=__webpack_require__(36),$assign=Object.assign;module.exports=!$assign||__webpack_require__(5)(function(){var A={},B={},S=Symbol(),K="abcdefghijklmnopqrst";return A[S]=7,K.split("").forEach(function(k){B[k]=k}),7!=$assign({},A)[S]||Object.keys($assign({},B)).join("")!=K})?function(target,source){for(var T=toObject(target),aLen=arguments.length,index=1,getSymbols=gOPS.f,isEnum=pIE.f;index<aLen;)for(var key,S=IObject(arguments[index++]),keys=getSymbols?getKeys(S).concat(getSymbols(S)):getKeys(S),length=keys.length,j=0;j<length;)isEnum.call(S,key=keys[j++])&&(T[key]=S[key]);return T}:$assign},function(module,exports){module.exports=function(it,Constructor,name,forbiddenField){if(!(it instanceof Constructor)||void 0!==forbiddenField&&forbiddenField in it)throw TypeError(name+": incorrect invocation!");return it}},function(module,exports,__webpack_require__){var ctx=__webpack_require__(12),call=__webpack_require__(96),isArrayIter=__webpack_require__(97),anObject=__webpack_require__(3),toLength=__webpack_require__(26),getIterFn=__webpack_require__(98),BREAK={},RETURN={};(exports=module.exports=function(iterable,entries,fn,that,ITERATOR){var length,step,iterator,result,iterFn=ITERATOR?function(){return iterable}:getIterFn(iterable),f=ctx(fn,that,entries?2:1),index=0;if("function"!=typeof iterFn)throw TypeError(iterable+" is not iterable!");if(isArrayIter(iterFn)){for(length=toLength(iterable.length);index<length;index++)if((result=entries?f(anObject(step=iterable[index])[0],step[1]):f(iterable[index]))===BREAK||result===RETURN)return result}else for(iterator=iterFn.call(iterable);!(step=iterator.next()).done;)if((result=call(iterator,f,step.value,entries))===BREAK||result===RETURN)return result}).BREAK=BREAK,exports.RETURN=RETURN},function(module,exports,__webpack_require__){var anObject=__webpack_require__(3);module.exports=function(iterator,fn,value,entries){try{return entries?fn(anObject(value)[0],value[1]):fn(value)}catch(e){var ret=iterator.return;throw void 0!==ret&&anObject(ret.call(iterator)),e}}},function(module,exports,__webpack_require__){var Iterators=__webpack_require__(20),ITERATOR=__webpack_require__(0)("iterator"),ArrayProto=Array.prototype;module.exports=function(it){return void 0!==it&&(Iterators.Array===it||ArrayProto[ITERATOR]===it)}},function(module,exports,__webpack_require__){var classof=__webpack_require__(43),ITERATOR=__webpack_require__(0)("iterator"),Iterators=__webpack_require__(20);module.exports=__webpack_require__(11).getIteratorMethod=function(it){if(null!=it)return it[ITERATOR]||it["@@iterator"]||Iterators[classof(it)]}},function(module,exports,__webpack_require__){var global=__webpack_require__(2),macrotask=__webpack_require__(56).set,Observer=global.MutationObserver||global.WebKitMutationObserver,process=global.process,Promise=global.Promise,isNode="process"==__webpack_require__(14)(process);module.exports=function(){var head,last,notify,flush=function(){var parent,fn;for(isNode&&(parent=process.domain)&&parent.exit();head;){fn=head.fn,head=head.next;try{fn()}catch(e){throw head?notify():last=void 0,e}}last=void 0,parent&&parent.enter()};if(isNode)notify=function(){process.nextTick(flush)};else if(!Observer||global.navigator&&global.navigator.standalone)if(Promise&&Promise.resolve){var promise=Promise.resolve(void 0);notify=function(){promise.then(flush)}}else notify=function(){macrotask.call(global,flush)};else{var toggle=!0,node=document.createTextNode("");new Observer(flush).observe(node,{characterData:!0}),notify=function(){node.data=toggle=!toggle}}return function(fn){var task={fn:fn,next:void 0};last&&(last.next=task),head||(head=task,notify()),last=task}}},function(module,exports){module.exports=function(exec){try{return{e:!1,v:exec()}}catch(e){return{e:!0,v:e}}}},function(module,exports,__webpack_require__){var navigator=__webpack_require__(2).navigator;module.exports=navigator&&navigator.userAgent||""},function(module,exports,__webpack_require__){var anObject=__webpack_require__(3),isObject=__webpack_require__(4),newPromiseCapability=__webpack_require__(59);module.exports=function(C,x){if(anObject(C),isObject(x)&&x.constructor===C)return x;var promiseCapability=newPromiseCapability.f(C);return(0,promiseCapability.resolve)(x),promiseCapability.promise}},function(module,exports,__webpack_require__){var redefine=__webpack_require__(9);module.exports=function(target,src,safe){for(var key in src)redefine(target,key,src[key],safe);return target}},function(module,exports,__webpack_require__){"use strict";var global=__webpack_require__(2),dP=__webpack_require__(7),DESCRIPTORS=__webpack_require__(6),SPECIES=__webpack_require__(0)("species");module.exports=function(KEY){var C=global[KEY];DESCRIPTORS&&C&&!C[SPECIES]&&dP.f(C,SPECIES,{configurable:!0,get:function(){return this}})}},function(module,exports,__webpack_require__){var ITERATOR=__webpack_require__(0)("iterator"),SAFE_CLOSING=!1;try{var riter=[7][ITERATOR]();riter.return=function(){SAFE_CLOSING=!0},Array.from(riter,function(){throw 2})}catch(e){}module.exports=function(exec,skipClosing){if(!skipClosing&&!SAFE_CLOSING)return!1;var safe=!1;try{var arr=[7],iter=arr[ITERATOR]();iter.next=function(){return{done:safe=!0}},arr[ITERATOR]=function(){return iter},exec(arr)}catch(e){}return safe}},function(module,exports,__webpack_require__){var UNSCOPABLES=__webpack_require__(0)("unscopables"),ArrayProto=Array.prototype;null==ArrayProto[UNSCOPABLES]&&__webpack_require__(8)(ArrayProto,UNSCOPABLES,{}),module.exports=function(key){ArrayProto[UNSCOPABLES][key]=!0}},function(module,exports){module.exports=function(done,value){return{value:value,done:!!done}}},function(module,exports,__webpack_require__){"use strict";var create=__webpack_require__(29),descriptor=__webpack_require__(22),setToStringTag=__webpack_require__(28),IteratorPrototype={};__webpack_require__(8)(IteratorPrototype,__webpack_require__(0)("iterator"),function(){return this}),module.exports=function(Constructor,NAME,next){Constructor.prototype=create(IteratorPrototype,{next:descriptor(1,next)}),setToStringTag(Constructor,NAME+" Iterator")}},function(module,exports,__webpack_require__){var dP=__webpack_require__(7),anObject=__webpack_require__(3),getKeys=__webpack_require__(15);module.exports=__webpack_require__(6)?Object.defineProperties:function(O,Properties){anObject(O);for(var P,keys=getKeys(Properties),length=keys.length,i=0;i<length;)dP.f(O,P=keys[i++],Properties[P]);return O}},function(module,exports,__webpack_require__){"use strict";var $at=__webpack_require__(62)(!0);__webpack_require__(60)(String,"String",function(iterated){this._t=String(iterated),this._i=0},function(){var point,O=this._t,index=this._i;return index>=O.length?{value:void 0,done:!0}:(point=$at(O,index),this._i+=point.length,{value:point,done:!1})})},function(module,exports,__webpack_require__){var META=__webpack_require__(18)("meta"),isObject=__webpack_require__(4),has=__webpack_require__(10),setDesc=__webpack_require__(7).f,id=0,isExtensible=Object.isExtensible||function(){return!0},FREEZE=!__webpack_require__(5)(function(){return isExtensible(Object.preventExtensions({}))}),setMeta=function(it){setDesc(it,META,{value:{i:"O"+ ++id,w:{}}})},meta=module.exports={KEY:META,NEED:!1,fastKey:function(it,create){if(!isObject(it))return"symbol"==typeof it?it:("string"==typeof it?"S":"P")+it;if(!has(it,META)){if(!isExtensible(it))return"F";if(!create)return"E";setMeta(it)}return it[META].i},getWeak:function(it,create){if(!has(it,META)){if(!isExtensible(it))return!0;if(!create)return!1;setMeta(it)}return it[META].w},onFreeze:function(it){return FREEZE&&meta.NEED&&isExtensible(it)&&!has(it,META)&&setMeta(it),it}}},function(module,exports,__webpack_require__){var getKeys=__webpack_require__(15),gOPS=__webpack_require__(42),pIE=__webpack_require__(27);module.exports=function(it){var result=getKeys(it),getSymbols=gOPS.f;if(getSymbols)for(var key,symbols=getSymbols(it),isEnum=pIE.f,i=0;symbols.length>i;)isEnum.call(it,key=symbols[i++])&&result.push(key);return result}},function(module,exports,__webpack_require__){var toIObject=__webpack_require__(16),gOPN=__webpack_require__(67).f,toString={}.toString,windowNames="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];module.exports.f=function(it){return windowNames&&"[object Window]"==toString.call(it)?function(it){try{return gOPN(it)}catch(e){return windowNames.slice()}}(it):gOPN(toIObject(it))}},function(module,exports,__webpack_require__){"use strict";var isRegExp=__webpack_require__(115),anObject=__webpack_require__(3),speciesConstructor=__webpack_require__(55),advanceStringIndex=__webpack_require__(116),toLength=__webpack_require__(26),callRegExpExec=__webpack_require__(117),regexpExec=__webpack_require__(47),fails=__webpack_require__(5),$min=Math.min,$push=[].push,SUPPORTS_Y=!fails(function(){RegExp(4294967295,"y")});__webpack_require__(118)("split",2,function(defined,SPLIT,$split,maybeCallNative){var internalSplit;return internalSplit="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||1<".".split(/()()/).length||"".split(/.?/).length?function(separator,limit){var string=String(this);if(void 0===separator&&0===limit)return[];if(!isRegExp(separator))return $split.call(string,separator,limit);for(var match,lastIndex,lastLength,output=[],flags=(separator.ignoreCase?"i":"")+(separator.multiline?"m":"")+(separator.unicode?"u":"")+(separator.sticky?"y":""),lastLastIndex=0,splitLimit=void 0===limit?4294967295:limit>>>0,separatorCopy=new RegExp(separator.source,flags+"g");(match=regexpExec.call(separatorCopy,string))&&!(lastLastIndex<(lastIndex=separatorCopy.lastIndex)&&(output.push(string.slice(lastLastIndex,match.index)),1<match.length&&match.index<string.length&&$push.apply(output,match.slice(1)),lastLength=match[0].length,lastLastIndex=lastIndex,output.length>=splitLimit));)separatorCopy.lastIndex===match.index&&separatorCopy.lastIndex++;return lastLastIndex===string.length?!lastLength&&separatorCopy.test("")||output.push(""):output.push(string.slice(lastLastIndex)),output.length>splitLimit?output.slice(0,splitLimit):output}:"0".split(void 0,0).length?function(separator,limit){return void 0===separator&&0===limit?[]:$split.call(this,separator,limit)}:$split,[function(separator,limit){var O=defined(this),splitter=null==separator?void 0:separator[SPLIT];return void 0!==splitter?splitter.call(separator,O,limit):internalSplit.call(String(O),separator,limit)},function(regexp,limit){var res=maybeCallNative(internalSplit,regexp,this,limit,internalSplit!==$split);if(res.done)return res.value;var rx=anObject(regexp),S=String(this),C=speciesConstructor(rx,RegExp),unicodeMatching=rx.unicode,flags=(rx.ignoreCase?"i":"")+(rx.multiline?"m":"")+(rx.unicode?"u":"")+(SUPPORTS_Y?"y":"g"),splitter=new C(SUPPORTS_Y?rx:"^(?:"+rx.source+")",flags),lim=void 0===limit?4294967295:limit>>>0;if(0===lim)return[];if(0===S.length)return null===callRegExpExec(splitter,S)?[S]:[];for(var p=0,q=0,A=[];q<S.length;){splitter.lastIndex=SUPPORTS_Y?q:0;var e,z=callRegExpExec(splitter,SUPPORTS_Y?S:S.slice(q));if(null===z||(e=$min(toLength(splitter.lastIndex+(SUPPORTS_Y?0:q)),S.length))===p)q=advanceStringIndex(S,q,unicodeMatching);else{if(A.push(S.slice(p,q)),A.length===lim)return A;for(var i=1;i<=z.length-1;i++)if(A.push(z[i]),A.length===lim)return A;q=p=e}}return A.push(S.slice(p)),A}]})},function(module,exports,__webpack_require__){var isObject=__webpack_require__(4),cof=__webpack_require__(14),MATCH=__webpack_require__(0)("match");module.exports=function(it){var isRegExp;return isObject(it)&&(void 0!==(isRegExp=it[MATCH])?!!isRegExp:"RegExp"==cof(it))}},function(module,exports,__webpack_require__){"use strict";var at=__webpack_require__(62)(!0);module.exports=function(S,index,unicode){return index+(unicode?at(S,index).length:1)}},function(module,exports,__webpack_require__){"use strict";var classof=__webpack_require__(43),builtinExec=RegExp.prototype.exec;module.exports=function(R,S){var exec=R.exec;if("function"==typeof exec){var result=exec.call(R,S);if("object"!=typeof result)throw new TypeError("RegExp exec method returned something other than an Object or null");return result}if("RegExp"!==classof(R))throw new TypeError("RegExp#exec called on incompatible receiver");return builtinExec.call(R,S)}},function(module,exports,__webpack_require__){"use strict";__webpack_require__(119);var redefine=__webpack_require__(9),hide=__webpack_require__(8),fails=__webpack_require__(5),defined=__webpack_require__(25),wks=__webpack_require__(0),regexpExec=__webpack_require__(47),SPECIES=wks("species"),REPLACE_SUPPORTS_NAMED_GROUPS=!fails(function(){var re=/./;return re.exec=function(){var result=[];return result.groups={a:"7"},result},"7"!=="".replace(re,"$<a>")}),SPLIT_WORKS_WITH_OVERWRITTEN_EXEC=function(){var re=/(?:)/,originalExec=re.exec;re.exec=function(){return originalExec.apply(this,arguments)};var result="ab".split(re);return 2===result.length&&"a"===result[0]&&"b"===result[1]}();module.exports=function(KEY,length,exec){var SYMBOL=wks(KEY),DELEGATES_TO_SYMBOL=!fails(function(){var O={};return O[SYMBOL]=function(){return 7},7!=""[KEY](O)}),DELEGATES_TO_EXEC=DELEGATES_TO_SYMBOL?!fails(function(){var execCalled=!1,re=/a/;return re.exec=function(){return execCalled=!0,null},"split"===KEY&&(re.constructor={},re.constructor[SPECIES]=function(){return re}),re[SYMBOL](""),!execCalled}):void 0;if(!DELEGATES_TO_SYMBOL||!DELEGATES_TO_EXEC||"replace"===KEY&&!REPLACE_SUPPORTS_NAMED_GROUPS||"split"===KEY&&!SPLIT_WORKS_WITH_OVERWRITTEN_EXEC){var nativeRegExpMethod=/./[SYMBOL],fns=exec(defined,SYMBOL,""[KEY],function(nativeMethod,regexp,str,arg2,forceStringMethod){return regexp.exec===regexpExec?DELEGATES_TO_SYMBOL&&!forceStringMethod?{done:!0,value:nativeRegExpMethod.call(regexp,str,arg2)}:{done:!0,value:nativeMethod.call(str,regexp,arg2)}:{done:!1}}),strfn=fns[0],rxfn=fns[1];redefine(String.prototype,KEY,strfn),hide(RegExp.prototype,SYMBOL,2==length?function(string,arg){return rxfn.call(string,this,arg)}:function(string){return rxfn.call(string,this)})}}},function(module,exports,__webpack_require__){"use strict";var regexpExec=__webpack_require__(47);__webpack_require__(1)({target:"RegExp",proto:!0,forced:regexpExec!==/./.exec},{exec:regexpExec})},function(module,exports,__webpack_require__){module.exports=function(){"use strict";function quickselectStep(arr,k,left,right,compare){for(;left<right;){if(600<right-left){var n=right-left+1,m=k-left+1,z=Math.log(n),s=.5*Math.exp(2*z/3),sd=.5*Math.sqrt(z*s*(n-s)/n)*(m-n/2<0?-1:1),newLeft=Math.max(left,Math.floor(k-m*s/n+sd)),newRight=Math.min(right,Math.floor(k+(n-m)*s/n+sd));quickselectStep(arr,k,newLeft,newRight,compare)}var t=arr[k],i=left,j=right;for(swap(arr,left,k),0<compare(arr[right],t)&&swap(arr,left,right);i<j;){for(swap(arr,i,j),i++,j--;compare(arr[i],t)<0;)i++;for(;0<compare(arr[j],t);)j--}0===compare(arr[left],t)?swap(arr,left,j):swap(arr,++j,right),j<=k&&(left=j+1),k<=j&&(right=j-1)}}function swap(arr,i,j){var tmp=arr[i];arr[i]=arr[j],arr[j]=tmp}function defaultCompare(a,b){return a<b?-1:b<a?1:0}return function(arr,k,left,right,compare){quickselectStep(arr,k,left||0,right||arr.length-1,compare||defaultCompare)}}()},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__(30),__webpack_require__(31),__webpack_require__(41),__webpack_require__(69),__webpack_require__(70),__webpack_require__(123);var _class,_jpmorganchase_perspective_viewer_cjs_js_utils__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(71),_less_plugin_less__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(72),_less_plugin_less__WEBPACK_IMPORTED_MODULE_7___default=__webpack_require__.n(_less_plugin_less__WEBPACK_IMPORTED_MODULE_7__),_package_json__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(21);function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _possibleConstructorReturn(self,call){return!call||"object"!==_typeof(call)&&"function"!=typeof call?function(self){if(void 0!==self)return self;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(self):call}function _getPrototypeOf(o){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function _setPrototypeOf(o,p){return(_setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}function _CustomElement(){return Reflect.construct(HTMLElement,[],this.__proto__.constructor)}Object.setPrototypeOf(_CustomElement.prototype,HTMLElement.prototype),Object.setPrototypeOf(_CustomElement,HTMLElement);var template='<template id="'.concat(_package_json__WEBPACK_IMPORTED_MODULE_8__.a,'"><div id="container"></div></template>');Object(_jpmorganchase_perspective_viewer_cjs_js_utils__WEBPACK_IMPORTED_MODULE_6__.bindTemplate)(template,_less_plugin_less__WEBPACK_IMPORTED_MODULE_7___default.a)(_class=function(_CustomElement2){function TemplateElement(){var _this;return function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,TemplateElement),(_this=_possibleConstructorReturn(this,_getPrototypeOf(TemplateElement).call(this)))._settings={},_this}var Constructor,protoProps,staticProps;return function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&_setPrototypeOf(subClass,superClass)}(TemplateElement,_CustomElement),Constructor=TemplateElement,(protoProps=[{key:"connectedCallback",value:function(){this._container=this.shadowRoot.querySelector("#container")}},{key:"render",value:function(view,config){view(this._container,config,this._settings)}},{key:"resize",value:function(){}},{key:"getSettings",value:function(){return this._settings}},{key:"setSettings",value:function(settings){this._settings=settings||{}}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),TemplateElement}())},function(module,exports,__webpack_require__){var isObject=__webpack_require__(4),anObject=__webpack_require__(3),check=function(O,proto){if(anObject(O),!isObject(proto)&&null!==proto)throw TypeError(proto+": can't set as prototype!")};module.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(test,buggy,set){try{(set=__webpack_require__(12)(Function.call,__webpack_require__(46).f(Object.prototype,"__proto__").set,2))(test,[]),buggy=!(test instanceof Array)}catch(e){buggy=!0}return function(O,proto){return check(O,proto),buggy?O.__proto__=proto:set(O,proto),O}}({},!1):void 0),check:check}},function(module,exports,__webpack_require__){var $export=__webpack_require__(1),create=__webpack_require__(29),aFunction=__webpack_require__(13),anObject=__webpack_require__(3),isObject=__webpack_require__(4),fails=__webpack_require__(5),bind=__webpack_require__(124),rConstruct=(__webpack_require__(2).Reflect||{}).construct,NEW_TARGET_BUG=fails(function(){function F(){}return!(rConstruct(function(){},[],F)instanceof F)}),ARGS_BUG=!fails(function(){rConstruct(function(){})});$export($export.S+$export.F*(NEW_TARGET_BUG||ARGS_BUG),"Reflect",{construct:function(Target,args){aFunction(Target),anObject(args);var newTarget=arguments.length<3?Target:aFunction(arguments[2]);if(ARGS_BUG&&!NEW_TARGET_BUG)return rConstruct(Target,args,newTarget);if(Target==newTarget){switch(args.length){case 0:return new Target;case 1:return new Target(args[0]);case 2:return new Target(args[0],args[1]);case 3:return new Target(args[0],args[1],args[2]);case 4:return new Target(args[0],args[1],args[2],args[3])}var $args=[null];return $args.push.apply($args,args),new(bind.apply(Target,$args))}var proto=newTarget.prototype,instance=create(isObject(proto)?proto:Object.prototype),result=Function.apply.call(Target,instance,args);return isObject(result)?result:instance}})},function(module,exports,__webpack_require__){"use strict";var aFunction=__webpack_require__(13),isObject=__webpack_require__(4),invoke=__webpack_require__(57),arraySlice=[].slice,factories={};module.exports=Function.bind||function(that){var fn=aFunction(this),partArgs=arraySlice.call(arguments,1),bound=function(){var args=partArgs.concat(arraySlice.call(arguments));return this instanceof bound?function(F,len,args){if(!(len in factories)){for(var n=[],i=0;i<len;i++)n[i]="a["+i+"]";factories[len]=Function("F,a","return new F("+n.join(",")+")")}return factories[len](F,args)}(fn,args.length,args):invoke(fn,args,that)};return isObject(fn.prototype)&&(bound.prototype=fn.prototype),bound}},function(module,exports,__webpack_require__){var gOPD=__webpack_require__(46),getPrototypeOf=__webpack_require__(61),has=__webpack_require__(10),$export=__webpack_require__(1),isObject=__webpack_require__(4),anObject=__webpack_require__(3);$export($export.S,"Reflect",{get:function get(target,propertyKey){var desc,proto,receiver=arguments.length<3?target:arguments[2];return anObject(target)===receiver?target[propertyKey]:(desc=gOPD.f(target,propertyKey))?has(desc,"value")?desc.value:void 0!==desc.get?desc.get.call(receiver):void 0:isObject(proto=getPrototypeOf(target))?get(proto,propertyKey,receiver):void 0}})},function(module,exports,__webpack_require__){"use strict";__webpack_require__(127);var anObject=__webpack_require__(3),$flags=__webpack_require__(48),DESCRIPTORS=__webpack_require__(6),$toString=/./.toString,define=function(fn){__webpack_require__(9)(RegExp.prototype,"toString",fn,!0)};__webpack_require__(5)(function(){return"/a/b"!=$toString.call({source:"a",flags:"b"})})?define(function(){var R=anObject(this);return"/".concat(R.source,"/","flags"in R?R.flags:!DESCRIPTORS&&R instanceof RegExp?$flags.call(R):void 0)}):"toString"!=$toString.name&&define(function(){return $toString.call(this)})},function(module,exports,__webpack_require__){__webpack_require__(6)&&"g"!=/./g.flags&&__webpack_require__(7).f(RegExp.prototype,"flags",{configurable:!0,get:__webpack_require__(48)})},function(module,exports,__webpack_require__){var DateProto=Date.prototype,$toString=DateProto.toString,getTime=DateProto.getTime;new Date(NaN)+""!="Invalid Date"&&__webpack_require__(9)(DateProto,"toString",function(){var value=getTime.call(this);return value==value?$toString.call(this):"Invalid Date"})},function(module,exports){module.exports=function(){var ua=window.navigator.userAgent,msie=ua.indexOf("MSIE ");if(0<msie)return parseInt(ua.substring(msie+5,ua.indexOf(".",msie)),10);if(0<ua.indexOf("Trident/")){var rv=ua.indexOf("rv:");return parseInt(ua.substring(rv+3,ua.indexOf(".",rv)),10)}var edge=ua.indexOf("Edge/");return 0<edge&&parseInt(ua.substring(edge+5,ua.indexOf(".",edge)),10)}},function(module,exports,__webpack_require__){"use strict";module.exports=function(useSourceMap){var list=[];return list.toString=function(){return this.map(function(item){var content=function(item,useSourceMap){var content=item[1]||"",cssMapping=item[3];if(!cssMapping)return content;if(useSourceMap&&"function"==typeof btoa){var sourceMapping=(sourceMap=cssMapping,"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(sourceMap))))+" */"),sourceURLs=cssMapping.sources.map(function(source){return"/*# sourceURL="+cssMapping.sourceRoot+source+" */"});return[content].concat(sourceURLs).concat([sourceMapping]).join("\n")}var sourceMap;return[content].join("\n")}(item,useSourceMap);return item[2]?"@media "+item[2]+"{"+content+"}":content}).join("")},list.i=function(modules,mediaQuery){"string"==typeof modules&&(modules=[[null,modules,""]]);for(var alreadyImportedModules={},i=0;i<this.length;i++){var id=this[i][0];null!=id&&(alreadyImportedModules[id]=!0)}for(i=0;i<modules.length;i++){var item=modules[i];null!=item[0]&&alreadyImportedModules[item[0]]||(mediaQuery&&!item[2]?item[2]=mediaQuery:mediaQuery&&(item[2]="("+item[2]+") and ("+mediaQuery+")"),list.push(item))}},list}},function(module,exports,__webpack_require__){}])});